<!-- TOC -->

- [おまじない](#おまじない)
  - [shebang](#shebang)
  - [Python バージョン](#python-バージョン)
- [文法](#文法)
  - [命名規則](#命名規則)
  - [予約語](#予約語)
  - [演算子](#演算子)
    - [演算子の優先順位](#演算子の優先順位)
    - [条件式(三項演算子)](#条件式三項演算子)
    - [比較演算子](#比較演算子)
      - [Null 判定](#null-判定)
        - [None との比較](#none-との比較)
        - [isNullOrEmpty](#isnullorempty)
      - [同一(is)と同値(==)](#同一isと同値)
      - [複数条件](#複数条件)
  - [変数](#変数)
    - [多重代入](#多重代入)
    - [代入式（セイウチ演算子、ウォルラス演算子）](#代入式セイウチ演算子ウォルラス演算子)
    - [変数のスコープ](#変数のスコープ)
  - [組み込み定数](#組み込み定数)
    - [False](#false)
    - [True](#true)
    - [None](#none)
    - [NotImplemented](#notimplemented)
    - [Ellipsis](#ellipsis)
    - [`__debug__`](#__debug__)
- [データ型](#データ型)
  - [データ型](#データ型-1)
    - [データ型の判定](#データ型の判定)
    - [type](#type)
    - [isinstance](#isinstance)
  - [boolean](#boolean)
  - [int](#int)
    - [数値チェック（整数）](#数値チェック整数)
      - [0 との比較（整数）](#0-との比較整数)
      - [整数文字列か判定](#整数文字列か判定)
    - [int 型と文字列型](#int-型と文字列型)
      - [int 型のフォーマット](#int-型のフォーマット)
      - [文字列型からのキャスト](#文字列型からのキャスト)
        - [漢数字のキャスト](#漢数字のキャスト)
          - [漢数字 1 文字のキャスト](#漢数字-1-文字のキャスト)
          - [漢数字 2 文字以上のキャスト](#漢数字-2-文字以上のキャスト)
          - [アラビア数字に変換してからキャスト](#アラビア数字に変換してからキャスト)
          - [kanjize パッケージを利用](#kanjize-パッケージを利用)
    - [n 進数](#n-進数)
      - [n 進数のキャスト](#n-進数のキャスト)
      - [ビット演算](#ビット演算)
        - [左シフト](#左シフト)
        - [右シフト](#右シフト)
        - [AND 演算](#and-演算)
        - [OR 演算](#or-演算)
        - [XOR 演算](#xor-演算)
      - [2 進数の補数](#2-進数の補数)
    - [四捨五入・数値の切り上げ・切り捨て](#四捨五入・数値の切り上げ・切り捨て)
    - [整数の乱数を取得する](#整数の乱数を取得する)
      - [乱数値を固定する](#乱数値を固定する)
    - [整数の計算](#整数の計算)
      - [算術演算子（整数）](#算術演算子整数)
      - [最小公倍数・最大公約数](#最小公倍数・最大公約数)
  - [float](#float)
    - [数値チェック（小数）](#数値チェック小数)
      - [0 との比較（小数）](#0-との比較小数)
      - [小数文字列か判定](#小数文字列か判定)
    - [float 型と文字列型](#float-型と文字列型)
      - [float 型のフォーマット](#float-型のフォーマット)
      - [文字列型からのキャスト](#文字列型からのキャスト-1)
    - [分数](#分数)
      - [分母の最大値を指定して近似](#分母の最大値を指定して近似)
    - [数値の指定桁数での四捨五入・切り上げ・切り捨て](#数値の指定桁数での四捨五入・切り上げ・切り捨て)
    - [絶対値（abs）](#絶対値abs)
    - [最大値・最小値（数値）](#最大値・最小値数値)
    - [平均値（数値）](#平均値数値)
      - [算術平均](#算術平均)
      - [調和平均](#調和平均)
    - [統計量](#統計量)
      - [中央値](#中央値)
      - [最頻値](#最頻値)
      - [母標準偏差](#母標準偏差)
      - [母分散](#母分散)
      - [標本標準偏差（不偏標準偏差）](#標本標準偏差不偏標準偏差)
      - [標本分散（不偏分散）](#標本分散不偏分散)
    - [小数値の乱数を取得する](#小数値の乱数を取得する)
    - [三角関数](#三角関数)
      - [円周率 π](#円周率-π)
      - [度（degree）とラジアン（rad）の変換](#度degreeとラジアンradの変換)
      - [sin、cos、tan](#sincostan)
      - [asin、acos、atan](#asinacosatan)
    - [実数の計算](#実数の計算)
      - [算術演算子（実数）](#算術演算子実数)
      - [平方根](#平方根)
      - [指数](#指数)
        - [べき乗](#べき乗)
          - [\*\*](#\)
          - [`pow()`](#pow)
          - [`math.pow()`](#mathpow)
          - [底が負値の場合](#底が負値の場合)
          - [自然対数の底（ネイピア数）のべき乗](#自然対数の底ネイピア数のべき乗)
        - [対数](#対数)
        - [自然対数（底が e）・任意の底の対数](#自然対数底が-e・任意の底の対数)
        - [底の変換公式](#底の変換公式)
        - [2 進対数（底が 2）](#2-進対数底が-2)
        - [常用対数（底が 10）](#常用対数底が-10)
        - [引数と 1 の和の自然対数](#引数と-1-の和の自然対数)
      - [階乗](#階乗)
  - [complex(虚数)](#complex虚数)
  - [datetime](#datetime)
    - [日時の比較](#日時の比較)
    - [現在日時](#現在日時)
    - [日時の各項目を取得](#日時の各項目を取得)
    - [日付の生成](#日付の生成)
      - [一定期間後の日付を生成](#一定期間後の日付を生成)
      - [日時の要素を置換](#日時の要素を置換)
        - [現在日時を取得し、特定の時刻に変更](#現在日時を取得し特定の時刻に変更)
          - [今年が閏年かどうか調べる](#今年が閏年かどうか調べる)
      - [日付のリスト](#日付のリスト)
      - [ランダムな日付を生成](#ランダムな日付を生成)
    - [指定日までの残り期間を取得](#指定日までの残り期間を取得)
    - [生年月日から年齢を取得](#生年月日から年齢を取得)
    - [タイムゾーンを考慮した datetime](#タイムゾーンを考慮した-datetime)
      - [datetime パッケージの timezone モジュールを使用する場合](#datetime-パッケージの-timezone-モジュールを使用する場合)
        - [生成](#生成)
        - [タイムゾーンを変更(変更前と同じ時刻)](#タイムゾーンを変更変更前と同じ時刻)
        - [タイムゾーンを置換(変更前と異なる時刻)](#タイムゾーンを置換変更前と異なる時刻)
      - [pytz を使用する場合](#pytz-を使用する場合)
        - [現在日時から生成](#現在日時から生成)
        - [任意の日時を生成](#任意の日時を生成)
        - [サマータイム終了時点を跨いだ日時の加算](#サマータイム終了時点を跨いだ日時の加算)
    - [datetime 型のキャスト](#datetime-型のキャスト)
      - [datetime 型と date 型・time 型](#datetime-型と-date-型・time-型)
        - [datetime 型 から date 型・time 型](#datetime-型-から-date-型・time-型)
        - [date 型・time 型 から datetime 型](#date-型・time-型-から-datetime-型)
      - [datetime 型と文字列型](#datetime-型と文字列型)
        - [datetime 型 から 文字列型](#datetime-型-から-文字列型)
          - [ロケールを指定して月・曜日を示す文字列を取得する](#ロケールを指定して月・曜日を示す文字列を取得する)
        - [文字列型 から datetime 型、date 型](#文字列型-から-datetime-型date-型)
        - [タイムゾーンを考慮した 文字列型 から datetime 型](#タイムゾーンを考慮した-文字列型-から-datetime-型)
        - [タイムゾーンを考慮した ISO 形式の 文字列型 から datetime 型](#タイムゾーンを考慮した-iso-形式の-文字列型-から-datetime-型)
        - [日付時刻の format 文字列に埋め込むディレクティブ](#日付時刻の-format-文字列に埋め込むディレクティブ)
    - [祝日判定](#祝日判定)
    - [実行時間を計測](#実行時間を計測)
      - [小数点以下がミリ秒](#小数点以下がミリ秒)
      - [ナノ秒単位](#ナノ秒単位)
      - [timeit](#timeit)
  - [str(文字列)](#str文字列)
    - [エスケープシーケンス](#エスケープシーケンス)
    - [RAW 文字列](#raw-文字列)
    - [ヒアドキュメント](#ヒアドキュメント)
      - [文字列の連結](#文字列の連結)
    - [文字列のフォーマット](#文字列のフォーマット)
      - [ゼロ埋め](#ゼロ埋め)
      - [書式指定子](#書式指定子)
      - [format 関数](#format-関数)
      - [str.format 関数](#strformat-関数)
        - [整列](#整列)
        - [小数点以下の桁数](#小数点以下の桁数)
        - [桁区切り文字](#桁区切り文字)
        - [指数表記](#指数表記)
        - [2 進数、8 進数、16 進数](#2-進数8-進数16-進数)
        - [リストの値を代入](#リストの値を代入)
        - [タプルの値を代入](#タプルの値を代入)
        - [辞書の値を代入](#辞書の値を代入)
        - [クラスの属性値を代入](#クラスの属性値を代入)
      - [f 文字列](#f-文字列)
        - [リストの値を代入](#リストの値を代入-1)
        - [タプルの値を代入](#タプルの値を代入-1)
        - [辞書の値を代入](#辞書の値を代入-1)
      - [フォーマット演算子](#フォーマット演算子)
    - [文字種チェック](#文字種チェック)
      - [数値チェック](#数値チェック)
    - [最大値・最小値（文字列）](#最大値・最小値文字列)
    - [バイト列(byte), Unicode](#バイト列byte-unicode)
      - [Python 3](#python-3)
      - [Python 2](#python-2)
      - [文字列とバイト列の変換](#文字列とバイト列の変換)
    - [区切り文字による分割](#区切り文字による分割)
      - [split の引数を指定しないと、空白文字(タブ文字、改行文字を含む)で分割される](#split-の引数を指定しないと空白文字タブ文字改行文字を含むで分割される)
      - [split で分割した後、各要素の先頭・末尾の空白文字を除去する](#split-で分割した後各要素の先頭・末尾の空白文字を除去する)
      - [正規表現で区切り文字を指定して分割](#正規表現で区切り文字を指定して分割)
    - [部分文字列](#部分文字列)
      - [1 文字ずつ処理する](#1-文字ずつ処理する)
        - [インデックスを取得](#インデックスを取得)
      - [スライスで指定](#スライスで指定)
      - [部分文字列を全パターン取得する](#部分文字列を全パターン取得する)
      - [文字列をランダムソートする](#文字列をランダムソートする)
    - [エンコード・デコード](#エンコード・デコード)
      - [Base64](#base64)
      - [URL safe な Base64](#url-safe-な-base64)
    - [検索](#検索)
      - [単純な検索](#単純な検索)
        - [前方一致](#前方一致)
        - [後方一致](#後方一致)
      - [正規表現による検索](#正規表現による検索)
        - [メタ文字](#メタ文字)
        - [フラグを利用](#フラグを利用)
        - [パターンのコンパイル](#パターンのコンパイル)
          - [コンパイルしない場合](#コンパイルしない場合)
          - [コンパイルする場合](#コンパイルする場合)
          - [パターンを文字列型変数からコンパイル](#パターンを文字列型変数からコンパイル)
        - [文字列の先頭でマッチ](#文字列の先頭でマッチ)
        - [文字列の途中でマッチ](#文字列の途中でマッチ)
          - [マッチした最初の場所](#マッチした最初の場所)
          - [文字列の途中でマッチした全ての箇所のリスト](#文字列の途中でマッチした全ての箇所のリスト)
          - [文字列の途中でマッチした全ての箇所のイテレーター](#文字列の途中でマッチした全ての箇所のイテレーター)
        - [グループ化](#グループ化)
          - [グループ番号](#グループ番号)
          - [シンボリックグループ名](#シンボリックグループ名)
        - [先読み・後読み](#先読み・後読み)
          - [先読み](#先読み)
          - [否定の先読み](#否定の先読み)
          - [後読み](#後読み)
          - [否定の後読み](#否定の後読み)
      - [文字種のフィルタリング](#文字種のフィルタリング)
        - [文字列全体が半角英数だけ含まれているか検査](#文字列全体が半角英数だけ含まれているか検査)
        - [半角カナなどが含まれていないか検査](#半角カナなどが含まれていないか検査)
        - [文字種別のパターン](#文字種別のパターン)
    - [置換](#置換)
      - [単純な置換](#単純な置換)
        - [改行文字を除去](#改行文字を除去)
        - [前後の空白文字を除去（trim）](#前後の空白文字を除去trim)
        - [大文字化・小文字化](#大文字化・小文字化)
      - [正規表現による置換](#正規表現による置換)
        - [数字のみ抽出](#数字のみ抽出)
        - [ファイル名に使用できない文字を除去](#ファイル名に使用できない文字を除去)
      - [1 文字ごとの置換](#1-文字ごとの置換)
    - [絵文字](#絵文字)
    - [ランダムな文字列の生成](#ランダムな文字列の生成)
    - [形態素解析](#形態素解析)
      - [janome による解析](#janome-による解析)
        - [NEologd 辞書を使用](#neologd-辞書を使用)
  - [リスト](#リスト)
    - [リストが空か検査](#リストが空か検査)
    - [リストを生成](#リストを生成)
      - [空のリストを生成](#空のリストを生成)
      - [初期値を指定して生成](#初期値を指定して生成)
      - [リストをコピーして生成](#リストをコピーして生成)
      - [タプルからリストを生成](#タプルからリストを生成)
      - [range()を使って連番の要素を持つリストを生成](#rangeを使って連番の要素を持つリストを生成)
        - [逆順の連番](#逆順の連番)
      - [文字列からリストを生成](#文字列からリストを生成)
    - [リストに要素を追加](#リストに要素を追加)
      - [append(末尾に追加)](#append末尾に追加)
      - [insert(添え字と要素の値を指定)](#insert添え字と要素の値を指定)
      - [スライスを使用して、別のリスト(別のイテラブルオブジェクト)の要素を指定位置に追加(連結／結合)する](#スライスを使用して別のリスト別のイテラブルオブジェクトの要素を指定位置に追加連結／結合する)
      - [別のリスト(別のイテラブルオブジェクト)の要素を末尾に追加(連結／結合)する](#別のリスト別のイテラブルオブジェクトの要素を末尾に追加連結／結合する)
      - [リストの要素を繰り返す](#リストの要素を繰り返す)
    - [リストの要素を参照](#リストの要素を参照)
      - [リストの要素の存在チェック](#リストの要素の存在チェック)
      - [リストの要素をランダム抽出](#リストの要素をランダム抽出)
      - [最大値・最小値（リスト）](#最大値・最小値リスト)
    - [リストの要素を除去](#リストの要素を除去)
    - [リストの反復処理](#リストの反復処理)
      - [インデックスを取得](#インデックスを取得-1)
      - [複数のリストを同時に繰り返す](#複数のリストを同時に繰り返す)
      - [リストの要素を連結(結合)した文字列を取得](#リストの要素を連結結合した文字列を取得)
      - [順列と組み合わせ](#順列と組み合わせ)
        - [順列](#順列)
        - [組み合わせ](#組み合わせ)
        - [重複組み合わせ](#重複組み合わせ)
        - [直積](#直積)
      - [多次元リスト](#多次元リスト)
        - [に平坦化(flatten)](#に平坦化flatten)
        - [2 次元リストを 1 次元リストに平坦化(flatten)](#2-次元リストを-1-次元リストに平坦化flatten)
        - [多次元リストを 1 次元リストに平坦化(flatten)](#多次元リストを-1-次元リストに平坦化flatten)
    - [リストをソート](#リストをソート)
      - [ソート条件を変える](#ソート条件を変える)
        - [文字数でソート](#文字数でソート)
        - [末尾の文字のアルファベット順でソート](#末尾の文字のアルファベット順でソート)
      - [リストの要素の型](#リストの要素の型)
        - [リストのリスト](#リストのリスト)
          - [リスト同士の比較方法(既定)](#リスト同士の比較方法既定)
          - [任意の要素を比較してソート](#任意の要素を比較してソート)
          - [3 次元リスト](#3次元リスト)
        - [辞書のリスト](#辞書のリスト)
        - [タプルのリスト](#タプルのリスト)
        - [セットのリスト](#セットのリスト)
    - [リストのランダム処理](#リストのランダム処理)
      - [リストから要素を 1 個ランダムに取り出す](#リストから要素を-1-個ランダムに取り出す)
      - [リストから要素を複数個ランダムに取り出す(重複あり)](#リストから要素を複数個ランダムに取り出す重複あり)
      - [リストから要素を複数個ランダムに取り出す(重複なし)](#リストから要素を複数個ランダムに取り出す重複なし)
      - [リストの要素をランダムソート(シャッフル)する](#リストの要素をランダムソートシャッフルする)
    - [リストの重複する要素](#リストの重複する要素)
      - [リストの重複する要素を除去](#リストの重複する要素を除去)
      - [リストの重複する要素を除去](#リストの重複する要素を除去-1)
      - [リストの重複する要素を除去](#リストの重複する要素を除去-2)
        - [リストが入れ子の場合](#リストが入れ子の場合)
      - [リストの重複する要素を抽出](#リストの重複する要素を抽出)
      - [リストの重複する要素を抽出](#リストの重複する要素を抽出-1)
      - [リストの重複する要素を抽出](#リストの重複する要素を抽出-2)
    - [高階関数](#高階関数)
      - [map(要素ごとに処理)](#map要素ごとに処理)
      - [filter(要素のフィルタリング)](#filter要素のフィルタリング)
      - [reduce(畳み込み／集約)](#reduce畳み込み／集約)
    - [リストの内包表記](#リストの内包表記)
      - [map(要素ごとに処理)](#map要素ごとに処理-1)
      - [filter(要素のフィルタリング)](#filter要素のフィルタリング-1)
      - [多次元リスト](#多次元リスト-1)
      - [リスト内包表記で FizzBuzz](#リスト内包表記で-fizzbuzz)
      - [リスト内包表記の入れ子](#リスト内包表記の入れ子)
  - [辞書](#辞書)
    - [辞書が空か検査](#辞書が空か検査)
    - [辞書を生成](#辞書を生成)
      - [空の辞書を生成](#空の辞書を生成)
      - [初期値を指定して生成](#初期値を指定して生成-1)
      - [辞書をコピーして生成](#辞書をコピーして生成)
        - [辞書を代入した場合](#辞書を代入した場合)
      - [リスト・タプルから生成](#リスト・タプルから生成)
        - [リストから生成](#リストから生成)
          - [連番とリストの要素から生成](#連番とリストの要素から生成)
        - [リストのリストから生成](#リストのリストから生成)
        - [2 つのリストから生成](#2-つのリストから生成)
          - [要素数の少ないリストに合わせる](#要素数の少ないリストに合わせる)
          - [要素数の多いリストに合わせる](#要素数の多いリストに合わせる)
          - [条件に合致する要素のみからなる辞書を生成(抽出)](#条件に合致する要素のみからなる辞書を生成抽出)
        - [リストのタプルから生成](#リストのタプルから生成)
        - [タプルのリストから生成](#タプルのリストから生成)
        - [文字列のリストから生成](#文字列のリストから生成)
        - [文字列のタプルから生成](#文字列のタプルから生成)
    - [辞書に要素を追加](#辞書に要素を追加)
      - [キーを指定して要素を追加](#キーを指定して要素を追加)
      - [辞書を連結(結合)](#辞書を連結結合)
      - [既存のキーと重複する場合に上書きせずにカンマ区切りで追加](#既存のキーと重複する場合に上書きせずにカンマ区切りで追加)
    - [辞書の要素を参照](#辞書の要素を参照)
      - [存在しないキーを指定した場合](#存在しないキーを指定した場合)
      - [辞書の要素の存在チェック](#辞書の要素の存在チェック)
      - [指定した値を持つキーを取得する](#指定した値を持つキーを取得する)
      - [最大値・最小値（辞書）](#最大値・最小値辞書)
        - [キーの最大値／最小値を返す](#キーの最大値／最小値を返す)
        - [値の最大値／最小値を取得する](#値の最大値／最小値を取得する)
        - [値が最大／最小の要素を取得する](#値が最大／最小の要素を取得する)
        - [値が最大／最小の要素のキーを取得する](#値が最大／最小の要素のキーを取得する)
    - [辞書の要素を除去](#辞書の要素を除去)
    - [辞書の反復処理(キー・値・インデックスを取得)](#辞書の反復処理キー・値・インデックスを取得)
      - [複数の辞書を同時に繰り返す](#複数の辞書を同時に繰り返す)
      - [タプルの要素を連結した文字列を取得](#タプルの要素を連結した文字列を取得)
      - [辞書のキーと値を交換する](#辞書のキーと値を交換する)
    - [辞書をソート](#辞書をソート)
      - [辞書のキーでソート](#辞書のキーでソート)
      - [辞書の値でソート](#辞書の値でソート)
    - [辞書の内包表記](#辞書の内包表記)
      - [文字の出現頻度を調べる](#文字の出現頻度を調べる)
      - [頭文字と単語のリストを辞書にまとめる](#頭文字と単語のリストを辞書にまとめる)
  - [順序つき辞書(OrderedDict)](#順序つき辞書ordereddict)
  - [タプル](#タプル)
    - [タプルが空か検査](#タプルが空か検査)
    - [タプルを生成](#タプルを生成)
      - [空のタプルを生成](#空のタプルを生成)
      - [初期値を指定して生成](#初期値を指定して生成-2)
      - [タプルをコピーして生成](#タプルをコピーして生成)
      - [タプルに要素を追加した新しいタプルを生成](#タプルに要素を追加した新しいタプルを生成)
      - [リストから生成](#リストから生成-1)
    - [タプルの要素を参照](#タプルの要素を参照)
      - [タプルの要素の存在チェック](#タプルの要素の存在チェック)
    - [タプルの要素を削除](#タプルの要素を削除)
    - [タプルの反復処理(インデックスを取得)](#タプルの反復処理インデックスを取得)
      - [複数のタプルを同時に繰り返す](#複数のタプルを同時に繰り返す)
      - [多重タプル](#多重タプル)
        - [平坦化(flatten)](#平坦化flatten)
          - [2 重タプルを平坦化(flatten)](#2-重タプルを平坦化flatten)
          - [多重タプルを平坦化(flatten)](#多重タプルを平坦化flatten)
      - [タプルの要素を連結した文字列を取得](#タプルの要素を連結した文字列を取得-1)
    - [シーケンス・アンパッキング](#シーケンス・アンパッキング)
    - [タプルをソート](#タプルをソート)
    - [タプルのランダム処理](#タプルのランダム処理)
      - [タプルから要素を 1 個ランダムに取り出す](#タプルから要素を-1-個ランダムに取り出す)
      - [タプルから要素を複数個ランダムに取り出す(重複あり)](#タプルから要素を複数個ランダムに取り出す重複あり)
      - [タプルから要素を複数個ランダムに取り出す(重複なし)](#タプルから要素を複数個ランダムに取り出す重複なし)
      - [タプルの要素をランダムソート(シャッフル)する](#タプルの要素をランダムソートシャッフルする)
    - [タプルの内包表記](#タプルの内包表記)
  - [セット](#セット)
    - [セットが空か判定](#セットが空か判定)
    - [セットを生成](#セットを生成)
      - [空のセットを生成](#空のセットを生成)
      - [初期値を指定して生成](#初期値を指定して生成-3)
      - [リストから生成](#リストから生成-2)
    - [辞書に要素を追加](#辞書に要素を追加-1)
    - [セットの要素を参照](#セットの要素を参照)
      - [セットの要素の存在チェック](#セットの要素の存在チェック)
    - [セットの演算](#セットの演算)
- [制御構文](#制御構文)
  - [条件分岐](#条件分岐)
    - [if](#if)
    - [条件演算子(三項演算子)](#条件演算子三項演算子)
  - [繰り返し](#繰り返し)
    - [for](#for)
      - [for 文の else 節](#for-文の-else-節)
      - [途中でループから脱出(break)](#途中でループから脱出break)
      - [スキップする(continue)](#スキップするcontinue)
      - [ループ回数を与える場合](#ループ回数を与える場合)
      - [文字列型を与える場合](#文字列型を与える場合)
      - [ファイルオブジェクトを場合](#ファイルオブジェクトを場合)
      - [複数リストの直積を取得](#複数リストの直積を取得)
    - [while](#while)
  - [例外処理](#例外処理)
  - [try](#try)
    - [例外を発生させる](#例外を発生させる)
    - [assert(アサーション)](#assertアサーション)
  - [評価](#評価)
    - [eval](#eval)
    - [exec](#exec)
      - [グローバル名前空間の参照・変更を制限](#グローバル名前空間の参照・変更を制限)
  - [del](#del)
  - [exit](#exit)
  - [pass](#pass)
  - [with](#with)
    - [複数の with をまとめる](#複数の-with-をまとめる)
- [関数](#関数)
  - [引数なし](#引数なし)
  - [引数あり](#引数あり)
  - [既定値を持つ引数あり](#既定値を持つ引数あり)
  - [戻り値あり](#戻り値あり)
  - [docstring あり](#docstring-あり)
  - [引数のアンパック](#引数のアンパック)
  - [リストやタプルを受け取る](#リストやタプルを受け取る)
  - [辞書を受け取る](#辞書を受け取る)
  - [関数オブジェクト](#関数オブジェクト)
    - [関数を変数に代入](#関数を変数に代入)
- [I/O](#io)
  - [コマンドライン引数](#コマンドライン引数)
  - [標準入力](#標準入力)
    - [無限ループをキー入力で抜ける](#無限ループをキー入力で抜ける)
    - [入力フォーマット別標準入力結果の抽出方法](#入力フォーマット別標準入力結果の抽出方法)
      - [sys.stdin.readline](#sysstdinreadline)
      - [1 行 1 列](#1-行-1-列)
      - [1 行 2 列](#1-行-2-列)
      - [1 行 n 列](#1-行-n-列)
      - [n 行 1 列](#n-行-1-列)
      - [n 行 2 列](#n-行-2-列)
      - [n 行 m 列（列ごとのリスト）](#n-行-m-列列ごとのリスト)
      - [n 行 m 列（2 次元配列）](#n-行-m-列2-次元配列)
  - [標準出力](#標準出力)
    - [追記（／改行して追記）ではなく、直前の内容を上書き更新しながら出力](#追記／改行して追記ではなく直前の内容を上書き更新しながら出力)
    - [末尾に改行文字をつけずに出力する](#末尾に改行文字をつけずに出力する)
    - [pprint()でデータ出力の整然化](#pprintでデータ出力の整然化)
    - [標準出力の内容をファイルに書き出す](#標準出力の内容をファイルに書き出す)
      - [stdout](#stdout)
      - [print()](#print)
    - [プログレスバーを表示](#プログレスバーを表示)
      - [イテラブルなオブジェクトを指定](#イテラブルなオブジェクトを指定)
      - [全量と割合を指定](#全量と割合を指定)
  - [環境変数](#環境変数)
    - [環境変数の読み出し](#環境変数の読み出し)
      - [一覧の取得](#一覧の取得)
      - [環境変数の存在チェック](#環境変数の存在チェック)
      - [キーを指定して値を取得](#キーを指定して値を取得)
    - [環境変数の書き込み](#環境変数の書き込み)
    - [環境変数の削除](#環境変数の削除)
    - [.env ファイルに記述した設定値を環境変数に設定](#env-ファイルに記述した設定値を環境変数に設定)
  - [ハッシュ](#ハッシュ)
    - [文字列からハッシュを取得](#文字列からハッシュを取得)
      - [巨大なデータのハッシュを取得](#巨大なデータのハッシュを取得)
    - [ファイルのハッシュを取得](#ファイルのハッシュを取得)
      - [巨大なファイルのハッシュを取得](#巨大なファイルのハッシュを取得)
  - [pathlib でのファイル操作](#pathlib-でのファイル操作)
  - [ローカルファイル](#ローカルファイル)
    - [パス文字列の操作](#パス文字列の操作)
      - [複数のパスが同一のファイルを示しているか検査](#複数のパスが同一のファイルを示しているか検査)
      - [パス文字列を正規化する](#パス文字列を正規化する)
      - [ホームディレクトリのパスを取得](#ホームディレクトリのパスを取得)
      - [環境変数を取得](#環境変数を取得)
      - [親ディレクトリのパスを取得](#親ディレクトリのパスを取得)
      - [シンボリックリンクのパスを正規化](#シンボリックリンクのパスを正規化)
      - [Linux 上で Windows 形式のパスを操作](#linux-上で-windows-形式のパスを操作)
    - [カレントディレクトリ](#カレントディレクトリ)
      - [スクリプトファイルのパスを取得](#スクリプトファイルのパスを取得)
    - [ファイル・フォルダを存在チェック](#ファイル・フォルダを存在チェック)
    - [ファイル・フォルダの一覧を取得](#ファイル・フォルダの一覧を取得)
      - [Python3.4 以前で、再帰的にファイル・フォルダ一覧を取得](#python34-以前で再帰的にファイル・フォルダ一覧を取得)
    - [ファイル情報を取得](#ファイル情報を取得)
    - [ファイルを作成](#ファイルを作成)
      - [touch()](#touch)
      - [既存のファイルがある場合はバックアップを作成して再作成](#既存のファイルがある場合はバックアップを作成して再作成)
    - [フォルダを作成](#フォルダを作成)
      - [既存のフォルダがある場合にエラーとしない](#既存のフォルダがある場合にエラーとしない)
      - [既存のフォルダがある場合はバックアップを作成して再作成](#既存のフォルダがある場合はバックアップを作成して再作成)
    - [ファイル・フォルダをコピー](#ファイル・フォルダをコピー)
      - [ディレクトリツリーをコピー(copytree)](#ディレクトリツリーをコピーcopytree)
      - [ファイル形式のオブジェクトをコピー(copyfileobj)](#ファイル形式のオブジェクトをコピーcopyfileobj)
    - [ファイル・フォルダをリネーム](#ファイル・フォルダをリネーム)
      - [os.rename](#osrename)
      - [shutil.move](#shutilmove)
    - [ファイルを削除](#ファイルを削除)
      - [特定のファイルを削除](#特定のファイルを削除)
      - [ファイルを検索して削除](#ファイルを検索して削除)
    - [フォルダを削除](#フォルダを削除)
    - [タイプ別のファイル読み書き](#タイプ別のファイル読み書き)
      - [テキストファイル](#テキストファイル)
        - [モード](#モード)
        - [文字コードの推測](#文字コードの推測)
          - [エラーハンドラ](#エラーハンドラ)
          - [cChardet モジュールを使用](#cchardet-モジュールを使用)
        - [読み込み](#読み込み)
          - [単一の文字列として読み込み(r: 読み取り)](#単一の文字列として読み込みr-読み取り)
          - [# SHIFT-JIS](#-shift-jis)
          - [# UTF-8 BOM なし](#-utf-8-bom-なし)
          - [# UTF-8 BOM あり](#-utf-8-bom-あり)
          - [1 行ずつ読み込み(r: 読み取り)](#1-行ずつ読み込みr-読み取り)
          - [リストへ格納(r: 読み取り)](#リストへ格納r-読み取り)
        - [書き込み](#書き込み)
          - [単一の文字列として書き込み(x: 新規作成)](#単一の文字列として書き込みx-新規作成)
          - [リストを書き込み(x: 新規作成)](#リストを書き込みx-新規作成)
          - [単一の文字列として書き込み(w: 新規作成／上書き)](#単一の文字列として書き込みw-新規作成／上書き)
          - [既存ファイルが存在するときに上書きするか確認する](#既存ファイルが存在するときに上書きするか確認する)
          - [リストを書き込み(w: 新規作成／上書き)](#リストを書き込みw-新規作成／上書き)
          - [単一の文字列として書き込み(a: 追記)](#単一の文字列として書き込みa-追記)
          - [リストを書き込み(a: 追記)](#リストを書き込みa-追記)
      - [csv ファイル](#csv-ファイル)
        - [読み込み](#読み込み-1)
          - [リストに格納(csv.reader)](#リストに格納csvreader)
          - [辞書に格納(csv.DictReader)](#辞書に格納csvdictreader)
          - [メモリ上の csv 文字列の読み込み](#メモリ上の-csv-文字列の読み込み)
        - [書き込み](#書き込み-1)
          - [上書き(mode:w)](#上書きmodew)
          - [追記(mode:a)](#追記modea)
      - [tsv ファイル](#tsv-ファイル) - [メモリ上の tsv 文字列の読み込み](#メモリ上の-tsv-文字列の読み込み)
      - [json ファイル](#json-ファイル)
        - [スクリプトを書かず、json.tool で解析する](#スクリプトを書かずjsontool-で解析する)
        - [読み込み](#読み込み-2)
        - [ファイルから読み込み](#ファイルから読み込み)
        - [文字列から読み込み](#文字列から読み込み)
        - [文字列から読み込み(順序を保つ)](#文字列から読み込み順序を保つ)
        - [要素の読み込み](#要素の読み込み)
          - [要素の検索](#要素の検索)
        - [要素の追加](#要素の追加)
        - [要素の置換](#要素の置換)
        - [要素の削除](#要素の削除)
        - [ファイルに書き込み](#ファイルに書き込み)
        - [ファイルに書き込み](#ファイルに書き込み-1)
        - [文字列として出力](#文字列として出力)
        - [datetime 型を出力する](#datetime-型を出力する)
      - [XML ファイル](#xml-ファイル)
        - [ファイルから一括読み込み](#ファイルから一括読み込み)
        - [ファイルから逐次的に読み込み](#ファイルから逐次的に読み込み)
        - [文字列から読み込み](#文字列から読み込み-1)
        - [書き込み](#書き込み-2)
        - [XML 文字列を JSON 文字列に変換](#xml-文字列を-json-文字列に変換)
      - [ARFF ファイル](#arff-ファイル)
        - [読み込み](#読み込み-3)
        - [書き込み](#書き込み-3)
      - [ini ファイル](#ini-ファイル)
      - [Markdown ファイル](#markdown-ファイル)
        - [ファイル入出力](#ファイル入出力)
      - [ログファイル(テキストファイル・追記)](#ログファイルテキストファイル・追記)
      - [zip ファイル](#zip-ファイル)
        - [zip ファイル圧縮](#zip-ファイル圧縮)
          - [shutil を使ってフォルダごと圧縮](#shutil-を使ってフォルダごと圧縮)
          - [個別にファイルを追加して圧縮ファイルを作成](#個別にファイルを追加して圧縮ファイルを作成)
        - [zip ファイル解凍](#zip-ファイル解凍)
        - [MS Office ファイル](#ms-office-ファイル)
        - [Excel ファイル](#excel-ファイル)
          - [書き出し](#書き出し)
          - [読み込み](#読み込み-4)
      - [PDF ファイル](#pdf-ファイル) - [読み込み](#読み込み-5)
  - [テストデータ生成](#テストデータ生成)
    - [Faker](#faker)
      - [基本](#基本)
      - [address](#address)
      - [automotive](#automotive)
      - [bank](#bank)
      - [barcode](#barcode)
      - [color](#color)
      - [company](#company)
      - [credit_card](#credit_card)
      - [currency](#currency)
      - [date_time](#date_time)
      - [file](#file)
      - [geo](#geo)
      - [internet](#internet)
      - [isbn](#isbn)
      - [job](#job)
      - [lorem](#lorem)
      - [misc](#misc)
      - [person](#person)
      - [phone_number](#phone_number)
      - [profile](#profile)
      - [python](#python)
      - [ssn](#ssn)
      - [user_agent](#user_agent)
  - [暗号](#暗号)
    - [AES による暗号化・復号化](#aes-による暗号化・復号化)
    - [06-300-5000-多要素認証（OTP）](#06-300-5000-多要素認証otp)
  - [ネットワーク](#ネットワーク)
    - [URL 文字列の操作](#url-文字列の操作)
      - [URL エンコーディング](#url-エンコーディング)
        - [変換対象の文字の違いと利用する関数](#変換対象の文字の違いと利用する関数)
        - [URL の一部の要素に日本語が含まれている場合](#url-の一部の要素に日本語が含まれている場合)
      - [URL 文字列のパース](#url-文字列のパース)
      - [URL 文字列の組み立て](#url-文字列の組み立て)
    - [リクエストを送信](#リクエストを送信)
      - [コンテンツを文字列として取得](#コンテンツを文字列として取得)
      - [文字コードを指定](#文字コードを指定)
        - [特定の文字コード(Shift-JIS)を指定](#特定の文字コードshift-jisを指定)
        - [コンテンツの内容から文字コードを推定する](#コンテンツの内容から文字コードを推定する)
          - [chardet による推定](#chardet-による推定)
          - [cChardet による推定(chardet よりも高速)](#cchardet-による推定chardet-よりも高速)
      - [コンテンツをテンポラリファイルとして取得](#コンテンツをテンポラリファイルとして取得)
      - [バイナリファイルを保存](#バイナリファイルを保存)
        - [画像ファイルの保存](#画像ファイルの保存)
        - [大容量ファイルの保存](#大容量ファイルの保存)
      - [GET](#get)
      - [POST](#post)
        - [フォーム送信(Multipart エンコード)](#フォーム送信multipart-エンコード)
      - [PUT](#put)
      - [DELETE](#delete)
      - [HEAD](#head)
      - [HTTP ヘッダ](#http-ヘッダ)
      - [BASIC 認証](#basic-認証)
      - [応答ヘッダ・リダイレクト先 URL](#応答ヘッダ・リダイレクト先-url)
      - [セッション](#セッション)
      - [Cookie](#cookie)
      - [例外処理とレスポンスコード](#例外処理とレスポンスコード)
    - [Selenium](#selenium)
      - [Selenium の準備](#selenium-の準備)
        - [パスを指定](#パスを指定)
        - [Webdriver Manager for Python](#webdriver-manager-for-python)
          - [Chrome](#chrome)
          - [Chromium](#chromium)
          - [Firefox](#firefox)
        - [webdrivermanager](#webdrivermanager)
          - [Chrome](#chrome-1)
          - [Firefox](#firefox-1)
      - [Web ページにアクセス](#web-ページにアクセス)
- [クラス](#クラス)
  - [オブジェクトの文字列表現](#オブジェクトの文字列表現)
  - [オブジェクトの属性の参照と存在チェック](#オブジェクトの属性の参照と存在チェック)
  - [クラスの継承](#クラスの継承)
    - [多重継承](#多重継承)
- [モジュール](#モジュール)
  - [モジュールの読み込み](#モジュールの読み込み)
    - [推奨される読み込み順序](#推奨される読み込み順序)
  - [外部スクリプトの読み込み](#外部スクリプトの読み込み)
  - [一時的にモジュール検索パスを追加](#一時的にモジュール検索パスを追加)
  - [恒久的にモジュール検索パスを追加](#恒久的にモジュール検索パスを追加)
  - [pip](#pip)
    - [パッケージのインストール](#パッケージのインストール)
      - [pip 自体のアップデート](#pip-自体のアップデート)
      - [requirements.txt を基にしたインストール](#requirementstxt-を基にしたインストール)
      - [特定のバージョンのインストール](#特定のバージョンのインストール)
      - [requirements.txt の書き出し](#requirementstxt-の書き出し)
        - [requirements.txt に書かれたパッケージのバージョンを更新](#requirementstxt-に書かれたパッケージのバージョンを更新)
    - [パッケージのアンインストール](#パッケージのアンインストール)
- [pydoc](#pydoc)
- [mypy による型チェック](#mypy-による型チェック)
  - [型の宣言](#型の宣言)
  - [イミュータブルな型](#イミュータブルな型)
  - [ミュータブルな型](#ミュータブルな型)
  - [複数の型](#複数の型)
  - [None を許容する](#none-を許容する)
  - [再代入しない変数（final）](#再代入しない変数final)
  - [def](#def)
  - [Class](#class)
- [画像処理](#画像処理)
  - [Pillow（PIL）](#pillowpil)
    - [Pillow のインストール](#pillow-のインストール)
    - [画像の生成](#画像の生成)
      - [ノイズ画像の生成](#ノイズ画像の生成)
        - [ガウシアンノイズ](#ガウシアンノイズ)
    - [画像の読み込み](#画像の読み込み)
      - [ヒストグラムの取得](#ヒストグラムの取得)
    - [画像の書き出し](#画像の書き出し)
      - [Base64 にエンコードして書き出す](#base64-にエンコードして書き出す)
    - [画素ごとの操作](#画素ごとの操作)
      - [画素値の取得](#画素値の取得)
      - [画素ごとにコピー](#画素ごとにコピー)
      - [グレースケール（画素ごと）](#グレースケール画素ごと)
        - [単純平均（画素ごと）](#単純平均画素ごと)
        - [NTSC 加重平均法（画素ごと）](#ntsc-加重平均法画素ごと)
        - [中間値法（画素ごと）](#中間値法画素ごと)
      - [画素ごとにネガポジ反転](#画素ごとにネガポジ反転)
      - [ぼかし処理（画素ごと）](#ぼかし処理画素ごと)
        - [平均化フィルター（画素ごと）](#平均化フィルター画素ごと)
        - [ガウシアンフィルター（画素ごと）](#ガウシアンフィルター画素ごと)
      - [ノイズ付加](#ノイズ付加)
        - [ごま塩ノイズ](#ごま塩ノイズ)
      - [色を透明度にする（画素ごと）](#色を透明度にする画素ごと)
    - [画像のリサイズ](#画像のリサイズ)
      - [サムネイル画像の生成](#サムネイル画像の生成)
      - [複数画像の一括リサイズ](#複数画像の一括リサイズ)
      - [余白を付けてリサイズ](#余白を付けてリサイズ)
        - [余白のサイズを指定](#余白のサイズを指定)
        - [リサイズ後のサイズを指定](#リサイズ後のサイズを指定)
        - [正方形にする](#正方形にする)
      - [モザイク](#モザイク)
    - [画像のトリミング](#画像のトリミング)
    - [画像の反転](#画像の反転)
    - [画像の回転](#画像の回転)
    - [色の変換](#色の変換)
      - [色空間の変換](#色空間の変換)
        - [グレースケール](#グレースケール)
        - [HSV 色空間](#hsv-色空間)
        - [CIELAB 色空間](#cielab-色空間)
    - [画素値の置換](#画素値の置換)
      - [フィルター処理](#フィルター処理)
    - [画像の合成](#画像の合成)
      - [画像の貼り付け](#画像の貼り付け)
        - [単純に貼り付け](#単純に貼り付け)
        - [マスク画像を使用して貼り付け](#マスク画像を使用して貼り付け)
      - [画像に文字を合成](#画像に文字を合成)
        - [利用できるフォントの一覧を取得](#利用できるフォントの一覧を取得)
        - [画像いっぱいに文字を描画](#画像いっぱいに文字を描画)
      - [画像に図形を描画](#画像に図形を描画)
      - [アニメーション GIF の作成](#アニメーション-gif-の作成)
- [並列処理](#並列処理)
- [exe 化](#exe-化)
- [エラーメッセージ](#エラーメッセージ)
  - [シンタックスハイライト](#シンタックスハイライト)
- [ロギング](#ロギング)
  - [ファイル出力](#ファイル出力)
  - [Python のバージョンを取得](#python-のバージョンを取得)
  - [実行時間の計測](#実行時間の計測)

<!-- /TOC -->

<a id="markdown-おまじない" name="おまじない"></a>

# おまじない

<a id="markdown-shebang" name="shebang"></a>

## shebang

```py
#!/usr/bin/env python
# -*- coding: utf-8 -*-

# #から行末まではコメント
# 1行目または2行目のコメントで、正規表現coding[=:]\s*([-\w.]+)にマッチする場合はエンコーディング宣言として扱われる
```

<a id="markdown-python-バージョン" name="python-バージョン"></a>

## Python バージョン

スクリプト内から確認する場合

```py
import platform
python_version = int(platform.python_version_tuple()[0])
```

ターミナルから確認する場合

```ps
$ python --version
```

<a id="markdown-文法" name="文法"></a>

# 文法

<a id="markdown-命名規則" name="命名規則"></a>

## 命名規則

| 項目                 | 文字種       | 区切り文字     |
| -------------------- | ------------ | -------------- |
| パッケージ           | 英数小文字   | -              |
| モジュール           | 英数小文字   | アンダースコア |
| クラス, 例外, 型変数 | 英数大小文字 | 大文字         |
| メソッド, 関数,変数  | 英数小文字   | アンダースコア |
| 定数                 | 英数大文字   | アンダースコア |

<a id="markdown-予約語" name="予約語"></a>

## 予約語

キーワードの一覧を確認する

```py
import keyword

print(len(keyword.kwlist))
print(keyword.kwlist)
```

> 35
>
> ['False', 'None', 'True', 'and', 'as', 'assert', 'async', 'await', 'break', 'class', 'continue', 'def', 'del', 'elif', 'else', 'except', 'finally', 'for', 'from', 'global', 'if', 'import', 'in', 'is', 'lambda', 'nonlocal', 'not', 'or', 'pass', 'raise', 'return', 'try', 'while', 'with', 'yield']

ある文字列がキーワードか判定する

```py
import keyword

target = keyword.kwlist[0]
print(keyword.iskeyword(target))
```

> True

<a id="markdown-演算子" name="演算子"></a>

## 演算子

<a id="markdown-演算子の優先順位" name="演算子の優先順位"></a>

### 演算子の優先順位

https://docs.python.org/ja/3/reference/expressions.html#operator-precedence

| 演算子                                       | 意味                                           |
| -------------------------------------------- | ---------------------------------------------- | ------------- |
| (1), [1], {1:1}, {1}                         | 式結合／タプル、リスト、辞書、集合             |
| l[1], l[1,2], f(arg), c.attribute            | 添え字指定、スライス、関数呼び出し、属性参照   |
| await                                        | Await 式                                       |
| \*\*                                         | べき乗                                         |
| +x, -x, ~x                                   | 数、負数、ビット単位 NOT                       |
| \*, /, //, %                                 | 乗算、除算、整除除算、剰余／文字列フォーマット |
| +, -                                         | 加算、減算                                     |
| <<, >>                                       | シフト演算                                     |
| &                                            | ビット単位 AND                                 |
| ^                                            | ビット単位 XOR                                 |
|                                              |                                                | ビット単位 OR |
| in, not in, is, is not, <, <=, >, >=, !=, == | 比較                                           |
| not x                                        | NOT                                            |
| and                                          | AND                                            |
| or                                           | OR                                             |
| if -- else                                   | 条件式(三項演算子)                             |
| lambda                                       | ラムダ式                                       |
| :=                                           | 代入式（セイウチ演算子）                       |

<a id="markdown-条件式三項演算子" name="条件式三項演算子"></a>

### 条件式(三項演算子)

```py
t = 'True'
f = 'False'
c = t if 1 == 1 else f
```

> 'True'

<a id="markdown-比較演算子" name="比較演算子"></a>

### 比較演算子

<a id="markdown-null-判定" name="null-判定"></a>

#### Null 判定

<a id="markdown-none-との比較" name="none-との比較"></a>

##### None との比較

```py
x = None

if x is None: # Nullチェック
    print('None')

if x is not None: # Nullチェック
    print('Not None')
```

> None

<a id="markdown-isnullorempty" name="isnullorempty"></a>

##### isNullOrEmpty

C#の String.IsNullOrEmpty メソッドと同様の処理を行う

```py
def isNullOrEmpty(s): # string.isNullOrEmpty()
    if s is None or s == '':
        return True
    else:
        return False

isNullOrEmpty(None)
isNullOrEmpty('')
isNullOrEmpty('a')
```

> True
>
> True
>
> False

<a id="markdown-同一isと同値" name="同一isと同値"></a>

#### 同一(is)と同値(==)

- 整数同士の比較

| 演算子 | `x = 1234567890` と `x` | `x` と `y = 1234567890` | `x` と `z = 12345678901` |
| ------ | ----------------------- | ----------------------- | ------------------------ |
| `==`   | `True`                  | `True`                  | `True`                   |
| `is`   | `True`                  | `False`                 | `False`                  |

- 文字列同士の比較

| 演算子 | `x = '1234567890'` と `x` | `x` と `y = '1234567890'` | `x` と `z = '12345678901'` |
| ------ | ------------------------- | ------------------------- | -------------------------- |
| `==`   | `True`                    | `True`                    | `True`                     |
| `is`   | `True`                    | `True`                    | `False`                    |

同一(`is`)比較で、オブジェクトが同一でなくても True が返る場合もある

```py
x = '1234567890'
print(len(x) is 10) # 同一
print(len(x) == 10) # 同値
```

> True
>
> True

<a id="markdown-複数条件" name="複数条件"></a>

#### 複数条件

複数の比較を連続して書く（チェーン）ことが可能

```py
a = 2
1 < a and a < 5
1 < a < 5
```

> True
>
> True

```py
content = 'foobarhogepiyo'

# if 'foo' in s and 'bar' in s:
if all(map(content.__contains__, ('foo', 'bar'))):
    print('found')

# if 'foo' in s or 'hoge' in s:
if any(map(content.__contains__, ('foo', 'hoge'))):
    print('found')
```

> found
>
> found

<a id="markdown-変数" name="変数"></a>

## 変数

```py
# 変数に値を代入
name = 'Suzuki'
print(name)

# 異なる型の値を代入
name = 3
print(name)

# 変数の削除
del name

print(name)
```

> Suzuki
>
> 3
>
> NameError: name 'name' is not defined

<a id="markdown-多重代入" name="多重代入"></a>

### 多重代入

```py
x = y = z = 2
print(x, y, z)
```

<a id="markdown-代入式セイウチ演算子ウォルラス演算子" name="代入式セイウチ演算子ウォルラス演算子"></a>

### 代入式（セイウチ演算子、ウォルラス演算子）

右辺の値を左辺の変数に代入しつつ、式全体の値として返す

```py
x = "abc"

if n := len(x):
    # 非0
    print(n)

if (n := len(x)) > 2:
    print(n)
```

> 3

<a id="markdown-変数のスコープ" name="変数のスコープ"></a>

### 変数のスコープ

| スコープ                         | 特徴                       | 備考                                                     |
| -------------------------------- | -------------------------- | -------------------------------------------------------- |
| ローカルスコープ                 | 関数内で定義               |                                                          |
| エンクロージングローカルスコープ | def や lambda で定義       |                                                          |
| グローバルスコープ               | モジュール内で定義         | 関数内でグローバル変数に書き込む場合は `global` 文を使用 |
| ビルトインスコープ               | 組み込み関数や組み込み変数 |                                                          |

名前が衝突しないか調べるには以下の関数を使用する

```py
'VAR_NAME' in globals()
'VAR_NAME' in locals()
```

<a id="markdown-組み込み定数" name="組み込み定数"></a>

## 組み込み定数

`None` 、 `False` 、 `True` 、 `__debug__` には再代入できない

<a id="markdown-false" name="false"></a>

### False

bool 型の偽値

<a id="markdown-true" name="true"></a>

### True

bool 型の真値

<a id="markdown-none" name="none"></a>

### None

型 NoneType の唯一の値

<a id="markdown-notimplemented" name="notimplemented"></a>

### NotImplemented

特殊な二項演算のメソッド（例: `__eq__()` , `__lt__()` , `__add__()` , `__rsub__()` など）が、他の型に対して演算が実装されていないことを示すために返す

<a id="markdown-ellipsis" name="ellipsis"></a>

### Ellipsis

```py
...

Ellipsis
```

> Ellipsis
>
> Ellipsis

<a id="markdown-__debug__" name="__debug__"></a>

### `__debug__`

Python が -O オプションを有効にして開始されたのでなければ真

<a id="markdown-データ型" name="データ型"></a>

# データ型

<a id="markdown-データ型-1" name="データ型-1"></a>

## データ型

| 組み込み型       | 変更不可    | 変更可    | 反復可     | シーケンス | マッピング |
| ---------------- | ----------- | --------- | ---------- | ---------- | ---------- |
| (built-in types) | (immutable) | (mutable) | (iterable) | (sequence) | (mapping)  |
|                  |             |           |            |            |            |
| bool             | ○           |           |            |            |            |
| int              | ○           |           |            |            |            |
| float            | ○           |           |            |            |            |
| complex          | ○           |           |            |            |            |
| str              | ○           |           | ○          | ○          |            |
| list             |             | ○         | ○          | ○          |            |
| tuple            | ○           |           | ○          | ○          |            |
| range            | ○           |           | ○          | ○          |            |
| dict             |             | ○         | ○          |            | ○          |
| set              |             | ○         | ○          |            |            |
| bytes            | ○           |           | ○          | ○          |            |
| bytearray        |             | ○         | ○          | ○          |            |
| file object      | ○           |           | ○          |            |            |

```
組み込み型
(built-in types)	変更不可
(immutable)	変更可
(mutable)	反復可
(iterable)	シーケンス
(sequence)	マッピング
(mapping)	データ
(data)
bool	◎					True,False
int	◎					整数
float	◎					浮動小数点数
complex	◎					複素数
str	◎		◎	◎		文字列
list		◎	◎	◎
tuple	◎		◎	◎
range	◎		◎	◎
dict		◎	◎		◎
set		◎	◎
bytes	◎		◎	◎		バイナリ
bytearray		◎	◎	◎
file object	◎		◎
```

<a id="markdown-データ型の判定" name="データ型の判定"></a>

### データ型の判定

type()と isinstance()がある。継承を考慮する必要があるかで使い分ける。
以下の例では、bool は int のサブクラスなので、isinstance で判定すると継承元の型にも True を返す

| 関数                      | 結果    |
| ------------------------- | ------- |
| `type(False) is bool`     | `True`  |
| `type(False) is int`      | `False` |
| `isinstance(False, bool)` | `True`  |
| `isinstance(False, int)`  | `True`  |

<a id="markdown-type" name="type"></a>

### type

| 関数                    | 結果              |
| ----------------------- | ----------------- |
| `type(True)`            | `<class 'bool'>`  |
| ----------------------- | ----------------- |
| `type(1)`               | `<class 'int'>`   |
| `type(1.23)`            | `<class 'float'>` |
| `type(int('1'))`        | `<class 'int'>`   |
| `type(float('1'))`      | `<class 'float'>` |
| `type(float('1.23'))`   | `<class 'float'>` |
| `type(0b11)` 2 進数     | `<class 'int'>`   |
| `type(0o11)` 8 進数     | `<class 'int'>`   |
| `type(0x11)` 16 進数    | `<class 'int'>`   |
| ----------------------- | ----------------- |
| `type('str')`           | `<class 'str'>`   |
| ----------------------- | ----------------- |
| `type({0:0, 1:1, 2:2})` | `<class 'dict'>`  |
| ----------------------- | ----------------- |
| `type([0, 1, 2])`       | `<class 'list'>`  |
| ----------------------- | ----------------- |
| `type({0, 1, 2})`       | `<class 'set'>`   |
| ----------------------- | ----------------- |
| `type((0, 1, 2))`       | `<class 'tuple'>` |

```py
def is_valid_isinstance(v):
    return type(v) in (int, str)

print(is_valid_isinstance(1))
print(is_valid_isinstance('1'))
print(is_valid_isinstance(1.23))
```

> True
>
> True
>
> False

<a id="markdown-isinstance" name="isinstance"></a>

### isinstance

| 関数                                | 結果    |
| ----------------------------------- | ------- |
| `isinstance(True, bool)`            | `True`  |
| ----------------------------------- | ------- |
| `isinstance(1, int)`                | `True`  |
| `isinstance(1.23, int)`             | `False` |
| `isinstance(1, float)`              | `False` |
| `isinstance(1.23, float)`           | `True`  |
| `isinstance(int('1'), int)`         | `True`  |
| `isinstance(float('1'), float)`     | `True`  |
| `isinstance(0b11, int)` 2 進数      | `True`  |
| `isinstance(0o11, int)` 8 進数      | `True`  |
| `isinstance(0x11, int)` 16 進数     | `True`  |
| ----------------------------------- | ------- |
| `isinstance('str', str)`            | `True`  |
| ----------------------------------- | ------- |
| `isinstance({0:0, 1:1, 2:2}, dict)` | `True`  |
| ----------------------------------- | ------- |
| `isinstance([0, 1, 2], list)`       | `True`  |
| ----------------------------------- | ------- |
| `isinstance({0, 1, 2}, set)`        | `True`  |
| ----------------------------------- | ------- |
| `isinstance((0, 1, 2), tuple)`      | `True`  |

<a id="markdown-boolean" name="boolean"></a>

## boolean

- False を返すオブジェクト
- - 偽であると定義されている定数: None と False
- - 数値型におけるゼロ: 0, 0.0, 0j, Decimal(0), Fraction(0, 1)
- - 空のシーケンスまたはコレクション: '', (), [], {}, set(), range(0)

```py
print(True == bool(0.))

from fractions import Fraction
print(True == Fraction(0, 1))
```

> False
>
> False

| `True`                | `False`    |
| --------------------- | ---------- |
| `bool(1)`, `bool(-3)` | `bool(0)`  |
| `bool(.1)`            | `bool(0.)` |
| `bool(1j)`            | `bool(0j)` |
| `bool('a')`           | `bool('')` |
| `bool([0])`           | `bool([])` |
| `bool((0,))`          | `bool(())` |
| `bool({0})`           | `bool({})` |

```py
print(True == 1)
print(False == 0)
print(True + False)
```

> True
>
> True
>
> 1

<a id="markdown-int" name="int"></a>

## int

Python3 では long 型はなくなり、int 型として扱う

```py
# l = 1234567890123456789012345678901234567890123456789012345678901234567890L # Python 2
l = 1234567890123456789012345678901234567890123456789012345678901234567890
```

可読性のために、アンダースコアで桁を区切ることができる

```py
i = 1_000_000_000 # アンダースコアは無視され、int型として扱われる
print(i)
print('{:,}'.format(i)) # 3桁ごとにセミコロンを入れる
```

> 1000000000
>
> 1,000,000,000

<a id="markdown-数値チェック整数" name="数値チェック整数"></a>

### 数値チェック（整数）

<a id="markdown-0-との比較整数" name="0-との比較整数"></a>

#### 0 との比較（整数）

```py
x = (-1, 0, 1, 2, 3, 4)

# bool(0) => False
# bool(-1), bool(1), bool(2) => True

for item in x:
    # if item != 0: のように、 0 と比較する必要はない
    if item:
        print(item)
```

> -1
>
> 1
>
> 2
>
> 3
>
> 4

<a id="markdown-整数文字列か判定" name="整数文字列か判定"></a>

#### 整数文字列か判定

文字列に対して数値チェック(整数)を行う

| `s`            | `s.isnumeric()`の結果 | 備考                                                                |
| -------------- | --------------------- | ------------------------------------------------------------------- |
| `'1'`          | `True`                |                                                                     |
| `'１２３'`     | `True`                | 全角数字文字列                                                      |
| `'一五一十'`   | `True`                | 全角漢数字文字列(`零 一 二 三 四 五 六 七 八 九 十 百 千 万 億 兆`) |
| `'-1.23'`      | `False`               | `-`や小数点が含まれていると `False`                                 |
| `'－１２．３'` | `False`               | `－`や小数点が含まれていると `False`                                |
| `'10,000'`     | `False`               | 桁区切りのカンマが含まれていると `False`                            |

<a id="markdown-int-型と文字列型" name="int-型と文字列型"></a>

### int 型と文字列型

<a id="markdown-int-型のフォーマット" name="int-型のフォーマット"></a>

#### int 型のフォーマット

フォーマットに利用する関数には以下の種類がある

- 組み込み関数`format()`
- `str.format()`
- f 文字列

| 種別           | 書き方                                    | 結果       |
| -------------- | ----------------------------------------- | ---------- |
| `format()`     | `format(255, '06o')`                      | `'000377'` |
| `str.format()` | `'{:06o}'.format(255)`                    | `'000377'` |
| f 文字列       | `f'right : {255:06o}'`                    | `'000377'` |
|                | `strval=255`<br>`f'right : {strval:06o}'` | `'000377'` |

詳細は[書式指定子](#書式指定子)の項を参照

<a id="markdown-文字列型からのキャスト" name="文字列型からのキャスト"></a>

#### 文字列型からのキャスト

| `s`          | `int(s)`の結果                                       | 備考                                                                                   |
| ------------ | ---------------------------------------------------- | -------------------------------------------------------------------------------------- |
| `'1'`        | `1`                                                  |                                                                                        |
| `'1.23'`     | `ValueError: invalid literal for int() with base 10` |                                                                                        |
| `'１２３'`   | `123`                                                |                                                                                        |
| `'一五一十'` | `ValueError: invalid literal for int() with base 10` | 漢数字だけしか含まれていないため `isnumeric`では `True` が返るが、キャストには失敗する |

```py
s = '10,000'
s = s.replace(',', '') # 桁区切りのカンマが含まれていると isnumeric() は False を返し、キャストにも失敗する
if s.isnumeric():
    print('数値文字列')
    i = int(s)  # 文字列型からのキャスト
    print('{}'.format(i))
```

<a id="markdown-漢数字のキャスト" name="漢数字のキャスト"></a>

##### 漢数字のキャスト

<a id="markdown-漢数字-1-文字のキャスト" name="漢数字-1-文字のキャスト"></a>

###### 漢数字 1 文字のキャスト

```py
import unicodedata

print(unicodedata.numeric('五'))
```

> 5.0

<a id="markdown-漢数字-2-文字以上のキャスト" name="漢数字-2-文字以上のキャスト"></a>

###### 漢数字 2 文字以上のキャスト

<a id="markdown-アラビア数字に変換してからキャスト" name="アラビア数字に変換してからキャスト"></a>

###### アラビア数字に変換してからキャスト

```py
import re


re_num = re.compile(r'[十拾百千万億兆\d]+')
re_units = re.compile(r'[十拾百千]|\d+')
re_unitm = re.compile(r'[万億兆]|[^万億兆]+')

TRANSUNIT = {'十': 10, '拾': 10, '百': 100, '千': 1000}
TRANSMANS = {'万': 10000, '億': 100000000, '兆': 1000000000000}


def transformNum(kstring: str, sep=False):
    def _transvalue(sj: str, re_obj=re_units, transdic=TRANSUNIT):
        unit = 1
        result = 0
        for piece in reversed(re_obj.findall(sj)):
            if piece in transdic:
                if unit > 1:
                    result += unit
                unit = transdic[piece]
            else:
                val = int(piece) if piece.isdecimal() else _transvalue(piece)
                result += val * unit
                unit = 1
        if unit > 1:
            result += unit
        return result
    transuji = kstring.translate(str.maketrans('一二三四五六七八九〇壱弐参', '1234567890123'))
    for suji in sorted(set(re_num.findall(transuji)), key=lambda s: len(s),
                           reverse=True):
        if not suji.isdecimal():
            arabic = _transvalue(suji, re_unitm, TRANSMANS)
            arabic = '{:,}'.format(arabic) if sep else str(arabic)
            transuji = transuji.replace(suji, arabic)
        elif sep and len(suji) > 3:
            transuji = transuji.replace(suji, '{:,}'.format(int(suji)))
    return transuji


int(transformNum('１億２３４万５千六百七十八'))
```

> 102345678

<a id="markdown-kanjize-パッケージを利用" name="kanjize-パッケージを利用"></a>

###### kanjize パッケージを利用

```sh
$ pip install kanjize
```

```py
from kanjize import int2kanji, kanji2int

print(kanji2int('十二億三千四十五万六千七百八十九')) # 漢数字→int
print(int2kanji(1230456789)) # int→漢数字
```

> 1230456789
>
> 十二億三千四十五万六千七百八十九

<a id="markdown-n-進数" name="n-進数"></a>

### n 進数

10 進数以外の数も、内部的には 10 進数として扱われる

| n 進数  | `i`          | 関数                        | 結果         | 備考                 |
| ------- | ------------ | --------------------------- | ------------ | -------------------- |
| 10 進数 | `123`        | `print(i)`                  | `123`        |                      |
| ------- | ------------ | --------------------------- | ------------ | -------------------- |
| 2 進数  | `0b11111111` | `print(i)`                  | `255`        | 10 進数で表示される  |
|         |              | `print(bin(i))`             | `0b11111111` | 2 進数の文字列       |
|         |              | `print(format(i, 'b'))`     | `11111111`   |                      |
|         |              | `print(format(i, '#b'))`    | `0b11111111` |                      |
|         |              | `print(format(i, '0>10b'))` | `0011111111` | 2 進数をゼロ埋め表示 |
| ------- | ------------ | --------------------------- | ------------ | -------------------- |
| 8 進数  | `0o777`      | `print(i)`                  | `511`        | 10 進数で表示される  |
|         |              | `print(oct(i))`             | `0o777`      | 8 進数の文字列       |
|         |              | `print(format(i, 'o'))`     | `777`        |                      |
|         |              | `print(format(i, '#o'))`    | `0o777`      |                      |
| ------- | ------------ | --------------------------- | ------------ | -------------------- |
| 16 進数 | `0xffff`     | `print(i)`                  | `65535`      | 10 進数で表示される  |
|         |              | `print(hex(i))`             | `0xffff`     | 16 進数の文字列      |
|         |              | `print(format(i, 'x'))`     | `ffff`       |                      |
|         |              | `print(format(i, '#x'))`    | `0xffff`     |                      |

<a id="markdown-n-進数のキャスト" name="n-進数のキャスト"></a>

#### n 進数のキャスト

接頭辞(0b, 0o, 0x)がついていれば、基数に 0 を指定しても変換される

| n 進数  | 関数                   | 結果    |
| ------- | ---------------------- | ------- |
| 2 進数  | `int('0b11111111', 2)` | `255`   |
|         | `int('0b11111111', 0)` | `255`   |
| 8 進数  | `int('0o777', 8)`      | `511`   |
|         | `int('0o777', 0)`      | `511`   |
| 16 進数 | `int('0xffff', 16)`    | `65535` |
|         | `int('0xffff', 0)`     | `65535` |

<a id="markdown-ビット演算" name="ビット演算"></a>

#### ビット演算

<a id="markdown-左シフト" name="左シフト"></a>

##### 左シフト

| 関数               | 結果          |
| ------------------ | ------------- |
| `bin(0b0101 << 0)` | &nbsp;`0b101` |
| `bin(0b0101 << 1)` | `0b1010`      |

<a id="markdown-右シフト" name="右シフト"></a>

##### 右シフト

| 関数               | 結果         |
| ------------------ | ------------ |
| `bin(0b0111 >> 0)` | `0b111`      |
| `bin(0b0111 >> 1)` | &nbsp;`0b11` |

<a id="markdown-and-演算" name="and-演算"></a>

##### AND 演算

| 関数                   | 結果       | 備考                                  |
| ---------------------- | ---------- | ------------------------------------- |
| `bin(bin(0b0 & 0b0))`  | `'0b0'`    |                                       |
| `bin(bin(0b0 & 0b1))`  | `'0b0'`    |                                       |
| `bin(bin(0b1 & 0b1))`  | `'0b1'`    |                                       |
| `bin(0b1100 & 0b1010)` | `'0b1000'` | 繰り上がりせず、各桁ごとに AND される |

<a id="markdown-or-演算" name="or-演算"></a>

##### OR 演算

| 関数         | 結果     | 備考       |
| ------------ | -------- | ---------- | ------------------------------------ |
| `bin(bin(0b0 | 0b0))`   | `'0b0'`    |                                      |
| `bin(bin(0b0 | 0b1))`   | `'0b1'`    |                                      |
| `bin(bin(0b1 | 0b1))`   | `'0b1'`    |                                      |
| `bin(0b1100  | 0b1010)` | `'0b1110'` | 繰り上がりせず、各桁ごとに OR される |

<a id="markdown-xor-演算" name="xor-演算"></a>

##### XOR 演算

| 関数                   | 結果      | 備考                                  |
| ---------------------- | --------- | ------------------------------------- |
| `bin(bin(0b0 ^ 0b0))`  | `'0b0'`   |                                       |
| `bin(bin(0b0 ^ 0b1))`  | `'0b1'`   |                                       |
| `bin(bin(0b1 ^ 0b1))`  | `'0b0'`   |                                       |
| `bin(0b1100 ^ 0b1010)` | `'0b110'` | 繰り上がりせず、各桁ごとに XOR される |

<a id="markdown-2-進数の補数" name="2-進数の補数"></a>

#### 2 進数の補数

```py
x = -36

print(
    '{:>10}\n{:>10}\n1の補数{:>10}\n2の補数{:>10}'.format(
        x,
        bin(x),
        bin((x & 0b11111111) - 1),
        bin(x & 0b11111111)
    )
)
```

```
       -36
 -0b100100
0b11011011
0b11011100
```

<a id="markdown-四捨五入・数値の切り上げ・切り捨て" name="四捨五入・数値の切り上げ・切り捨て"></a>

### 四捨五入・数値の切り上げ・切り捨て

| 処理                      | 関数                | 結果              |
| ------------------------- | ------------------- | ----------------- |
| 四捨五入(偶数への丸め)    | `round(7 / 3)`      | `2`               |
|                           | `round(1 / 2)`      | `0` (`1`ではない) |
| 切り捨て                  | `7 // 3`            | `2`               |
|                           | `int(7 / 3)`        | `2`               |
| 切り上げ                  | `-(-7 // 3)`        | `3`               |
| 切り捨て(math モジュール) | `math.floor(7 / 3)` | `2`               |
| 切り上げ(math モジュール) | `math.ceil(7 / 3)`  | `3`               |

```py
import math
math.floor(7 / 3) # 切り捨て
math.ceil(7 / 3) # 切り上げ
```

> 2
>
> 3

偶数への丸めではなく四捨五入を行いたい時は、decimal モジュールを使用する

```py
from decimal import Decimal, ROUND_HALF_UP, ROUND_DOWN

f = 1234.567

# 四捨五入
print(Decimal(str(f)).quantize(Decimal('0'), rounding=ROUND_HALF_UP))

# int型に戻す
int_value = int(Decimal(str(f)).quantize(Decimal('0'), rounding=ROUND_HALF_UP))

# 切り捨て
print(Decimal(str(f)).quantize(Decimal('0'), rounding=ROUND_DOWN))

# 切り上げ
print(Decimal(str(f)).quantize(Decimal('0'), rounding=ROUND_UP))
```

> \# 四捨五入
>
> 1235

> \# 切り捨て
>
> 1234

> \# 切り上げ
>
> 1235

<a id="markdown-整数の乱数を取得する" name="整数の乱数を取得する"></a>

### 整数の乱数を取得する

```py
import random

random.randint(1, 3) # m以上n以下の整数を返す
```

> 1
>
> 3

```py
import random

start=10
stop=100
step=20

# range(start, stop, step)で生成したリストの要素からランダムに抽出
random.randrange(start, stop, step)

# 乱数リストを内包表記で作る
[random.randrange(start, stop, step) for i in range(10)]
```

> 90
>
> 70

> [10, 10, 30, 50, 50, 70, 50, 10, 90, 30]

<a id="markdown-乱数値を固定する" name="乱数値を固定する"></a>

#### 乱数値を固定する

```py
import random

# 乱数シードを設定する
random.seed(123)

random.random()
random.random()
random.random()

# 再度同じ乱数シードを設定する
random.seed(123)

random.random()
random.random()
random.random()
```

> 0.052363598850944326
>
> 0.08718667752263232
>
> 0.4072417636703983

> 0.052363598850944326
>
> 0.08718667752263232
>
> 0.4072417636703983

<a id="markdown-整数の計算" name="整数の計算"></a>

### 整数の計算

<a id="markdown-算術演算子整数" name="算術演算子整数"></a>

#### 算術演算子（整数）

```py
# 和（加算）
print(1 + 2)

# 差（減算）
print(1 - 2)

# 積（乗算）
print(1 * 2)
```

> 3
>
> -1
>
> 2

```py
# 商（実数除算）… Python2 では / でも整数除算になる
print(1 / 2)

# 商（整数除算）
print(1 // 2)

# 剰余（<ruby>余り<rt>あまり</rt></ruby>）
print(1 % 2)

# 商と剰余
divmod(7, 3)
```

> 0.5 \# Python2 では / でも整数除算になるので 0
>
> 0
>
> 1
>
> (2, 1)

```py
# 累乗
print(123 ** 2)
```

> 15129

<a id="markdown-最小公倍数・最大公約数" name="最小公倍数・最大公約数"></a>

#### 最小公倍数・最大公約数

```py
# 最大公約数
import math
print(math.gcd(8, 28))
```

> 4

```py
# 最小公倍数
import math
def lcm(x, y):
    return (x * y) // math.gcd(x, y)

print(lcm(8, 28))
```

> 56

<a id="markdown-float" name="float"></a>

## float

| 定義                         | 結果     |
| ---------------------------- | -------- |
| `1.23`                       | `1.23`   |
| `1.2e3` (1.2 \* 10 \*\* 3)   | `1200.0` |
| `1.2E-3` (1.2 \* 10 \*\* -3) | `0.0012` |

<a id="markdown-数値チェック小数" name="数値チェック小数"></a>

### 数値チェック（小数）

<a id="markdown-0-との比較小数" name="0-との比較小数"></a>

#### 0 との比較（小数）

```py
x = (-0.1, 0, 0.1, 2.34)

# bool(0) => False
# bool(-0.1), bool(0.1) => True

for item in x:
    # if item != 0: のように、 0 と比較する必要はない
    if item:
        print(item)
```

> -0.1
>
> 0.1
>
> 2.34

<a id="markdown-小数文字列か判定" name="小数文字列か判定"></a>

#### 小数文字列か判定

文字列に対して数値チェック(小数)を行う

```py
def is_float(s):
  try:
    float(s)
  except:
    return False
  return True


s = '1.23e-4'
if is_float(s):
    f = float(s)  # 文字列型からのキャスト
    print('{}'.format(f))
```

> 0.000123

<a id="markdown-float-型と文字列型" name="float-型と文字列型"></a>

### float 型と文字列型

<a id="markdown-float-型のフォーマット" name="float-型のフォーマット"></a>

#### float 型のフォーマット

フォーマットに利用する関数には以下の種類がある

- 組み込み関数`format()`
- `str.format()`
- f 文字列

| 種別           | 書き方                                        | 結果      |
| -------------- | --------------------------------------------- | --------- |
| `format()`     | `format(1.2345, '0.3f')`                      | `'1.234'` |
| `str.format()` | `'{:0.3f}'.format(1.2345)`                    | `'1.234'` |
| f 文字列       | `f'right : {1.2345:0.3f}'`                    | `'1.234'` |
|                | `strval=1.2345`<br>`f'right : {strval:0.3f}'` | `'1.234'` |

詳細は[書式指定子](#書式指定子)の項を参照

<a id="markdown-文字列型からのキャスト-1" name="文字列型からのキャスト-1"></a>

#### 文字列型からのキャスト

| `s`         | `float(s)`の結果 |
| ----------- | ---------------- |
| `'1.23'`    | `1.23`           |
| `'.23'`     | `0.23`           |
| `'1.23e-4'` | `0.000123`       |

<a id="markdown-分数" name="分数"></a>

### 分数

```py
from fractions import Fraction
print(Fraction(7, 3))

print(Fraction('7/3'))

print(Fraction(0.5))

x = Fraction('7/3')
print(x.numerator, type(x.numerator), x.denominator, type(x.denominator))
```

> 7/3
>
> 7/3
>
> 1/2
>
> 7 \<class 'int'\> 3 \<class 'int'\>

```py
from fractions import Fraction
result = Fraction(7, 3) + Fraction(7, 3) / Fraction(3, 7)

print(result > Fraction(7, 3))

float(result)
str(result)
```

> Fraction(70, 9)
>
> True
>
> 7.777777777777778
>
> '70/9'

<a id="markdown-分母の最大値を指定して近似" name="分母の最大値を指定して近似"></a>

#### 分母の最大値を指定して近似

浮動小数点数の誤差が出てしまう場合、近似することも可能

```py
print(Fraction(0.2))

print(Fraction(0.2).limit_denominator(5))
```

> Fraction(3602879701896397, 18014398509481984)
>
> 1/5

<a id="markdown-数値の指定桁数での四捨五入・切り上げ・切り捨て" name="数値の指定桁数での四捨五入・切り上げ・切り捨て"></a>

### 数値の指定桁数での四捨五入・切り上げ・切り捨て

| 処理                      | 関数                | 結果                     |
| ------------------------- | ------------------- | ------------------------ |
| 四捨五入(偶数への丸め)    | `round(7 / 3, 2)`   | `2.33`                   |
|                           | `round(1 / 4, 1)`   | `0.2` ( `0.25` ではない) |
| 切り捨て                  | `7 // 3`            | `2`                      |
|                           | `int(7 / 3)`        | `2`                      |
| 切り上げ                  | `-(-7 // 3)`        | `3`                      |
| 切り捨て(math モジュール) | `math.floor(7 / 3)` | `2`                      |
| 切り上げ(math モジュール) | `math.ceil(7 / 3)`  | `3`                      |

偶数への丸めではなく四捨五入を行いたい時は、decimal モジュールを使用する

```py
from decimal import Decimal, ROUND_HALF_UP, ROUND_DOWN

f = 1234.567

# 四捨五入
print(Decimal(str(f)).quantize(Decimal('0.1'), rounding=ROUND_HALF_UP))
print(Decimal(str(f)).quantize(Decimal('0.01'), rounding=ROUND_HALF_UP))

# float型に戻す
float_value = float(Decimal(str(f)).quantize(Decimal('0.1'), rounding=ROUND_HALF_UP))

# 切り捨て
print(Decimal(str(f)).quantize(Decimal('0.1'), rounding=ROUND_DOWN))

# 切り上げ
print(Decimal(str(f)).quantize(Decimal('0.1'), rounding=ROUND_UP))
```

> \# 四捨五入
>
> 1234.6
>
> 1234.57

> \# 切り捨て
>
> 1234.5

> \# 切り上げ
>
> 1235.6

<a id="markdown-絶対値abs" name="絶対値abs"></a>

### 絶対値（abs）

| 関数         | 引数の型 | 結果の型 |
| ------------ | -------- | -------- |
| abs(x)       | int      | int      |
|              | float    | float    |
|              | complex  | float    |
| math.fabs(x) | int      | float    |
|              | float    | float    |

```py
abs(-123)
abs(-1.23)
abs(32 + 1j)
```

> 123
>
> 1.23
>
> 32.01562118716424

```py
import math
math.fabs(-123)
math.fabs(-1.23)
math.fabs(32 + 1j)
```

> 123.0
>
> 1.23
>
> TypeError: can't convert complex to float

<a id="markdown-最大値・最小値数値" name="最大値・最小値数値"></a>

### 最大値・最小値（数値）

```py
print(max(1, 2, -3))
print(min(1, 2, -3))

print(max(1.2, 3.4, -5.6))
print(min(1.2, 3.4, -5.6))
```

> 2
>
> -3
>
> 3.4
>
> -5.6

<a id="markdown-平均値数値" name="平均値数値"></a>

### 平均値（数値）

<a id="markdown-算術平均" name="算術平均"></a>

#### 算術平均

```py
import statistics as st

x = (1.2, 2.3, 4.56)
print(st.mean(x))
x = [1.2, 2.3, 4.56]
print(st.mean(x))

print(st.mean(1.2, 2.3, 4.56))

x = [1.2, 2.3, 4.56, None]
print(st.mean(x))
```

> 2.6866666666666665
>
> 2.6866666666666665

> TypeError: mean() takes 1 positional argument but 3 were given

> TypeError: don't know how to coerce float and NoneType

```py
from decimal import Decimal as D
import statistics as st

x = [D('1.2'), D('2.3'), D('4.56')]
print(st.mean(x))
```

> 2.686666666666666666666666667

```py
from fractions import Fraction as F
import statistics as st

# 1/2, 1/4, 1/8
x = [F(1, 2), F(1, 4), F(1, 8)]
print(st.mean(x))
```

> 7/24

<a id="markdown-調和平均" name="調和平均"></a>

#### 調和平均

```py
import statistics as st

x = (1.2, 2.3, 4.56)
print(st.harmonic_mean(x))
x = [1.2, 2.3, 4.56]
print(st.harmonic_mean(x))
```

> 2.0169230769230766
>
> 2.0169230769230766

<a id="markdown-統計量" name="統計量"></a>

### 統計量

<a id="markdown-中央値" name="中央値"></a>

#### 中央値

```py
import statistics as st

x = (1, 2, 3, 4, 5, 6, 7, 8, 9)
print(st.median(x))
print(st.median_low(x))
print(st.median_high(x))
x = (1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
print(st.median(x))
print(st.median_low(x))
print(st.median_high(x))
```

> 5
>
> 5
>
> 5

要素数が奇数の場合は、中央の 2 要素の平均値

> 5.5
>
> 5
>
> 6

<a id="markdown-最頻値" name="最頻値"></a>

#### 最頻値

```py
import statistics as st

x = (1, 1, 1, 2, 2, 3, 4, 5)
print(st.mode(x))

x = (1, 1, 1, 2, 2, 2, 3, 4, 5)
print(st.mode(x))
```

> 1
>
> 1

```py
import collections

x = [1, 1, 1, 2, 2, 2, 3, 4, 5]
c = collections.Counter(x)

print(type(c), c)
print(c[1])

print(c.items())

print(c.most_common())

# 出現回数が最大の要素
print(c.most_common()[0])
print(c.most_common()[0][0])
print(c.most_common()[0][1])

# 出現頻度が大きい方からn個
print(c.most_common(2))

# 頻度が最小の要素
print(c.most_common()[-1])
```

> \# print(type(c), c)
>
> \<class 'collections.Counter'> Counter({1: 3, 2: 3, 3: 1, 4: 1, 5: 1})
>
> 3

> \# print(c.items())
>
> dict_items([(1, 3), (2, 3), (3, 1), (4, 1), (5, 1)])

> \# print(c.most_common())
>
> [(1, 3), (2, 3), (3, 1), (4, 1), (5, 1)]

> (1, 3)
>
> 1
>
> 3

> [(1, 3), (2, 3)]

> (5, 1)

<a id="markdown-母標準偏差" name="母標準偏差"></a>

#### 母標準偏差

```py
import statistics as st

x = (1, 2, 3, 4, 5, 6, 7, 8, 9, 10)

# print(st.mean(x)) # 5.5

print(st.pstdev(x))
# math.sqrt(st.pvariance(x))
```

> 2.8722813232690143

<a id="markdown-母分散" name="母分散"></a>

#### 母分散

```py
import statistics as st

x = (1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
print(st.pvariance(x))
# sum((i - sum(x) / len(x))**2 for i in x) / len(x)
```

> 8.25

<a id="markdown-標本標準偏差不偏標準偏差" name="標本標準偏差不偏標準偏差"></a>

#### 標本標準偏差（不偏標準偏差）

```py
import statistics as st

x = (1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
print(st.stdev(x))
# math.sqrt(st.variance(x))
```

> 3.0276503540974917

<a id="markdown-標本分散不偏分散" name="標本分散不偏分散"></a>

#### 標本分散（不偏分散）

```py
import statistics as st

x = (1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
print(st.variance(x))
# sum((i - sum(x) / len(x))**2 for i in x) / (len(x) - 1)
```

> 9.166666666666666

<a id="markdown-小数値の乱数を取得する" name="小数値の乱数を取得する"></a>

### 小数値の乱数を取得する

```py
import random

random.random() # 0以上1未満の小数を返す
```

> 0.9526105265369583
>
> 0.20576122073048697

```py
import random

# m以上n以下の小数を返す
# ( a + (b-a) * random() の丸められ方によっては「n未満」 )
random.uniform(1, 3)
```

> 2.812125216111861
>
> 1.2485392016103378

<a id="markdown-三角関数" name="三角関数"></a>

### 三角関数

<a id="markdown-円周率-π" name="円周率-π"></a>

#### 円周率 π

```py
import math
print(math.pi)
```

<a id="markdown-度degreeとラジアンradの変換" name="度degreeとラジアンradの変換"></a>

#### 度（degree）とラジアン（rad）の変換

```py
import math

print(math.degrees(2 * math.pi))
print(math.radians(360))
```

> 360.0
>
> 6.283185307179586

<a id="markdown-sincostan" name="sincostan"></a>

#### sin、cos、tan

```py
import math

math.sin(math.radians(0))
math.cos(math.radians(0))
math.tan(math.radians(0))
```

> 0.0
>
> 1.0
>
> 0.0

```py
import math

math.sin(math.radians(45))
math.cos(math.radians(45))
math.tan(math.radians(45))

x = math.tan(math.radians(45))
print(round(x, 3))
print(math.isclose(x, 1.0))
print(math.isclose(x, 0.9))
```

> 0.7071067811865475
>
> 0.7071067811865476
>
> 0.9999999999999999

> 1.0
>
> True
>
> False

<a id="markdown-asinacosatan" name="asinacosatan"></a>

#### asin、acos、atan

```py
import math

x = math.degrees(math.asin(0.5))
print(x)
print(round(x, 3))

x = math.degrees(math.acos(0.5))
print(x)
print(round(x, 3))

x = math.degrees(math.atan(math.inf))
print(x)
print(round(x, 3))
```

> 29.999999999999996
>
> 30.0

> 59.99999999999999
>
> 60.0

> 90.0
>
> 90.0

<a id="markdown-実数の計算" name="実数の計算"></a>

### 実数の計算

<a id="markdown-算術演算子実数" name="算術演算子実数"></a>

#### 算術演算子（実数）

```py
# 和（加算）
print(1.23 + 2)

# 差（減算）
print(1.23 - 2)

# 積（乗算）
print(1.23 * 2)
```

> 3.23
>
> -0.77
>
> 2.46

```py
# 商（実数除算）… Python2 では / でも整数除算になる
print(1.23 / 2)

# 商（整数除算）
print(1.23 // 2)

# 剰余（<ruby>余り<rt>あまり</rt></ruby>）
print(1.23 % 2)

# 商と剰余
divmod(1.23, 2)
```

> 0.61
>
> 0.0
>
> 1.23
>
> (0.0, 1.23)

```py
# べき乗（累乗）
print(1.23 ** 2)
```

> 15129

<a id="markdown-平方根" name="平方根"></a>

#### 平方根

複素数に対して `**` 、 `pow()` 、 `math.sqrt()` で平方根を求めると誤差が発生する

```py
n = 13 ** 2
o = -1
p = -3 + 4j

n ** 0.5
o ** 0.5
p ** 0.5

pow(n, 0.5)
pow(o, 0.5)
pow(p, 0.5)

import math
math.sqrt(n)
math.sqrt(o)
math.sqrt(p)
```

> 13.0
>
> (6.123233995736766e-17+1j)
>
> (1.0000000000000002+2j)

> 13.0
>
> (6.123233995736766e-17+1j)
>
> (1.0000000000000002+2j)

> 13.0
>
> ValueError: math domain error
>
> TypeError: can't convert complex to float

より高精度の結果を得るためには cmath.sqrt()を使う

```py
import cmath
cmath.sqrt(n)
cmath.sqrt(o)
cmath.sqrt(p)
```

> (13+0j)
>
> 1j
>
> (1+2j)

<a id="markdown-指数" name="指数"></a>

#### 指数

<a id="markdown-べき乗" name="べき乗"></a>

##### べき乗

<a id="markdown-\\" name="\\"></a>

###### \*\*

```py
print(0**0)
print(2**6)
print(2.1**6)
print(2.1**6.5)

print((1 + 2j) ** 3)
print((1 + 2j) ** (3 + 4j))
```

> 1
>
> 64
>
> 85.76612100000003
>
> 124.286917147027
>
> (-11-2j)
>
> (0.12900959407446697+0.03392409290517014j)

<a id="markdown-pow" name="pow"></a>

###### `pow()`

```py
print(pow(0, 0))
print(pow(2, 6))
print(pow(2.1, 6))
print(pow(2.1, 6.5))

print(pow(1 + 2j, 3))
print(pow(1 + 2j, 3 + 4j))
```

> 1
>
> 64
>
> 85.76612100000003
>
> 124.286917147027
>
> (-11-2j)
>
> (0.12900959407446697+0.03392409290517014j)

`pow()` に第 3 引数を与えると、第 3 引数で割った時の剰余を返す

```py
print(pow(2, 6, 5))
```

> 4

<a id="markdown-mathpow" name="mathpow"></a>

###### `math.pow()`

```py
import math

print(math.pow(0, 0))
print(math.pow(2, 6))
print(math.pow(2.1, 6))
print(math.pow(2.1, 6.5))

# float型にキャストして計算するため、float型にキャストできないcomplex型などの値は引数にとれない
print(math.pow(1 + 2j, 3))
```

> 1.0
>
> 64.0
>
> 85.76612100000003
>
> 124.286917147027
>
> TypeError: can't convert complex to float

<a id="markdown-底が負値の場合" name="底が負値の場合"></a>

###### 底が負値の場合

```py
print(pow(125, 1/3))
print(pow(-125, 1/3)) # 複素数の解が返る

# 複素数ではなく実数の解を求めたい場合
def pow2(x, y):
    if x >= 0:
        p = pow(x, y)
    else:
        p = - pow(abs(-x), y)
    return p

print(pow2(-125, 1/3))
```

> 5.0
>
> (2.5000000000000004+4.330127018922193j)

> -5.0

<a id="markdown-自然対数の底ネイピア数のべき乗" name="自然対数の底ネイピア数のべき乗"></a>

###### 自然対数の底（ネイピア数）のべき乗

```py
import math

# math.e**2 だと精度が低い
print(math.exp(2))
```

> 7.38905609893065

<a id="markdown-対数" name="対数"></a>

##### 対数

<a id="markdown-自然対数底が-e・任意の底の対数" name="自然対数底が-e・任意の底の対数"></a>

##### 自然対数（底が e）・任意の底の対数

```py
# mathモジュールをインポート
import math

# 底（第2引数）を省略するとeが使われる
print(math.log(1))

# ネイピア数は math.e
print(math.log(math.e))

# +∞はfloat("inf")
print(math.log(float("inf")))

# 底（第2引数）を指定
print(math.log(3, 2))
```

> 0.0
>
> 1.0
>
> inf
>
> 1.5849625007211563

<a id="markdown-底の変換公式" name="底の変換公式"></a>

##### 底の変換公式

```py
# math.log(3, 2)と同じ
print(math.log(3) / math.log(2))
```

> 1.5849625007211563

<a id="markdown-2-進対数底が-2" name="2-進対数底が-2"></a>

##### 2 進対数（底が 2）

```py
import math
print(math.log2(1024))
```

> 10.0

<a id="markdown-常用対数底が-10" name="常用対数底が-10"></a>

##### 常用対数（底が 10）

```py
import math
print(math.log10(100))
```

> 2.0

<a id="markdown-引数と-1-の和の自然対数" name="引数と-1-の和の自然対数"></a>

##### 引数と 1 の和の自然対数

x の値が小さい場合に使用する

```py
import math

print(math.log(1.01))
print(math.log1p(0.01)) # math.logと比べて、より高精度
```

> 0.009950330853168092
> 0.009950330853168083

<a id="markdown-階乗" name="階乗"></a>

#### 階乗

```py
import math
print(math.factorial(10))

# 再帰呼び出しで書く場合
def factorial(x):
    if x == 0:
        return 1
    else:
        return x * factorial(x - 1)

print(factorial(10))
```

> 3628800
>
> 3628800

<a id="markdown-complex虚数" name="complex虚数"></a>

## complex(虚数)

```py
c = 1j
c = 2.3J
```

<a id="markdown-datetime" name="datetime"></a>

## datetime

<a id="markdown-日時の比較" name="日時の比較"></a>

### 日時の比較

```py
import datetime
d1 = datetime.datetime(2016, 12, 31, 23, 59, 59)
d2 = datetime.datetime(2016, 1, 1, 0, 0, 0)
td = d1 - d2
print(td)
print(td.days)
print(td.seconds)

print(d2 < d1)
print(d2 > d1)
print(d1 == d2)
```

| 項目         | 値                   |
| ------------ | -------------------- |
| `td`         | `365 days, 23:59:59` |
| `td.days`    | `365`                |
| `td.seconds` | `86399`              |
| `d1 > d2`    | `True`               |
| `d1 < d2`    | `False`              |
| `d1 == d2`   | `False`              |

<a id="markdown-現在日時" name="現在日時"></a>

### 現在日時

```py
from datetime import datetime

dt = datetime.today()
print(dt)

dt = datetime.now()
print(dt)
```

> 2019-08-02 08:34:17.354115
>
> 2019-08-02 08:34:17.354115

<a id="markdown-日時の各項目を取得" name="日時の各項目を取得"></a>

### 日時の各項目を取得

| 項目              | 値                             | 備考           |
| ----------------- | ------------------------------ | -------------- |
| `type(dt)`        | `<class 'datetime.datetime'\>` |                |
| `dt.year`         | `2019`                         |                |
| `dt.month`        | `8`                            |                |
| `dt.day`          | `2`                            |                |
| `dt.weekday()`    | `4`                            | 0:月曜; 6:日曜 |
| `dt.isoweekday()` | `5`                            | 1:月曜; 7:日曜 |
| `dt.hour`         | `8`                            |                |
| `dt.minute`       | `34`                           |                |
| `dt.second`       | `17`                           |                |
| `dt.microsecond`  | `354115`                       |                |

<a id="markdown-日付の生成" name="日付の生成"></a>

### 日付の生成

```py
from datetime import datetime
# 年・月・日は必須
dt = datetime(2019, 8, 2)
dt = datetime(2019, 8, 2, 1, 2, 3)
```

| 関数                             | 結果                                  |
| -------------------------------- | ------------------------------------- |
| `datetime(2019, 8, 2)`           | `2019-08-02 00:00:00`                 |
| `datetime(2019, 8, 2, 1, 2, 3)`  | `2019-08-02 01:02:03`                 |
| `datetime(2019, 8, 2, 1, 1, 63)` | `ValueError: second must be in 0..59` |

<a id="markdown-一定期間後の日付を生成" name="一定期間後の日付を生成"></a>

#### 一定期間後の日付を生成

```py
from datetime import datetime
from datetime import timedelta

dt = datetime(2019, 8, 2)

# 一定期間後の日付を生成する場合はtimedeltaを使用
dt += timedelta(weeks=1, days=2, hours=3, minutes=4, seconds=5, milliseconds=6, microseconds=7)
print(dt)
```

> 2019-08-11 03:04:05.006007

<a id="markdown-日時の要素を置換" name="日時の要素を置換"></a>

#### 日時の要素を置換

```py
from datetime import datetime
from datetime import timedelta

dt = datetime(2019, 8, 2)

# 日時の要素を置換
print(dt.replace(day=22))
```

> 2019-08-22 00:00:00

<a id="markdown-現在日時を取得し特定の時刻に変更" name="現在日時を取得し特定の時刻に変更"></a>

##### 現在日時を取得し、特定の時刻に変更

```py
from datetime import datetime

dt = datetime.now()

# 日時の要素を置換
print(dt.replace(hour=2,minute=0,second=0,microsecond=0))
```

> 2020-01-27 02:00:00

<a id="markdown-今年が閏年かどうか調べる" name="今年が閏年かどうか調べる"></a>

###### 今年が閏年かどうか調べる

```py
from datetime import datetime
from datetime import timedelta

dt = datetime.now()
dt = dt.replace(month=3,day=1,hour=0,minute=0,second=0,microsecond=0)
dt += timedelta(days=-1)
print(dt)

if 29 == dt.day:
    print('閏年')
else:
    print('not 閏年')
```

<a id="markdown-日付のリスト" name="日付のリスト"></a>

#### 日付のリスト

```py
from datetime import date
from datetime import timedelta

f = '%Y-%m-%d'
n = 5
d = date(2019, 8, 2)
td = timedelta(weeks=1)

l = [(d + i * td).strftime(f) for i in range(n)]
print(l)
```

> ['2019-08-02', '2019-08-09', '2019-08-16', '2019-08-23', '2019-08-30']

<a id="markdown-ランダムな日付を生成" name="ランダムな日付を生成"></a>

#### ランダムな日付を生成

```py
import random
import time

def generate_random_datetime(start, end, format = '%Y/%m/%d %H:%M:%S'):
    start_datetime = time.mktime(time.strptime(start, format))
    end_datetime = time.mktime(time.strptime(end, format))
    generated = start_datetime + random.random() * (end_datetime - start_datetime)
    return time.strftime(format, time.localtime(generated))


print(generate_random_datetime('2020/10/01 00:00:00', '2020/10/31 23:59:59'))
```

> 2020/10/07 04:17:34
>
> 2020/10/31 07:40:03
>
> 2020/10/01 04:21:58
>
> 2020/10/24 21:50:26
>
> 2020/10/27 17:41:34

<a id="markdown-指定日までの残り期間を取得" name="指定日までの残り期間を取得"></a>

### 指定日までの残り期間を取得

```py
from datetime import datetime
from datetime import timedelta

td = datetime(2019, 12, 24) - datetime(2019, 8, 2, 9, 0, 0)
print(td)
```

> 143 days, 15:00:00

<a id="markdown-生年月日から年齢を取得" name="生年月日から年齢を取得"></a>

### 生年月日から年齢を取得

```sh
$ python -m pip install python-dateutil
```

```py
from datetime import date
from dateutil.relativedelta import relativedelta

birthday = date(2000, 2, 29)
today = date.today()

delta = relativedelta(today, birthday)
print(today, birthday, delta)
print(delta.years)
```

> 2020-10-21 2000-02-29 relativedelta(years=+20, months=+7, days=+22)
>
> 20

<a id="markdown-タイムゾーンを考慮した-datetime" name="タイムゾーンを考慮した-datetime"></a>

### タイムゾーンを考慮した datetime

<a id="markdown-datetime-パッケージの-timezone-モジュールを使用する場合" name="datetime-パッケージの-timezone-モジュールを使用する場合"></a>

#### datetime パッケージの timezone モジュールを使用する場合

UTC からの時間差を指定して最低限の処理をすればよい場合

| 種類  | 内容                                                   |
| ----- | ------------------------------------------------------ |
| aware | TimeZone 情報を持つ datetime オブジェクト(tzinfo 属性) |
| naive | TimeZone 情報を持たない datetime オブジェクト          |

```py
from datetime import datetime, timedelta, timezone

# 現在時刻
print(datetime.now())
# 2019-08-08 12:17:51.835080

print(datetime.utcnow())
# 2019-08-08 03:17:53.033335
```

<a id="markdown-生成" name="生成"></a>

##### 生成

```py
from datetime import datetime, timedelta, timezone

# 任意の時刻を設定
print(datetime(2019, 8, 7, 6, 54, 32, 1000))
# 2019-08-07 06:54:32.001000

print(type(datetime(2019, 8, 7, 6, 54, 32, 1000)))
# <class 'datetime.datetime'>

print(datetime(2019, 8, 7, 6, 54, 32, 1000).tzinfo)
# None

print(datetime(2019, 8, 7, 6, 54, 32, 1000, tzinfo=timezone.utc))
# 2019-08-07 06:54:32.001000+00:00

print(datetime(2019, 8, 7, 6, 54, 32, 1000, tzinfo=timezone.utc).tzinfo)
# UTC

print(datetime(2019, 8, 7, 6, 54, 32, 1000, tzinfo=timezone(timedelta(hours=9))))
# 2019-08-07 06:54:32.001000+09:00
```

<a id="markdown-タイムゾーンを変更変更前と同じ時刻" name="タイムゾーンを変更変更前と同じ時刻"></a>

##### タイムゾーンを変更(変更前と同じ時刻)

```py
print(datetime(2019, 8, 7, 6, 54, 32, 1000, tzinfo=timezone(timedelta(hours=9))).astimezone(timezone(timedelta(hours=8))))
# 2019-08-07 06:54:32.001000+09:00 → 2019-08-07 05:54:32.001000+08:00

# Python3.6以降の場合、naiveなdatetimeオブジェクトにもastimezone関数を実行できる(ローカルのタイムゾーンから変換される)
print(datetime(2019, 8, 7, 6, 54, 32, 1000).astimezone(timezone(timedelta(hours=8))))
# 2019-08-07 06:54:32.001000+09:00 → 2019-08-07 05:54:32.001000+08:00
```

<a id="markdown-タイムゾーンを置換変更前と異なる時刻" name="タイムゾーンを置換変更前と異なる時刻"></a>

##### タイムゾーンを置換(変更前と異なる時刻)

```py
print(datetime(2019, 8, 7, 6, 54, 32, 1000, tzinfo=timezone(timedelta(hours=9))).replace(tzinfo=timezone.utc))
# 2019-08-07 06:54:32.001000+09:00 → 2019-08-07 06:54:32.001000+00:00

# タイムゾーンの削除
print(datetime(2019, 8, 7, 6, 54, 32, 1000, tzinfo=timezone(timedelta(hours=9))).replace(tzinfo=None))
# 2019-08-07 06:54:32.001000+09:00 → 2019-08-07 06:54:32.001000
```

<a id="markdown-pytz-を使用する場合" name="pytz-を使用する場合"></a>

#### pytz を使用する場合

<a id="markdown-現在日時から生成" name="現在日時から生成"></a>

##### 現在日時から生成

```sh
$ pip install pytz
```

```py
from pytz import timezone
from datetime import datetime
```

- 型

| 項目                           | 値                                 |
| ------------------------------ | ---------------------------------- |
| `type(datetime.now())`         | `<class 'datetime.datetime'>`      |
| `type(timezone('UTC'))`        | `<class 'pytz.UTC'>`               |
| `type(timezone('Asia/Tokyo'))` | `<class 'pytz.tzfile.Asia/Tokyo'>` |

| 項目                                                                                    | 値                                 |
| --------------------------------------------------------------------------------------- | ---------------------------------- |
| `print(datetime.now())`                                                                 | `2019-08-07 12:45:18.487441`       |
|                                                                                         |                                    |
| `print(datetime.now(timezone('UTC')))`                                                  | `2019-08-07 03:45:18.553981+00:00` |
| `print(datetime.now(tz=timezone('Europe/London')))`                                     | `2019-08-07 04:45:18.553981+01:00` |
| `print(datetime.now(tz=timezone('Asia/Tokyo')))`                                        | `2019-08-07 12:45:18.553981+09:00` |
|                                                                                         |                                    |
| `print(datetime.now(timezone('UTC')).astimezone(timezone('Europe/London')))`            | `2019-08-07 04:45:18.634371+01:00` |
| `print(datetime.now(timezone('UTC')).astimezone(timezone('Asia/Tokyo')))`               | `2019-08-07 12:45:18.754351+09:00` |
|                                                                                         |                                    |
| `print(timezone('Europe/London').localize(datetime.now()))`                             | `2019-08-07 12:45:20.011410+01:00` |
| `print(timezone('Asia/Tokyo').localize(datetime.now()))`                                | `2019-08-07 12:45:20.011410+09:00` |
|                                                                                         |                                    |
| `print(timezone('UTC').localize(datetime.now()))`                                       | `2019-08-07 12:45:18.760637+00:00` |
|                                                                                         |                                    |
| `print(timezone('UTC').localize(datetime.now()).astimezone(timezone('Europe/London')))` | `2019-08-07 13:45:18.760637+09:00` |
| `print(timezone('UTC').localize(datetime.now()).astimezone(timezone('Asia/Tokyo')))`    | `2019-08-07 21:45:18.760637+09:00` |

<a id="markdown-任意の日時を生成" name="任意の日時を生成"></a>

##### 任意の日時を生成

```py
from datetime import datetime
from pytz import timezone

date = datetime(2019, 8, 9, 10)

tz = timezone('Asia/Tokyo')
print(tz.localize(date))

tz = timezone('Europe/London')
print(tz.localize(date))

tz = timezone('UTC')
print(tz.localize(date))
```

> 2019-08-09 10:11:12+09:00
>
> 2019-08-09 10:11:12+01:00
>
> 2019-08-10 02:00:00+00:00

<a id="markdown-サマータイム終了時点を跨いだ日時の加算" name="サマータイム終了時点を跨いだ日時の加算"></a>

##### サマータイム終了時点を跨いだ日時の加算

```py
from datetime import datetime, timedelta
from pytz import timezone

tz = timezone('Europe/London')
dt = datetime(year=2019, month=10, day=27, hour=0, minute=58)
localized = tz.normalize(tz.normalize(tz.localize(dt)) + timedelta(minutes=1))
print(localized)

dt = datetime(year=2019, month=10, day=27, hour=0, minute=59)
localized = tz.normalize(tz.normalize(tz.localize(dt)) + timedelta(minutes=1))
print(localized)

dt = datetime(year=2019, month=10, day=27, hour=0, minute=59, second=59)
localized = tz.normalize(tz.normalize(tz.localize(dt)) + timedelta(seconds=1))
print(localized)

dt = datetime(year=2019, month=10, day=27, hour=1, minute=0, second=0)
localized = tz.normalize(tz.normalize(tz.localize(dt)) + timedelta(seconds=1))
print(localized)

dt = datetime(year=2019, month=10, day=27, hour=1, minute=0)
localized = tz.normalize(tz.normalize(tz.localize(dt)) + timedelta(minutes=1))
print(localized)
```

> 2019-10-27 00:59:00+01:00
>
> 2019-10-27 01:00:00+01:00
>
> 2019-10-27 01:00:00+01:00
>
> 2019-10-27 01:00:01+00:00
>
> 2019-10-27 01:01:00+00:00

<a id="markdown-datetime-型のキャスト" name="datetime-型のキャスト"></a>

### datetime 型のキャスト

<a id="markdown-datetime-型と-date-型・time-型" name="datetime-型と-date-型・time-型"></a>

#### datetime 型と date 型・time 型

<a id="markdown-datetime-型-から-date-型・time-型" name="datetime-型-から-date-型・time-型"></a>

##### datetime 型 から date 型・time 型

```py
from datetime import datetime

dt = datetime(2019, 8, 2)

# date型
print(dt.date())
print(type(dt.date()))

# time型
print(dt.time())
print(type(dt.time()))

print(dt.date().weekday())
```

> 2019-08-02
>
> \<class 'datetime.date'\>
>
> 00:00:00
>
> \<class 'datetime.time'>
>
> 4

<a id="markdown-date-型・time-型-から-datetime-型" name="date-型・time-型-から-datetime-型"></a>

##### date 型・time 型 から datetime 型

```py
import datetime

# 今日の日付(date)
date = datetime.date.today()

# time
# 範囲外の数値を指定するとエラー
# ValueError: second must be in 0..59
time = datetime.time(hour=12, minute=34, second=56)

dt = datetime.datetime.combine(date, time)
print(dt)
```

> 2019-08-02 12:34:56

<a id="markdown-datetime-型と文字列型" name="datetime-型と文字列型"></a>

#### datetime 型と文字列型

<a id="markdown-datetime-型-から-文字列型" name="datetime-型-から-文字列型"></a>

##### datetime 型 から 文字列型

```py
from datetime import datetime
now = datetime.now().strftime('%Y%m%d%H%M%S') # YYYYmmddHHMMSS
print(now)

print(datetime.now().isoformat()) # ISO形式
```

> 20190730121658
>
> 2019-07-30T12:16:58.427664

<a id="markdown-ロケールを指定して月・曜日を示す文字列を取得する" name="ロケールを指定して月・曜日を示す文字列を取得する"></a>

###### ロケールを指定して月・曜日を示す文字列を取得する

```py
import datetime
import locale

dt = datetime.datetime(2020, 1, 23)
print(dt) # 2020-01-23 00:00:00

print(locale.getlocale(locale.LC_TIME))
print(dt.strftime('%A, %a, %B, %b'))

locale.setlocale(locale.LC_TIME, 'en_US.UTF-8')
print(dt.strftime('%A, %a, %B, %b'))

locale.setlocale(locale.LC_TIME, 'ja_JP.UTF-8')
print(dt.strftime('%A, %a, %B, %b'))
```

| locale          | `%A`       | `%a`  | `%B`      | `%b`  |
| --------------- | ---------- | ----- | --------- | ----- |
| `(None, None)`  | `Thursday` | `Thu` | `January` | `Jan` |
| `'en_US.UTF-8'` | `Thursday` | `Thu` | `January` | `Jan` |
| `'ja_JP.UTF-8'` | `木曜日`   | `木`  | `1月`     | `1`   |

<a id="markdown-文字列型-から-datetime-型date-型" name="文字列型-から-datetime-型date-型"></a>

##### 文字列型 から datetime 型、date 型

```py
from datetime import date
from datetime import datetime
tstr = '2019-07-30 12:16:58'
tdatetime = datetime.strptime(tstr, '%Y-%m-%d %H:%M:%S') # YYYY-mm-dd HH:MM:SS
tdate = date(tdatetime.year, tdatetime.month, tdatetime.day)
print(tdatetime)
print(tdate)

tstr = '2019-07-30T12:16:58.001000'
tdatetime = datetime.fromisoformat(tstr) # ISO形式 (Python3.7以降)
print(tdatetime)

#      '2019-07-30T12:16:58.001000+00:00'
tstr = '2019-07-30T12:16:58.001000Z'
tdatetime = datetime.fromisoformat(tstr.replace('Z', '+00:00')) # ISO形式 (Python3.7以降) 末尾にUTCを示すZがついているとエラーになるので置換する
print(tdatetime)

tstr = '2019-07-30T12:16:58.001000+09:00'
tdatetime = datetime.fromisoformat(tstr) # ISO形式 (Python3.7以降)
print(tdatetime)
```

> 2019-07-30 12:16:58
>
> 2019-07-30
>
> 2019-07-30 12:16:58.001000
>
> 2019-07-30 12:16:58.001000+00:00
>
> 2019-07-30 12:16:58.001000+09:00

<a id="markdown-タイムゾーンを考慮した-文字列型-から-datetime-型" name="タイムゾーンを考慮した-文字列型-から-datetime-型"></a>

##### タイムゾーンを考慮した 文字列型 から datetime 型

```py
from datetime import datetime
tstr = '2019/08/08 12:23:34+0900'
tdatetime = datetime.strptime(tstr, '%Y/%m/%d %H:%M:%S%z')
print(tdatetime)
print(tdatetime.tzinfo)
```

> 2019-08-08 12:23:34+09:00
>
> UTC+09:00

<a id="markdown-タイムゾーンを考慮した-iso-形式の-文字列型-から-datetime-型" name="タイムゾーンを考慮した-iso-形式の-文字列型-から-datetime-型"></a>

##### タイムゾーンを考慮した ISO 形式の 文字列型 から datetime 型

dateutil.parser を利用する

```sh
$ pip install python-dateutil
```

```py
from datetime import datetime, timedelta, timezone
from dateutil.parser import parse


tstr = '2019-08-07T03:04:05.432100Z'

JST = timezone(timedelta(hours=+9), 'JST')
print(parse(tstr))
tdatetime = parse(tstr).astimezone(JST)
print(tdatetime)

print(tdatetime.astimezone(timezone('UTC'))) # 再度UTCに戻す
```

> 2019-08-07 03:04:05.432100+00:00
>
> 2019-08-07 12:04:05.432100+09:00

```py
import datetime
from dateutil.parser import parse


JST = datetime.timezone(datetime.timedelta(hours=+9), 'JST')

print(parse('2019-08-07T03:04:05.432100+00:00').astimezone(JST))
print(parse('2019-08-07T03:04:05.432100+0000').astimezone(JST))
print(parse('2019-08-07T03:04:05.432100+00').astimezone(JST))
print(parse('2019-08-07T03:04:05.432100Z').astimezone(JST))
print(parse('20190807T030405+00:00').astimezone(JST))
print(parse('20190807T030405Z').astimezone(JST))

print(parse('2019-08-07T03:04:05.432100+09:00').astimezone(JST))
print(parse('2019-08-07T03:04:05.432100JST').astimezone(JST))
```

> 2019-08-07 12:04:05.432100+09:00
>
> 2019-08-07 12:04:05.432100+09:00
>
> 2019-08-07 12:04:05.432100+09:00
>
> 2019-08-07 12:04:05.432100+09:00
>
> 2019-08-07 12:04:05+09:00
>
> 2019-08-07 12:04:05+09:00

> 2019-08-07 03:04:05.432100+09:00
>
> 2019-08-07 03:04:05.432100+09:00

<a id="markdown-日付時刻の-format-文字列に埋め込むディレクティブ" name="日付時刻の-format-文字列に埋め込むディレクティブ"></a>

##### 日付時刻の format 文字列に埋め込むディレクティブ

https://docs.python.org/ja/3/library/time.html#time.strftime

| ディレクティブ | 意味                                                                                                                                                  | 注釈 |
| -------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- | ---- |
| %a             | ロケールにおける省略形の曜日名。                                                                                                                      |      |
| %A             | ロケールにおける省略なしの曜日名。                                                                                                                    |      |
| %b             | ロケールにおける省略形の月名。                                                                                                                        |      |
| %B             | ロケールにおける省略なしの月名。                                                                                                                      |      |
| %c             | ロケールにおける適切な日付および時刻表現。                                                                                                            |      |
| %d             | 月の始めから何日目かを表す 10 進数 [01,31]。                                                                                                          |      |
| %H             | (24 時間計での) 時を表す 10 進数 [00,23]。                                                                                                            |      |
| %I             | (12 時間計での) 時を表す 10 進数 [01,12]。                                                                                                            |      |
| %j             | 年の初めから何日目かを表す 10 進数 [001,366]。                                                                                                        |      |
| %m             | 月を表す 10 進数 [01,12]。                                                                                                                            |      |
| %M             | 分を表す 10 進数 [00,59]。                                                                                                                            |      |
| %p             | ロケールにおける AM または PM に対応する文字列。                                                                                                      | (1)  |
| %S             | 秒を表す 10 進数 [00,61]。                                                                                                                            | (2)  |
| %U             | 年の初めから何週目か (日曜を週の始まりとします)を表す<br>10 進数 [00,53]。年が明けてから最初の日曜日までの全ての曜日は 0 週目に属すると見なされます。 | (3)  |
| %w             | 曜日を表す 10 進数 [0(日曜日),6]。                                                                                                                    |      |
| %W             | 年の初めから何週目か (日曜を週の始まりとします)を表す<br>10 進数 [00,53]。年が明けてから最初の月曜日までの全ての曜日は 0 週目に属すると見なされます。 | (3)  |
| %x             | ロケールにおける適切な日付の表現。                                                                                                                    |      |
| %X             | ロケールにおける適切な時刻の表現。                                                                                                                    |      |
| %y             | 上 2 桁なしの西暦年を表す 10 進数 [00,99]。                                                                                                           |      |
| %Y             | 上 2 桁付きの西暦年を表す 10 進数。                                                                                                                   |      |
| %Z             | タイムゾーンの名前 (タイムゾーンがない場合には空文字列)。                                                                                             |      |
| %%             | 文字 “%” 自体の表現。                                                                                                                                 |      |

1. strptime() 関数で使う場合、%p ディレクティブが出力結果の時刻フィールドに影響を及ぼすのは、時刻を解釈するために %I を使ったときのみです。
1. 値の幅は実際に 0 から 61 です; 60 は うるう秒\<leap seconds\> を表し、 61 は歴史的理由によりサポートされています。
1. strptime() 関数で使う場合、%U および %W を計算に使うのは曜日と年を指定したときだけです。

<a id="markdown-祝日判定" name="祝日判定"></a>

### 祝日判定

[emasaka/jpholidayp](https://github.com/emasaka/jpholidayp)

<a id="markdown-実行時間を計測" name="実行時間を計測"></a>

### 実行時間を計測

<a id="markdown-小数点以下がミリ秒" name="小数点以下がミリ秒"></a>

#### 小数点以下がミリ秒

```py
import time # 計測
import random, string # ランダム文字列生成


started = time.perf_counter()

print(
    [random.choice(string.ascii_letters + string.digits) for i in range(10000)]
)

print(time.perf_counter() - started)
```

<a id="markdown-ナノ秒単位" name="ナノ秒単位"></a>

#### ナノ秒単位

```
import time # 計測
import random, string # ランダム文字列生成


started = time.perf_counter_ns()

print(
    [random.choice(string.ascii_letters + string.digits) for i in range(10000)]
)

print(time.perf_counter_ns() - started)
```

<a id="markdown-timeit" name="timeit"></a>

#### timeit

```py
import time # 計測
import timeit # 計測
import random, string # ランダム文字列生成


def long_long_proc(n=10000):
    print(
        [random.choice(string.ascii_letters + string.digits) for i in range(n)]
    )


result = timeit.timeit(long_long_proc, number=1)
print(result)


result = timeit.repeat('long_long_proc(1000)', globals=globals(), number=10, repeat=3)
print(result)
```

<a id="markdown-str文字列" name="str文字列"></a>

## str(文字列)

```py
print('str\nstr')
print("str\nstr")
print(str(123))
print('cq' * 3) # 文字列の繰り返し
print('cq' + 'cq') # 文字列をつなげる(連結／結合)
print('cq' 'cq' 'cq') # 文字列を演算子なしでつなげる
```

> str
>
> str

> str
>
> str

> 123

> cqcqcq
>
> cqcqcq

<a id="markdown-エスケープシーケンス" name="エスケープシーケンス"></a>

### エスケープシーケンス

| 項目         | 内容                                                                  |
| ------------ | --------------------------------------------------------------------- |
| '\\'         | \                                                                     |
| '\''         | '                                                                     |
| "\""         | "                                                                     |
| '\a'         | ベル                                                                  |
| '\b'         | バックスペース                                                        |
| '\f'         | フォームフィード                                                      |
| '\n'         | LF                                                                    |
| '\r'         | CR                                                                    |
| '\t'         | タブ                                                                  |
| '\v'         | 垂直タブ                                                              |
| '\nnn'       | 8 進表記文字(n は 0 ～ 7)                                             |
| '\xnn'       | 16 進表記文字(n は 0 ～ f)                                            |
| '\uxxxx'     | ユニコード文字 xxxx (xxxx は 10 進数　例: u'\u3042'→'あ')             |
| '\Uxxxxxxxx' | ユニコード文字 xxxxxxxx (xxxxxxxx は 10 進数　例: U'\U00003042'→'あ') |
| '\N{name}'   | Unicode データベース文字 (例: u'\N{HIRAGANA LETTER A}'→'あ')          |

<a id="markdown-raw-文字列" name="raw-文字列"></a>

### RAW 文字列

```py
print(r'str\nstr') # エスケープシーケンスが無視される
print(R'str\nstr') # エスケープシーケンスが無視される
```

> str\nstr
>
> str\nstr

<a id="markdown-ヒアドキュメント" name="ヒアドキュメント"></a>

### ヒアドキュメント

```py
hoge = '''abc
def
ghi'''

print(hoge)
```

> abc
>
> def
>
> ghi

```py
piyo = 'abc \
def'

print(piyo)

fuga = ('abc'
    'def'
    'ghi')

print(fuga)
```

> abc def
>
> abcdefghi

<a id="markdown-文字列の連結" name="文字列の連結"></a>

#### 文字列の連結

```py
import random, string


# 低速
s = [random.choice(string.ascii_letters + string.digits) for i in range(10000)]
result = ''
for c in s:
    result += c
print(result)


# 高速
s = [random.choice(string.ascii_letters + string.digits) for i in range(10000)]
result = []
for c in s:
    result.append(c)
print(''.join(result))
```

<a id="markdown-文字列のフォーマット" name="文字列のフォーマット"></a>

### 文字列のフォーマット

フォーマットに利用する関数には以下の種類がある

- 組み込み関数`format()`
- `str.format()`
- f 文字列

| 種別           | 書き方                                                          | 結果                                      |
| -------------- | --------------------------------------------------------------- | ----------------------------------------- |
| `format()`     | `format(255, '06o')`                                            | `'000377'`                                |
| `str.format()` | `'{:06d}'.format(255)`                                          | `'000255'`                                |
| f 文字列       | `f'value : {255:04}'`                                           | `'value : 0255'`                          |
|                | `strval=255`<br>`f'value : {strval:06o}'`                       | `'value : 000377'`                        |
|                | `strval=255`<br>`f'value : {strval=:06x}'`                      | `'value : strval=0000ff'`<br>変数名も表示 |
|                | `strval=255`<br>`length=6`<br>`f'value : {strval=:0{length}o}'` | `'value : strval=000377'`<br>入れ子       |

print('{n:0{i}}'.format(n=n, i=i))

詳細は[書式指定子](#書式指定子)の項を参照

<a id="markdown-ゼロ埋め" name="ゼロ埋め"></a>

#### ゼロ埋め

| 関数                            | 値           |                  |
| ------------------------------- | ------------ | ---------------- |
| `print('12345'.zfill(8))`       | `00012345`   |                  |
| `print('1234567890'.zfill(8))`  | `1234567890` |                  |
| `print('+1234'.zfill(8))`       | `+0001234`   | +の後ろに 0 埋め |
| `print('-1234'.zfill(8))`       | `-0001234`   | -の後ろに 0 埋め |
| `print('-a1234'.zfill(8))`      | `-00a1234`   |                  |
| `print('xyz'.zfill(8))`         | `00000xyz`   |                  |
| `print(str(12345).zfill(8))`    | `00012345`   |                  |
|                                 |              |                  |
| `print('1234'.rjust(8, '0'))`   | `00001234`   |                  |
| `print('1234'.ljust(8, '0'))`   | `12340000`   |                  |
| `print('1234'.center(8, '0'))`  | `00123400`   |                  |
| `print('-1234'.rjust(8, '0'))`  | `000-1234`   |                  |
| `print('-1234'.ljust(8, '0'))`  | `-1234000`   |                  |
| `print('-1234'.center(8, '0'))` | `0-123400`   |                  |

<a id="markdown-書式指定子" name="書式指定子"></a>

#### 書式指定子

| 項目 | \*  | fill                              | \*           | align | \*                 | sign     | \*        | `#`  | `0`    | width        | \*           | grouping_option | \*         | precision             | \*                                      | type   | \*                                   |
| ---- | --- | --------------------------------- | ------------ | ----- | ------------------ | -------- | --------- | ---- | ------ | ------------ | ------------ | --------------- | ---------- | --------------------- | --------------------------------------- | ------ | ------------------------------------ |
|      |     | パディングに使う文字<sup>\*</sup> | (任意の文字) | 方向  |                    | 符号     |           | n 進 | 0 埋め | フィールド幅 | (任意の数値) | 桁区切り        |            | 小数桁数(type=f のみ) |                                         | 表現型 |                                      |
|      |     |                                   |              | `<`   | 左詰め             | `+`      | `+／-`    |      |        |              |              | `,`             | 3 桁区切り | `.<桁数>`             |                                         | `b`    | 2 進数                               |
|      |     |                                   |              | `>`   | 右詰め             | `-`      | `-` のみ  |      |        |              |              |                 |            | `.1`                  | 小数点以下１桁（小数点 2 位を四捨五入） | `c`    | Unicode 文字                         |
|      |     |                                   |              | `=`   | 符号の後ろを埋める | 半角空白 | `空白／-` |      |        |              |              |                 |            |                       |                                         | `d`    | 10 進数                              |
|      |     |                                   |              | `^`   | 中央               |          |           |      |        |              |              |                 |            |                       |                                         | `e`    | 指数表記                             |
|      |     |                                   |              |       |                    |          |           |      |        |              |              |                 |            |                       |                                         | `E`    | 大文字の `E` を使う指数表記          |
|      |     |                                   |              |       |                    |          |           |      |        |              |              |                 |            |                       |                                         | `f`    | 固定小数点数表記                     |
|      |     |                                   |              |       |                    |          |           |      |        |              |              |                 |            |                       |                                         | `F`    | (`nan` => `NAN`、`inf` => `INF`)     |
|      |     |                                   |              |       |                    |          |           |      |        |              |              |                 |            |                       |                                         | `g`    | 桁に応じて固定小数点か指数表記で表示 |
|      |     |                                   |              |       |                    |          |           |      |        |              |              |                 |            |                       |                                         | `G`    | (指数表記の時に`E`を使う)            |
|      |     |                                   |              |       |                    |          |           |      |        |              |              |                 |            |                       |                                         | `n`    | 数値(数値分割文字が挿入される)       |
|      |     |                                   |              |       |                    |          |           |      |        |              |              |                 |            |                       |                                         | `o`    | 8 進数                               |
|      |     |                                   |              |       |                    |          |           |      |        |              |              |                 |            |                       |                                         | `s`    | 文字列                               |
|      |     |                                   |              |       |                    |          |           |      |        |              |              |                 |            |                       |                                         | `x`    | 16 進数                              |
|      |     |                                   |              |       |                    |          |           |      |        |              |              |                 |            |                       |                                         | `X`    | `A`以降の数字に大文字を使う 16 進数  |
|      |     |                                   |              |       |                    |          |           |      |        |              |              |                 |            |                       |                                         | `%`    | 数値を 100 倍して%表記               |

注)f 文字列や str.format()では、fill に `{` と `}`を使えない

<a id="markdown-format-関数" name="format-関数"></a>

#### format 関数

<a id="markdown-strformat-関数" name="strformat-関数"></a>

#### str.format 関数

| 関数                            | 値           |                                     |
| ------------------------------- | ------------ | ----------------------------------- |
| `print('{}'.format(1))`         | `1`          |                                     |
| `print('{{}}'.format(1))`       | `{}`         | {}自体を記述したい場合は 2 つ重ねる |
| `print('{:+}'.format(1))`       | `+1`         | 正の数でも符号を表示                |
| `print('{:0=10}'.format(100))`  | `0000000100` | ゼロ埋め                            |
| `print('{:010}'.format(100))`   | `0000000100` |                                     |
| `print('{:0=10}'.format(-100))` | `-000000100` |                                     |
| `print('{:010}'.format(-100))`  | `-000000100` |                                     |
| `print('{:w<10}'.format(1))`    | `1wwwwwwwww` | 左寄せ                              |
| `print('{:0<10}'.format(1))`    | `1000000000` |                                     |
| `print('{:w>10}'.format(1))`    | `wwwwwwwww1` | 右寄せ                              |
| `print('{:0>10}'.format(1))`    | `0000000001` |                                     |
| `print('{:w^10}'.format(1))`    | `wwww1wwwww` | センタリング(中央寄せ)              |
| `print('{:0^10}'.format(1))`    | `0000100000` |                                     |

- 入れ子

```py
val = 15
digits = 6

'{:0>{width}b}'.format(val, width=digits)
'{0:0>{1}b}'.format(val, digits)
'{:0>{}{}}'.format(val, digits, 'b')
'{:{}{}{}}'.format(val, '0>',digits, 'b')
```

<a id="markdown-整列" name="整列"></a>

##### 整列

| 関数                                                         | 値      |                        |
| ------------------------------------------------------------ | ------- | ---------------------- |
| `print('{} {} {}'.format(1, 2, 3))`                          | `1 2 3` | 複数の値を埋め込む     |
| `print('{2} {0} {1}'.format(1, 2, 3))`                       | `3 1 2` | 埋め込み順序を指定する |
| `print('{one} {three} {two}'.format(one=1, two=2, three=3))` | `1 3 2` | 埋め込み順序を指定する |

<a id="markdown-小数点以下の桁数" name="小数点以下の桁数"></a>

##### 小数点以下の桁数

```py
print('{:.0f}'.format(1.5))
print('{:.0f}'.format(2.5)) # 偶数への丸め(JIS Z 8401)なので、3ではなく2となる(round関数と同様)
```

> 2
>
> 2

<a id="markdown-桁区切り文字" name="桁区切り文字"></a>

##### 桁区切り文字

```py
print('{:,}'.format(1234567))
```

> 1,234,567

<a id="markdown-指数表記" name="指数表記"></a>

##### 指数表記

```py
print('{:.3e}'.format(1.234567))
```

> 1.235e+00

<a id="markdown-2-進数8-進数16-進数" name="2-進数8-進数16-進数"></a>

##### 2 進数、8 進数、16 進数

| 関数                         | 値           |                     |
| ---------------------------- | ------------ | ------------------- |
| `print('{:d}'.format(255))`  | `255`        | 10 進数             |
|                              |              |                     |
| `print('{:b}'.format(255))`  | `11111111`   | 2 進数              |
| `print('{:o}'.format(255))`  | `377`        | 8 進数              |
| `print('{:x}'.format(255))`  | `ff`         | 16 進数             |
| `print('{:#b}'.format(255))` | `0b11111111` | 2 進数(接頭辞付き)  |
| `print('{:#o}'.format(255))` | `0o377`      | 8 進数(接頭辞付き)  |
| `print('{:#x}'.format(255))` | `0xff`       | 16 進数(接頭辞付き) |

<a id="markdown-リストの値を代入" name="リストの値を代入"></a>

##### リストの値を代入

```py
lst = ['first', 'second', 'third']
mes = '{}: {}{}'.format(*lst)
print(mes)

mes = '{0[0]}: {0[1]}{0[2]}'.format(lst)
print(mes)
```

> first: secondthird
>
> first: secondthird

```py
# 複数のリストから値を埋め込む
lst1 = ['first', 'second', 'third']
lst2 = ['one', 'two', 'three']
mes = '{0[0]}: {0[1]}{0[2]}\t{1[0]}: {1[1]}{1[2]}'.format(lst1, lst2)
print(mes)
```

> first: secondthird one: twothree

<a id="markdown-タプルの値を代入" name="タプルの値を代入"></a>

##### タプルの値を代入

```py
tpl = ('first', 'second', 'third')
mes = '{}: {}{}'.format(*tpl)
print(mes)

mes = '{0[0]}: {0[1]}{0[2]}'.format(tpl)
print(mes)
```

> first: secondthird
>
> first: secondthird

<a id="markdown-辞書の値を代入" name="辞書の値を代入"></a>

##### 辞書の値を代入

```py
dct = { 'aaa':'first', 'bbb':'second', 'ccc':'third'}
mes = '{aaa}: {bbb}{ccc}'.format(**dct)
print(mes)
```

> first: secondthird

<a id="markdown-クラスの属性値を代入" name="クラスの属性値を代入"></a>

##### クラスの属性値を代入

```py
class MyClass:
    id = 1
    name = 'n1'

myClass = MyClass()
print('{0.id} {0.name}'.format(myClass)) # クラスの属性を指定する
```

> 1 n1 \# クラスの属性を指定する

<a id="markdown-f-文字列" name="f-文字列"></a>

#### f 文字列

```py
one = 'first'
two = 2
three = '3rd'
mes = f'{one}: {two}{three}'
print(mes)
```

> first: 23rd

```py
strval=255
mes = f'value : {strval=:06d}'
print(mes)

# RAW文字列との組み合わせ
length=32
mes = fr'value :\t{strval=:0{length}o}'
print(mes)
```

> value : strval=000255
>
> # RAW 文字列との組み合わせ
>
> value :\tstrval=00000000000000000000000000000377

<a id="markdown-リストの値を代入-1" name="リストの値を代入-1"></a>

##### リストの値を代入

```py
lst = ['first', 'second', 'third']
mes = f'{lst[0]}: {lst[1]}{lst[2]}'
print(mes)
```

> first: secondthird

<a id="markdown-タプルの値を代入-1" name="タプルの値を代入-1"></a>

##### タプルの値を代入

```py
tpl = ('first', 'second', 'third')
mes = f'{tpl[0]}: {tpl[1]}{tpl[2]}'
print(mes)
```

> first: secondthird

<a id="markdown-辞書の値を代入-1" name="辞書の値を代入-1"></a>

##### 辞書の値を代入

`f""` の中では `"` は使えず、 `f''`の中では `'` は使えない(バックスラッシュでエスケープできない)

```py
dct = { 'aaa':'first', 'bbb':'second', 'ccc':'third'}
mes = f"{dct['aaa']}: {dct['bbb']}{dct['ccc']}"
print(mes)
```

> first: secondthird

<a id="markdown-フォーマット演算子" name="フォーマット演算子"></a>

#### フォーマット演算子

- 種類

| 関数                  | 種類    | 値             |
| --------------------- | ------- | -------------- |
| `print('%c' % 'A')`   | 文字    | `A`            |
| `print('%s' % 'ABC')` | 文字列  | `ABC`          |
| `print('%r' % 'ABC')` |         | `ABC`          |
|                       |         |                |
| `print('%d' % 123)`   | 整数    | `123`          |
| `print('%i' % 123)`   |         | `123`          |
|                       |         |                |
| `print('%e' % 1.23)`  | 指数    | `1.230000e+00` |
| `print('%E' % 1.23)`  |         | `1.230000E+00` |
| `print('%f' % 1.23)`  | 実数    | `1.23`         |
| `print('%F' % 1.23)`  |         | `1.23`         |
|                       |         |                |
| `print('%o' % 255)`   | 8 進数  | `377`          |
| `print('%b' % 255)`   |         | `377`          |
|                       |         |                |
| `print('%x' % 255)`   | 16 進数 | `ff`           |
| `print('%X' % 255)`   |         | `FF`           |
|                       |         |                |
| `print('%d%%' % 100)` | %自体   | `100%`         |

- 配置

| 関数     | 値    | 備考        |
| -------- | ----- | ----------- | --- | ----- | --- | ----------------- |
| `print(' | %4s   | ' % 'ABC')` | `   | ABC   | `   | 右寄せ            |
| `print(' | %-4s  | ' % 'ABC')` | `   | ABC   | `   | 左寄せ            |
| `print(' | %4d   | ' % 123)`   | `   | 123   | `   | 右寄せ            |
| `print(' | %-4d  | ' % 123)`   | `   | 123   | `   | 左寄せ            |
| `print(' | %+5d  | ' % 123)`   | `   | +123  | `   | ± 符号付き        |
| `print(' | %5.2f | ' % 1.23)`  | `   | 1.23  | `   | 桁数.小数部の桁数 |
| `print(' | %05d  | ' % 123)`   | `   | 00123 | `   | 0 埋め            |

<a id="markdown-文字種チェック" name="文字種チェック"></a>

### 文字種チェック

<a id="markdown-数値チェック" name="数値チェック"></a>

#### 数値チェック

```py
def is_int(intstr):
    try:
        int(intstr)
        return True
    except ValueError:
        return False
```

```py
def check_numstr(numstr):
    print(
        '{} {} {} {}'.format(
            numstr,
            numstr.isdigit(),
            numstr.isdecimal(),
            numstr.isnumeric()
        )
    )
```

| numstr | isdigit() | isdecimal() | isnumeric() |
| ------ | --------- | ----------- | ----------- |
| `1`    | True      | True        | True        |
| `01`   | True      | True        | True        |
| `１`   | True      | True        | True        |
| `①`    | True      |             | True        |
| `一`   |           |             | True        |
| `1`    |           |             |             |
| `0x11` |           |             |             |
| `1.1`  |           |             |             |

```py
import itertools

print('| chr | isdigit | isdecimal | isnumeric')
print('---------------------------------------')
for number in range(0, 12000):
    char = chr(number)
    if (char.isdigit() or char.isdecimal() or char.isnumeric()):
        print('| {0:>3} | {1:^7} | {2:^9} | {3:9} '.format(
            char,
            'True' if char.isdigit() else ' ',
            'True' if char.isdecimal() else ' ',
            'True' if char.isnumeric() else ' '
        )
    )

```

```
|   0 |  True   |   True    | True
|   1 |  True   |   True    | True
|   2 |  True   |   True    | True
|   3 |  True   |   True    | True
|   4 |  True   |   True    | True
|   5 |  True   |   True    | True
|   6 |  True   |   True    | True
|   7 |  True   |   True    | True
|   8 |  True   |   True    | True
|   9 |  True   |   True    | True
|   ² |  True   |           | True
|   ³ |  True   |           | True
|   ¹ |  True   |           | True
|   ¼ |         |           | True
|   ½ |         |           | True
|   ¾ |         |           | True
|   ٠ |  True   |   True    | True
|   ١ |  True   |   True    | True
|   ٢ |  True   |   True    | True
|   ٣ |  True   |   True    | True
|   ٤ |  True   |   True    | True
|   ٥ |  True   |   True    | True
|   ٦ |  True   |   True    | True
|   ٧ |  True   |   True    | True
|   ٨ |  True   |   True    | True
|   ٩ |  True   |   True    | True
|   ۰ |  True   |   True    | True
|   ۱ |  True   |   True    | True
|   ۲ |  True   |   True    | True
|   ۳ |  True   |   True    | True
|   ۴ |  True   |   True    | True
|   ۵ |  True   |   True    | True
|   ۶ |  True   |   True    | True
|   ۷ |  True   |   True    | True
|   ۸ |  True   |   True    | True
|   ۹ |  True   |   True    | True
|   ߀ |  True   |   True    | True
|   ߁ |  True   |   True    | True
|   ߂ |  True   |   True    | True
|   ߃ |  True   |   True    | True
|   ߄ |  True   |   True    | True
|   ߅ |  True   |   True    | True
|   ߆ |  True   |   True    | True
|   ߇ |  True   |   True    | True
|   ߈ |  True   |   True    | True
|   ߉ |  True   |   True    | True
|   ० |  True   |   True    | True
|   १ |  True   |   True    | True
|   २ |  True   |   True    | True
|   ३ |  True   |   True    | True
|   ४ |  True   |   True    | True
|   ५ |  True   |   True    | True
|   ६ |  True   |   True    | True
|   ७ |  True   |   True    | True
|   ८ |  True   |   True    | True
|   ९ |  True   |   True    | True
|   ০ |  True   |   True    | True
|   ১ |  True   |   True    | True
|   ২ |  True   |   True    | True
|   ৩ |  True   |   True    | True
|   ৪ |  True   |   True    | True
|   ৫ |  True   |   True    | True
|   ৬ |  True   |   True    | True
|   ৭ |  True   |   True    | True
|   ৮ |  True   |   True    | True
|   ৯ |  True   |   True    | True
|   ৴ |         |           | True
|   ৵ |         |           | True
|   ৶ |         |           | True
|   ৷ |         |           | True
|   ৸ |         |           | True
|   ৹ |         |           | True
|   ੦ |  True   |   True    | True
|   ੧ |  True   |   True    | True
|   ੨ |  True   |   True    | True
|   ੩ |  True   |   True    | True
|   ੪ |  True   |   True    | True
|   ੫ |  True   |   True    | True
|   ੬ |  True   |   True    | True
|   ੭ |  True   |   True    | True
|   ੮ |  True   |   True    | True
|   ੯ |  True   |   True    | True
|   ૦ |  True   |   True    | True
|   ૧ |  True   |   True    | True
|   ૨ |  True   |   True    | True
|   ૩ |  True   |   True    | True
|   ૪ |  True   |   True    | True
|   ૫ |  True   |   True    | True
|   ૬ |  True   |   True    | True
|   ૭ |  True   |   True    | True
|   ૮ |  True   |   True    | True
|   ૯ |  True   |   True    | True
|   ୦ |  True   |   True    | True
|   ୧ |  True   |   True    | True
|   ୨ |  True   |   True    | True
|   ୩ |  True   |   True    | True
|   ୪ |  True   |   True    | True
|   ୫ |  True   |   True    | True
|   ୬ |  True   |   True    | True
|   ୭ |  True   |   True    | True
|   ୮ |  True   |   True    | True
|   ୯ |  True   |   True    | True
|   ୲ |         |           | True
|   ୳ |         |           | True
|   ୴ |         |           | True
|   ୵ |         |           | True
|   ୶ |         |           | True
|   ୷ |         |           | True
|   ௦ |  True   |   True    | True
|   ௧ |  True   |   True    | True
|   ௨ |  True   |   True    | True
|   ௩ |  True   |   True    | True
|   ௪ |  True   |   True    | True
|   ௫ |  True   |   True    | True
|   ௬ |  True   |   True    | True
|   ௭ |  True   |   True    | True
|   ௮ |  True   |   True    | True
|   ௯ |  True   |   True    | True
|   ௰ |         |           | True
|   ௱ |         |           | True
|   ௲ |         |           | True
|   ౦ |  True   |   True    | True
|   ౧ |  True   |   True    | True
|   ౨ |  True   |   True    | True
|   ౩ |  True   |   True    | True
|   ౪ |  True   |   True    | True
|   ౫ |  True   |   True    | True
|   ౬ |  True   |   True    | True
|   ౭ |  True   |   True    | True
|   ౮ |  True   |   True    | True
|   ౯ |  True   |   True    | True
|   ౸ |         |           | True
|   ౹ |         |           | True
|   ౺ |         |           | True
|   ౻ |         |           | True
|   ౼ |         |           | True
|   ౽ |         |           | True
|   ౾ |         |           | True
|   ೦ |  True   |   True    | True
|   ೧ |  True   |   True    | True
|   ೨ |  True   |   True    | True
|   ೩ |  True   |   True    | True
|   ೪ |  True   |   True    | True
|   ೫ |  True   |   True    | True
|   ೬ |  True   |   True    | True
|   ೭ |  True   |   True    | True
|   ೮ |  True   |   True    | True
|   ೯ |  True   |   True    | True
|   ൘ |         |           | True
|   ൙ |         |           | True
|   ൚ |         |           | True
|   ൛ |         |           | True
|   ൜ |         |           | True
|   ൝ |         |           | True
|   ൞ |         |           | True
|   ൦ |  True   |   True    | True
|   ൧ |  True   |   True    | True
|   ൨ |  True   |   True    | True
|   ൩ |  True   |   True    | True
|   ൪ |  True   |   True    | True
|   ൫ |  True   |   True    | True
|   ൬ |  True   |   True    | True
|   ൭ |  True   |   True    | True
|   ൮ |  True   |   True    | True
|   ൯ |  True   |   True    | True
|   ൰ |         |           | True
|   ൱ |         |           | True
|   ൲ |         |           | True
|   ൳ |         |           | True
|   ൴ |         |           | True
|   ൵ |         |           | True
|   ൶ |         |           | True
|   ൷ |         |           | True
|   ൸ |         |           | True
|   ෦ |  True   |   True    | True
|   ෧ |  True   |   True    | True
|   ෨ |  True   |   True    | True
|   ෩ |  True   |   True    | True
|   ෪ |  True   |   True    | True
|   ෫ |  True   |   True    | True
|   ෬ |  True   |   True    | True
|   ෭ |  True   |   True    | True
|   ෮ |  True   |   True    | True
|   ෯ |  True   |   True    | True
|   ๐ |  True   |   True    | True
|   ๑ |  True   |   True    | True
|   ๒ |  True   |   True    | True
|   ๓ |  True   |   True    | True
|   ๔ |  True   |   True    | True
|   ๕ |  True   |   True    | True
|   ๖ |  True   |   True    | True
|   ๗ |  True   |   True    | True
|   ๘ |  True   |   True    | True
|   ๙ |  True   |   True    | True
|   ໐ |  True   |   True    | True
|   ໑ |  True   |   True    | True
|   ໒ |  True   |   True    | True
|   ໓ |  True   |   True    | True
|   ໔ |  True   |   True    | True
|   ໕ |  True   |   True    | True
|   ໖ |  True   |   True    | True
|   ໗ |  True   |   True    | True
|   ໘ |  True   |   True    | True
|   ໙ |  True   |   True    | True
|   ༠ |  True   |   True    | True
|   ༡ |  True   |   True    | True
|   ༢ |  True   |   True    | True
|   ༣ |  True   |   True    | True
|   ༤ |  True   |   True    | True
|   ༥ |  True   |   True    | True
|   ༦ |  True   |   True    | True
|   ༧ |  True   |   True    | True
|   ༨ |  True   |   True    | True
|   ༩ |  True   |   True    | True
|   ༪ |         |           | True
|   ༫ |         |           | True
|   ༬ |         |           | True
|   ༭ |         |           | True
|   ༮ |         |           | True
|   ༯ |         |           | True
|   ༰ |         |           | True
|   ༱ |         |           | True
|   ༲ |         |           | True
|   ༳ |         |           | True
|   ၀ |  True   |   True    | True
|   ၁ |  True   |   True    | True
|   ၂ |  True   |   True    | True
|   ၃ |  True   |   True    | True
|   ၄ |  True   |   True    | True
|   ၅ |  True   |   True    | True
|   ၆ |  True   |   True    | True
|   ၇ |  True   |   True    | True
|   ၈ |  True   |   True    | True
|   ၉ |  True   |   True    | True
|   ႐ |  True   |   True    | True
|   ႑ |  True   |   True    | True
|   ႒ |  True   |   True    | True
|   ႓ |  True   |   True    | True
|   ႔ |  True   |   True    | True
|   ႕ |  True   |   True    | True
|   ႖ |  True   |   True    | True
|   ႗ |  True   |   True    | True
|   ႘ |  True   |   True    | True
|   ႙ |  True   |   True    | True
|   ፩ |  True   |           | True
|   ፪ |  True   |           | True
|   ፫ |  True   |           | True
|   ፬ |  True   |           | True
|   ፭ |  True   |           | True
|   ፮ |  True   |           | True
|   ፯ |  True   |           | True
|   ፰ |  True   |           | True
|   ፱ |  True   |           | True
|   ፲ |         |           | True
|   ፳ |         |           | True
|   ፴ |         |           | True
|   ፵ |         |           | True
|   ፶ |         |           | True
|   ፷ |         |           | True
|   ፸ |         |           | True
|   ፹ |         |           | True
|   ፺ |         |           | True
|   ፻ |         |           | True
|   ፼ |         |           | True
|   ᛮ |         |           | True
|   ᛯ |         |           | True
|   ᛰ |         |           | True
|   ០ |  True   |   True    | True
|   ១ |  True   |   True    | True
|   ២ |  True   |   True    | True
|   ៣ |  True   |   True    | True
|   ៤ |  True   |   True    | True
|   ៥ |  True   |   True    | True
|   ៦ |  True   |   True    | True
|   ៧ |  True   |   True    | True
|   ៨ |  True   |   True    | True
|   ៩ |  True   |   True    | True
|   ៰ |         |           | True
|   ៱ |         |           | True
|   ៲ |         |           | True
|   ៳ |         |           | True
|   ៴ |         |           | True
|   ៵ |         |           | True
|   ៶ |         |           | True
|   ៷ |         |           | True
|   ៸ |         |           | True
|   ៹ |         |           | True
|   ᠐ |  True   |   True    | True
|   ᠑ |  True   |   True    | True
|   ᠒ |  True   |   True    | True
|   ᠓ |  True   |   True    | True
|   ᠔ |  True   |   True    | True
|   ᠕ |  True   |   True    | True
|   ᠖ |  True   |   True    | True
|   ᠗ |  True   |   True    | True
|   ᠘ |  True   |   True    | True
|   ᠙ |  True   |   True    | True
|   ᥆ |  True   |   True    | True
|   ᥇ |  True   |   True    | True
|   ᥈ |  True   |   True    | True
|   ᥉ |  True   |   True    | True
|   ᥊ |  True   |   True    | True
|   ᥋ |  True   |   True    | True
|   ᥌ |  True   |   True    | True
|   ᥍ |  True   |   True    | True
|   ᥎ |  True   |   True    | True
|   ᥏ |  True   |   True    | True
|   ᧐ |  True   |   True    | True
|   ᧑ |  True   |   True    | True
|   ᧒ |  True   |   True    | True
|   ᧓ |  True   |   True    | True
|   ᧔ |  True   |   True    | True
|   ᧕ |  True   |   True    | True
|   ᧖ |  True   |   True    | True
|   ᧗ |  True   |   True    | True
|   ᧘ |  True   |   True    | True
|   ᧙ |  True   |   True    | True
|   ᧚ |  True   |           | True
|   ᪀ |  True   |   True    | True
|   ᪁ |  True   |   True    | True
|   ᪂ |  True   |   True    | True
|   ᪃ |  True   |   True    | True
|   ᪄ |  True   |   True    | True
|   ᪅ |  True   |   True    | True
|   ᪆ |  True   |   True    | True
|   ᪇ |  True   |   True    | True
|   ᪈ |  True   |   True    | True
|   ᪉ |  True   |   True    | True
|   ᪐ |  True   |   True    | True
|   ᪑ |  True   |   True    | True
|   ᪒ |  True   |   True    | True
|   ᪓ |  True   |   True    | True
|   ᪔ |  True   |   True    | True
|   ᪕ |  True   |   True    | True
|   ᪖ |  True   |   True    | True
|   ᪗ |  True   |   True    | True
|   ᪘ |  True   |   True    | True
|   ᪙ |  True   |   True    | True
|   ᭐ |  True   |   True    | True
|   ᭑ |  True   |   True    | True
|   ᭒ |  True   |   True    | True
|   ᭓ |  True   |   True    | True
|   ᭔ |  True   |   True    | True
|   ᭕ |  True   |   True    | True
|   ᭖ |  True   |   True    | True
|   ᭗ |  True   |   True    | True
|   ᭘ |  True   |   True    | True
|   ᭙ |  True   |   True    | True
|   ᮰ |  True   |   True    | True
|   ᮱ |  True   |   True    | True
|   ᮲ |  True   |   True    | True
|   ᮳ |  True   |   True    | True
|   ᮴ |  True   |   True    | True
|   ᮵ |  True   |   True    | True
|   ᮶ |  True   |   True    | True
|   ᮷ |  True   |   True    | True
|   ᮸ |  True   |   True    | True
|   ᮹ |  True   |   True    | True
|   ᱀ |  True   |   True    | True
|   ᱁ |  True   |   True    | True
|   ᱂ |  True   |   True    | True
|   ᱃ |  True   |   True    | True
|   ᱄ |  True   |   True    | True
|   ᱅ |  True   |   True    | True
|   ᱆ |  True   |   True    | True
|   ᱇ |  True   |   True    | True
|   ᱈ |  True   |   True    | True
|   ᱉ |  True   |   True    | True
|   ᱐ |  True   |   True    | True
|   ᱑ |  True   |   True    | True
|   ᱒ |  True   |   True    | True
|   ᱓ |  True   |   True    | True
|   ᱔ |  True   |   True    | True
|   ᱕ |  True   |   True    | True
|   ᱖ |  True   |   True    | True
|   ᱗ |  True   |   True    | True
|   ᱘ |  True   |   True    | True
|   ᱙ |  True   |   True    | True
|   ⁰ |  True   |           | True
|   ⁴ |  True   |           | True
|   ⁵ |  True   |           | True
|   ⁶ |  True   |           | True
|   ⁷ |  True   |           | True
|   ⁸ |  True   |           | True
|   ⁹ |  True   |           | True
|   ₀ |  True   |           | True
|   ₁ |  True   |           | True
|   ₂ |  True   |           | True
|   ₃ |  True   |           | True
|   ₄ |  True   |           | True
|   ₅ |  True   |           | True
|   ₆ |  True   |           | True
|   ₇ |  True   |           | True
|   ₈ |  True   |           | True
|   ₉ |  True   |           | True
|   ⅐ |         |           | True
|   ⅑ |         |           | True
|   ⅒ |         |           | True
|   ⅓ |         |           | True
|   ⅔ |         |           | True
|   ⅕ |         |           | True
|   ⅖ |         |           | True
|   ⅗ |         |           | True
|   ⅘ |         |           | True
|   ⅙ |         |           | True
|   ⅚ |         |           | True
|   ⅛ |         |           | True
|   ⅜ |         |           | True
|   ⅝ |         |           | True
|   ⅞ |         |           | True
|   ⅟ |         |           | True
|   Ⅰ |         |           | True
|   Ⅱ |         |           | True
|   Ⅲ |         |           | True
|   Ⅳ |         |           | True
|   Ⅴ |         |           | True
|   Ⅵ |         |           | True
|   Ⅶ |         |           | True
|   Ⅷ |         |           | True
|   Ⅸ |         |           | True
|   Ⅹ |         |           | True
|   Ⅺ |         |           | True
|   Ⅻ |         |           | True
|   Ⅼ |         |           | True
|   Ⅽ |         |           | True
|   Ⅾ |         |           | True
|   Ⅿ |         |           | True
|   ⅰ |         |           | True
|   ⅱ |         |           | True
|   ⅲ |         |           | True
|   ⅳ |         |           | True
|   ⅴ |         |           | True
|   ⅵ |         |           | True
|   ⅶ |         |           | True
|   ⅷ |         |           | True
|   ⅸ |         |           | True
|   ⅹ |         |           | True
|   ⅺ |         |           | True
|   ⅻ |         |           | True
|   ⅼ |         |           | True
|   ⅽ |         |           | True
|   ⅾ |         |           | True
|   ⅿ |         |           | True
|   ↀ |         |           | True
|   ↁ |         |           | True
|   ↂ |         |           | True
|   ↅ |         |           | True
|   ↆ |         |           | True
|   ↇ |         |           | True
|   ↈ |         |           | True
|   ↉ |         |           | True
|   ① |  True   |           | True
|   ② |  True   |           | True
|   ③ |  True   |           | True
|   ④ |  True   |           | True
|   ⑤ |  True   |           | True
|   ⑥ |  True   |           | True
|   ⑦ |  True   |           | True
|   ⑧ |  True   |           | True
|   ⑨ |  True   |           | True
|   ⑩ |         |           | True
|   ⑪ |         |           | True
|   ⑫ |         |           | True
|   ⑬ |         |           | True
|   ⑭ |         |           | True
|   ⑮ |         |           | True
|   ⑯ |         |           | True
|   ⑰ |         |           | True
|   ⑱ |         |           | True
|   ⑲ |         |           | True
|   ⑳ |         |           | True
|   ⑴ |  True   |           | True
|   ⑵ |  True   |           | True
|   ⑶ |  True   |           | True
|   ⑷ |  True   |           | True
|   ⑸ |  True   |           | True
|   ⑹ |  True   |           | True
|   ⑺ |  True   |           | True
|   ⑻ |  True   |           | True
|   ⑼ |  True   |           | True
|   ⑽ |         |           | True
|   ⑾ |         |           | True
|   ⑿ |         |           | True
|   ⒀ |         |           | True
|   ⒁ |         |           | True
|   ⒂ |         |           | True
|   ⒃ |         |           | True
|   ⒄ |         |           | True
|   ⒅ |         |           | True
|   ⒆ |         |           | True
|   ⒇ |         |           | True
|   ⒈ |  True   |           | True
|   ⒉ |  True   |           | True
|   ⒊ |  True   |           | True
|   ⒋ |  True   |           | True
|   ⒌ |  True   |           | True
|   ⒍ |  True   |           | True
|   ⒎ |  True   |           | True
|   ⒏ |  True   |           | True
|   ⒐ |  True   |           | True
|   ⒑ |         |           | True
|   ⒒ |         |           | True
|   ⒓ |         |           | True
|   ⒔ |         |           | True
|   ⒕ |         |           | True
|   ⒖ |         |           | True
|   ⒗ |         |           | True
|   ⒘ |         |           | True
|   ⒙ |         |           | True
|   ⒚ |         |           | True
|   ⒛ |         |           | True
|   ⓪ |  True   |           | True
|   ⓫ |         |           | True
|   ⓬ |         |           | True
|   ⓭ |         |           | True
|   ⓮ |         |           | True
|   ⓯ |         |           | True
|   ⓰ |         |           | True
|   ⓱ |         |           | True
|   ⓲ |         |           | True
|   ⓳ |         |           | True
|   ⓴ |         |           | True
|   ⓵ |  True   |           | True
|   ⓶ |  True   |           | True
|   ⓷ |  True   |           | True
|   ⓸ |  True   |           | True
|   ⓹ |  True   |           | True
|   ⓺ |  True   |           | True
|   ⓻ |  True   |           | True
|   ⓼ |  True   |           | True
|   ⓽ |  True   |           | True
|   ⓾ |         |           | True
|   ⓿ |  True   |           | True
|   ❶ |  True   |           | True
|   ❷ |  True   |           | True
|   ❸ |  True   |           | True
|   ❹ |  True   |           | True
|   ❺ |  True   |           | True
|   ❻ |  True   |           | True
|   ❼ |  True   |           | True
|   ❽ |  True   |           | True
|   ❾ |  True   |           | True
|   ❿ |         |           | True
|   ➀ |  True   |           | True
|   ➁ |  True   |           | True
|   ➂ |  True   |           | True
|   ➃ |  True   |           | True
|   ➄ |  True   |           | True
|   ➅ |  True   |           | True
|   ➆ |  True   |           | True
|   ➇ |  True   |           | True
|   ➈ |  True   |           | True
|   ➉ |         |           | True
|   ➊ |  True   |           | True
|   ➋ |  True   |           | True
|   ➌ |  True   |           | True
|   ➍ |  True   |           | True
|   ➎ |  True   |           | True
|   ➏ |  True   |           | True
|   ➐ |  True   |           | True
|   ➑ |  True   |           | True
|   ➒ |  True   |           | True
|   ➓ |         |           | True
|   ⳽  |         |           | True

```

<a id="markdown-最大値・最小値文字列" name="最大値・最小値文字列"></a>

### 最大値・最小値（文字列）

```py
print(max('abcxyz'))
print(min('abcxyz'))
```

> z
>
> a

<a id="markdown-バイト列byte-unicode" name="バイト列byte-unicode"></a>

### バイト列(byte), Unicode

<a id="markdown-python-3" name="python-3"></a>

#### Python 3

```py
print('あいうえお')
print(len('あいうえお'))        # uをつけなくてもUnicodeとして扱われる
print(b'あいうえお')
print(len(b'あいうえお'))       # バイト列として扱われる
print(r'あいう\nえお')          # Raw文字列
print(len(r'あいう\nえお'))
```

> あいうえお
>
> 5
>
> SyntaxError: bytes can only contain ASCII literal characters.
>
> SyntaxError: bytes can only contain ASCII literal characters.
>
> あいう\n えお
>
> 7

<a id="markdown-python-2" name="python-2"></a>

#### Python 2

```py
print u'あいうえお'
print len(u'あいうえお')
print 'あいうえお'
print len('あいうえお')        # バイト列として扱われる
```

> あいうえお
>
> 5
>
> あいうえお
>
> 15

<a id="markdown-文字列とバイト列の変換" name="文字列とバイト列の変換"></a>

#### 文字列とバイト列の変換

```py
'foobar'.encode() # b'foobar'
b'foobar'.decode() # 'foobar'

# 文字コードを明示
'foobar'.encode(encoding='utf-8') # b'foobar'
b'foobar'.decode(encoding='utf-8') # 'foobar'
bytes('abcd', encoding='utf-8')
str(b'abcd', encoding='utf-8')

# UnicodeDecodeErrorを無視する
b'\xff'.decode() # UnicodeDecodeError: 'utf-8' codec can't decode byte 0xff in position 0: invalid start byte

b'\xff'.decode('utf-8', 'replace') # '�'
b'\xff'.decode(encoding='utf-8', errors='replace') # '�'

bytes('abcd', encoding='utf-8', errors='replace') # b'abcd'
str(b'abcd', encoding='utf-8', errors='replace') # 'abcd'

```

<a id="markdown-区切り文字による分割" name="区切り文字による分割"></a>

### 区切り文字による分割

```py
hoge = 'abc\ndef\nghi\njkl\nmno\npqr\nstu\nvwx\nyz'
parts = hoge.split('\n')
for key, value in enumerate(parts):
    print('{0}:{1}'.format(key, value))
```

> 0:abc
>
> 1:def
>
> 2:ghi
>
> 3:jkl
>
> 4:mno
>
> 5:pqr
>
> 6:stu
>
> 7:vwx
>
> 8:yz

<a id="markdown-split-の引数を指定しないと空白文字タブ文字改行文字を含むで分割される" name="split-の引数を指定しないと空白文字タブ文字改行文字を含むで分割される"></a>

#### split の引数を指定しないと、空白文字(タブ文字、改行文字を含む)で分割される

```py
hoge = 'a bc\nde f\nghi\njkl\nmno\npqr\nstu\nvwx\ny z'
parts = hoge.split('\n')
print(parts)
```

> ['a bc', 'de f', 'ghi', 'jkl', 'mno', 'pqr', 'stu', 'vwx', 'y z']

| 文字          |
| ------------- |
| スペース ``   |
| タブ `\t`     |
| 改行 `\n`     |
| 復帰 `\r`     |
| 改頁 `\f`     |
| 垂直タブ `\v` |

<a id="markdown-split-で分割した後各要素の先頭・末尾の空白文字を除去する" name="split-で分割した後各要素の先頭・末尾の空白文字を除去する"></a>

#### split で分割した後、各要素の先頭・末尾の空白文字を除去する

```py
hoge = 'abc, def,\tghi'
parts = [x.strip() for x in hoge.split(',')]
print(parts)
```

> ['abc', 'def', 'ghi']

<a id="markdown-正規表現で区切り文字を指定して分割" name="正規表現で区切り文字を指定して分割"></a>

#### 正規表現で区切り文字を指定して分割

```py
import re

hoge = 'abc\n  def\nghi \njkl\nmno\npqr\nstu\nvwx\nyz.'
parts = re.split('[,. \\s]+', hoge)
for key, value in enumerate(parts):
    print('{0}:{1}'.format(key, value))
```

> 0:abc
>
> 1:def
>
> 2:ghi
>
> 3:jkl
>
> 4:mno
>
> 5:pqr
>
> 6:stu
>
> 7:vwx
>
> 8:yz
>
> 9:

<a id="markdown-部分文字列" name="部分文字列"></a>

### 部分文字列

<a id="markdown-1-文字ずつ処理する" name="1-文字ずつ処理する"></a>

#### 1 文字ずつ処理する

```py
for c in 'abc':
    print(c)
```

> a
>
> b
>
> c

<a id="markdown-インデックスを取得" name="インデックスを取得"></a>

##### インデックスを取得

```py
for i, c in enumerate('abc'):
    print("{0}: {1}".format(i, c))
```

> 0: a
>
> 1: b
>
> 2: c

<a id="markdown-スライスで指定" name="スライスで指定"></a>

#### スライスで指定

```py
# index #################################
# 0   1   2   3   4   5   6   7   8   9 #
# | A | B | C | D | E | f | g | h | i | #
# -9  -8  -7  -6  -5  -4  -3  -2  -1  0 #
#########################################

hoge = 'abcdefghi'
print(hoge[:])      # abcdefghi
print(hoge[1:3])    # bc
print(hoge[:3])     # abc # 先頭から3文字
print(hoge[8:])     # i
print(hoge[-2:])    # hi # 末尾から2文字
print(hoge[:-4])    # abcde
print(hoge[-4:-2])  # fg
print(hoge[0:7:2])  # acdf

# 文字列を逆順にする
print(hoge[::-1])   # ihgfedcba

# 範囲外のインデックスを指定してもエラーにはならない
print(hoge[:100])   # abcdefghi
print(hoge[100])    # スライスではなくインデックス指定の場合は IndexError: string index out of range

# 0は、マイナスを付けても「末尾から」にならない
print(hoge[0:])     # abcdefghi
print(hoge[-0:])    # abcdefghi
print(hoge[:0])     # （空文字）
print(hoge[:-0])    # （空文字）
```

<a id="markdown-部分文字列を全パターン取得する" name="部分文字列を全パターン取得する"></a>

#### 部分文字列を全パターン取得する

```py
hoge = 'abcdefghi'
l = len(hoge)

for s in range(l+1):
  for e in range(s+1, l+1):
    print(hoge[s:e])
```

```py
import itertools

hoge = 'abcdefghi'
l = len(hoge)

for s, e in itertools.combinations(range(l+1), 2):
  print(hoge[s:e])
```

```
a
ab
abc
abcd
abcde
abcdef
abcdefg
abcdefgh
abcdefghi
b
bc
bcd
bcde
bcdef
bcdefg
bcdefgh
bcdefghi
c
cd
cde
cdef
cdefg
cdefgh
cdefghi
d
de
def
defg
defgh
defghi
e
ef
efg
efgh
efghi
f
fg
fgh
fghi
g
gh
ghi
h
hi
i
```

<a id="markdown-文字列をランダムソートする" name="文字列をランダムソートする"></a>

#### 文字列をランダムソートする

```py
import random

hoge = 'abcdefghi'
''.join(random.sample(hoge, len(hoge)))
```

> 'cigahdebf'

<a id="markdown-エンコード・デコード" name="エンコード・デコード"></a>

### エンコード・デコード

<a id="markdown-base64" name="base64"></a>

#### Base64

```py
import base64

filepath = '/path/to/file'
filecontents = open(filepath, 'rb').read()

# エンコード
encoded = base64.b64encode( filecontents )
print(encoded)

# デコード
decoded = base64.b64decode( encoded )
if filecontents == decoded:
    print('success')
else:
    print('failure')
```

<a id="markdown-url-safe-な-base64" name="url-safe-な-base64"></a>

#### URL safe な Base64

```py
import base64

filepath = '/path/to/file'
filecontents = open(filepath, 'rb').read()

# エンコード
encoded = base64.urlsafe_b64encode( filecontents )
print(encoded)

# デコード
decoded = base64.urlsafe_b64decode( encoded )
if filecontents == decoded:
    print('success')
else:
    print('failure')
```

<a id="markdown-検索" name="検索"></a>

### 検索

<a id="markdown-単純な検索" name="単純な検索"></a>

#### 単純な検索

| メソッド | 特徴                                           |
| -------- | ---------------------------------------------- |
| find     | 文字列が見つからない場合に `-1` を返す         |
| index    | 文字列が見つからない場合に `ValueError` を返す |

```py
# -----:    0000000000111111111122222222223333333333444444444455
# count:    0123456789012345678901234567890123456789012345678901
haystack = 'abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz'
needle = 'e'
```

| 機能                       | 関数                            | 値     |
| -------------------------- | ------------------------------- | ------ |
| 文字列が含まれているか判定 | `print(needle in haystack)`     | `True` |
| 出現回数                   | `print(haystack.count(needle))` | `2`    |

| 機能                                       | 関数                                      | 値                                |
| ------------------------------------------ | ----------------------------------------- | --------------------------------- |
| 左から検索した場合の出現箇所(インデックス) | `print(haystack.find(needle))`            | `4`                               |
| (検索開始位置を指定)                       | `print(haystack.find(needle, 4))`         | `4`                               |
|                                            | `print(haystack.find(needle, 5))`         | `30`                              |
| (検索開始位置・検索終了位置を指定)         | `print(haystack.find(needle, 5,30))`      | `-1`                              |
|                                            | `print(haystack.index(needle, 5,30))`     | `ValueError: substring not found` |
|                                            | `print(haystack.find(needle, 5,31))`      | `30`                              |
|                                            |                                           |                                   |
| 右から検索した場合の出現箇所(インデックス) | `print(haystack.rfind(needle))`           | `30`                              |
| (検索終了位置を指定)                       | `print(haystack.rfind(needle, None, 30))` | `4`                               |
|                                            | `print(haystack.rfind(needle, None, 31))` | `30`                              |
| (検索開始位置・検索終了位置を指定)         | `print(haystack.rfind(needle, 5,30))`     | `-1`                              |
| (検索開始位置・検索終了位置を指定)         | `print(haystack.rindex(needle, 5,30))`    | `ValueError: substring not found` |
| (検索開始位置・検索終了位置を指定)         | `print(haystack.rfind(needle, 4,30))`     | `4`                               |

<a id="markdown-前方一致" name="前方一致"></a>

##### 前方一致

```py
haystack = 'abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz'
haystack.startswith('abc')
haystack.startswith('xyz')
```

> True
>
> False

<a id="markdown-後方一致" name="後方一致"></a>

##### 後方一致

```py
haystack = 'abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz'
haystack.endswith('abc')
haystack.endswith('xyz')
```

> False
>
> True

<a id="markdown-正規表現による検索" name="正規表現による検索"></a>

#### 正規表現による検索

<a id="markdown-メタ文字" name="メタ文字"></a>

##### メタ文字

| 文字 | 内容（ `re.ASCII` を指定した場合） | 内容（Unicode (str) パターン）                                 |
| ---- | ---------------------------------- | -------------------------------------------------------------- |
| `\b` | 文字列の境界                       | 単語は `\w` からなる（英数字以外も含む）                       |
| `\B` | `\b` 以外                          |                                                                |
| `\d` | `[0-9]`                            | `[0-9]` とその他多数の数字                                     |
| `\D` | `\d`                               |                                                                |
| `\s` | `[ \t\n\r\f\v]`                    | Unicode 空白文字                                               |
| `\S` | `\s` 以外                          |                                                                |
| `\w` | `[a-zA-Z0-9_]`                     | 単語の一部になりうるほとんどの文字、数字、およびアンダースコア |
| `\W` | `\w` 以外                          |                                                                |

| 文字 | 内容             |
| ---- | ---------------- |
| `\0` | NULL 文字        |
| `\A` | 文字列の先頭     |
| `\f` | FF               |
| `\l` | `[a-z]`          |
| `\L` | `\l` 以外        |
| `\n` | LF               |
| `\r` | CR               |
| `\t` | TAB              |
| `\u` | `[A-Z]`          |
| `\U` | `\u` 以外        |
| `\v` | VTAB（垂直タブ） |
| `\Z` | 文字列の末尾     |

| 文字         | 内容                 |
| ------------ | -------------------- |
| `\N{name}`   | Unicode 文字（名前） |
| `\uxxxx`     | （16bit）            |
| `\Uxxxxxxxx` | （32bit）            |

<a id="markdown-フラグを利用" name="フラグを利用"></a>

##### フラグを利用

[モジュールコンテンツ](https://docs.python.org/ja/3/library/re.html#contents-of-module-re)

| フラグ                | 効果                                                                               |
| --------------------- | ---------------------------------------------------------------------------------- |
| re.ASCII<br>re.A      | `\w \W \b \B \d \D \s \S` に、 ASCII 限定マッチングを行わせる                      |
| re.DOTALL<br>re.S     | '.' 特殊文字を、改行を含むあらゆる文字にマッチさせる                               |
| re.IGNORECASE<br>re.I | 大文字・小文字を区別しない                                                         |
| re.MULTILINE<br>re.M  | `^` を文字列の先頭と各改行の直後で、`$` を文字列の末尾と各改行の直前でマッチさせる |
| re.VERBOSE<br>re.X    | 正規表現を見た目よく読みやすく書けるようにします                                   |

```py
haystack = 'a12345.67890b'
patternA = re.compile(r'''\d +  # the integral part
                   \.    # the decimal point
                   \d *  # some fractional digits''', re.X)
patternB = re.compile(r'\d+\.\d*')
allfoundA = patternA.findall(haystack)
allfoundB = patternB.findall(haystack)

# 結果を取得
if allfoundA:
    print(allfoundA)

if allfoundB:
    print(allfoundB)
```

| 関数               | 値                |
| ------------------ | ----------------- |
| `print(allfoundA)` | `['12345.67890']` |
| `print(allfoundB)` | `['12345.67890']` |

<a id="markdown-パターンのコンパイル" name="パターンのコンパイル"></a>

##### パターンのコンパイル

<a id="markdown-コンパイルしない場合" name="コンパイルしない場合"></a>

###### コンパイルしない場合

```py
import re

content = 'abc123def'

pattern_match = r'\w+'
pattern_search = r'\d+'
pattern_findall = r'\w'

# 文字列の先頭でマッチ
result_match = re.match(pattern_match, content)
if result_match:
  print(result_match, result_match.span(), result_match.group())

# 文字列の途中でマッチ
result_search = re.search(pattern_search, content)
if result_search:
  print(result_search, result_search.span(), result_search.group())

# 文字列の途中でマッチした全ての箇所のリスト
result_findall = re.findall(pattern_findall, content)
if result_findall:
  for item in result_findall:
    print(item)
```

> \# result_match
>
> <re.Match object; span=(0, 9), match='abc123def'>
>
> (0, 9)
>
> abc123def

> \# result_search
>
> <re.Match object; span=(3, 6), match='123'>
>
> (3, 6)
>
> 123

> \# result_findall
>
> a
>
> b
>
> ...
>
> f

<a id="markdown-コンパイルする場合" name="コンパイルする場合"></a>

###### コンパイルする場合

```py
import re
r = re.compile(r'(\w)')
```

<a id="markdown-パターンを文字列型変数からコンパイル" name="パターンを文字列型変数からコンパイル"></a>

###### パターンを文字列型変数からコンパイル

```py
s = r'C:\Users\y\Documents'     # Raw文字列
print(s)                        # C:\Users\y\Documents

s = 'C:\\Users\\y\\Documents'
print(s)                        # C:\Users\y\Documents

p = 'y\\'
print(re.search(repr(p)[1:-1], s)) # <re.Match object; span=(9, 11), match='y\\'>
```

- raw 文字列でも、引用符をバックスラッシュでエスケープできるが、バックスラッシュ自体も文字列に残る
- - raw 文字列の末尾に奇数個連続したバックスラッシュは置けない
- - `r"\""` は OK、 `r"\"` は NG

```py
print(re.search('y', s))        # <re.Match object; span=(9, 10), match='y'>
print(re.search(r'y\', s))      # SyntaxError: EOL while scanning string literal
print(re.search('y\', s))       # SyntaxError: EOL while scanning string literal
print(re.search(r'y\\', s))     # <re.Match object; span=(9, 11), match='y\\'>
print(re.search('y\\', s))      # re.error: bad escape (end of pattern) at position 1
print(re.search(r'y\\\', s))    # SyntaxError: EOL while scanning string literal
print(re.search('y\\\', s))     # SyntaxError: EOL while scanning string literal
```

<a id="markdown-文字列の先頭でマッチ" name="文字列の先頭でマッチ"></a>

##### 文字列の先頭でマッチ

```py
import re

haystack = 'haystack'
needle = '([abd-jl-z]+)([ck]+)'

# コンパイル有
pattern = re.compile(needle)
matched = pattern.match(haystack)
print(matched)

# コンパイル無
matched = re.match(needle, haystack)
print(matched)

# 結果を取得
if matched:
    if matched.group() != '': # パターンが空文字とマッチするのを防ぐ場合
        print(matched.group())
        print(matched.start())
        print(matched.end())
        print(matched.span())

        ###

        print(matched.groups())
        for g in matched.groups():
            print(g)

        ###

        print(matched.group(0))
        print(matched.group(1))
        print(matched.group(2))
        print(matched.group(0, 1))

        ###

        print(matched.start(0))
        print(matched.end(1))
        print(matched.span(2))
```

| 関数                         | 値                                                        | 備考         |
| ---------------------------- | --------------------------------------------------------- | ------------ |
| `print(matched)`             | `<\_sre.SRE_Match object; span=(0, 8), match='haystack'>` | コンパイル有 |
| `print(matched)`             | `<\_sre.SRE_Match object; span=(0, 8), match='haystack'>` | コンパイル無 |
|                              |                                                           |              |
| `print(matched.group())`     | `haystack`                                                |              |
| `print(matched.start())`     | `0`                                                       |              |
| `print(matched.end())`       | `8`                                                       |              |
| `print(matched.span())`      | `(0, 8)`                                                  |              |
|                              |                                                           |              |
| `print(matched.groups())`    | `('haysta', 'ck')`                                        |              |
| `print(g)` (1 回目のループ)  | `haysta`                                                  |              |
| `print(g)` (2 回目のループ)  | `ck`                                                      |              |
|                              |                                                           |              |
| `print(matched.group(0))`    | `haystack`                                                |              |
| `print(matched.group(1))`    | `haysta`                                                  |              |
| `print(matched.group(2))`    | `ck`                                                      |              |
| `print(matched.group(0, 1))` | `('haystack', 'haysta')`                                  |              |
|                              |                                                           |              |
| `print(matched.start(0))`    | `0`                                                       |              |
| `print(matched.end(1))`      | `6`                                                       |              |
| `print(matched.span(2))`     | `(6, 8)`                                                  |              |

<a id="markdown-文字列の途中でマッチ" name="文字列の途中でマッチ"></a>

##### 文字列の途中でマッチ

<a id="markdown-マッチした最初の場所" name="マッチした最初の場所"></a>

###### マッチした最初の場所

```py
import re

haystack = 'haystack'
needle = '([a-rt-z]+)'

# コンパイル有
pattern = re.compile(needle)
searched = pattern.search(haystack)
print(searched)

# コンパイル無
searched = re.search(needle, haystack)
print(searched)

# 結果を取得
if searched:
    print(searched.group())
    print(searched.start())
    print(searched.end())
    print(searched.span())
```

| 関数                      | 値                                            | 備考         |
| ------------------------- | --------------------------------------------- | ------------ |
| `print(searched)`         | `<re.Match object; span=(0, 3), match='hay'>` | コンパイル有 |
| `print(searched)`         | `<re.Match object; span=(0, 3), match='hay'>` | コンパイル無 |
| `print(searched.group())` | `hay`                                         |              |
| `print(searched.start())` | `0`                                           |              |
| `print(searched.end())`   | `3`                                           |              |
| `print(searched.span())`  | `(0, 3)`                                      |              |

<a id="markdown-文字列の途中でマッチした全ての箇所のリスト" name="文字列の途中でマッチした全ての箇所のリスト"></a>

###### 文字列の途中でマッチした全ての箇所のリスト

```py
import re

haystack = 'haystack'
needle = '([a-rt-z]+)'

# コンパイル有
pattern = re.compile(needle)
allfound = pattern.findall(haystack)
print(allfound)

# コンパイル無
allfound = re.findall(needle, haystack)
print(allfound)

# 結果を取得
if allfound:
    print(allfound)
```

| 関数              | 値                | 備考         |
| ----------------- | ----------------- | ------------ |
| `print(allfound)` | `['hay', 'tack']` | コンパイル有 |
| `print(allfound)` | `['hay', 'tack']` | コンパイル無 |
| `print(allfound)` | `['hay', 'tack']` | 結果を取得   |

<a id="markdown-文字列の途中でマッチした全ての箇所のイテレーター" name="文字列の途中でマッチした全ての箇所のイテレーター"></a>

###### 文字列の途中でマッチした全ての箇所のイテレーター

```py
import re

haystack = 'haystack'
needle = '([a-rt-z]+)'

# コンパイル有
pattern = re.compile(needle)
allfound = pattern.finditer(haystack)
print(allfound)

# コンパイル無
allfound = re.finditer(needle, haystack)
print(allfound)

# 結果を取得
for found in allfound:
    print(found.group())
    print(found.start())
    print(found.end())
    print(found.span())
```

| 関数                                | 値                                              | 備考         |
| ----------------------------------- | ----------------------------------------------- | ------------ |
| `print(allfound)`                   | `<callable_iterator object at 0x7fd0e8dd4da0\>` | コンパイル有 |
| `print(allfound)`                   | `<callable_iterator object at 0x7fd0e8cc8a20\>` | コンパイル無 |
| `print(found.group())` (1 ループ目) | `hay`                                           |              |
| `print(found.start())` (1 ループ目) | `0`                                             |              |
| `print(found.end())` (1 ループ目)   | `3`                                             |              |
| `print(found.span())` (1 ループ目)  | `(0, 3)`                                        |              |
| `print(found.group())` (2 ループ目) | `tack`                                          |              |
| `print(found.start())` (2 ループ目) | `4`                                             |              |
| `print(found.end())` (2 ループ目)   | `8`                                             |              |
| `print(found.span())` (2 ループ目)  | `(4, 8)`                                        |              |

<a id="markdown-グループ化" name="グループ化"></a>

##### グループ化

<a id="markdown-グループ番号" name="グループ番号"></a>

###### グループ番号

```py
import re

haystack = 'haystack'
needle = '(h)([abd-gijl-z]+)([ck]+)'

matched = re.match(needle, haystack)
print(matched.groups())

print(matched.group(0))
print(matched.group(1))
print(matched.group(2))
print(matched.group(3))
```

| 関数                      | 値                     |
| ------------------------- | ---------------------- |
| `print(matched.groups())` | `('h', 'aysta', 'ck')` |
| `print(matched.group(0))` | `haystack`             |
| `print(matched.group(1))` | `h`                    |
| `print(matched.group(2))` | `aysta`                |
| `print(matched.group(3))` | `ck`                   |

<a id="markdown-シンボリックグループ名" name="シンボリックグループ名"></a>

###### シンボリックグループ名

```py
import re

haystack = 'haystack'
needle = r'(?P<ONE>h)(?P<two>[abd-gijl-z]+)(?P<three>[ck]+)'

matched = re.match(needle, haystack)
print(matched.group('ONE'))
print(matched.group('two'))
print(matched.group('three'))
print(matched.group(0, 'three'))

print(matched.groupdict())
```

| 関数                               | 値                                             |
| ---------------------------------- | ---------------------------------------------- |
| `print(matched.group('ONE'))`      | `h`                                            |
| `print(matched.group('two'))`      | `aysta`                                        |
| `print(matched.group('three'))`    | `ck`                                           |
| `print(matched.group(0, 'three'))` | `('haystack', 'ck')`                           |
|                                    |                                                |
| `print(matched.groupdict())`       | `{'ONE': 'h', 'two': 'aysta', 'three3': 'ck'}` |

<a id="markdown-先読み・後読み" name="先読み・後読み"></a>

##### 先読み・後読み

<a id="markdown-先読み" name="先読み"></a>

###### 先読み

`AAA(?=BB)` : AAA に BB が続く場合、 AAA にマッチ

```py
import re

# パターンに正規表現を使える
m = re.search(r'Windows(?=\s?10)', 'Windows 10')
m.group(0)
```

> 'Windows'

<a id="markdown-否定の先読み" name="否定の先読み"></a>

###### 否定の先読み

`AAA(?!BB)` : AAA に BB が続かない場合、 AAA にマッチ

```py
import re

# パターンに正規表現を使える
m = re.search(r'Windows(?!\s?10)', 'Windows XP')
m.group(0)
```

> 'Windows'

<a id="markdown-後読み" name="後読み"></a>

###### 後読み

`(?<=AA)BBB` : AA に BBB が続く場合、 BBB にマッチ

```py
import re

# パターンに正規表現を使えない
# m = re.search('(?<=Windows\s?)10', 'Windows 10')
# m.group(0)
m = re.search('(?<=Windows )10', 'Windows 10')
m.group(0)
```

> 10

<a id="markdown-否定の後読み" name="否定の後読み"></a>

###### 否定の後読み

`(?<!AA)BBB` : AA に BBB が続かない場合、 BBB にマッチ

```py
import re

# パターンに正規表現を使えない
# m = re.search('(?<!Windows\s?)10', 'Linux Mint 10')
# m.group(0)
m = re.search('(?<!Windows )10', 'Linux Mint 10')
m.group(0)

```

> 10

<a id="markdown-文字種のフィルタリング" name="文字種のフィルタリング"></a>

#### 文字種のフィルタリング

<a id="markdown-文字列全体が半角英数だけ含まれているか検査" name="文字列全体が半角英数だけ含まれているか検査"></a>

##### 文字列全体が半角英数だけ含まれているか検査

```py
import re

def validate(content):
    p = re.compile('[a-zA-Z0-9]+')
    if p.fullmatch(content):
        print('valid')
    else:
        print('invalid')

validate('abcdefg')

validate('abcdefgあいう')
```

> valid
>
> invalid

<a id="markdown-半角カナなどが含まれていないか検査" name="半角カナなどが含まれていないか検査"></a>

##### 半角カナなどが含まれていないか検査

```py
import re

def validate(content):
    p = re.compile('[｡-ﾟ]+') # 句読点などが不要であれば[ｦ-ﾟ]
    if p.search(content):
        print('found')
    else:
        print('valid')

validate('abcdefgあいう')
validate('abcdefgｱｲｳ')
```

> valid
>
> found

<a id="markdown-文字種別のパターン" name="文字種別のパターン"></a>

##### 文字種別のパターン

| 文字種              | パターン                                                    | 例             |
| ------------------- | ----------------------------------------------------------- | -------------- |
| 半角英字            | `'[a-zA-Z]+'`                                               |                |
| 半角数字            | `'[0-9]+'`                                                  |                |
| ASCII 文字          | `'[\u0000-\u007F]+'`                                        | `ABCabc!"#$%&` |
| 半角記号            | `'[\u0020-\u002F\u003A-\u0040\u005B-\u0060\u007B-\u007E]+'` | `!"#$%&`       |
| 全角英字            | `'[ａ-ｚＡ-Ｚ]+'`                                           |                |
| 全角数字            | `'[０-９]+'`                                                |                |
| ローマ数字          | `'[\u2160-\u217F]+'`                                        | `ⅠⅡⅢ`          |
| 漢数字              | `'[〇一二三四五六七八九十百千万億兆]+'`                     |                |
| ひらがな            | `'[\u3041-\u309F]+'`                                        |                |
| 全角カタカナ        | `'[\u30A1-\u30FF]+'`                                        |                |
| 半角カタカナ        | `'[\uFF66-\uFF9F]+'`                                        |                |
| 漢字 (CJK 統合漢字) | `'[\u4E00-\u9FFF]+'`                                        |
| ハングル            | `'[가-힣]+'`                                                |                |

<a id="markdown-置換" name="置換"></a>

### 置換

<a id="markdown-単純な置換" name="単純な置換"></a>

#### 単純な置換

```py
haystack = 'haystack'
needle = 'a'
replacement = 'replacement'

content = haystack.replace(needle, replacement)
content = haystack.replace(needle, replacement, 1)
```

> 'hreplacementystreplacementck'
> 'hreplacementystack'

<a id="markdown-改行文字を除去" name="改行文字を除去"></a>

##### 改行文字を除去

```py
haystack = 'haystack\nhaystack\r\nhaystack'
replacement = ''

replacement.join(haystack.splitlines())
```

> 'haystackhaystackhaystack'

<a id="markdown-前後の空白文字を除去trim" name="前後の空白文字を除去trim"></a>

##### 前後の空白文字を除去（trim）

```py
s = ' \txyz\t '
print('^' + s.strip() + '$')
print('^' + s.lstrip() + '$')
print('^' + s.rstrip() + '$')
```

> ^xyz\$
>
> ^xyz \$
>
> ^ xyz\$

```py
s = '### \txyz\t ###'
print('^' + s.strip('#') + '$') # 引数に指定された文字を先頭・末尾から除去する(空白文字は除去しない)
print('^' + s.lstrip('#') + '$')
print('^' + s.rstrip('#') + '$')
```

> ^ xyz \$
>
> ^ xyz ###\$
>
> ^### xyz \$

<a id="markdown-大文字化・小文字化" name="大文字化・小文字化"></a>

##### 大文字化・小文字化

```py
print('abcde'.upper())
print('ABCDE'.lower())
```

> ABCDE
>
> abcde

<a id="markdown-正規表現による置換" name="正規表現による置換"></a>

#### 正規表現による置換

```py
import re

haystack = 'haystack'
needle = '([a-rt-z]+)'
replacement = 'replacement[\\1]'

content = re.sub(needle, replacement, haystack)
print(content)
content = re.sub(needle, replacement, haystack, 1)
print(content)
```

> replacement[hay]sreplacement[tack]
>
> replacement[hay]stack

```py
import re

haystack = 'haystack'
needle = '([A-RT-Z]+)'
replacement = r'replacement[\1]'

content = re.sub(needle, replacement, haystack, flags=re.IGNORECASE)
print(content)
```

> replacement[hay]sreplacement[tack]

```py
import re

haystack = 'foobar\nhoge\npiyo'
needle = '(^h)|(e$)'
replacement = '#'

content = re.sub(needle, replacement, haystack)
print(content)
content = re.sub(needle, replacement, haystack, flags=re.MULTILINE)
print(content)
```

> foobar
>
> hoge
>
> piyo

> foobar
>
> #og#
>
> piyo

```py
import re

haystack = 'foobar\nhoge\npiyo'
needle = 'r.h'
replacement = '#'

content = re.sub(needle, replacement, haystack)
print(content)
content = re.sub(needle, replacement, haystack, flags=re.DOTALL)
print(content)
```

> foobar
>
> hoge
>
> piyo

> fooba#oge
>
> piyo

<a id="markdown-数字のみ抽出" name="数字のみ抽出"></a>

##### 数字のみ抽出

```py
# 正規表現操作のライブラリ
import re
content =  '123１２３一二三'
numstr = re.sub('\\D', '', content)
print(numstr)
```

> 123 １２３

<a id="markdown-ファイル名に使用できない文字を除去" name="ファイル名に使用できない文字を除去"></a>

##### ファイル名に使用できない文字を除去

```py
import re

haystack = 'foobar/hoge!piyo'
replacement = '-'

content = re.sub(r'[\\|/|:|?|.|"|<|>|\|]', replacement, haystack)
print(content)
```

> foobar-hoge!piyo

<a id="markdown-1-文字ごとの置換" name="1-文字ごとの置換"></a>

#### 1 文字ごとの置換

```py
haystack = 'haystack'
print(haystack.translate(str.maketrans({'h': 'H', 'a': 'oo', 's': '', 'k': None})))
```

> Hooytooc

<a id="markdown-絵文字" name="絵文字"></a>

### 絵文字

[emoji](https://pypi.org/project/emoji/)

```sh
$ pip install emoji --upgrade
```

```py
import emoji
print(emoji.emojize('Python is :thumbs_up:'))
```

> Python is 👍

<a id="markdown-ランダムな文字列の生成" name="ランダムな文字列の生成"></a>

### ランダムな文字列の生成

```py
import random

str_length = 10
universe = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'

generated = "".join([random.choice(universe) for x in range(str_length)])
print(generated)
```

> XGIuCq68EQ

<a id="markdown-形態素解析" name="形態素解析"></a>

### 形態素解析

<a id="markdown-janome-による解析" name="janome-による解析"></a>

#### janome による解析

```sh
$ pip install janome
```

```py
from janome.tokenizer import Tokenizer


sentence = 'すもももももももものうち'

t = Tokenizer()


for token in t.tokenize(sentence):
    print(token)
    # print(
    #     token.surface,
    #     token.part_of_speech,
    #     token.infl_type,
    #     token.infl_form,
    #     token.base_form,
    #     token.reading,
    #     token.phonetic,
    #     token.node_type
    # )

for token in t.tokenize(sentence, wakati=True):
    print(token)
```

> すもも 名詞,一般,_,_,_,_,すもも,スモモ,スモモ
>
> も 助詞,係助詞,_,_,_,_,も,モ,モ
>
> もも 名詞,一般,_,_,_,_,もも,モモ,モモ
>
> も 助詞,係助詞,_,_,_,_,も,モ,モ
>
> もも 名詞,一般,_,_,_,_,もも,モモ,モモ
>
> の 助詞,連体化,_,_,_,_,の,ノ,ノ
>
> うち 名詞,非自立,副詞可能,_,_,\*,うち,ウチ,ウチ

> すもも
>
> も
>
> もも
>
> も
>
> もも
>
> の
>
> うち

<a id="markdown-neologd-辞書を使用" name="neologd-辞書を使用"></a>

##### NEologd 辞書を使用

```sh
$ git clone https://github.com/neologd/mecab-ipadic-neologd.git
$ xz -dkv mecab-ipadic-neologd/seed/*.csv.xz
$ cat mecab-ipadic-neologd/seed/*.csv > neologd-dic-seed.csv
```

```py
from janome import sysdic
from janome.dic import UserDictionary
from janome.tokenizer import Tokenizer


# ユーザー辞書の生成
user_dict = UserDictionary('neologd-dic-seed.csv', 'utf8', 'ipadic', sysdic.connections)
user_dict.save('neologd-dic-dir')


# 解析
sentence = 'すもももももももものうち'

t = Tokenizer('neologd-dic-dir')


for token in t.tokenize(sentence):
   print(token)
```

<a id="markdown-リスト" name="リスト"></a>

## リスト

```
[ ]:リスト, ( ):タプル, { }:セット／辞書
リストは変更可能
タプルは変更不可
```

<a id="markdown-リストが空か検査" name="リストが空か検査"></a>

### リストが空か検査

| 判定方法      |
| ------------- |
| `not lst`     |
| `len(lst)==0` |
| `lst == []`   |

```py
lst = []
if not lst:
  print('empty')

if len(lst)==0:
  print('empty')

if lst == []:
  print('empty')
```

<a id="markdown-リストを生成" name="リストを生成"></a>

### リストを生成

<a id="markdown-空のリストを生成" name="空のリストを生成"></a>

#### 空のリストを生成

| 関数                               | 値                                                             |
| ---------------------------------- | -------------------------------------------------------------- |
| `lst = []`                         | `[]`                                                           |
| `lst = [None] * 10`                | `[None, None, None, None, None, None, None, None, None, None]` |
| `lst = [0] * 10`                   | `[0, 0, 0, 0, 0, 0, 0, 0, 0, 0]`                               |
| `lst.clear()`                      | `[] # 初期化(すべての要素を削除)`                              |
| `lst = [[0] * 3 for _ in [0] * 4]` | `[[0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]`                 |

<a id="markdown-初期値を指定して生成" name="初期値を指定して生成"></a>

#### 初期値を指定して生成

```py
lst = ['foo', 'bar', 'hoge']
print(lst)
```

> ['foo', 'bar', 'hoge']

<a id="markdown-リストをコピーして生成" name="リストをコピーして生成"></a>

#### リストをコピーして生成

```py
oldlist = ['foo', 'bar', 'hoge']
newlist = list(oldlist)
print(newlist)
```

> ['foo', 'bar', 'hoge']

<a id="markdown-タプルからリストを生成" name="タプルからリストを生成"></a>

#### タプルからリストを生成

```py
tpllist = list(('foo', 'bar', 'hoge'))
print(tpllist)
```

> \# tpllist
>
> ['foo', 'bar', 'hoge']

<a id="markdown-rangeを使って連番の要素を持つリストを生成" name="rangeを使って連番の要素を持つリストを生成"></a>

#### range()を使って連番の要素を持つリストを生成

```py
rnglist = list(range(5))
print(rnglist)

rnglist = list(range(5, 10))
print(rnglist)

rnglist = list(range(5, 15, 2))
print(rnglist)
```

> \# range(stop)
>
> [0, 1, 2, 3, 4]
>
> \# range(start, stop)
>
> [5, 6, 7, 8, 9]
>
> \# range(start, stop, step)
>
> [5, 7, 9, 11, 13]

<a id="markdown-逆順の連番" name="逆順の連番"></a>

##### 逆順の連番

```py
rnglist = list(range(3, 10, 2))
print(rnglist)

# ずれる
rnglist = list(range(10, 3, -2))
print(rnglist)

rnglist = list(range(9, 2, -2))
print(rnglist)

rnglist = list(reversed(range(3, 10, 2)))
print(rnglist)
```

> \# range(3, 10, 2)
>
> [3, 5, 7, 9]
>
> \# range(10, 3, -2) \# ずれる
>
> [10, 8, 6, 4]
>
> \# range(9, 2, -2)
>
> [9, 7, 5, 3]
>
> \# reversed(range(3, 10, 2))
>
> [9, 7, 5, 3]

<a id="markdown-文字列からリストを生成" name="文字列からリストを生成"></a>

#### 文字列からリストを生成

```py
strlist = list('abcdefg')
print(strlist)
```

> \# strlist
>
> ['a', 'b', 'c', 'd', 'e', 'f', 'g']

<a id="markdown-リストに要素を追加" name="リストに要素を追加"></a>

### リストに要素を追加

<a id="markdown-append末尾に追加" name="append末尾に追加"></a>

#### append(末尾に追加)

```py

lst = ['foo', 'hoge']
lst.append('piyo')
print(lst)

lst.append(['fu', 'ga']) # appendの引数にリストを指定すると、リスト自体が新たな要素になる
print(lst)
```

> ['foo', 'hoge', 'piyo']
>
> ['foo', 'hoge', 'piyo', ['fu', 'ga']]

<a id="markdown-insert添え字と要素の値を指定" name="insert添え字と要素の値を指定"></a>

#### insert(添え字と要素の値を指定)

```py
lst.insert(1, 'bar')
print(lst)
```

> ['foo', 'bar', 'hoge', 'piyo']

<a id="markdown-スライスを使用して別のリスト別のイテラブルオブジェクトの要素を指定位置に追加連結／結合する" name="スライスを使用して別のリスト別のイテラブルオブジェクトの要素を指定位置に追加連結／結合する"></a>

#### スライスを使用して、別のリスト(別のイテラブルオブジェクト)の要素を指定位置に追加(連結／結合)する

```py
lst = ['foo', 'bar', 'hoge']
print(lst[0:len(lst)-1])
print(lst[0:len(lst)])

lst[len(lst):len(lst)] = ['fu', 'ga']
print(lst)
```

> ['foo', 'bar']
>
> ['foo', 'bar', 'hoge']
>
> ['foo', 'bar', 'hoge', 'fu', 'ga']

<a id="markdown-別のリスト別のイテラブルオブジェクトの要素を末尾に追加連結／結合する" name="別のリスト別のイテラブルオブジェクトの要素を末尾に追加連結／結合する"></a>

#### 別のリスト(別のイテラブルオブジェクト)の要素を末尾に追加(連結／結合)する

```py
lst1 = ['foo', 'bar', 'hoge']
lst2 = ['fu', 'ga']
lst1.extend(lst2)
print(lst1)

lst1.extend('piyo') # 文字列を追加する場合、1文字ずつが要素となる
print(lst1)

lst1.extend(['piyo']) # 文字列を1要素として追加する場合
print(lst1)

lst1 = ['foo', 'bar', 'hoge']
lst2 = ['fu', 'ga']
lst1 = lst1 + lst2
print(lst1)

lst1 = lst1 + ['piyo'] # 文字列を1要素として追加する場合
print(lst1)
```

> ['foo', 'bar', 'hoge', 'fu', 'ga']
>
> ['foo', 'bar', 'hoge', 'fu', 'ga', 'p', 'i', 'y', 'o']
>
> ['foo', 'bar', 'hoge', 'fu', 'ga', 'p', 'i', 'y', 'o', 'piyo']
>
> ['foo', 'bar', 'hoge', 'fu', 'ga']
>
> ['foo', 'bar', 'hoge', 'fu', 'ga', 'piyo']

<a id="markdown-リストの要素を繰り返す" name="リストの要素を繰り返す"></a>

#### リストの要素を繰り返す

```py
lst = ['foo', 'bar', 'hoge']
lst= lst * 3
print(lst)

lst.remove('foo')
print(lst)
lst.remove('foo')
print(lst)
lst.remove('foo')
print(lst)
lst.remove('foo')
print(lst)  # 存在しない値を指定するとエラーが発生
```

> ['foo', 'bar', 'hoge', 'foo', 'bar', 'hoge', 'foo', 'bar', 'hoge']
>
> ['bar', 'hoge', 'foo', 'bar', 'hoge', 'foo', 'bar', 'hoge']
>
> ['bar', 'hoge', 'bar', 'hoge', 'foo', 'bar', 'hoge']
>
> ['bar', 'hoge', 'bar', 'hoge', 'bar', 'hoge']
>
> ValueError: list.remove(x): x not in list
>
> ['bar', 'hoge', 'bar', 'hoge', 'bar', 'hoge']

<a id="markdown-リストの要素を参照" name="リストの要素を参照"></a>

### リストの要素を参照

```py
lst = ['foo', 'bar', 'hoge']
print(lst[0])
print(lst[len(lst) - 1])
```

> foo
>
> hoge

<a id="markdown-リストの要素の存在チェック" name="リストの要素の存在チェック"></a> ####リストの要素の存在チェック

```py
lst = ['foo', 'bar', 'hoge']
print('bar' in lst)
```

> True

<a id="markdown-リストの要素をランダム抽出" name="リストの要素をランダム抽出"></a>

#### リストの要素をランダム抽出

<a id="markdown-最大値・最小値リスト" name="最大値・最小値リスト"></a>

#### 最大値・最小値（リスト）

```py
print(max([1, 2, 3]))
print(min([1, 2, 3]))

tpllst = [(1, 9), (3, 7), (5, 8)]
print(max(tpllst, key = lambda x:x[0])) # タプルの左側の要素で比較
print(min(tpllst, key = lambda x:x[1])) # タプルの右側の要素で比較
```

> 3
>
> 1
>
> (5, 8)
>
> (3, 7)

<a id="markdown-リストの要素を除去" name="リストの要素を除去"></a>

### リストの要素を除去

```py
lst = ['foo', 'bar', 'hoge', 'piyo']
print(lst)

lst.pop() # 末尾から除去
print(lst)

lst.pop(0) # 先頭から除去
print(lst)

# 指定された値を持つ要素のうち、最初のものを除去（戻り値なし）
# 指定された値を持つ要素が存在しない場合は、 ValueError: list.remove(x): x not in list
lst.remove('bar')
print(lst)

del lst[0] # 指定された位置の要素を除去（戻り値なし）
print(lst)


lst = ['foo', 'bar', 'hoge', 'piyo']

# 指定された複数の位置の要素を除去（すべて削除する場合は del lst[:] ）
del lst[0:2]
print(lst)

# 初期化(すべての要素を削除)
lst.clear()
print(lst)

# 初期化
lst = []
print(lst)
```

> ['foo', 'bar', 'hoge', 'piyo'] # print(lst) の戻り値
>
> 'piyo' # lst.pop() の戻り値
>
> ['foo', 'bar', 'hoge'] # print(lst) の戻り値
>
> 'foo' # lst.pop(0) の戻り値
>
> ['bar', 'hoge'] # print(lst) の戻り値
>
> ['hoge'] # lst.remove('bar') の直後の print(lst) の戻り値
>
> []
>
> ['hoge', 'piyo'] # del lst[0:2]の直後の print(lst) の戻り値
>
> []
>
> []

<a id="markdown-リストの反復処理" name="リストの反復処理"></a>

### リストの反復処理

```py
l = list(range(5, 10))
for item in l:
    print(item)
```

> 5
>
> 6
>
> 7
>
> 8
>
> 9

```py
l = list(range(5, 10))

for item in l[::-1]:
    print(item)

for item in reversed(l):
    print(item)
```

> 9
>
> 8
>
> 7
>
> 6
>
> 5

<a id="markdown-インデックスを取得-1" name="インデックスを取得-1"></a>

#### インデックスを取得

```py
l = list(range(5, 10))
for (index, item) in enumerate(l):
    print(index, item)
```

> 0 5
>
> 1 6
>
> 2 7
>
> 3 8
>
> 4 9

<a id="markdown-複数のリストを同時に繰り返す" name="複数のリストを同時に繰り返す"></a>

#### 複数のリストを同時に繰り返す

```py
l1 = list(range(5)) # リストの要素数が同じ場合
l2 = list(range(5,10))

for (i1, i2) in zip(l1, l2):
    print(i1, i2)
```

> 0 5
>
> 1 6
>
> 2 7
>
> 3 8
>
> 4 9

```py
l1 = list(range(5)) # リストの要素数が異なる場合
l2 = list(range(5,8))

# 要素数の少ないリストの要素数分だけ繰り返す
for (i1, i2) in zip(l1, l2):
    print(i1, i2)
```

> 0 5
>
> 1 6
>
> 2 7

```py
from itertools import zip_longest

l1 = list(range(5)) # リストの要素数が異なる場合
l2 = list(range(5,8))

# 要素数の多いリストの要素数分だけ繰り返す
for (i1, i2) in zip_longest(l1, l2):
    print(i1, i2)

# 要素数の多いリストの要素数分だけ繰り返す(不足している要素にNoneではなく指定した値を使用)
for (i1, i2) in zip_longest(l1, l2, fillvalue=999):
    print(i1, i2)
```

> 0 5
>
> 1 6
>
> 2 7
>
> 3 None
>
> 4 None

> 0 5
>
> 1 6
>
> 2 7
>
> 3 999
>
> 4 999

<a id="markdown-リストの要素を連結結合した文字列を取得" name="リストの要素を連結結合した文字列を取得"></a>

#### リストの要素を連結(結合)した文字列を取得

```py
lst = ['foo', 'bar', 'hoge']
''.join(lst)
','.join(lst) # 区切り文字を指定
```

> 'foobarhoge'
>
> 'foo,bar,hoge'

<a id="markdown-順列と組み合わせ" name="順列と組み合わせ"></a>

#### 順列と組み合わせ

<a id="markdown-順列" name="順列"></a>

##### 順列

1,2,3,4,5 の 5 つから 3 つ選ぶ

```py
import itertools

items = range(1, 6)
for i in items:
    print(i, end=' ')

print('')

combi = list(itertools.combinations(items, 3))
print(combi)
print(len(combi))
```

> 1 2 3 4 5
>
> [(1, 2, 3), (1, 2, 4), (1, 2, 5), (1, 3, 4), (1, 3, 5), (1, 4, 5), (2, 3, 4), (2, 3, 5), (2, 4, 5), (3, 4, 5)]
>
> 10

<a id="markdown-組み合わせ" name="組み合わせ"></a>

##### 組み合わせ

1,2,3,4,5 の 5 つを並べる

```py
import itertools

items = range(1, 6)
for i in items:
    print(i, end=' ')

print('')

perm = list(itertools.permutations(items))
print(perm)
print(len(perm))
```

> 1 2 3 4 5
>
> [(1, 2, 3, 4, 5), (1, 2, 3, 5, 4), (1, 2, 4, 3, 5), (1, 2, 4, 5, 3), (1, 2, 5, 3, 4), (1, 2, 5, 4, 3), (1, 3, 2, 4, 5), (1, 3, 2, 5, 4), (1, 3, 4, 2, 5), (1, 3, 4, 5, 2), (1, 3, 5, 2, 4), (1, 3, 5, 4, 2), (1, 4, 2, 3, 5), (1, 4, 2, 5, 3), (1, 4, 3, 2, 5), (1, 4, 3, 5, 2), (1, 4, 5, 2, 3), (1, 4, 5, 3, 2), (1, 5, 2, 3, 4), (1, 5, 2, 4, 3), (1, 5, 3, 2, 4), (1, 5, 3, 4, 2), (1, 5, 4, 2, 3), (1, 5, 4, 3, 2), (2, 1, 3, 4, 5), (2, 1, 3, 5, 4), (2, 1, 4, 3, 5), (2, 1, 4, 5, 3), (2, 1, 5, 3, 4), (2, 1, 5, 4, 3), (2, 3, 1, 4, 5), (2, 3, 1, 5, 4), (2, 3, 4, 1, 5), (2, 3, 4, 5, 1), (2, 3, 5, 1, 4), (2, 3, 5, 4, 1), (2, 4, 1, 3, 5), (2, 4, 1, 5, 3), (2, 4, 3, 1, 5), (2, 4, 3, 5, 1), (2, 4, 5, 1, 3), (2, 4, 5, 3, 1), (2, 5, 1, 3, 4), (2, 5, 1, 4, 3), (2, 5, 3, 1, 4), (2, 5, 3, 4, 1), (2, 5, 4, 1, 3), (2, 5, 4, 3, 1), (3, 1, 2, 4, 5), (3, 1, 2, 5, 4), (3, 1, 4, 2, 5), (3, 1, 4, 5, 2), (3, 1, 5, 2, 4), (3, 1, 5, 4, 2), (3, 2, 1, 4, 5), (3, 2, 1, 5, 4), (3, 2, 4, 1, 5), (3, 2, 4, 5, 1), (3, 2, 5, 1, 4), (3, 2, 5, 4, 1), (3, 4, 1, 2, 5), (3, 4, 1, 5, 2), (3, 4, 2, 1, 5), (3, 4, 2, 5, 1), (3, 4, 5, 1, 2), (3, 4, 5, 2, 1), (3, 5, 1, 2, 4), (3, 5, 1, 4, 2), (3, 5, 2, 1, 4), (3, 5, 2, 4, 1), (3, 5, 4, 1, 2), (3, 5, 4, 2, 1), (4, 1, 2, 3, 5), (4, 1, 2, 5, 3), (4, 1, 3, 2, 5), (4, 1, 3, 5, 2), (4, 1, 5, 2, 3), (4, 1, 5, 3, 2), (4, 2, 1, 3, 5), (4, 2, 1, 5, 3), (4, 2, 3, 1, 5), (4, 2, 3, 5, 1), (4, 2, 5, 1, 3), (4, 2, 5, 3, 1), (4, 3, 1, 2, 5), (4, 3, 1, 5, 2), (4, 3, 2, 1, 5), (4, 3, 2, 5, 1), (4, 3, 5, 1, 2), (4, 3, 5, 2, 1), (4, 5, 1, 2, 3), (4, 5, 1, 3, 2), (4, 5, 2, 1, 3), (4, 5, 2, 3, 1), (4, 5, 3, 1, 2), (4, 5, 3, 2, 1), (5, 1, 2, 3, 4), (5, 1, 2, 4, 3), (5, 1, 3, 2, 4), (5, 1, 3, 4, 2), (5, 1, 4, 2, 3), (5, 1, 4, 3, 2), (5, 2, 1, 3, 4), (5, 2, 1, 4, 3), (5, 2, 3, 1, 4), (5, 2, 3, 4, 1), (5, 2, 4, 1, 3), (5, 2, 4, 3, 1), (5, 3, 1, 2, 4), (5, 3, 1, 4, 2), (5, 3, 2, 1, 4), (5, 3, 2, 4, 1), (5, 3, 4, 1, 2), (5, 3, 4, 2, 1), (5, 4, 1, 2, 3), (5, 4, 1, 3, 2), (5, 4, 2, 1, 3), (5, 4, 2, 3, 1), (5, 4, 3, 1, 2), (5, 4, 3, 2, 1)]
>
> 120

<a id="markdown-重複組み合わせ" name="重複組み合わせ"></a>

##### 重複組み合わせ

1,2,3,4,5 から、１つずつ取り出して元に戻す操作を 3 回繰り返した場合

```py
import itertools

items = range(1, 6)
for i in items:
    print(i, end=' ')

print('')

perm = list(itertools.combinations_with_replacement(items, 3))
print(perm)
print(len(perm))
```

> 1 2 3 4 5
>
> [(1, 1, 1), (1, 1, 2), (1, 1, 3), (1, 1, 4), (1, 1, 5), (1, 2, 2), (1, 2, 3), (1, 2, 4), (1, 2, 5), (1, 3, 3), (1, 3, 4), (1, 3, 5), (1, 4, 4), (1, 4, 5), (1, 5, 5), (2, 2, 2), (2, 2, 3), (2, 2, 4), (2, 2, 5), (2, 3, 3), (2, 3, 4), (2, 3, 5), (2, 4, 4), (2, 4, 5), (2, 5, 5), (3, 3, 3), (3, 3, 4), (3, 3, 5), (3, 4, 4), (3, 4, 5), (3, 5, 5), (4, 4, 4), (4, 4,
>
> > 5), (4, 5, 5), (5, 5, 5)]
>
> 35

<a id="markdown-直積" name="直積"></a>

##### 直積

2 つのリストの全要素の組み合わせを求める。

```py
import itertools

items = range(1, 6)
for i in items:
    print(i, end=' ')

print('')

# 同じリストを複数回使いたいときは repeat 引数に回数を指定
# perm = list(itertools.product(items, items))
perm = list(itertools.product(items, repeat=2))
print(perm)
print(len(perm))
```

> 1 2 3 4 5
>
> [(1, 1), (1, 2), (1, 3), (1, 4), (1, 5), (2, 1), (2, 2), (2, 3), (2, 4), (2, 5), (3, 1), (3, 2), (3, 3), (3, 4), (3, 5), (4, 1), (4, 2), (4, 3), (4, 4), (4, 5), (5, 1), (5, 2), (5, 3), (5, 4), (5, 5)]
>
> 25

多重 for ループでネストが深くなるのを防ぐためにも使える

```py
import itertools

# 2重forループ
# for tpl in itertools.product(range(2), range(3)):
#   print("%d, %d" % tpl)
for i, j in itertools.product(range(2), range(3)):
  print("%d, %d" % (i, j))

# 3重forループ
for i, j, k in itertools.product(range(2), range(3), range(4)):
  print("%d, %d, %d" % (i, j, k))
```

> 0, 0
>
> 0, 1
>
> 0, 2
>
> 1, 0
>
> 1, 1
>
> 1, 2

> 0, 0, 0
>
> 0, 0, 1
>
> 0, 0, 2
>
> 0, 0, 3
>
> 0, 1, 0
>
> 0, 1, 1
>
> 0, 1, 2
>
> 0, 1, 3
>
> ...
>
> 1, 2, 0
>
> 1, 2, 1
>
> 1, 2, 2
>
> 1, 2, 3

<a id="markdown-多次元リスト" name="多次元リスト"></a>

#### 多次元リスト

```py
l = [
    [1, 2, 3],
    [4, 5, 6],
    [7, 8, 9]
]

for (a, b, c) in zip(*l):
    print(a, b, c)
```

> 1 4 7
>
> 2 5 8
>
> 3 6 9

<a id="markdown-に平坦化flatten" name="に平坦化flatten"></a>

##### に平坦化(flatten)

<a id="markdown-2-次元リストを-1-次元リストに平坦化flatten" name="2-次元リストを-1-次元リストに平坦化flatten"></a>

##### 2 次元リストを 1 次元リストに平坦化(flatten)

```py
l = [
    [1, 2, 3],
    [4, 5, 6],
    [7, 8, 9]
]

# 内包表記
result = [item for m in l for item in m]

# itertools
from itertools import chain
result = list(chain.from_iterable(l))
```

> [1, 2, 3, 4, 5, 6, 7, 8, 9]

<a id="markdown-多次元リストを-1-次元リストに平坦化flatten" name="多次元リストを-1-次元リストに平坦化flatten"></a>

##### 多次元リストを 1 次元リストに平坦化(flatten)

```py
import collections.abc

l = [
    [1, [2, 3]],
    [4, 5, [6]],
    [[7, 8], 9]
]

def flatten(l):
    i = 0
    while i < len(l):
        while isinstance(l[i], collections.Iterable):
            if not l[i]:
                l.pop(i)
                i -= 1
                break
            else:
                l[i:i + 1] = l[i]
        i += 1
    return l

result = flatten(l)
```

> [1, 2, 3, 4, 5, 6, 7, 8, 9]

<a id="markdown-リストをソート" name="リストをソート"></a>

### リストをソート

```py
lst = ['foo', 'bar', 'piyo', 'hoge', 'foo', 'bar', 'piyo', 'hoge']
sortedlist = sorted(lst)
print(lst)
print(sortedlist)

lst.sort(key=None, reverse=False)
print(lst)
```

> ['foo', 'bar', 'piyo', 'hoge', 'foo', 'bar', 'piyo', 'hoge']
>
> ['bar', 'bar', 'foo', 'foo', 'hoge', 'hoge', 'piyo', 'piyo']

> ['bar', 'bar', 'foo', 'foo', 'hoge', 'hoge', 'piyo', 'piyo']

<a id="markdown-ソート条件を変える" name="ソート条件を変える"></a>

#### ソート条件を変える

ラムダ式を指定すると、要素ごとに関数を実行した結果を基にソートされる

<a id="markdown-文字数でソート" name="文字数でソート"></a>

##### 文字数でソート

```py
print(len)

lst = ['foo', 'bar', 'piyo', 'hoge', 'foo', 'bar', 'piyo', 'hoge']
sortedlist = sorted(lst, key=len)
print(lst)
print(sortedlist)
```

> \<built-in function len\>
>
> ['foo', 'bar', 'piyo', 'hoge', 'foo', 'bar', 'piyo', 'hoge']
>
> ['foo', 'bar', 'foo', 'bar', 'piyo', 'hoge', 'piyo', 'hoge']

<a id="markdown-末尾の文字のアルファベット順でソート" name="末尾の文字のアルファベット順でソート"></a>

##### 末尾の文字のアルファベット順でソート

```py
lst = ['foo', 'bar', 'piyo', 'hoge', 'foo', 'bar', 'piyo', 'hoge']
sortedlist = sorted(lst, key=lambda x: x[-1:])
print(lst)
print(sortedlist)
```

> ['foo', 'bar', 'piyo', 'hoge', 'foo', 'bar', 'piyo', 'hoge']
>
> ['hoge', 'hoge', 'foo', 'piyo', 'foo', 'piyo', 'bar', 'bar']

<a id="markdown-リストの要素の型" name="リストの要素の型"></a>

#### リストの要素の型

<a id="markdown-リストのリスト" name="リストのリスト"></a>

##### リストのリスト

<a id="markdown-リスト同士の比較方法既定" name="リスト同士の比較方法既定"></a>

###### リスト同士の比較方法(既定)

```py
print([2] > [1]) # 最初の要素
print([1] > [2])
print([1, 2] > [1, 1]) # 一番最初の異なる要素
print([1, 1] > [1, 2])
```

> True
>
> False
>
> True
>
> False

```py
lst = [[2, 10, 100], [3, 20, 300], [1, 10, 200], [1, 30, 200], [2, 10, 200]]

# lst = sorted(lst)
lst.sort()

print(lst)
```

> [
>
>     [1, 10, 200],
>
>     [1, 30, 200],
>
>     [2, 10, 100],
>
>     [2, 10, 200],
>
>     [3, 20, 300]
>
> ]

<a id="markdown-任意の要素を比較してソート" name="任意の要素を比較してソート"></a>

###### 任意の要素を比較してソート

```py
lst = [[2, 10, 100], [3, 20, 300], [1, 10, 200], [1, 30, 200], [2, 10, 200]]

lst = sorted(lst, key=lambda x: x[2]) # 逆順ソートの場合は sorted(lst, key=lambda x: x[2], reverse=True)
# lst.sort(key=lambda x: x[2])

print(lst)
```

> [
>
>     [2, 10, 100],
>
>     [1, 10, 200],
>
>     [1, 30, 200],
>
>     [2, 10, 200],
>
>     [3, 20, 300]
>
> ]

<a id="markdown-3次元リスト" name="3次元リスト"></a>

###### 3 次元リスト

```py
lst = [[[2, 10, 100], [3, 20, 300], [1, 20, 200]], [[1, 10, 200], [1, 30, 200], [2, 10, 200]]]

# lst = sorted(lst, key=lambda x: x[0][0])
lst.sort(key=lambda x: x[0][0])

print(lst)
```

> [
>
>     [
>
>         [1, 10, 200],
>
>         [1, 30, 200],
>
>         [2, 10, 200]
>
>     ],
>
>     [
>
>         [2, 10, 100],
>
>         [3, 20, 300],
>
>         [1, 20, 200]
>
>     ]
>
> ]

<a id="markdown-辞書のリスト" name="辞書のリスト"></a>

##### 辞書のリスト

```py
lst = [
    {'height': 170, 'weight': 65},
    {'height': 160, 'weight': 55},
    {'height': 180, 'weight': 75}
]

lst = sorted(lst, key=lambda x: x['height'])
# lst.sort(key=lambda x: x[2])

print(lst)
```

> [
>
>     {'height': 160, 'weight': 55},
>
>     {'height': 170, 'weight': 65},
>
>     {'height': 180, 'weight': 75}
>
> ]

<a id="markdown-タプルのリスト" name="タプルのリスト"></a>

##### タプルのリスト

```py
lst = [
    ('Ichiro', 185, 65),
    ('Jiro', 160, 55),
    ('Saburo', 180, 75)
]

# lst = sorted(lst, key=lambda x: x[2])

# lst.sort(key=lambda x: x[2])

from operator import itemgetter
lst = sorted(lst, key=itemgetter(2))

print(lst)
```

> [
>
>     ('Jiro', 160, 55),
>
>     ('Ichiro', 185, 65),
>
>      ('Saburo', 180, 75)
>
> ]

<a id="markdown-セットのリスト" name="セットのリスト"></a>

##### セットのリスト

<a id="markdown-リストのランダム処理" name="リストのランダム処理"></a>

### リストのランダム処理

<a id="markdown-リストから要素を-1-個ランダムに取り出す" name="リストから要素を-1-個ランダムに取り出す"></a>

#### リストから要素を 1 個ランダムに取り出す

```py
import random

lst = list(range(1,7))

random.choice(lst)
```

> 6
>
> 3
>
> 2

<a id="markdown-リストから要素を複数個ランダムに取り出す重複あり" name="リストから要素を複数個ランダムに取り出す重複あり"></a>

#### リストから要素を複数個ランダムに取り出す(重複あり)

```py
import random

lst = list(range(1,7))
n = 3

[random.choice(lst) for _ in range(n)]

random.choices(lst, k=n)
```

> [5, 2, 3]
>
> [1, 1, 5]

<a id="markdown-リストから要素を複数個ランダムに取り出す重複なし" name="リストから要素を複数個ランダムに取り出す重複なし"></a>

#### リストから要素を複数個ランダムに取り出す(重複なし)

```py
import random

lst = list(range(1,7))
n = 3

random.sample(lst, n)
```

> [1, 6, 4]

<a id="markdown-リストの要素をランダムソートシャッフルする" name="リストの要素をランダムソートシャッフルする"></a>

#### リストの要素をランダムソート(シャッフル)する

```py
import random

lst1 = list(range(1,7))

# もとのリスト自体をソート
random.shuffle(lst1)
print(lst1)

# シャッフルした新しいリストを返す
lst2 = random.sample(lst1, len(lst1))
print(lst2)
```

> [2, 4, 3, 1, 6, 5]
>
> [1, 6, 5, 2, 3, 4]

<a id="markdown-リストの重複する要素" name="リストの重複する要素"></a>

### リストの重複する要素

<a id="markdown-リストの重複する要素を除去" name="リストの重複する要素を除去"></a>

#### リストの重複する要素を除去

<a id="markdown-リストの重複する要素を除去-1" name="リストの重複する要素を除去-1"></a>

#### リストの重複する要素を除去

```py
# 順番を無視
l = ['foo', 'bar', 'hoge', 'foo', 'bar', 'hoge', 'foo', 'bar', 'hoge']
ls = list(set(l))
print(ls)
```

> ['hoge', 'bar', 'foo']

<a id="markdown-リストの重複する要素を除去-2" name="リストの重複する要素を除去-2"></a>

#### リストの重複する要素を除去

```py
# Python 3.6以降
ld = list(dict.fromkeys(l))
print(ld)

# Python 3.5以前
ss = sorted(set(l), key=l.index)
print(ss)
```

> ['foo', 'bar', 'hoge']
>
> ['foo', 'bar', 'hoge']

<a id="markdown-リストが入れ子の場合" name="リストが入れ子の場合"></a>

##### リストが入れ子の場合

```py
def uniq(td):
    f = []
    return [i for i in td if i not in f and not f.append(i)]

l2d = [['foo'], ['bar'], ['hoge'], ['foo'], ['bar'], ['hoge'], ['foo'], ['bar'], ['hoge']]
uniql2d = uniq(l2d)
print(uniql2d)
```

> [['foo'], ['bar'], ['hoge']]

<a id="markdown-リストの重複する要素を抽出" name="リストの重複する要素を抽出"></a>

#### リストの重複する要素を抽出

<a id="markdown-リストの重複する要素を抽出-1" name="リストの重複する要素を抽出-1"></a>

#### リストの重複する要素を抽出

```py
l = ['foo', 'bar', 'hoge', 'foo', 'bar', 'hoge', 'foo', 'bar', 'hoge']
sc = [x for x in set(l) if l.count(x) > 1]
print(sc)
```

> ['hoge', 'bar', 'foo']

<a id="markdown-リストの重複する要素を抽出-2" name="リストの重複する要素を抽出-2"></a>

#### リストの重複する要素を抽出

```py
# Python 3.6以降
df = [x for x in dict.fromkeys(l) if l.count(x) > 1]
print(df)

# Python 3.5以前
sk = sorted([x for x in set(l) if l.count(x) > 1], key=l.index)
print(ss)
```

> ['foo', 'bar', 'hoge']
>
> ['foo', 'bar', 'hoge']

<a id="markdown-高階関数" name="高階関数"></a>

### 高階関数

<a id="markdown-map要素ごとに処理" name="map要素ごとに処理"></a>

#### map(要素ごとに処理)

第 2 引数の各要素に対して、第 1 引数の lambda 式を適用した結果をイテレータとして返す

```py
# リストに対する演算(map)：map関数は、Python2ではリストを返すがPython3ではイテレータを返すため、list関数を挟む必要がある
numlist = [1, 3, 5, 2, 4]

def double(x): return x * 2

print(map(double, numlist))
print(map(lambda x: x * 2, numlist))

print(list(map(double, numlist))) # Python3でリストを得たい場合
print(list(map(lambda x: x * 2, numlist))) # Python3でリストを得たい場合

print([x * 2 for x in numlist]) # 同じことを内包表記で行う
```

> [2, 6, 10, 4, 8]

<a id="markdown-filter要素のフィルタリング" name="filter要素のフィルタリング"></a>

#### filter(要素のフィルタリング)

リストに対してフィルタリングする

```py
numlist = [1, 3, 5, 2, 4]

def isodd(x): return x % 2 # 条件式(True/Falseを返す)のlambda式

print(list(filter(isodd, numlist)))
print(list(filter(lambda x: x % 2, numlist)))
print([x for x in numlist if x % 2]) # 同じことを内包表記で行う
```

> [1, 3, 5]

<a id="markdown-reduce畳み込み／集約" name="reduce畳み込み／集約"></a>

#### reduce(畳み込み／集約)

リストに対する畳みこみ(集約)

```py
from functools import reduce

numlist = [1, 3, 5, 2, 4]

def add(x, y): return x + y

print(reduce(add, numlist))
print(reduce(lambda x, y: x + y, numlist))
```

> 15

<a id="markdown-リストの内包表記" name="リストの内包表記"></a>

### リストの内包表記

```
形式: [式 for 変数 in イテラブルオブジェクト if 条件式]
```

高階関数のうち、map と filter は内包表記でも同等の処理を行うことが可能

<a id="markdown-map要素ごとに処理-1" name="map要素ごとに処理-1"></a>

#### map(要素ごとに処理)

要素全てに処理を行う

```py
l = list(range(100))

# 要素全てに処理を行う
strlist = [str(i) for i in l]
print(strlist)
```

> ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31', '32', '33', '34', '35', '36', '37', '38', '39', '40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59', '60', '61', '62', '63', '64', '65', '66', '67', '68', '69', '70', '71', '72', '73', '74', '75', '76', '77', '78', '79', '80', '81', '82', '83', '84', '85', '86', '87', '88', '89', '90', '91', '92', '93', '94', '95', '96', '97', '98', '99']

<a id="markdown-filter要素のフィルタリング-1" name="filter要素のフィルタリング-1"></a>

#### filter(要素のフィルタリング)

条件に合致する要素のみからなるリストを生成(抽出)

```py
l = list(range(100))

# 条件に合致する要素のみからなるリストを生成(抽出)
fivelist = [i for i in l if i % 5 == 0 and i <= 50]
print(fivelist)

fivelist = [i  if i % 5 == 0 and i <= 50 else -1 for i in l] # elseがある場合は三項演算子なので順序が変わる
print(fivelist)
```

> [0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50]
>
> [0, -1, -1, -1, -1, 5, -1, -1, -1, -1, 10, -1, -1, -1, -1, 15, -1, -1, -1, -1, 20, -1, -1, -1, -1, 25, -1, -1, -1, -1, 30, -1, -1, -1, -1, 35, -1, -1, -1, -1, 40, -1, -1, -1, -1, 45, -1, -1, -1, -1, 50, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1]

```py
l = ['Lorem', '', 'ipsum', None, 'dolor', 'sit', 'amet']
l = [s for s in l if s]
print(l)
```

>

<a id="markdown-多次元リスト-1" name="多次元リスト-1"></a>

#### 多次元リスト

```py
# 多次元リストの初期化
m = 3
n = 4
[[0] * m for _ in [0] * n]
```

> [[0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]]

```py
[[i, j, i * j] for i in range(10) for j in range(10)]
```

> \# 多次元リスト
>
> [
>
> &nbsp;&nbsp;&nbsp;&nbsp;[0, 0, 0], [0, 1, 0], [0, 2, 0], [0, 3, 0], [0, 4, 0], [0, 5, 0], [0, 6, 0], [0, 7, 0], [0, 8, 0], [0, 9, 0],
>
> &nbsp;&nbsp;&nbsp;&nbsp;[1, 0, 0], [1, 1, 1], [1, 2, 2], [1, 3, 3], [1, 4, 4], [1, 5, 5], [1, 6, 6], [1, 7, 7], [1, 8, 8], [1, 9, 9],
>
> &nbsp;&nbsp;&nbsp;&nbsp;[2, 0, 0], [2, 1, 2], [2, 2, 4], [2, 3, 6], [2, 4, 8], [2, 5, 10], [2, 6, 12], [2, 7, 14], [2, 8, 16], [2, 9, 18],
>
> &nbsp;&nbsp;&nbsp;&nbsp;[3, 0, 0], [3, 1, 3], [3, 2, 6], [3, 3, 9], [3, 4, 12], [3, 5, 15], [3, 6, 18], [3, 7, 21], [3, 8, 24], [3, 9, 27],
>
> &nbsp;&nbsp;&nbsp;&nbsp;[4, 0, 0], [4, 1, 4], [4, 2, 8], [4, 3, 12], [4, 4, 16], [4, 5, 20], [4, 6, 24], [4, 7, 28], [4, 8, 32], [4, 9, 36],
>
> &nbsp;&nbsp;&nbsp;&nbsp;[5, 0, 0], [5, 1, 5], [5, 2, 10], [5, 3, 15], [5, 4, 20], [5, 5, 25], [5, 6, 30], [5, 7, 35], [5, 8, 40], [5, 9, 45],
>
> &nbsp;&nbsp;&nbsp;&nbsp;[6, 0, 0], [6, 1, 6], [6, 2, 12], [6, 3, 18], [6, 4, 24], [6, 5, 30], [6, 6, 36], [6, 7, 42], [6, 8, 48], [6, 9, 54],
>
> &nbsp;&nbsp;&nbsp;&nbsp;[7, 0, 0], [7, 1, 7], [7, 2, 14], [7, 3, 21], [7, 4, 28], [7, 5, 35], [7, 6, 42], [7, 7, 49], [7, 8, 56], [7, 9, 63],
>
> &nbsp;&nbsp;&nbsp;&nbsp;[8, 0, 0], [8, 1, 8], [8, 2, 16], [8, 3, 24], [8, 4, 32], [8, 5, 40], [8, 6, 48], [8, 7, 56], [8, 8, 64], [8, 9, 72],
>
> &nbsp;&nbsp;&nbsp;&nbsp;[9, 0, 0], [9, 1, 9], [9, 2, 18], [9, 3, 27], [9, 4, 36], [9, 5, 45], [9, 6, 54], [9, 7, 63], [9, 8, 72], [9, 9, 81]
>
> ]

<a id="markdown-リスト内包表記で-fizzbuzz" name="リスト内包表記で-fizzbuzz"></a>

#### リスト内包表記で FizzBuzz

```py
[
    'FizzBuzz' if not n % 15 else
    'Fizz'     if not n % 3  else
    'Buzz'     if not n % 5  else
    str(n)
    for n in range(1, 1 + 100)
]
```

<a id="markdown-リスト内包表記の入れ子" name="リスト内包表記の入れ子"></a>

#### リスト内包表記の入れ子

```py
[
    i*i
    for i
    in [
        j*2
        for j
        in range(10)
    ]
]
```

> [0, 4, 16, 36, 64, 100, 144, 196, 256, 324]

```py
[
    (i,j)
    for i in [-2, -1, 0, 1, 2]
    for j in [-2, -1, 0, 1, 2]
    if sqrt(i**2 + j**2) < 2
]
```

<a id="markdown-辞書" name="辞書"></a>

## 辞書

<a id="markdown-辞書が空か検査" name="辞書が空か検査"></a>

### 辞書が空か検査

| 判定方法      |
| ------------- |
| `not dct`     |
| `len(dct)==0` |
| `dct == {}`   |

```py
dct = {}
if not dct:
  print('empty')

if len(dct)==0:
  print('empty')

if dct == {}:
  print('empty')
```

<a id="markdown-辞書を生成" name="辞書を生成"></a>

### 辞書を生成

<a id="markdown-空の辞書を生成" name="空の辞書を生成"></a>

#### 空の辞書を生成

```py
dct = {}

# 初期化(すべての要素を削除)
dct.clear()
```

<a id="markdown-初期値を指定して生成-1" name="初期値を指定して生成-1"></a>

#### 初期値を指定して生成

```py
dct = { 1:'first', 2:'second', 3:'third'}

# デバッグ表示
print(str(dct))
print('%s' % dct)
```

> {1: 'first', 2: 'second', 3: 'third'}
>
> {1: 'first', 2: 'second', 3: 'third'}

```py
dct = { 1:'first', 2:'two', 2:'second', 3:'third'}
# キーが同じ要素が追加されたら上書きされる(2:'two'ではなく2:'second'が残る)
```

> {1: 'first', 2: 'second', 3: 'third'}

<a id="markdown-辞書をコピーして生成" name="辞書をコピーして生成"></a>

#### 辞書をコピーして生成

```py
olddict = { 1:'first', 2:'second', 3:'third'}
newdict = dict(olddict)
print(newdict)
```

> {1: 'first', 2: 'second', 3: 'third'}

<a id="markdown-辞書を代入した場合" name="辞書を代入した場合"></a>

##### 辞書を代入した場合

```py
dct1 = dict(('1f', '2s', '3t'))

dct2 = dct1
dct1['1'] = 'z'
print(dct1)
print(dct2)

dct1 = dict(('1f', '2s', '3t'))
dct2 = dct1.copy()
dct1['1'] = 'z'
print(dct1)
print(dct2)
```

> {'1': 'z', '2': 's', '3': 't'}
>
> {'1': 'z', '2': 's', '3': 't'}

> {'1': 'z', '2': 's', '3': 't'}
>
> {'1': 'f', '2': 's', '3': 't'}

<a id="markdown-リスト・タプルから生成" name="リスト・タプルから生成"></a>

#### リスト・タプルから生成

<a id="markdown-リストから生成" name="リストから生成"></a>

##### リストから生成

```py
l = list(range(100))
lst = [str(i) for i in l] # リスト
dct = {li: str(li) for li in l} # 辞書
print(dct)
```

> {0: '0', 1: '1', 2: '2', ＜中略＞ 99: '99'}

<a id="markdown-連番とリストの要素から生成" name="連番とリストの要素から生成"></a>

###### 連番とリストの要素から生成

```py
values = ['first', 'second', 'third']
['{0}: {1}'.format(i + 100, values[i]) for i in range(len(values))]
['{0}: {1}'.format(i + 100, v) for i, v in enumerate(values)]
```

> ['100: first', '101: second', '102: third']
>
> ['100: first', '101: second', '102: third']

<a id="markdown-リストのリストから生成" name="リストのリストから生成"></a>

##### リストのリストから生成

```py
lst = [[1, 'first'], [2, 'second'], [3, 'third']]
dct = dict(lst)
print(dct)
```

> {1: 'first', 2: 'second', 3: 'third'}

<a id="markdown-2-つのリストから生成" name="2-つのリストから生成"></a>

##### 2 つのリストから生成

<a id="markdown-要素数の少ないリストに合わせる" name="要素数の少ないリストに合わせる"></a>

###### 要素数の少ないリストに合わせる

```py
keys = [1, 2, 3]
values = ['first', 'second', 'third']
dct = dict(zip(keys, values))
print(dct)
```

> {1: 'first', 2: 'second', 3: 'third'}

<a id="markdown-要素数の多いリストに合わせる" name="要素数の多いリストに合わせる"></a>

###### 要素数の多いリストに合わせる

```py
from itertools import zip_longest
keys = [1, 2]
values = ['first', 'second', 'third']
dct = dict(zip_longest(keys, values, fillvalue=3))
print(dct)
```

> {1: 'first', 2: 'second', 3: 'third'}

<a id="markdown-条件に合致する要素のみからなる辞書を生成抽出" name="条件に合致する要素のみからなる辞書を生成抽出"></a>

###### 条件に合致する要素のみからなる辞書を生成(抽出)

```py
keys = [1, 2, 3, 4, 5, 10, 12]
values = ['v1', 'v2', 'v3', 'v4', 'v5', 'v10', 'v12']
dct1 = {k: v for k, v in zip(keys, values) if k % 5 == 0 and k <= 50}
print(dct1)

dct2 = {k: v if k % 5 == 0 and k <= 50 else -1 for k, v in zip(keys, values)}
print(dct2)
```

> {5: 'v5', 10: 'v10'}
>
> {1: -1, 2: -1, 3: -1, 4: -1, 5: 'v5', 10: 'v10', 12: -1}

<a id="markdown-リストのタプルから生成" name="リストのタプルから生成"></a>

##### リストのタプルから生成

```py
tpl = ([1, 'first'], [2, 'second'], [3, 'third'])
dct = dict(tpl)
```

> {1: 'first', 2: 'second', 3: 'third'}

<a id="markdown-タプルのリストから生成" name="タプルのリストから生成"></a>

##### タプルのリストから生成

```py
lst = [(1, 'first'), (2, 'second'), (3, 'third')]
dct = dict(lst)
```

> {1: 'first', 2: 'second', 3: 'third'}

<a id="markdown-文字列のリストから生成" name="文字列のリストから生成"></a>

##### 文字列のリストから生成

```py
lst = ['1f', '2s', '3t']
dct = dict(lst)
```

> {'1': 'f', '2': 's', '3': 't'}

<a id="markdown-文字列のタプルから生成" name="文字列のタプルから生成"></a>

##### 文字列のタプルから生成

```py
tpl = ('1f', '2s', '3t')
dct = dict(tpl)
```

> {'1': 'f', '2': 's', '3': 't'}

<a id="markdown-辞書に要素を追加" name="辞書に要素を追加"></a>

### 辞書に要素を追加

<a id="markdown-キーを指定して要素を追加" name="キーを指定して要素を追加"></a>

#### キーを指定して要素を追加

```py
dct = { 1:'first', 2:'second', 3:'third'}
print(len(dct))

# 追加
dct[len(dct) + 1] = 'fourth'

# 要素の置換
dct[2] = 'secondsecond'

print(dct)
```

> 3
>
> {1: 'first', 2: 'secondsecond', 3: 'third', 4: 'fourth'}

<a id="markdown-辞書を連結結合" name="辞書を連結結合"></a>

#### 辞書を連結(結合)

```py
dct1 = dict(('1f', '2s', '3t'))
dct2 = dict(('4f', '5f', '6s'))
dct3 = dict(('4x', '8e', '9n'))

print(dct1)

dct1.update(dct2)

print(dct1)
print(dct2)

dct1.update(dct3)

print(dct1)
print(dct3)

print({**dct2, **dct3})

# Python 3.9以降
print(dct2 | dct3)
```

> {'1': 'f', '2': 's', '3': 't'} \# print(dct1)
>
> {'1': 'f', '2': 's', '3': 't', '4': 'f', '5': 'f', '6': 's'} \# print(dct1)
>
> {'4': 'f', '5': 'f', '6': 's'} \# print(dct2)

> {'1': 'f', '2': 's', '3': 't', '4': 'x', '5': 'f', '6': 's', '8': 'e', '9': 'n'} \# print(dct1)
>
> {'4': 'x', '8': 'e', '9': 'n'} \# print(dct3)
>
> {'4': 'x', '5': 'f', '6': 's', '8': 'e', '9': 'n'} \# print({**dct2, **dct3})
>
> {'4': 'x', '5': 'f', '6': 's', '8': 'e', '9': 'n'} \# print(dct2 | dct3)

<a id="markdown-既存のキーと重複する場合に上書きせずにカンマ区切りで追加" name="既存のキーと重複する場合に上書きせずにカンマ区切りで追加"></a>

#### 既存のキーと重複する場合に上書きせずにカンマ区切りで追加

```py
from collections import defaultdict

def merge(*dicts):
    merged = defaultdict(list)
    # merged = defaultdict(set) # setにすると、既存のものとキーも値も重複した場合は追加されない
    for d in dicts:
        for k, v in d.items():
            # if v not in merged[k]: # listを使いつつ、既存のものとキーも値も重複した場合は追加しない
            merged[k].append(v) # list
            # merged[k].add(v) # set
    return merged

dct1 = {'red':'1', 'green':'2'}
dct2 = {'red':'3', 'green':'2', 'blue':'4'}
dct = merge(dct1, dct2)
print(dct)

dct_csv = {k: ','.join(v) for k, v in dct.items()}
print(dct_csv)
```

> \# list
>
> defaultdict(<class 'list'>, {'red': ['1', '3'], 'green': ['2', '2'], 'blue': ['4']})
>
> {'red': '3,1', 'green': '2,2', 'blue': '4'}

> \# set
>
> defaultdict(<class 'set'>, {'red': {'3', '1'}, 'green': {'2'}, 'blue': {'4'}})
>
> {'red': '3,1', 'green': '2', 'blue': '4'}

<a id="markdown-辞書の要素を参照" name="辞書の要素を参照"></a>

### 辞書の要素を参照

```py
dct = { 'key1':'first', 'key2':'second', 'key3':'third'}

dct['key1']
dct.key1 # 辞書には使用できない(オブジェクトの属性を参照する際に使用)
```

> 'first'
>
> AttributeError: 'dict' object has no attribute 'key1'

<a id="markdown-存在しないキーを指定した場合" name="存在しないキーを指定した場合"></a>

#### 存在しないキーを指定した場合

```py
dct = { 'key1':'first', 'key2':'second', 'key3':'third'}
```

| 関数                             | 値                   | 備考                                      |
| -------------------------------- | -------------------- | ----------------------------------------- |
| `dct['key999']`                  | `KeyError: 'key999'` | エラーが発生する                          |
| `dct.get('key999')`              | `None`               | 指定したキーが存在しなければ None を返す  |
| `dct.get('key999', 'not found')` | `not found`          | 指定したキーが存在しなければ引数 2 を返す |

<a id="markdown-辞書の要素の存在チェック" name="辞書の要素の存在チェック"></a>

#### 辞書の要素の存在チェック

```py
dct = { 1:'first', 2:'second', 3:'third', }
```

| 項目     | 関数                          | 値      |
| -------- | ----------------------------- | ------- |
| キー     | `1 in dct`                    | `True`  |
|          | `1 not in dct`                | `False` |
| 値       | `'first' in dct.values()`     | `True`  |
| キーと値 | `(1, 'first') in dct.items()` | `True`  |

<a id="markdown-指定した値を持つキーを取得する" name="指定した値を持つキーを取得する"></a>

#### 指定した値を持つキーを取得する

```py
targets = ['first', 'third']
keys = [k for k, v in dct.items() if v in targets]
print(keys)
```

> [1, 3]

<a id="markdown-最大値・最小値辞書" name="最大値・最小値辞書"></a>

#### 最大値・最小値（辞書）

<a id="markdown-キーの最大値／最小値を返す" name="キーの最大値／最小値を返す"></a>

##### キーの最大値／最小値を返す

辞書型をそのまま指定すると、キーの最大値／最小値を返す

```py
dct = { 'a':987, 'b':987, 'c':65, 'd':4, 'e':-3, 'f':-21, 'g':-21}
print(max(dct))
print(min(dct))
```

> g
>
> a

```py
dct = { 'a':987, 'b':987, 'c':65, 'd':4, 'e':-3, 'f':-21, 'g':-21}
print([k for k, v in dct.items() if k == max(dct.keys())])
print([k for k, v in dct.items() if k == min(dct.keys())])
```

> ['g']
>
> ['a']

<a id="markdown-値の最大値／最小値を取得する" name="値の最大値／最小値を取得する"></a>

##### 値の最大値／最小値を取得する

```py
dct = { 'a':987, 'b':987, 'c':65, 'd':4, 'e':-3, 'f':-21, 'g':-21}
print(max(dct.values()))
print(min(dct.values()))
```

> 987
>
> -21

```py
dct = { 'a':987, 'b':987, 'c':65, 'd':4, 'e':-3, 'f':-21, 'g':-21}
print(
    len(
        [v for k, v in dct.items() if v == max(dct.values())]
        )
    )
print(
    len(
        [v for k, v in dct.items() if v == min(dct.values())]
        )
    )
```

> 2
>
> 2

<a id="markdown-値が最大／最小の要素を取得する" name="値が最大／最小の要素を取得する"></a>

##### 値が最大／最小の要素を取得する

```py
print(max(dct.items(), key=lambda x: x[1]))
print(min(dct.items(), key=lambda x: x[1]))

```

> ('a', 987)
>
> ('f', -21)

```py
dct = { 'a':987, 'b':987, 'c':65, 'd':4, 'e':-3, 'f':-21, 'g':-21}
print([i for i in dct.items() if i[1] == max(dct.values())])
print([i for i in dct.items() if i[1] == min(dct.values())])
```

> [('a', 987), ('b', 987)]
>
> [('f', -21), ('g', -21)]

<a id="markdown-値が最大／最小の要素のキーを取得する" name="値が最大／最小の要素のキーを取得する"></a>

##### 値が最大／最小の要素のキーを取得する

```py
print(max(dct, key=dct.get))
print(min(dct, key=dct.get))
```

> a
>
> f

```py
dct = { 'a':987, 'b':987, 'c':65, 'd':4, 'e':-3, 'f':-21, 'g':-21}
print([k for k, v in dct.items() if v == max(dct.values())])
print([k for k, v in dct.items() if v == min(dct.values())])
```

> ['a', 'b']
>
> ['f', 'g']

<a id="markdown-辞書の要素を除去" name="辞書の要素を除去"></a>

### 辞書の要素を除去

```py
dct = { 'key1':'first', 'key2':'second', 'key3':'third'}

# キーを指定して要素を削除
del dct['key1']

print(dct)
```

> {'key2': 'second', 'key3': 'third'}

<a id="markdown-辞書の反復処理キー・値・インデックスを取得" name="辞書の反復処理キー・値・インデックスを取得"></a>

### 辞書の反復処理(キー・値・インデックスを取得)

```py
dct = { 1:'first', 2:'second', 3:'third'}
```

| 項目               | 関数                                                                                                    | 値                                                               |
| ------------------ | ------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- |
| キー               | `dct.keys()`                                                                                            | `dict_keys([1, 2, 3])`                                           |
|                    | `list(dct.keys())`                                                                                      | `[1, 2, 3]`                                                      |
| 値                 | `dct.values()`                                                                                          | `dict_values(['first', 'second', 'third'])`                      |
|                    | `list(dct.values())`                                                                                    | `['first', 'second', 'third']`                                   |
| キーと値のタプル   | `dct.items()`                                                                                           | `dict_items([(1, 'first'), (2, 'second'), (3, 'third')])`        |
|                    | `list(dct.items())`                                                                                     | `[(1, 'first'), (2, 'second'), (3, 'third')]`                    |
| インデックスとキー | `for index, key in enumerate(dct):` <br>&nbsp;&nbsp;&nbsp;&nbsp;`print(f'{index}: {key}')`              | `0: 1` <br> `1: 2` <br> `2: 3`                                   |
| インデックスと値   | `for index, value in enumerate(dct.values()):` <br>&nbsp;&nbsp;&nbsp;&nbsp;`print(f'{index}: {value}')` | `0: first` <br> `1: second` <br> `2: third`                      |
| インデックスと要素 | `for index, item in enumerate(dct.items()):` <br>&nbsp;&nbsp;&nbsp;&nbsp;`print(f'{index}: {item}')`    | `0: (1, 'first')` <br> `1: (2, 'second')` <br> `2: (3, 'third')` |

<a id="markdown-複数の辞書を同時に繰り返す" name="複数の辞書を同時に繰り返す"></a>

#### 複数の辞書を同時に繰り返す

```py
dct1 = {
    'key1-1':'val1-1',
    'key1-2':'val1-2',
    'key1-3':'val1-3'
    }
dct2 = {
    'key2-1':'val2-1',
    'key2-2': 'val2-2',
    'key2-3': 'val2-3'
    }
for index, item in enumerate(zip(dct1, dct1.values(), dct1.items(), dct2, dct2.values(), dct2.items())):
    print(f'{index}: {item}')
```

> 0: ('key1-1', 'val1-1', ('key1-1', 'val1-1'), 'key2-1', 'val2-1', ('key2-1', 'val2-1'))
>
> 1: ('key1-2', 'val1-2', ('key1-2', 'val1-2'), 'key2-2', 'val2-2', ('key2-2', 'val2-2'))
>
> 2: ('key1-3', 'val1-3', ('key1-3', 'val1-3'), 'key2-3', 'val2-3', ('key2-3', 'val2-3'))

<a id="markdown-タプルの要素を連結した文字列を取得" name="タプルの要素を連結した文字列を取得"></a>

#### タプルの要素を連結した文字列を取得

```py
dct = { 1:'first', 2:'second', 3:'third'}
print(
    ','.join(['"{0}":"{1}"'.format(key, value) for (key, value) in dct.items()])
)
```

> "1":"first","2":"second","3":"third"

<a id="markdown-辞書のキーと値を交換する" name="辞書のキーと値を交換する"></a>

#### 辞書のキーと値を交換する

```py
dct1 = dict(('1f', '2s', '3t'))
print(dct1)
dct2 = {v: k for k, v in dct1.items()}
print(dct2)
```

> {'1': 'f', '2': 's', '3': 't'}
>
> {'f': '1', 's': '2', 't': '3'}

<a id="markdown-辞書をソート" name="辞書をソート"></a>

### 辞書をソート

<a id="markdown-辞書のキーでソート" name="辞書のキーでソート"></a>

#### 辞書のキーでソート

```py
dct1 = dict(('1b', '4a', '3c'))
print(dct1)
dct2 = dict(sorted(dct1.items(), key=lambda x: x[0], reverse=True))
print(dct2)
```

> {'1': 'b', '4': 'a', '3': 'c'}
>
> {'3': 'c', '1': 'b', '4': 'a'}

<a id="markdown-辞書の値でソート" name="辞書の値でソート"></a>

#### 辞書の値でソート

```py
dct1 = dict(('1b', '4a', '3c'))
print(dct1)
dct2 = dict(sorted(dct1.items(), key=lambda x: x[1], reverse=True))
print(dct2)
```

> {'1': 'b', '4': 'a', '3': 'c'}
>
> {'3': 'c', '1': 'b', '4': 'a'}

<a id="markdown-辞書の内包表記" name="辞書の内包表記"></a>

### 辞書の内包表記

```
形式: {キー: 値 for 変数 in イテラブルオブジェクト}
```

`キー:`を忘れるとセット(Set／集合)になる

<a id="markdown-文字の出現頻度を調べる" name="文字の出現頻度を調べる"></a>

#### 文字の出現頻度を調べる

```py
code = 'Lorem ipsum dolor sit amet, dico quidam percipitur mea no, labitur scaevola molestiae in vis, malis veniam tacimates mea cu.'
{letter: code.count(letter) for letter in code}

# 文字でソート
dict(sorted({letter: code.count(letter) for letter in code}.items(), key=lambda x: x[0]))

# 多い順にソート
dict(sorted({letter: code.count(letter) for letter in code}.items(), key=lambda x: x[1], reverse=True))
```

> {'L': 1, 'o': 7, 'r': 5, 'e': 10, 'm': 10, ' ': 19, 'i': 13, 'p': 3, 's': 7, 'u': 5, 'd': 3, 'l': 5, 't': 7, 'a': 12, ',': 3, 'c': 5, 'q': 1, 'n': 3, 'b': 1, 'v': 3, '.': 1}
>
> [(' ', 19), (',', 3), ('.', 1), ('L', 1), ('a', 12), ('b', 1), ('c', 5), ('d', 3), ('e', 10), ('i', 13), ('l', 5), ('m', 10), ('n', 3), ('o', 7), ('p', 3), ('q', 1), ('r', 5), ('s', 7), ('t', 7), ('u', 5), ('v', 3)]
>
> [(' ', 19), ('i', 13), ('a', 12), ('e', 10), ('m', 10), ('o', 7), ('s', 7), ('t', 7), ('r', 5), ('u', 5), ('l', 5), ('c', 5), ('p', 3), ('d', 3), (',', 3), ('n', 3), ('v', 3), ('L', 1), ('q', 1), ('b', 1), ('.', 1)]

<a id="markdown-頭文字と単語のリストを辞書にまとめる" name="頭文字と単語のリストを辞書にまとめる"></a>

#### 頭文字と単語のリストを辞書にまとめる

```py
import re

code = 'Lorem ipsum dolor sit amet, dico quidam percipitur mea no, labitur scaevola molestiae in vis, malis veniam tacimates mea cu.'
codes = re.split('[,. \s]+', code)
codes = [s for s in codes if len(s) > 0]
print(codes)

results = {}
for c in codes:
    results.setdefault(c[0], []).append(c)

print(results)
```

> {
>
>     'L': ['Lorem'],
>
>     'i': ['ipsum', 'in'],
>
>     'd': ['dolor', 'dico'],
>
>     's': ['sit', 'scaevola'],
>
>     'a': ['amet'],
>
>     'q': ['quidam'],
>
>     'p': ['percipitur'],
>
>     'm': ['mea', 'molestiae', 'malis', 'mea'],
>
>     'n': ['no'], 'l': ['labitur'],
>
>     'v': ['vis', 'veniam'],
>
>     't': ['tacimates'],
>
>     'c': ['cu']
>
> }

<a id="markdown-順序つき辞書ordereddict" name="順序つき辞書ordereddict"></a>

## 順序つき辞書(OrderedDict)

```py
from collections import OrderedDict

testOrderedDict = OrderedDict()
testOrderedDict['k1'] = 'v1'
testOrderedDict['k2'] = 'v2'
testOrderedDict['k3'] = 'v3'

for k, v in testOrderedDict:
    print(k, v)
```

> k 1
>
> k 2
>
> k 3

<a id="markdown-タプル" name="タプル"></a>

## タプル

リストとは異なり、タプルは読み取り専用

<a id="markdown-タプルが空か検査" name="タプルが空か検査"></a>

### タプルが空か検査

| 判定方法      |
| ------------- |
| `not tpl`     |
| `len(tpl)==0` |
| `tpl == ()`   |

```py
tpl = ()
if not tpl:
  print('empty')

if len(tpl)==0:
  print('empty')

if tpl == ():
  print('empty')
```

<a id="markdown-タプルを生成" name="タプルを生成"></a>

### タプルを生成

<a id="markdown-空のタプルを生成" name="空のタプルを生成"></a>

#### 空のタプルを生成

```py
tpl = ()
```

<a id="markdown-初期値を指定して生成-2" name="初期値を指定して生成-2"></a>

#### 初期値を指定して生成

```py
tpl = 'foo', 'bar', 123, 456
tpl = ('foo', 'bar', 123, 456)
print(str(tpl))
```

> ('foo', 'bar', 123, 456)

1 要素のタプルを宣言するときは後ろにカンマをつける(カンマをつけないとただの変数として代入される)

```py
tpl = 'hoge',

print('%s' % (tpl,)) # print('%s' % tpl)とするとTypeError: not all arguments converted during string formatting
```

> ('hoge',)

<a id="markdown-タプルをコピーして生成" name="タプルをコピーして生成"></a>

#### タプルをコピーして生成

```py
import copy

tpl1 = 'foo', ['bar'], 123, 456
tpl2 = copy.deepcopy(tpl1) # copy()と異なり、要素の参照しているデータもコピー
tpl2[1].append('hoge')
print(tpl1)
print(tpl2)
```

> ('foo', ['bar'], 123, 456)
>
> ('foo', ['bar', 'hoge'], 123, 456)

<a id="markdown-タプルに要素を追加した新しいタプルを生成" name="タプルに要素を追加した新しいタプルを生成"></a>

#### タプルに要素を追加した新しいタプルを生成

```py
tpl1 = ("123", "456")
tpl2 = ("78", "90")

tpl3 = tpl1 + tpl2
print(tpl3)
```

> ('123', '456', '78', '90')

<a id="markdown-リストから生成-1" name="リストから生成-1"></a>

#### リストから生成

```py
tpl = tuple(['foo', 'bar', 123, 456])
print(tpl)
```

> ('foo', 'bar', 123, 456)

<a id="markdown-タプルの要素を参照" name="タプルの要素を参照"></a>

### タプルの要素を参照

<a id="markdown-タプルの要素の存在チェック" name="タプルの要素の存在チェック"></a>

#### タプルの要素の存在チェック

<a id="markdown-タプルの要素を削除" name="タプルの要素を削除"></a>

### タプルの要素を削除

<a id="markdown-タプルの反復処理インデックスを取得" name="タプルの反復処理インデックスを取得"></a>

### タプルの反復処理(インデックスを取得)

```py
tpl = tuple(range(5, 10))
for (index, item) in enumerate(tpl):
    print(index, item)
```

> 0 5
>
> 1 6
>
> 2 7
>
> 3 8
>
> 4 9

<a id="markdown-複数のタプルを同時に繰り返す" name="複数のタプルを同時に繰り返す"></a>

#### 複数のタプルを同時に繰り返す

```py
tpl1 = tuple(range(5)) # タプルの要素数が同じ場合
tpl2 = tuple(range(5,10))

for (i1, i2) in zip(tpl1, tpl2):
    print(i1, i2)
```

> 0 5
>
> 1 6
>
> 2 7
>
> 3 8
>
> 4 9

```py
tpl1 = tuple(range(5)) # タプルの要素数が異なる場合
tpl2 = tuple(range(5,8))

# 要素数の少ないタプルの要素数分だけ繰り返す
for (i1, i2) in zip(tpl1, tpl2):
    print(i1, i2)
```

> 0 5
>
> 1 6
>
> 2 7

```py
from itertools import zip_longest

tpl1 = tuple(range(5)) # タプルの要素数が異なる場合
tpl2 = tuple(range(5,8))

# 要素数の多いタプルの要素数分だけ繰り返す
for (i1, i2) in zip_longest(tpl1, tpl2):
    print(i1, i2)

# 要素数の多いタプルの要素数分だけ繰り返す(不足している要素にNoneではなく指定した値を使用)
for (i1, i2) in zip_longest(tpl1, tpl2, fillvalue=999):
    print(i1, i2)
```

> 0 5
>
> 1 6
>
> 2 7
>
> 3 None
>
> 4 None

> 0 5
>
> 1 6
>
> 2 7
>
> 3 999
>
> 4 999

<a id="markdown-多重タプル" name="多重タプル"></a>

#### 多重タプル

```py
tpl = 'foo', ['bar'], 123, 456
tpl = tpl, (('hoge', 'piyo'), 789)
print(tpl)
```

> (('foo', ['bar'], 123, 456), (('hoge', 'piyo'), 789))

<a id="markdown-平坦化flatten" name="平坦化flatten"></a>

##### 平坦化(flatten)

<a id="markdown-2-重タプルを平坦化flatten" name="2-重タプルを平坦化flatten"></a>

###### 2 重タプルを平坦化(flatten)

```py
tpl1 = ((3, 1, 4), (1, 5, 9), (2, 6, 5))
print(tpl1)

tpl2 = [ f for i in tpl1 for f in i ]
print(tuple(tpl2))
# or
tpl2 = ()
for rows in tpl1:
    tpl2 = tpl2 + rows

print(tpl2)
```

<a id="markdown-多重タプルを平坦化flatten" name="多重タプルを平坦化flatten"></a>

###### 多重タプルを平坦化(flatten)

<a id="markdown-タプルの要素を連結した文字列を取得-1" name="タプルの要素を連結した文字列を取得-1"></a>

#### タプルの要素を連結した文字列を取得

```py
lst = 'foo', 'bar', 'hoge'
''.join(lst)
','.join(lst) # 区切り文字を指定
```

> 'foobarhoge'
>
> 'foo,bar,hoge'

<a id="markdown-シーケンス・アンパッキング" name="シーケンス・アンパッキング"></a>

### シーケンス・アンパッキング

タプルから複数の変数に展開(一括代入)する

```py
t = 'foo', 'bar', 123, 456
x, y, z, w = t
```

一時変数を使用せずに変数を交換（スワップ）する

```py
a, b = 'x', 'y'
a, b = b, a
print(a, b)
```

> y x

```py
def fibonacci(n):
    x, y = 0, 1
    for i in range(n):
        print(x)
        x, y = y, x+y # tmp変数が不要になる

fibonacci(10)
```

代入元の要素数と代入先の変数の数が異なる場合

```py
x, y, z = 'foo', 'bar', 123, 456 # ValueError

x, y, *z = 'foo', 'bar', 123, 456 # アスタリスクをつけるとリストに格納
print(x, y, z)

x, y, z, *w = 'foo', 'bar', 123, 456
print(x, y, z, w)

x, y, z, w, *v = 'foo', 'bar', 123, 456
print(x, y, z, w, v)
```

> ValueError: too many values to unpack (expected 3)

> 'foo', 'bar', [123, 456]

> foo bar 123 [456]

> foo bar 123 456 []

入れ子のタプルを展開

```py
x, (y, z) = 'foo', (123, 456)
print(x, y, z)
```

> foo 123 456

不要な要素を展開しない

```py
x, y, *_ = 'foo', 'bar', 123, 456
print(x, y)
```

> foo bar

<a id="markdown-タプルをソート" name="タプルをソート"></a>

### タプルをソート

<a id="markdown-タプルのランダム処理" name="タプルのランダム処理"></a>

### タプルのランダム処理

<a id="markdown-タプルから要素を-1-個ランダムに取り出す" name="タプルから要素を-1-個ランダムに取り出す"></a>

#### タプルから要素を 1 個ランダムに取り出す

```py
import random

tpl = tuple(range(1,7))

random.choice(tpl)
```

> 1
>
> 1
>
> 4

<a id="markdown-タプルから要素を複数個ランダムに取り出す重複あり" name="タプルから要素を複数個ランダムに取り出す重複あり"></a>

#### タプルから要素を複数個ランダムに取り出す(重複あり)

```py
import random

tpl = tuple(range(1,7))
n = 3

tuple([random.choice(tpl) for _ in range(n)])

tuple(random.choices(tpl, k=n))
```

> (5, 3, 3)
>
> (6, 1, 3)

<a id="markdown-タプルから要素を複数個ランダムに取り出す重複なし" name="タプルから要素を複数個ランダムに取り出す重複なし"></a>

#### タプルから要素を複数個ランダムに取り出す(重複なし)

```py
import random

tpl = tuple(range(1,7))
n = 3

tuple(random.sample(tpl, n))
```

> (1, 5, 4)

<a id="markdown-タプルの要素をランダムソートシャッフルする" name="タプルの要素をランダムソートシャッフルする"></a>

#### タプルの要素をランダムソート(シャッフル)する

```py
import random

tpl1 = tuple(range(1,7))

# もとのタプル自体をソート→TypeError
random.shuffle(tpl1)

# シャッフルした新しいタプルを返す
tpl2 = tuple(random.sample(tpl1, len(tpl1)))
print(tpl2)
```

> TypeError: 'tuple' object does not support item assignment
>
> (1, 3, 4, 6, 5, 2)

<a id="markdown-タプルの内包表記" name="タプルの内包表記"></a>

### タプルの内包表記

丸括弧 `()` の内包表記はタプルではなくジェネレータとなる

```py
l = list(range(10))
(i * 2 for i in l) # 誤

tuple(i * 2 for i in l) # 正
```

> \<generator object \<genexpr\> at 0x000001E1C99F7F90\> \# 誤
>
> (0, 2, 4, 6, 8, 10, 12, 14, 16, 18) \# 正

<a id="markdown-セット" name="セット"></a>

## セット

リストとは異なり、重複する要素があれば削除される

<a id="markdown-セットが空か判定" name="セットが空か判定"></a>

### セットが空か判定

<a id="markdown-セットを生成" name="セットを生成"></a>

### セットを生成

<a id="markdown-空のセットを生成" name="空のセットを生成"></a>

#### 空のセットを生成

```py
s1 = {}
```

<a id="markdown-初期値を指定して生成-3" name="初期値を指定して生成-3"></a>

#### 初期値を指定して生成

```py
s1 = {'ab', 'cd', 'ab', 'cd'}
print(s1)
```

> {'ab', 'cd'}

<a id="markdown-リストから生成-2" name="リストから生成-2"></a>

#### リストから生成

```py
ls2 = ['ab', 'cd', 'ef', 'cd']
s2 = set(ls2)
print(s2)
```

> {'cd', 'ab', 'ef'}

<a id="markdown-辞書に要素を追加-1" name="辞書に要素を追加-1"></a>

### 辞書に要素を追加

```py
s1 = {'ab', 'cd'}
s1.add('yz')
print(s1)
```

> {'ab', 'yz', 'cd'}

<a id="markdown-セットの要素を参照" name="セットの要素を参照"></a>

### セットの要素を参照

<a id="markdown-セットの要素の存在チェック" name="セットの要素の存在チェック"></a>

#### セットの要素の存在チェック

```py
s1 = {'ab', 'cd', 'ab', 'cd'}
print('ab' in s1)
```

> True

<a id="markdown-セットの演算" name="セットの演算"></a>

### セットの演算

```py
s1 = {'ab', 'cd'}
s1 = {'ef', 'ab', 'cd'}
```

| 関数      | 値                   |
| --------- | -------------------- | -------------------- |
| `s1`      | `{'ab', 'cd'}`       |
| `s2`      | `{'ef', 'ab', 'cd'}` |
| `s1 - s2` | `set()`              |
| `s1       | s2`                  | `{'ab', 'cd', 'ef'}` |
| `s1 & s2` | `{'ab', 'cd'}`       |
| `s1 ^ s2` | `{'ef'}`             |

<a id="markdown-制御構文" name="制御構文"></a>

# 制御構文

<a id="markdown-条件分岐" name="条件分岐"></a>

## 条件分岐

<a id="markdown-if" name="if"></a>

### if

switch 文や case 文はなく、すべて if 文を使う

```py
x = 1
if x < 0:
    print('N')
elif x == 0: # else if
    print('0')
else:
    print('P')
```

条件式が長い場合は、各文末に `\` を付けるか、全体を括弧で囲む

```py
x = 1
y = 1
z = -1

if x > 0 \
    and \
    ( \
    y > 0 \
    or \
    z > 0 \
    ):
        print('true')
else:
    print('false')

if ( x > 0
    and
    (
    y > 0
    or
    z > 0
    )
    ):
        print('true')
else:
    print('false')
```

<a id="markdown-条件演算子三項演算子" name="条件演算子三項演算子"></a>

### 条件演算子(三項演算子)

```py
con = 0

result = 'true' if con == 1 else 'false'

print(result)
```

> false

<a id="markdown-繰り返し" name="繰り返し"></a>

## 繰り返し

| 構文    | 備考                             |
| ------- | -------------------------------- |
| `for`   | コレクションの各要素に対して処理 |
| `while` | 条件式が `True` の間繰り返し処理 |

<a id="markdown-for" name="for"></a>

### for

```py
for i in [0, 1, 2, 3]:
    j = 99
    print(i, end=' ')

# ループ変数やループ内で定義された変数を、ループの外でも参照できる
print(i, j)
```

> 0 1 2 3
>
> 3 99

<a id="markdown-for-文の-else-節" name="for-文の-else-節"></a>

#### for 文の else 節

```py
for i in range(5):
    print(i, end=' ')
else:
    # ループを抜けたときに実行される
    print('else')
```

> 0 1 2 3 4 else

<a id="markdown-途中でループから脱出break" name="途中でループから脱出break"></a>

#### 途中でループから脱出(break)

```py

for i in range(5):
    if i > 3:
        break
    print(i, end=' ')
```

> 0 1 2 3

<a id="markdown-スキップするcontinue" name="スキップするcontinue"></a>

#### スキップする(continue)

```py
for i in range(5):
    if i == 3:
        continue
    print(i, end=' ')
```

> 0 1 2 4

<a id="markdown-ループ回数を与える場合" name="ループ回数を与える場合"></a>

#### ループ回数を与える場合

| 関数                       | 内容                                             |
| -------------------------- | ------------------------------------------------ |
| `range(stop)`              | ループ回数                                       |
| `range(start, stop)`       | 指定された開始位置／終了位置の範囲をループ       |
| `range(start, stop, step)` | 指定された開始位置／終了位置／増分の範囲をループ |

```py
for i in range(4):
    print(i, end=' ')

for i in range(5, 8):
    j = i + 1
    print(i, end=' ')

for i in range(5, 20, 5):
    print(i, end=' ')

for i in range(5, 21, 5):
    print(i, end=' ')
```

> 0 1 2 3
>
> 5 6 7
>
> 5 10 15
>
> 5 10 15 20

<a id="markdown-文字列型を与える場合" name="文字列型を与える場合"></a>

#### 文字列型を与える場合

```py
for c in '012':
    print(c, end=' ')
```

> 0 1 2

<a id="markdown-ファイルオブジェクトを場合" name="ファイルオブジェクトを場合"></a>

#### ファイルオブジェクトを場合

```py
for line in open('test-fileio/inpututf8.txt', encoding='utf8'):
    print(line)
```

```
あいうえお8XkfWDHyFdcB52MbTNNswDnFRAsZdEgRmmsaNktD
かきくけこxahfE6WkxNFpU-4KgnJ4jS2jZUyWf9spDbKRaFyC
...
tRR_6_JHDbL27G24P2NaMb-znLJs5iC3wQbPxnyyJc6HV9XYjQ
```

<a id="markdown-複数リストの直積を取得" name="複数リストの直積を取得"></a>

#### 複数リストの直積を取得

```py
import itertools
for x, y,z in itertools.product(range(3), range(3), range(3)):
  print('%d,%d,%d' % (x,y,z))
```

```
0,0,0
0,0,1
0,0,2
0,1,0
0,1,1
0,1,2
0,2,0
0,2,1
0,2,2
1,0,0
1,0,1
1,0,2
1,1,0
1,1,1
1,1,2
1,2,0
1,2,1
1,2,2
2,0,0
2,0,1
2,0,2
2,1,0
2,1,1
2,1,2
2,2,0
2,2,1
2,2,2
```

<a id="markdown-while" name="while"></a>

### while

```py
i = 0
while i < 10:
    i += 1
    if i == 3:
        continue
    print(i, end=' ')
else:
    print('-1')
```

> 1 2 4 5 6 7 8 9 10 -1

<a id="markdown-例外処理" name="例外処理"></a>

## 例外処理

<a id="markdown-try" name="try"></a>

## try

```py
import traceback

str = 'ABC'
try:
    # 範囲外の文字が指定し、IndexError例外を発生させる
    c = str[5]
except IOError as err:
    print('I/O error: {0}'.format(err))
except IndexError as err:
    print('IndexError: {0}'.format(err))
except (UnicodeEncodeError, UnicodeDecodeError, UnicodeTranslateError) as err:
    # 複数の例外をまとめて扱う
    print('UnicodeError: {0}'.format(err))
except:
    # その他の例外
    print(sys.exc_info())   # 現在処理中の例外(type, value, traceback)

    traceback.print_exc()   # 例外情報とスタックトレース項目
    traceback.format_exc()
else:
    # 例外が発生しない場合
    print('Success')
finally:
    # 最終処理
    print('Finally')

# 例外を発生させる
raise IOError('IOError')
```

<a id="markdown-例外を発生させる" name="例外を発生させる"></a>

### 例外を発生させる

例外を投げてプログラム実行を終了させる

```py
raise exception
```

<a id="markdown-assertアサーション" name="assertアサーション"></a>

### assert(アサーション)

`__debug__` が `True` の時のみ動作するので、テスト用に使用できる。
コマンドラインオプションに-O をつけると、 `__debug__` が `False` になるので assert が動作しなくなる。

```py
sum = 1 + 2
assert sum == 3
assert sum == 4  # AssertionErrorが発生
assert sum == 4, '期待される値と異なります'  # AssertionErrorが発生
```

> \# assert sum == 3
>
> &nbsp;&nbsp;&nbsp;&nbsp;\# (何も出力されない)

> \# assert sum == 4
>
> AssertionError

> \# assert sum == 4, '期待される値と異なります'
>
> AssertionError: 期待される値と異なります

<a id="markdown-評価" name="評価"></a>

## 評価

| 関数 | 用途         |
| ---- | ------------ |
| eval | 式として評価 |
| exec | 文として評価 |

<a id="markdown-eval" name="eval"></a>

### eval

```py
result = eval('1 + 2')
print(result)

eval('a = 1 + 2')
```

> 3
>
> SyntaxError: invalid syntax

```py
# 式、グローバル、ローカル
result = eval('a + b', {}, {'a': 1, 'b': 2})
print(result)

result = eval('a + b', {'a': 3, 'b': 4})
print(result)

result = eval('a + b', {'a': 5, 'b': 6}, {'a': 7, 'b': 8})
print(result)
```

> 3
>
> 7
>
> 15

```py
# compile(source, filename, mode, flags=0, dont_inherit=False, optimize=-1)
# 第1引数に文字列を与えている(コードの読み出し元のファイルがない)ので、慣習的に第2引数にファイル名ではなく空文字か「<string>」を指定
result = eval(compile('1 + 2', '<string>', 'eval'))
print(result)
```

| mode     | 意味                                 |
| -------- | ------------------------------------ |
| `eval`   | 単一の式としてコンパイルする         |
| `single` | 単一の文としてコンパイルする         |
| `exec`   | 単一のモジュールとしてコンパイルする |

> 3

<a id="markdown-exec" name="exec"></a>

### exec

```py
exec('a = 1 + 2')
exec('print(a)')
```

> 3

```py
exec('print(a)', {}, {'a': 4})
```

> 4

```py
# 式、グローバル、ローカル
a = {}
exec('b = 3', {}, a)
print(a)
```

> {'b': 3}

```py
for i, s in enumerate(["'foo'","'bar'", "'hoge'"]):
    exec(f'var{i+1} = {s}')

print(var1)
print(var2)
print(var3)
```

> foo
>
> bar
>
> hoge

<a id="markdown-グローバル名前空間の参照・変更を制限" name="グローバル名前空間の参照・変更を制限"></a>

#### グローバル名前空間の参照・変更を制限

```py
exec('import os;os.system("echo foobar")', {}, {})

exec('import os;os.system("echo foobar")', {'__builtins__':None}, {})
```

> foobar
>
> ImportError: **import** not found

<a id="markdown-del" name="del"></a>

## del

オブジェクトを削除

```py
s = 'foo'
i = [1, 2, 3]
b = Bar()
del s, i, b
```

<a id="markdown-exit" name="exit"></a>

## exit

プログラム実行を終了させる

```py
import sys
sys.exit()  # SystemExit例外を出して終了

import sys
sys.exit('error!') # 引数をstderrに出力し、SystemExit例外を出して終了

import os
status = 1
os._exit(status) # 例外を出さずに終了

raise exception # 例外を投げて終了
```

<a id="markdown-pass" name="pass"></a>

## pass

空の関数や空の型を定義する

```py
def empty_func():
    pass


class EmptyClass:
    pass
```

<a id="markdown-with" name="with"></a>

## with

with ブロックが終了するとオブジェクトの終了処理が自動的に呼ばれる

```py
with open(filepath, 'w') as f:
    pass
```

<a id="markdown-複数の-with-をまとめる" name="複数の-with-をまとめる"></a>

### 複数の with をまとめる

入力ファイルと出力ファイルを同時に開く場合など、複数の with ブロックによってネストが深くなってしまうのを防ぐために、「,」で区切って 1 つの with ブロックにまとめることができる

```py
with open(filepath1, 'r') as f1:
    with open(filepath2, 'w') as f2:
        pass

with open(filepath1, 'r') as f1, with open(filepath2, 'w') as f2:
    pass
```

<a id="markdown-関数" name="関数"></a>

# 関数

<a id="markdown-引数なし" name="引数なし"></a>

## 引数なし

```py
# 定義
def func1():
    print('hello')

# 呼出
func1()
```

<a id="markdown-引数あり" name="引数あり"></a>

## 引数あり

```py
# 定義
def func2(arg):
    print(arg)

# 呼出
func2('hello')
```

<a id="markdown-既定値を持つ引数あり" name="既定値を持つ引数あり"></a>

## 既定値を持つ引数あり

```py
# 定義
def func3(arg='bye'):
    print(arg)

# 呼出
func3()
func3(arg='hi')
```

<a id="markdown-戻り値あり" name="戻り値あり"></a>

## 戻り値あり

```py
# 定義
def func4(arg):
    return arg

# 呼出
print(func4('hello'))
```

<a id="markdown-docstring-あり" name="docstring-あり"></a>

## docstring あり

```py
# 定義
def func5():
    '''helloと表示する関数'''
    print('hello')

# 呼出
func5()

# ヘルプを表示
help(func5)
```

<a id="markdown-引数のアンパック" name="引数のアンパック"></a>

## 引数のアンパック

<a id="markdown-リストやタプルを受け取る" name="リストやタプルを受け取る"></a>

## リストやタプルを受け取る

```py
args = [1, 5]
list(range(*args))

list(range(1, 5))   # と同じ
```

可変長引数よりも後に通常の引数を定義することもできるが、キーワード引数を使って呼び出す必要がある

```py
def func_variable_argument(arg, *l, arg1, arg2):
    print(arg)
    for val in l:
        print(val)
    print(arg1)
    print(arg2)

func_variable_argument('a0', ['l1','l2','l3'], 'a1', 'a2')

func_variable_argument('a0', ['l1','l2','l3'], arg1='a1', arg2='a2')
```

> TypeError: func_variable_argument() missing 2 required keyword-only arguments: 'arg1' and 'arg2'

> a0
>
> ['l1', 'l2', 'l3']
>
> a1
>
> a2

<a id="markdown-辞書を受け取る" name="辞書を受け取る"></a>

## 辞書を受け取る

```py
my_dict = {'sep': '%', 'end': '!\r\n!\r\n', 'flush': False}
print('foo', 'bar', 'hoge', **my_dict)
```

> foo%bar%hoge!
>
> !

```py
# 定義
def func_ld(arg, *l, **d):
    for val in l:
        print(val)
    keys = sorted(d.keys())
    for val in keys:
        print(val)

def func_lt(arg, *t, **d):
    for val in t:
        print(val)
    keys = sorted(d.keys())
    for val in keys:
        print(val)

# 呼出
func_ld('foobar',
        'l1',
        'l2',
        dk1='dv1',
        dk2='dv2',
        dk3='dv3')

func_lt('foobar',
        't1',
        't2',
        dk1='dv1',
        dk2='dv2',
        dk3='dv3')
```

<a id="markdown-関数オブジェクト" name="関数オブジェクト"></a>

## 関数オブジェクト

<a id="markdown-関数を変数に代入" name="関数を変数に代入"></a>

### 関数を変数に代入

- def
  - 中身は複数の文。単独の文になる
- lambda
  - 中身は単一の式。式になる

```py
print(print)

def print2(x):
    print(x)

print(print2)

print3 = print2
print(print3)

print3('foobar')
```

> \<built-in function print\>
>
> \<function print2 at 0x00000206FF1A4558\>
>
> \<function print2 at 0x00000206FF1A4558\>
>
> foobar

```py
print4 = lambda x: print(x)
print(print4)

print4('foobar')
```

> \<function <lambda> at 0x00000206FF1A40D8\>
>
> foobar

<a id="markdown-io" name="io"></a>

# I/O

<a id="markdown-コマンドライン引数" name="コマンドライン引数"></a>

## コマンドライン引数

```py
import sys

# sys.argv[1:] とすればファイル名をスキップ（aaa以降が含まれる）
args = sys.argv

print(args)

for i, arg in enumerate(args):
    print('第{}引数: {}'.format(i, args[i]))
```

> ['python3md-arg.py', 'aaa', 'bbb', 'ccc']
>
> 第 1 引数: python3md-arg.py
>
> 第 2 引数: aaa
>
> 第 3 引数: bbb
>
> 第 4 引数: ccc

<a id="markdown-標準入力" name="標準入力"></a>

## 標準入力

```py
s = input('Enter your name:').strip() # stripで空白文字を除去
print(s)

# 数値の場合
if s.isnumeric():
    print(int(s))
```

```
aaaaa
```

> aaaaa

```py
s = input() # splitで空白文字ごとに分割
ss = s.split()
for item in ss:
    print(item)
```

```
aaa bbb ccc
```

> aaa
>
> bbb
>
> ccc

```py
s = input()
num = int(s) if s.isnumeric() else 1 # 引数の要求数
ss = [input() for i in range(num)]
print(ss)
```

```
aaa
bbb
ccc
```

> ['aaa', 'bbb', 'ccc']

<a id="markdown-無限ループをキー入力で抜ける" name="無限ループをキー入力で抜ける"></a>

### 無限ループをキー入力で抜ける

[python/python3md-termios.py](python/python3md-termios.py)

```py
import fcntl
import termios
import sys
import os

def getkey():
    fno = sys.stdin.fileno()

    #stdinの端末属性を取得
    attr_old = termios.tcgetattr(fno)

    # エコーバック・行単位での編集(カノニカルモード)を無効化する
    attr = termios.tcgetattr(fno)

    # Ctrl + CでKeyboardInterruptとする場合
    # attr[3] = attr[3] & ~termios.ECHO & ~termios.ICANON
    # Ctrl + Cをキー入力として利用する場合
    attr[3] = attr[3] & ~termios.ECHO & ~termios.ICANON & ~termios.ISIG
    # ##

    termios.tcsetattr(fno, termios.TCSADRAIN, attr)

    # NONBLOCKモードを設定して、リアルタイムに取る
    fcntl_old = fcntl.fcntl(fno, fcntl.F_GETFL)
    fcntl.fcntl(fno, fcntl.F_SETFL, fcntl_old | os.O_NONBLOCK)

    chr = 0

    try:
        # キーを取得
        c = sys.stdin.read(1)
        if len(c):
            while len(c):
                chr = (chr << 8) + ord(c)
                c = sys.stdin.read(1)
    finally:
        # stdinを元に戻す
        fcntl.fcntl(fno, fcntl.F_SETFL, fcntl_old)
        termios.tcsetattr(fno, termios.TCSANOW, attr_old)

    return chr

if __name__ == '__main__':
    while 1:
        key = getkey()
        if key == 10:
            # Enter
            break
        elif key == 27:
            # Esc
            break
        elif key == 1792836:
            # ←
            break
        elif key == 1792833:
            # ↑
            break
        elif key == 1792834:
            # ↓
            break
        elif key == 1792835:
            # →
            break
        elif key:
            print(key)
```

<a id="markdown-入力フォーマット別標準入力結果の抽出方法" name="入力フォーマット別標準入力結果の抽出方法"></a>

### 入力フォーマット別標準入力結果の抽出方法

競技プログラミングで標準入力からデータが与えられる場合などに使う

<a id="markdown-sysstdinreadline" name="sysstdinreadline"></a>

#### sys.stdin.readline

input の代わりに sys.stdin.readline を使って高速化する

```py
import sys
input = sys.stdin.readline

inputed = input().strip()
```

<a id="markdown-1-行-1-列" name="1-行-1-列"></a>

#### 1 行 1 列

```py
inputed = input().strip()
# 対象が数値なら必要に応じてキャスト
# inputed = int(input().strip())
# inputed = float(input().strip())

print (type(inputed), inputed)
```

<a id="markdown-1-行-2-列" name="1-行-2-列"></a>

#### 1 行 2 列

```py
k, v = input().split()
# 対象が数値なら必要に応じてキャスト
# k, v = (map(int,input().split()))
# k, v = (map(float,input().split()))

print (type(k), k, type(v), v)
```

```py
inputed = tuple(input().split())
# 対象が数値なら必要に応じてキャスト
# inputed = (map(int,input().split()))
# inputed = (map(float,input().split()))

print (type(inputed), inputed)
```

<a id="markdown-1-行-n-列" name="1-行-n-列"></a>

#### 1 行 n 列

```py
inputed = input().split()

# 対象が数値なら必要に応じてキャスト
# inputed = list(map(int,inputed))
# inputed = list(map(float,inputed))

# ソートする場合
# inputed = sorted(input().split())
# inputed = sorted(map(int, input().split()))

print (type(inputed), inputed)
```

<a id="markdown-n-行-1-列" name="n-行-1-列"></a>

#### n 行 1 列

EOF（または `-1` など特定の文字列）が出現するまで読み込む場合

```py
123
456
789
-1
```

```py
for val in iter(input, '-1'):
    print(val)
    # 対象が数値なら必要に応じてキャスト
    # print(int(val))
    # print(float(val))
```

1 行目に行数が、2 行目以降にデータが記載されている場合

```py
N
V1
V2
︙
VN
```

```py
# 1行読み込む
N = int(input().split())

# (a) for文
inputed = []
for _ in range(N):
    inputed.append(int(input())

# (b) 内包表記
inputed = [int(input()) for _ in range(N)]

print (type(inputed), inputed)
```

<a id="markdown-n-行-2-列" name="n-行-2-列"></a>

#### n 行 2 列

1 行目に行数が、2 行目以降にデータが記載されている場合

```py
N
X1 Y1
X2 Y2
︙　︙
XN YN
```

```py
N = int(input())
xy = [map(int, input().split()) for _ in range(N)]
x, y = [list(i) for i in zip(*xy)]
```

<a id="markdown-n-行-m-列列ごとのリスト" name="n-行-m-列列ごとのリスト"></a>

#### n 行 m 列（列ごとのリスト）

1 行目に行数が、2 行目以降にデータが記載されている場合

```
N
X1 Y1 … M1
X2 Y2 … M2
︙　︙　　︙
XN YN … MN
```

```py
N = int(input())
X = [0] * N
Y = [0] * N
# ︙
M = [0] * N
for i in range(N):
    X[i], Y[i], # …
        M[i] = map(int, input().split())
```

<a id="markdown-n-行-m-列2-次元配列" name="n-行-m-列2-次元配列"></a>

#### n 行 m 列（2 次元配列）

1 行目に行数が、2 行目以降にデータが記載されている場合

```
N
V11 V12 … V1M
V21 V22 … V1M
︙　　︙　　　︙
VN1 VN2 … VNM
```

```py
# 1行読み込む
N = int(input().split())

# 残りはforループ
inputed = [input().split() for i in [0] * N]
# inputed = [stdin.readline()[:-1] for _ in [0] * N] # 改行文字を除去

# inputed = [list(map(int,input().split())) for i in [0] * N]
```

```py
# まとめると
inputed = [list(map(int, input().split())) for i in range(int(input()))]
```

<a id="markdown-標準出力" name="標準出力"></a>

## 標準出力

```py
print('Hello Python!')

# すぐにフラッシュする(Python3.3以降)
print('Hello Python!', flush=True)

# すぐにフラッシュする(Python3.2以前)
import sys
print('Hello Python!')
sys.stdout.flush()
```

<a id="markdown-追記／改行して追記ではなく直前の内容を上書き更新しながら出力" name="追記／改行して追記ではなく直前の内容を上書き更新しながら出力"></a>

### 追記（／改行して追記）ではなく、直前の内容を上書き更新しながら出力

[python/python3md-stdout.py](python/python3md-stdout.py)

```py
import sys, time
for num, i in enumerate(range(100)):
    sys.stdout.write("\r%d" % num)
    # print("\r%d" % num, end='') # print() を使う場合は、ただの print() だと開業されてしまい上書きされないので end='' が必要
    sys.stdout.flush()
    time.sleep(0.01)
```

<a id="markdown-末尾に改行文字をつけずに出力する" name="末尾に改行文字をつけずに出力する"></a>

### 末尾に改行文字をつけずに出力する

```py
print('Hello Python!', end='');print('Hello Python!', end='')
```

> Hello Python!Hello Python!

<a id="markdown-pprintでデータ出力の整然化" name="pprintでデータ出力の整然化"></a>

### pprint()でデータ出力の整然化

辞書・リストなどのオブジェクトを整形して出力する

```py
from pprint import pprint

dctlst = [{ 1:'first', 2:'second', 3:'third'},{ 11:'first', 12:'second', 13:'third'},{ 21:'first', 22:'second', 23:'third'}]
pprint(dctlst, stream=f)
```

> [{1: 'first', 2: 'second', 3: 'third'},
>
> {11: 'first', 12: 'second', 13: 'third'},
>
> {21: 'first', 22: 'second', 23: 'third'}]

```py
from pprint import pprint

dctlst = [{ 1:'first', 2:'second', 3:'third'},{ 11:'first', 12:'second', 13:'third'},{ 21:'first', 22:'second', 23:'third'}]

# 深さを指定
pprint(dctlst, depth=1)

# 横幅を指定
pprint(dctlst, width=20)
```

> [{...}, {...}, {...}]

> [{1: 'first',
>
> 2: 'second',
>
> 3: 'third'},
>
> {11: 'first',
>
> 12: 'second',
>
> 13: 'third'},
>
> {21: 'first',
>
> 22: 'second',
>
> 23: 'third'}]

<a id="markdown-標準出力の内容をファイルに書き出す" name="標準出力の内容をファイルに書き出す"></a>

### 標準出力の内容をファイルに書き出す

<a id="markdown-stdout" name="stdout"></a>

#### stdout

```py
import sys
temp_sysout = sys.stdout
f = open('./path/to/file.txt', 'w')
sys.stdout = f

print('to file')

sys.stdout = temp_sysout
f.close()

print('to console')
```

- file.txt

> to file

- Console

> to console

<a id="markdown-print" name="print"></a>

#### print()

```py
with open('./path/to/file.txt', 'w') as f:
    print('contents', file=f)
```

<a id="markdown-プログレスバーを表示" name="プログレスバーを表示"></a>

### プログレスバーを表示

```sh
$ pip install tqdm
```

<a id="markdown-イテラブルなオブジェクトを指定" name="イテラブルなオブジェクトを指定"></a>

#### イテラブルなオブジェクトを指定

```py
from tqdm import tqdm
import time

for i in tqdm(range(100)):
    time.sleep(0.1)

for i in tqdm([1, 2, 3, 4, 5, 6, 7, 8, 9, 10]):
    time.sleep(0.1)

for i in tqdm('Lorem ipsum dolor sit amet, vidit causae eum at.'):
    time.sleep(0.1)
```

<a id="markdown-全量と割合を指定" name="全量と割合を指定"></a>

#### 全量と割合を指定

```py
from tqdm import tqdm
import time

total = 10000
per = 100

bar = tqdm(total = total)
for i in range(100):
    bar.update(per)
    time.sleep(0.1)
bar.close()
```

<a id="markdown-環境変数" name="環境変数"></a>

## 環境変数

<a id="markdown-環境変数の読み出し" name="環境変数の読み出し"></a>

### 環境変数の読み出し

<a id="markdown-一覧の取得" name="一覧の取得"></a>

#### 一覧の取得

```py
import os
print(os.environ)
```

> environ({
>
>     'ALLUSERSPROFILE': 'C:\\ProgramData',
>
>     'APPDATA': 'C:\\Users\\y\\AppData\\Roaming',
>
>     (中略)
>
>     'COLORTERM': 'truecolor'
>
> })

※整形済

```py
import os
for k in os.environ: # そのままforループで回す
    print(k)

for k in os.environ.keys(): # keys()メソッドをつけてforループで回す
    print(k)
```

> ALLUSERSPROFILE
>
> APPDATA
>
> (中略)
>
> COLORTERM

```py
import os
for v in os.environ.values():
    print(v)

for v in list(os.environ.values()): # list型で取得
    print(v)
```

> C:\ProgramData
>
> C:\Users\y\AppData\Roaming
>
> (中略)
>
> truecolor

```py
import os
for k, v in os.environ.items():
    print(k, v)

for k, v in list(os.environ.items()): # list型で取得
    print(k, v)
```

> ALLUSERSPROFILE C:\ProgramData
>
> APPDATA C:\Users\y\AppData\Roaming
>
> (中略)
>
> COLORTERM truecolor

<a id="markdown-環境変数の存在チェック" name="環境変数の存在チェック"></a>

#### 環境変数の存在チェック

```py
import os

# キーの存在チェック
print('ALLUSERSPROFILE' in os.environ)
print('ALLUSERSPROFILE' not in os.environ.keys())

# 値の存在チェック
print('C:\\ProgramData' in os.environ.values())

# キーと値を組み合わせてチェック
print(('ALLUSERSPROFILE', 'C:\\ProgramData') in os.environ.items())
```

> True
>
> False

> True

> True

<a id="markdown-キーを指定して値を取得" name="キーを指定して値を取得"></a>

#### キーを指定して値を取得

```py
import os

print(os.environ['ALLUSERSPROFILE'])
print(os.environ.get('ALLUSERSPROFILE'))
print(os.getenv('ALLUSERSPROFILE'))

print(os.environ['_ALLUSERSPROFILE']) # 指定されたキーが存在しない場合はエラー
print(os.environ.get('_ALLUSERSPROFILE')) # 指定されたキーが存在しない場合はNone
print(os.environ.get('_ALLUSERSPROFILE', 'NULL')) # 指定されたキーが存在しない場合は第2引数に指定された値
print(os.getenv('_ALLUSERSPROFILE', 'NULL')) # 指定されたキーが存在しない場合は第2引数に指定された値
```

> C:\ProgramData
>
> C:\ProgramData
>
> C:\ProgramData

> KeyError: '\_ALLUSERSPROFILE'
>
> None
>
> NULL
>
> NULL

<a id="markdown-環境変数の書き込み" name="環境変数の書き込み"></a>

### 環境変数の書き込み

以下の手順で環境変数を設定／上書きしても、システムの環境変数が変更されるわけではなく、実行中のスクリプトでのみ反映される

```py
import os

os.environ['SAMPLE'] = 'foobar'
print(os.environ['SAMPLE'])

os.environ['SAMPLE'] = 'hogepiyo' # 上書きされる
print(os.environ['SAMPLE'])

os.environ['SAMPLE'] = 123 # 文字列以外を代入しようとするとTypeError
print(os.environ['SAMPLE'])
```

> foobar
>
> hogepiyo
>
> TypeError: str expected, not int
>
> hogepiyo

<a id="markdown-環境変数の削除" name="環境変数の削除"></a>

### 環境変数の削除

```py
import os

os.environ['SAMPLE'] = 'foobar'
print(os.environ['SAMPLE'])

print(os.environ.pop('SAMPLE'))
print(os.environ['SAMPLE'])

print(os.environ.pop('SAMPLE', None))
```

> foobar

> foobar
>
> KeyError: 'SAMPLE'

> None

```py
import os

os.environ['SAMPLE'] = 'foobar'
print(os.environ['SAMPLE'])

del os.environ['SAMPLE']

del os.environ['SAMPLE']
```

> foobar

>

> KeyError: 'SAMPLE'

<a id="markdown-env-ファイルに記述した設定値を環境変数に設定" name="env-ファイルに記述した設定値を環境変数に設定"></a>

### .env ファイルに記述した設定値を環境変数に設定

- 1. `python-dotenv` モジュールをインストールする

```sh
$ pip install python-dotenv
```

- 2. `.env` ファイルを作成

```
PASSWORD=my_password
```

- 3. `settings.py` を呼び出す

- settings.py

```py
import os
from os.path import join, dirname
from dotenv import load_dotenv

load_dotenv(join(dirname(__file__), '.env'))
PASSWORD = os.environ.get('PASSWORD')
```

- app.py

```py
import settings

PASSWORD = settings.PASSWORD
print(PASSWORD)
```

<a id="markdown-ハッシュ" name="ハッシュ"></a>

## ハッシュ

<a id="markdown-文字列からハッシュを取得" name="文字列からハッシュを取得"></a>

### 文字列からハッシュを取得

```py
import hashlib

dat = 'foobar'

print(hashlib.algorithms_guaranteed) # サポートしているアルゴリズムの一覧を取得

print(hashlib.md5(dat.encode()).hexdigest()) # MD5
print(hashlib.sha1(dat.encode()).hexdigest()) # SHA-1
print(hashlib.sha256(dat.encode()).hexdigest()) # SHA256
print(hashlib.sha512(dat.encode()).hexdigest()) # SHA512
```

> {'shake_128', 'sha384', 'blake2b', 'sha3_224', 'blake2s', 'sha224', 'sha256', 'sha512', 'sha3_256', 'sha3_384', 'shake_256', 'sha3_512', 'md5', 'sha1'}
>
> 3858f62230ac3c915f300c664312c63f
>
> 8843d7f92416211de9ebb963ff4ce28125932878
>
> c3ab8ff13720e8ad9047dd39466b3c8974e592c2fa383d4a3960714caef0c4f2
>
> 0a50261ebd1a390fed2bf326f2673c145582a6342d523204973d0219337f81616a8069b012587cf5635f6925f1b56c360230c19b273500ee013e030601bf2425

<a id="markdown-巨大なデータのハッシュを取得" name="巨大なデータのハッシュを取得"></a>

#### 巨大なデータのハッシュを取得

```py
import hashlib

dat = b'hoge'*0x100000

# 比較用
print(hashlib.md5(dat).hexdigest())

h = hashlib.new('md5')

# 処理単位
chunk_size = h.block_size * 4096

while dat:
    chunk = dat[:chunk_size]
    dat = dat[chunk_size:]
    # ハッシュオブジェクトを更新
    h.update(chunk)

print(h.hexdigest())
```

> 58e20228105b868ae22ac4e3f5074631
>
> 58e20228105b868ae22ac4e3f5074631

<a id="markdown-ファイルのハッシュを取得" name="ファイルのハッシュを取得"></a>

### ファイルのハッシュを取得

```py
import hashlib
import os

with open(os.path.join('test-fileio', 'inputsjis.txt'),'rb') as f:
    dat = f.read()
    print(hashlib.algorithms_guaranteed) # サポートしているアルゴリズムの一覧を取得
    print(hashlib.md5(dat).hexdigest()) # MD5
    print(hashlib.sha1(dat).hexdigest()) # SHA-1
    print(hashlib.sha256(dat).hexdigest()) # SHA256
    print(hashlib.sha512(dat).hexdigest()) # SHA512
```

> {'shake_128', 'sha384', 'blake2b', 'sha3_224', 'blake2s', 'sha224', 'sha256', 'sha512', 'sha3_256', 'sha3_384', 'shake_256', 'sha3_512', 'md5', 'sha1'}
>
> 8618e191816aeee9ad8e3444be9a26b5
>
> 7904da5abecff2cfa009df4262140d2f55e4d3da
>
> 9f4b600039cc7d66def7f25be7c6e1b998f3afc6c23eb52fb840b19480dd1ca2
>
> 3e5df2441e594ce512d81de7db1574e8c5f3187610ac0855d1d8f9111b983ced5af1277ee036c7e6817419553a3f7c910986fbd9d6d754b57cd82f2ee0d25fcc

<a id="markdown-巨大なファイルのハッシュを取得" name="巨大なファイルのハッシュを取得"></a>

#### 巨大なファイルのハッシュを取得

```py
import hashlib
import os

h = hashlib.new('md5')

# 処理単位
chunk_size = h.block_size * 4096

with open(os.path.join('test-fileio', 'inputsjis.txt'),'rb') as f:
    chunk = f.read(chunk_size)
    while chunk:
        # ハッシュオブジェクトを更新
        h.update(chunk)
        chunk = f.read(chunk_size)

print(h.hexdigest())
```

> 8618e191816aeee9ad8e3444be9a26b5

<a id="markdown-pathlib-でのファイル操作" name="pathlib-でのファイル操作"></a>

## pathlib でのファイル操作

```py
from pathlib import Path
```

| 項目                 | 関数            | 値                                                             |
| -------------------- | --------------- | -------------------------------------------------------------- |
| カレントディレクトリ | `Path().cwd()`  | `WindowsPath('C:/Users/y/Documents/GitHub/Python-cheatsheet')` |
| ホームディレクトリ   | `Path().home()` | `WindowsPath('C:/Users/y')`                                    |

```py
from pathlib import Path

pd = Path() # カレントディレクトリ

filepath = ('./test-pathlib/test.txt')
pf = Path(filepath) # ファイルのPathオブジェクト
```

| 項目                                                                                             | 関数                                                         | 値                                                                                                                                                                                                                                                                                                                                                                    |
| ------------------------------------------------------------------------------------------------ | ------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ファイル情報（フォルダ）                                                                         | `pd.stat()`                                                  | `os.stat_result(st_mode=16895, st_ino=1970324838202858, st_dev=2665268219, st_nlink=1, st_uid=0, st_gid=0, st_size=4096, st_atime=1580268901, st_mtime=1580268901, st_ctime=1564111044)`                                                                                                                                                                              |
| 　　　　　　（ファイル）                                                                         | `pf.stat()`                                                  | `os.stat_result(st_mode=33206, st_ino=21110623253331987, st_dev=2665268219, st_nlink=1, st_uid=0, st_gid=0, st_size=533, st_atime=1580268916, st_mtime=1565394485, st_ctime=1580268916)`                                                                                                                                                                              |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| 　（パスがシンボリックリンクの場合、シンボリックリンク自身の情報を取得）                         | `pd.lstat()`                                                 | `os.stat_result(st_mode=16895, st_ino=1970324838202858, st_dev=2665268219, st_nlink=1, st_uid=0, st_gid=0, st_size=4096, st_atime=1580268901, st_mtime=1580268901, st_ctime=1564111044)`                                                                                                                                                                              |
| ファイルの所有者のユーザー名                                                                     | `pd.owner()`                                                 | `NotImplementedError: Path.owner() is unsupported on this system` (Windows)                                                                                                                                                                                                                                                                                           |
| ファイルの所有者のグループ名                                                                     | `pd.group()`                                                 | `NotImplementedError: Path.owner() is unsupported on this system` (Windows)                                                                                                                                                                                                                                                                                           |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| 相対パス（フォルダ）                                                                             | `pd`                                                         | `WindowsPath('.')`                                                                                                                                                                                                                                                                                                                                                    |
| 　　　　（ファイル）                                                                             | `pf`                                                         | `WindowsPath('test-pathlib/test.txt')`                                                                                                                                                                                                                                                                                                                                |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| 絶対パス（フォルダ）                                                                             | `pd.resolve()` <br> `p.absolute()`                           | `WindowsPath('C:/Users/y/Documents/GitHub/Python-cheatsheet')`                                                                                                                                                                                                                                                                                                        |
| 　　　　（ファイル）                                                                             | `pf.resolve()` <br>or<br> `p.absolute()`                     | `WindowsPath('C:/Users/y/Documents/GitHub/Python-cheatsheet/test-pathlib/test.txt')`                                                                                                                                                                                                                                                                                  |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| スラッシュ区切りのパス                                                                           | `Path('c:\\windows').resolve().as_posix()`                   | `'C:/Windows'`                                                                                                                                                                                                                                                                                                                                                        |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| file URI                                                                                         | `pf.resolve().as_uri()`                                      | `'file:///C:/Users/y/Documents/GitHub/Python-cheatsheet/test-pathlib/test.txt'`                                                                                                                                                                                                                                                                                       |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| ドライブ文字                                                                                     | `pf.resolve().drive`                                         | `'C:'`                                                                                                                                                                                                                                                                                                                                                                |
| ルート                                                                                           | `pf.resolve().root`                                          | `\\`                                                                                                                                                                                                                                                                                                                                                                  |
| アンカー（ドライブ文字＋ルート）                                                                 | `pf.resolve().anchor`                                        | `C:\\`                                                                                                                                                                                                                                                                                                                                                                |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| ファイル名（basename）                                                                           | `pf.resolve().name`                                          | `'test.txt'`                                                                                                                                                                                                                                                                                                                                                          |
| 拡張子                                                                                           | `pf.resolve().suffix`                                        | `'.txt'`                                                                                                                                                                                                                                                                                                                                                              |
|                                                                                                  | `Path('test.tar.gz').resolve().suffix`                       | `'.gz'`                                                                                                                                                                                                                                                                                                                                                               |
| 拡張子のリスト                                                                                   | `pf.resolve().suffixes`                                      | `['.txt']`                                                                                                                                                                                                                                                                                                                                                            |
|                                                                                                  | `Path('test.tar.gz').resolve().suffixes`                     | `['.tar', '.gz']`                                                                                                                                                                                                                                                                                                                                                     |
| ファイル名から拡張子を除いたもの                                                                 | `pf.resolve().stem`                                          | `'test'`                                                                                                                                                                                                                                                                                                                                                              |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| パスが存在するかどうか（フォルダ）                                                               | `pd.exists()`                                                | `True`                                                                                                                                                                                                                                                                                                                                                                |
| 　　　　　　　　　　　（ファイル）                                                               | `pf.exists()`                                                | `True`                                                                                                                                                                                                                                                                                                                                                                |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| パスがディレクトリ（またはディレクトリへのシンボリックリンク）（フォルダ）                       | `pd.is_dir()`                                                | `True`                                                                                                                                                                                                                                                                                                                                                                |
| 　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　（ファイル）                       | `pf.is_dir()`                                                | `False`                                                                                                                                                                                                                                                                                                                                                               |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| パスが一般ファイル（または一般ファイルへのシンボリックリンク）（フォルダ）                       | `pd.is_file()`                                               | `False`                                                                                                                                                                                                                                                                                                                                                               |
| 　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　（ファイル）                       | `pf.is_file()`                                               | `True`                                                                                                                                                                                                                                                                                                                                                                |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| パスがシンボリックリンク（フォルダ）                                                             | `pd.is_symlink()`                                            | `False`                                                                                                                                                                                                                                                                                                                                                               |
| 　　　　　　　　　　　　（ファイル）                                                             | `pf.is_symlink()`                                            | `False`                                                                                                                                                                                                                                                                                                                                                               |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| パスが Unix ソケット（または Unix ソケットへのシンボリックリンク）（フォルダ）                   | `pd.is_socket()`                                             | `False`                                                                                                                                                                                                                                                                                                                                                               |
| 　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　（ファイル）                   | `pf.is_socket()`                                             | `False`                                                                                                                                                                                                                                                                                                                                                               |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| パスが FIFO（または FIFO へのシンボリックリンク）（フォルダ）                                    | `pd.is_fifo()`                                               | `False`                                                                                                                                                                                                                                                                                                                                                               |
| 　　　　　　　　　　　　　　　　　　　　　　　　　（ファイル）                                   | `pf.is_fifo()`                                               | `False`                                                                                                                                                                                                                                                                                                                                                               |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| パスが絶対パスかどうか（フォルダ）                                                               | `pd.is_absolute()`                                           | `False`                                                                                                                                                                                                                                                                                                                                                               |
| 　　　　　　　　　　　（ファイル）                                                               | `pf.is_absolute()`                                           | `False`                                                                                                                                                                                                                                                                                                                                                               |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| パス文字列の連結（結合）                                                                         | `Path('test-pathlib').joinpath('sub')`                       | `WindowsPath('test-pathlib/sub')`                                                                                                                                                                                                                                                                                                                                     |
|                                                                                                  | `Path('test-pathlib').joinpath('test.txt')`                  | `WindowsPath('test-pathlib/test.txt')`                                                                                                                                                                                                                                                                                                                                |
|                                                                                                  | `Path('c:').joinpath('/Program Files')`                      | `WindowsPath('c:/Program Files')`                                                                                                                                                                                                                                                                                                                                     |
|                                                                                                  | `Path('c:/').joinpath('Program Files')`                      | `WindowsPath('c:/Program Files')`                                                                                                                                                                                                                                                                                                                                     |
|                                                                                                  | `Path('c:').joinpath('Program Files')`                       | `WindowsPath('c:Program Files')`                                                                                                                                                                                                                                                                                                                                      |
|                                                                                                  | `Path('c:\\').joinpath('Program Files').joinpath('Python')`  | `WindowsPath('c:/Program Files/Python')`                                                                                                                                                                                                                                                                                                                              |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| `~` および `~user` を展開（存在しないパスも可）                                                  | `Path('~/non-existent').expanduser()`                        | `WindowsPath('C:/Users/y/work')`                                                                                                                                                                                                                                                                                                                                      |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| パス文字列のうちファイル名（basename）のみを置換 （フォルダ）                                    | `Path('c:/non-existent').with_name('replaced')`              | `WindowsPath('c:/replaced')`                                                                                                                                                                                                                                                                                                                                          |
| 　　　　　　　　　　　　　　　　　　　　　　　　　（ファイル）                                   | `pf.with_name('replaced.txt')`                               | `WindowsPath('test-pathlib/replaced.txt')`                                                                                                                                                                                                                                                                                                                            |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| パス文字列のうち拡張子のみを置換                                                                 | `pf.with_suffix('.txt')`                                     | `WindowsPath('test-pathlib/test.txt')`                                                                                                                                                                                                                                                                                                                                |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| 上位パスを辿る                                                                                   | `pf.resolve().parents`                                       | `<WindowsPath.parents>`                                                                                                                                                                                                                                                                                                                                               |
|                                                                                                  | `[i for i in pf.resolve().parents]`                          | `[WindowsPath('C:/Users/y/Documents/GitHub/Python-cheatsheet/test-pathlib'), WindowsPath('C:/Users/y/Documents/GitHub/Python-cheatsheet'),` ... `WindowsPath('C:/Users'), WindowsPath('C:/')]`                                                                                                                                                                        |
| 上位パス                                                                                         | `pf.resolve().parent`                                        | `WindowsPath('C:/Users/y/Documents/GitHub/Python-cheatsheet/test-pathlib')`                                                                                                                                                                                                                                                                                           |
|                                                                                                  | `Path('/').parent`                                           | `WindowsPath('/')` 親ディレクトリが存在しない場合                                                                                                                                                                                                                                                                                                                     |
|                                                                                                  | `Path('.').parent`                                           | `WindowsPath('.')` 空のパス                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                  | `Path('.').resolve().parent`                                 | `WindowsPath('C:/Users/y/Documents/GitHub')`                                                                                                                                                                                                                                                                                                                          |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| 2 つのパスが参照するファイル／フォルダが一致するか（ファイルが存在しないと `FileNotFoundError`） | `Path('C:/Users/y/').samefile(Path('~/').expanduser())`      | `True`                                                                                                                                                                                                                                                                                                                                                                |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| 2 つのパス間の相対パス                                                                           | `Path('/var/www/html').relative_to('/var')`                  | `WindowsPath('www/html')`                                                                                                                                                                                                                                                                                                                                             |
|                                                                                                  | `Path('/var/www/html').relative_to('/etc')`                  | `ValueError: '\\var\\www\\html' does not start with '\\etc'`                                                                                                                                                                                                                                                                                                          |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| ディレクトリの内容を列挙                                                                         | `for child in pd.iterdir(): child`                           | `WindowsPath('.git')` <br> `WindowsPath('.gitattributes')` <br> ... <br> `WindowsPath('__pycache__')`                                                                                                                                                                                                                                                                 |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| glob 形式のパターンにマッチするか                                                                | `pf.match('*.txt')`                                          | `True`                                                                                                                                                                                                                                                                                                                                                                |
| 　（pattern が相対表記であればパスは相対／絶対パスを取り、右から一致を調べる）                   | `Path('/a/b/c.py').match('b/*.py')`                          | `True`                                                                                                                                                                                                                                                                                                                                                                |
|                                                                                                  | `Path('/a/b/c.py').match('a/*.py')`                          | `False`                                                                                                                                                                                                                                                                                                                                                               |
| 　（pattern が絶対表記であればパスは絶対パスでなければならず、パス全体が一致するか調べる）       | `Path('/a.py').match('/*.py')`                               | `True`                                                                                                                                                                                                                                                                                                                                                                |
|                                                                                                  | `Path('a/b.py').match('/*.py')`                              | `False`                                                                                                                                                                                                                                                                                                                                                               |
| 　（大文字／小文字の区別）                                                                       | `Path('b.py').match('*.PY')`                                 | `True` (Windows の場合)                                                                                                                                                                                                                                                                                                                                               |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| glob 形式のパターンにマッチするファイル・フォルダの一覧                                          | `sorted(Path('./test-glob').glob('*'))`                      | `[WindowsPath('test-glob/test-glob-1'), WindowsPath('test-glob/test-glob-2'), WindowsPath('test-glob/test-glob-3.dat')]`                                                                                                                                                                                                                                              |
|                                                                                                  | `sorted(Path('./test-glob').glob('non-existent-dir/*.dat'))` | `[]`                                                                                                                                                                                                                                                                                                                                                                  |
|                                                                                                  | `sorted(Path('./test-glob').glob('*/*.dat'))`                | `[WindowsPath('test-glob/test-glob-1/test-glob-1-2.dat'), WindowsPath('test-glob/test-glob-2/.test-glob-2-1.dat'), WindowsPath('test-glob/test-glob-2/test-glob-2-2.dat')]`                                                                                                                                                                                           |
| 　（再帰的に検索）                                                                               | `sorted(Path('./test-glob').glob('**/*.dat'))`               | `[WindowsPath('test-glob/test-glob-1/test-glob-1-1/test-glob-1-1-1.dat'), WindowsPath('test-glob/test-glob-1/test-glob-1-1/test-glob-1-1-2.dat'), WindowsPath('test-glob/test-glob-1/test-glob-1-2.dat'), WindowsPath('test-glob/test-glob-2/.test-glob-2-1.dat'), WindowsPath('test-glob/test-glob-2/test-glob-2-2.dat'), WindowsPath('test-glob/test-glob-3.dat')]` |
| 　（再帰的に検索；pattern の前に `"**/"` を追加した glob()）                                     | `sorted(Path('./test-glob').rglob('*.py'))`                  | `[WindowsPath('test-glob/test-glob-1/test-glob-1-1/test-glob-1-1-1.dat'), WindowsPath('test-glob/test-glob-1/test-glob-1-1/test-glob-1-1-2.dat'), WindowsPath('test-glob/test-glob-1/test-glob-1-2.dat'), WindowsPath('test-glob/test-glob-2/.test-glob-2-1.dat'), WindowsPath('test-glob/test-glob-2/test-glob-2-2.dat'), WindowsPath('test-glob/test-glob-3.dat')]` |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |

| stat の項目 | 説明                             |
| ----------- | -------------------------------- |
| `st_mode`   | ファイルモード                   |
| `st_ino`    | inode 番号（Unix）               |
|             | the file index（Windows）        |
| `st_dev`    | デバイスの識別子                 |
| `st_nlink`  | ハードリンクの数                 |
| `st_uid`    | ファイル所有者のユーザ識別子     |
| `st_gid`    | ファイル所有者のグループ識別子   |
| `st_size`   | バイト単位でのファイルサイズ     |
| `st_atime`  | 秒で表した最終アクセス時刻       |
| `st_mtime`  | 秒で表した最終更新時刻           |
| `st_ctime`  | メタデータの最終更新時刻（Unix） |
|             | 秒で表した作成時刻（Windows）    |

```py
from pathlib import Path

pd = Path('./test-pathlib/')
pf = Path('./test-pathlib/test.txt')
```

| 項目                                                                                                       | 関数                                                                                                                                       | オプション                                                                                 | 値                                                                                             |
| ---------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------- |
| ファイルを作成                                                                                             | `Path('./test-pathlib/test').touch(mode=0o666, exist_ok=True)`                                                                             | 途中のパスが存在しない場合はエラーを出さずに何もしない                                     |                                                                                                |
|                                                                                                            |                                                                                                                                            | `mode` がある場合、プロセスの umask 値と組み合わせてファイルのモードとアクセスフラグを決定 |                                                                                                |
| フォルダを作成                                                                                             | `Path('./test-pathlib/').mkdir(mode=0o777, parents=False, exist_ok=False)`                                                                 | `mode` がある場合、プロセスの umask 値と組み合わせてファイルのモードとアクセスフラグを決定 |                                                                                                |
|                                                                                                            |                                                                                                                                            | `parents=False` （既定）：親ディレクトリがないと FileNotFoundError                         |                                                                                                |
|                                                                                                            |                                                                                                                                            | `parents=True`：途中階層のディレクトリがなければ作成                                       |                                                                                                |
|                                                                                                            |                                                                                                                                            | `exist_ok=False` （既定）：対象のディレクトリが既に存在すると FileExistsError              |                                                                                                |
|                                                                                                            |                                                                                                                                            | `exist_ok=True`：パス要素の末尾が既に存在するがディレクトリではないと FileExistsError      |                                                                                                |
|                                                                                                            |                                                                                                                                            |                                                                                            |                                                                                                |
| シンボリックリンクを作成（Windows でフォルダにリンクする場合は `target_is_directory=True` を指定）         | `Path('./test-pathlib/link').symlink_to('./test-pathlib/test.txt')`                                                                        |                                                                                            |                                                                                                |
| ハードリンクを作成                                                                                         | `Path('./test-pathlib/link').link_to('./test-pathlib/test.txt')`                                                                           |                                                                                            |                                                                                                |
|                                                                                                            |                                                                                                                                            |                                                                                            |                                                                                                |
| ファイル・フォルダを移動                                                                                   | `Path('./test-pathlib/test.txt').rename('./test-pathlib/renamed.txt')`                                                                     | `WindowsPath('test-pathlib/renamed.txt')`                                                  |                                                                                                |
| （Unix の場合は target が既存のファイルだと上書きされるが、Windows の場合は `FileExistsError` ）           | `Path('./test-pathlib/renamed.txt').rename(Path('./test-pathlib/test.txt')).exists()`                                                      | `True`                                                                                     |                                                                                                |
| ファイル・フォルダを移動                                                                                   | `Path('./test-pathlib/test.txt').replace('./test-pathlib/replaced.txt')`                                                                   | `WindowsPath('test-pathlib/renamed.txt')`                                                  |                                                                                                |
| （target が既存のファイル／フォルダだと無条件に上書き）                                                    | `Path('./test-pathlib/replaced.txt').replace(Path('./test-pathlib/test.txt')).exists()`                                                    | `True`                                                                                     |                                                                                                |
| （既存のフォルダにファイルを上書きしようとすると `PermissionError`）                                       | `Path('./test-pathlib/test.txt').is_dir() and Path('./test-pathlib/replaced.txt').replace(Path('./test-pathlib/test.txt')).exists()`       | `PermissionError`                                                                          |                                                                                                |
|                                                                                                            |                                                                                                                                            |                                                                                            |                                                                                                |
| モードを変更                                                                                               | `pf.chmod(0o444)` < br > `pf.stat().st_mode`                                                                                               |                                                                                            | `33060`                                                                                        |
|                                                                                                            | `pd.chmod(0o444)` < br > `pd.stat().st_mode`                                                                                               |                                                                                            | `16749`                                                                                        |
| 　（シンボリックリンク自身のモードを変更）                                                                 | `pd.lchmod(0o444)` < br > `pd.stat().st_mode`                                                                                              |                                                                                            | `16749`                                                                                        |
|                                                                                                            |                                                                                                                                            |                                                                                            |                                                                                                |
| ファイルを削除 （デフォルトの missing_ok=False だと、ファイルが既に存在しない場合は `FileNotFoundError` ） | `Path('./test-pathlib/exist.txt').unlink()`                                                                                                |                                                                                            |                                                                                                |
| 　特定のフォルダ内にあるファイルをすべて削除                                                               | `[p.unlink() for p in Path('./test-pathlib/exist/').iterdir() if p.is_file()]`                                                             |                                                                                            |                                                                                                |
| 空のフォルダを削除                                                                                         | `Path('./test-pathlib/exist').rmdir()`                                                                                                     |                                                                                            | 配下にファイル／フォルダが存在すると `OSError: ディレクトリが空ではありません。`               |
|                                                                                                            |                                                                                                                                            |                                                                                            |                                                                                                |
| ファイルを開いて 1 行読み込む                                                                              | `with pf.open(mode='r', buffering=-1, encoding='utf_8_sig', errors=None, newline=None) as f:` <br> &nbsp;&nbsp;&nbsp;&nbsp; `f.readline()` | BOM なしの UTF-8 ならば `encoding = 'UTF-8'`                                               | `'あいうえお8XkfWDHyFdcB52MbTNNswDnFRAsZdEgRmmsaNktD\n'`                                       |
| ファイルの内容をバイナリデータとして取得 （パスが存在しない場合は `FileNotFoundError`）                    | `pf.read_bytes()`                                                                                                                          |                                                                                            | `b'\xef\xbb\xbf\xe3\x81\x82\xe3\x81\x84\xe3\x81\x86\xe3\x81\x88\xe3\x81\x8a8Xk` ... `YjQ\r\n'` |
| ファイルの内容をテキストデータ（文字列型）として取得（パスが存在しない場合は `FileNotFoundError`）         | `pf.read_text(encoding='utf_8_sig')`                                                                                                       |                                                                                            | `'あいうえお8Xk` ... `YjQ\n'`                                                                  |
|                                                                                                            |                                                                                                                                            |                                                                                            |                                                                                                |
| ファイルにバイナリデータを書き込む（上書き；パスが存在しない場合は新規作成）                               | `Path('./test-pathlib/write.bin').write_bytes(b'Binary data')`                                                                             |                                                                                            | `11`                                                                                           |
| ファイルにテキストデータを書き込む（上書き；パスが存在しない場合は新規作成）                               | `Path('./test-pathlib/write.txt').write_text('Text data', encoding='UTF-8')`                                                               |                                                                                            | `9`                                                                                            |
|                                                                                                            | `Path('./test-pathlib/write.txt').write_text('Text data', encoding='utf_8_sig')`                                                           |                                                                                            | `9`                                                                                            |
|                                                                                                            | `Path('./test-pathlib/write.txt').write_text('Ｔｅｘｔ ｄａｔａ', encoding='Shift-JIS')`                                                   |                                                                                            | `9`                                                                                            |

| ファイルが開かれるモードの項目 | 説明                                                     | パスが存在しない場合 |
| ------------------------------ | -------------------------------------------------------- | -------------------- |
| `r`                            | 読み込み用に開く(デフォルト)                             | `FileNotFoundError`  |
| `w`                            | 書き込み用に開き、まずファイルを切り詰める               | 新規作成             |
| `x`                            | 排他的な生成に開き、ファイルが存在する場合は失敗する     |                      |
| `a`                            | 書き込み用に開き、ファイルが存在する場合は末尾に追記する |                      |
| `b`                            | バイナリモード                                           | -                    |
| `t`                            | テキストモード(デフォルト)                               | -                    |
| `+`                            | 更新用に開く（読み込み／書き込み）                       | -                    |

<a id="markdown-ローカルファイル" name="ローカルファイル"></a>

## ローカルファイル

<a id="markdown-パス文字列の操作" name="パス文字列の操作"></a>

### パス文字列の操作

| 取得内容                           | 関数(`import os`が必要)                                                                                        | 値                                                                       | パスにファイルが存在しない場合                                           |
| ---------------------------------- | -------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------ | ------------------------------------------------------------------------ |
| パス区切り文字                     | `os.path.sep`                                                                                                  | `'/'`                                                                    |                                                                          |
| パス文字列を組み立て(結合)         | `os.path.join('.', 'test' + '-' + 'join', 'test.txt')`                                                         | `'./test-join/test.txt'`                                                 | `'./test-join/test.txt'`                                                 |
|                                    |                                                                                                                |                                                                          |                                                                          |
| ファイル名                         | `os.path.basename('./test-join/test.txt')`                                                                     | `'test.txt'`                                                             | `'test.txt'`                                                             |
| ディレクトリ名                     | `os.path.dirname('./test-join/test.txt')`                                                                      | `'./test-join'`                                                          | `'./test-join'`                                                          |
| ファイル名とディレクトリ名のタプル | `dname, bname = os.path.split('./test-join/test.txt')` <br> `print(dname, bname)`                              | `./test-join test.txt`                                                   | `./test-join test.txt`                                                   |
| パス～ファイル名と拡張子           | `root, ext = os.path.splitext('./test-join/test.txt')` <br> `print(root, ext)`                                 | `./test-join/test .txt`                                                  | `./test-join/test .txt`                                                  |
|                                    | `spltext = os.path.splitext('./test-join/test.txt')` <br> `print(spltext[0], spltext[1])`                      | `./test-join/test .txt`                                                  | `./test-join/test .txt`                                                  |
|                                    |                                                                                                                |                                                                          |                                                                          |
| 絶対パス                           | `os.path.abspath('./test-join/test.txt')`                                                                      | `'/mnt/c/Users/y/Documents/GitHub/Python-cheatsheet/test-join/test.txt'` | `'/mnt/c/Users/y/Documents/GitHub/Python-cheatsheet/test-join/test.txt'` |
| 2 つのパス間の相対パス             | `os.path.relpath(os.path.abspath('./test-join/test.txt'), '.')`                                                | `'test-join/test.txt'`                                                   | `'test-join/test.txt'`                                                   |
| 共通パス(階層単位)                 | `os.path.commonpath( [os.path.abspath('./test-join/test1.txt'), os.path.abspath('./test-join/test2.txt')] )`   | `'C:\Users\y\Documents\GitHub\Python-cheatsheet\test-join'`              | `'C:\Users\y\Documents\GitHub\Python-cheatsheet\test-join'`              |
| 共通パス(文字単位)                 | `os.path.commonprefix( [os.path.abspath('./test-join/test1.txt'), os.path.abspath('./test-join/test2.txt')] )` | `'C:\Users\y\Documents\GitHub\Python-cheatsheet\test-join\test'`         | `'C:\Users\y\Documents\GitHub\Python-cheatsheet\test-join\test'`         |
| ドライブレター                     | `os.path.splitdrive(os.path.abspath('./test-join/test.txt'))[0]`                                               | `'C:'`                                                                   |                                                                          |

| 検査内容                         | 関数                                                                            | 値      | パスにファイルが存在しない場合                                         |
| -------------------------------- | ------------------------------------------------------------------------------- | ------- | ---------------------------------------------------------------------- |
| パス文字列が絶対パスか           | `os.path.isabs(os.path.abspath('./test-join/test.txt'))`                        | `True`  | `True`                                                                 |
| パス文字列がシンボリックリンクか | `os.path.islink(os.path.abspath('./test-join/test.txt'))`                       | `False` | `False`                                                                |
| パス文字列がマウントポイントか   | `os.path.ismount(os.path.abspath('./test-join/test.txt'))`                      | `False` | `False`                                                                |
| パスが示すファイルが同一か       | `os.path.samefile('./test-join/test.txt', './test-join/../test-join/test.txt')` | `True`  | `FileNotFoundError: [WinError 2] 指定されたファイルが見つかりません。` |

<a id="markdown-複数のパスが同一のファイルを示しているか検査" name="複数のパスが同一のファイルを示しているか検査"></a>

#### 複数のパスが同一のファイルを示しているか検査

```py
paths = [
    os.path.abspath('./test-join/test1.txt'),
    os.path.abspath('./test-join/test/../test1.txt'),
]

print(os.path.samefile(paths[0], paths[1])) # ファイルパスが同じファイルを参照しているか

with open(paths[0], 'r') as f1, open(paths[1], 'r') as f2:
    print(os.path.sameopenfile(f1.fileno(), f2.fileno())) # ファイル記述子が同じファイルを参照しているか

stat1 = os.stat(paths[0])
stat2 = os.stat(paths[1])
print(os.path.samestat(stat1, stat2)) # os.fstat(), os.lstat()，os.stat() の返り値 (stat1, stat2) が同じファイルを参照しているか
```

> True
>
> True
>
> True

<a id="markdown-パス文字列を正規化する" name="パス文字列を正規化する"></a>

#### パス文字列を正規化する

不要な区切り文字、 `..` の除去　／　 Windows 環境での大文字小文字の置換、スラッシュとバックスラッシュの置換

```py
import os

dirpath = 'path/to/to/to/../../folder/'

# 不要な区切り文字、 `..` の除去
nrmpath = os.path.normpath(dirpath)
print(nrmpath)

# Windows環境での大文字小文字の置換、スラッシュとバックスラッシュの置換
nrmcase = os.path.normcase(path)
print(nrmcase)
```

> path\to\folder
>
> c:\users\y\path\to\file.txt

<a id="markdown-ホームディレクトリのパスを取得" name="ホームディレクトリのパスを取得"></a>

#### ホームディレクトリのパスを取得

```py
import os.path

filepath = os.path.join('~', 'path', 'to', 'file.txt')
path  = os.path.expanduser(filepath)
print(path)
```

> C:\Users\y\path\to\file.txt

<a id="markdown-環境変数を取得" name="環境変数を取得"></a>

#### 環境変数を取得

```py
import os.path

# for Linux
filepath = os.path.join('$HOME', 'path', 'to', 'file.txt')
path  = os.path.expandvars(filepath)
print(path)

# for Windows
filepath = os.path.join('%USERPROFILE%', 'path', 'to', 'file.txt')
path  = os.path.expandvars(filepath)
print(path)
```

> /home/y/path/to/file.txt

> C:\Users\y\path\to\file.txt

<a id="markdown-親ディレクトリのパスを取得" name="親ディレクトリのパスを取得"></a>

#### 親ディレクトリのパスを取得

```py
import os

def get_parent(path='.', lev=0):
    return str((os.path.sep).join(os.path.abspath(path).split(os.path.sep)[0:-1-lev]))

get_parent('__file__')
get_parent('__file__', 1)
```

> '/mnt/c/Users/y/Documents/GitHub'
>
> '/mnt/c/Users/y/Documents/GitHub/Python-cheatsheet'

```py
from pathlib import Path

def get_parent(path='.', lev=0):
    return Path(path).resolve().parents[lev]

get_parent('__file__')
get_parent('__file__', 1)
```

> PosixPath('/mnt/c/Users/y/Documents/GitHub/Python-cheatsheet')
>
> PosixPath('/mnt/c/Users/y/Documents/GitHub')

<a id="markdown-シンボリックリンクのパスを正規化" name="シンボリックリンクのパスを正規化"></a>

#### シンボリックリンクのパスを正規化

```py
import os

os.path.realpath(__file__)
```

<a id="markdown-linux-上で-windows-形式のパスを操作" name="linux-上で-windows-形式のパスを操作"></a>

#### Linux 上で Windows 形式のパスを操作

```py
import ntpath

print(ntpath.sep)
print(ntpath.sep is '\\')

bname = ntpath.basename('\\path\\to\\file')
print(bname)
```

> \
>
> True

> file

<a id="markdown-カレントディレクトリ" name="カレントディレクトリ"></a>

### カレントディレクトリ

[python/python3md-cwd.py](python/python3md-cwd.py)

```py
import os


CURRENT_DIRECTORY = os.getcwd()
os.chdir(CURRENT_DIRECTORY)
```

<a id="markdown-スクリプトファイルのパスを取得" name="スクリプトファイルのパスを取得"></a>

#### スクリプトファイルのパスを取得

```py
import os

print(os.getcwd())
print(__file__)

print(os.path.basename(__file__))
print(os.path.abspath(__file__))
print(os.path.dirname(os.path.abspath(__file__)))
```

> /mnt/c/Users/y/Documents/GitHub/Python-cheatsheet
>
> python3-cwd.py
>
> python3-cwd.py
>
> /mnt/c/Users/y/Documents/GitHub/Python-cheatsheet/python3-cwd.py
>
> /mnt/c/Users/y/Documents/GitHub/Python-cheatsheet

<a id="markdown-ファイル・フォルダを存在チェック" name="ファイル・フォルダを存在チェック"></a>

### ファイル・フォルダを存在チェック

```
import os

FILEPATH = '.'
print(os.path.exists(FILEPATH) and os.path.isdir(FILEPATH))
print(os.path.exists(FILEPATH) and os.path.isfile(FILEPATH))
```

| FILEPATH           | `os.path.exists(FILEPATH)` | `os.path.isdir(FILEPATH)` | `os.path.isfile(FILEPATH)` |
| ------------------ | -------------------------- | ------------------------- | -------------------------- |
| `'.'`              | `True`                     | `True`                    | `False`                    |
| `'./'`             | `True`                     | `True`                    | `False`                    |
| `'./README.md'`    | `True`                     | `False`                   | `True`                     |
| `'./NOTFOUND.txt'` | `False`                    | `False`                   | `False`                    |

<a id="markdown-ファイル・フォルダの一覧を取得" name="ファイル・フォルダの一覧を取得"></a>

### ファイル・フォルダの一覧を取得

| 文字          | 内容                          |
| ------------- | ----------------------------- |
| \*            | 長さ 0 文字以上の任意の文字列 |
| ?             | 任意の一文字                  |
| []            | 括弧の中の文字                |
| [*], [?], [[] | エスケープ                    |

```py
from glob import glob
import os

DIRPATH = os.path.join('.', 'test-glob') # './test-glob'
DIRPATH += '' if DIRPATH.endswith(os.path.sep) else os.path.sep # './test-glob/'
```

| 取得内容                             | 関数                                                                                                                                           | 値                                                                                            | 備考                                           |
| ------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------- | ---------------------------------------------- |
| 直下のファイル・フォルダ一覧を取得   | `glob(os.path.join(DIRPATH, '*'), recursive=False)`                                                                                            | `['.\\test-glob\\test-glob-1', '.\\test-glob\\test-glob-2', '.\\test-glob\\test-glob-3.dat']` |                                                |
|                                      | `glob(os.path.join(DIRPATH, '*'), recursive=True)`                                                                                             | `['.\\test-glob\\test-glob-1', '.\\test-glob\\test-glob-2', '.\\test-glob\\test-glob-3.dat']` | `**` を指定していないため `recursive` は無関係 |
| 直下のファイル一覧を取得             | `glob(os.path.join(DIRPATH, '*.*'), recursive=True)`                                                                                           | `['./test-glob/test-glob-3.dat']`                                                             |                                                |
|                                      | `[f for f in glob(os.path.join(DIRPATH, '*')) if os.path.isfile(f)]`                                                                           | `['./test-glob/test-glob-3.dat']`                                                             |                                                |
| 直下のフォルダ一覧を取得             | `[f for f in glob(os.path.join(DIRPATH, '*')) if os.path.isdir(f)]`                                                                            | `['.\\test-glob\\test-glob-1', '.\\test-glob\\test-glob-2']`                                  |                                                |
|                                      |                                                                                                                                                |                                                                                               |                                                |
| 再帰的にファイル・フォルダ一覧を取得 | `glob(os.path.join(DIRPATH, '**'), recursive=True)`                                                                                            | [1]                                                                                           | _recursive_ が `True` かつ、パスに `**`        |
| 再帰的にファイル一覧を取得           | `glob(os.path.join(DIRPATH, os.path.join('**', '*.*')), recursive=True)`                                                                       | [2]                                                                                           |                                                |
| 再帰的にフォルダ一覧を取得           | `[f for f in glob(os.path.join(DIRPATH, '**'), recursive=True) if os.path.isdir(f)]`                                                           | [3]                                                                                           |                                                |
|                                      | `glob(os.path.join(DIRPATH, '**' + os.path.sep), recursive=True)`                                                                              | [4]                                                                                           | パスの末尾が `os.path.sep` になる              |
|                                      |                                                                                                                                                |                                                                                               |                                                |
| ワイルドカードを利用                 | `glob(os.path.join(DIRPATH, os.path.join('**', '*-[0-1].???')), recursive=True)`                                                               | `['.\\test-glob\\test-glob-1\\test-glob-1-1\\test-glob-1-1-1.dat']`                           |                                                |
| 正規表現を利用                       | `import re` <br> `[p for p in glob(os.path.join(DIRPATH, os.path.join('**', '*.*')), recursive=True) if re.search('test-glob(-1){3}.dat', p)]` | `['.\\test-glob\\test-glob-1\\test-glob-1-1\\test-glob-1-1-1.dat']`                           |                                                |

[1]

> ['.\\test-glob\\', '.\\test-glob\\test-glob-1', '.\\test-glob\\test-glob-1\\test-glob-1-1', '.\\test-glob\\test-glob-1\\test-glob-1-1\\test-glob-1-1-1.dat', '.\\test-glob\\test-glob-1\\test-glob-1-1\\test-glob-1-1-2.dat', '.\\test-glob\\test-glob-1\\test-glob-1-2.dat', '.\\test-glob\\test-glob-2', '.\\test-glob\\test-glob-2\\test-glob-2-2.dat', '.\\test-glob\\test-glob-3.dat']

[2]

> ['.\\test-glob\\test-glob-3.dat', '.\\test-glob\\test-glob-1\\test-glob-1-2.dat', '.\\test-glob\\test-glob-1\\test-glob-1-1\\test-glob-1-1-1.dat', '.\\test-glob\\test-glob-1\\test-glob-1-1\\test-glob-1-1-2.dat', '.\\test-glob\\test-glob-2\\test-glob-2-2.dat']

[3]

> ['.\\test-glob\\', '.\\test-glob\\test-glob-1', '.\\test-glob\\test-glob-1\\test-glob-1-1', '.\\test-glob\\test-glob-2']

[4]

> ['.\\test-glob\\', '.\\test-glob\\test-glob-1\\', '.\\test-glob\\test-glob-1\\test-glob-1-1\\', '.\\test-glob\\test-glob-2\\']

<a id="markdown-python34-以前で再帰的にファイル・フォルダ一覧を取得" name="python34-以前で再帰的にファイル・フォルダ一覧を取得"></a>

#### Python3.4 以前で、再帰的にファイル・フォルダ一覧を取得

```py
import os

files = []
def glb(directory):
    for root, dirs, files in os.walk(directory):
        yield root
        for file in files:
            yield os.path.join(root, file)

for file in glb(DIRPATH):
    files.append(file)

print(files)
```

<a id="markdown-ファイル情報を取得" name="ファイル情報を取得"></a>

### ファイル情報を取得

```py
import math

def roundstr(size):
    return '{}'.format(round(size, 1))

def human_readable(bytesize):
    if bytesize < 1024:
        return str(bytesize) + ' B'
    elif bytesize < 1024 ** 2:
        return roundstr(bytesize / 1024.0) + ' KB'
    elif bytesize < 1024 ** 3:
        return roundstr(bytesize / (1024.0 ** 2)) + ' MB'
    elif bytesize < 1024 ** 4:
        return roundstr(bytesize / (1024.0 ** 3)) + ' GB'
    elif bytesize < 1024 ** 5:
        return roundstr(bytesize / (1024.0 ** 4)) + ' TB'
    else:
        return str(bytesize) + ' B'

```

```py
from datetime import datetime, timezone, timedelta
import os

filepath = './README.md'

atime1 = datetime.fromtimestamp(os.path.getatime(filepath))
atime
print(atime1)

atime2 = datetime.fromtimestamp(os.path.getatime(filepath), timezone(timedelta(hours=9)))
atime2
print(atime2)
print(atime2.tzinfo)

mtime1 = datetime.fromtimestamp(os.path.getmtime(filepath))
mtime1
print(mtime1)

mtime2 = datetime.fromtimestamp(os.path.getmtime(filepath), timezone(timedelta(hours=9)))
mtime2
print(mtime2)
print(mtime2.tzinfo)

size = os.path.getsize(filepath)
size
print(human_readable(size))
```

| 項目             | 関数                          | 値                                                                                                               |
| ---------------- | ----------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| 最終アクセス日時 | `atime1`                      | `datetime.datetime(2020, 1, 24, 8, 38, 56, 106605)`                                                              |
|                  | `print(atime1)`               | `2020-01-24 08:38:56.106605`                                                                                     |
|                  | `atime2`                      | `datetime.datetime(2020, 1, 24, 8, 38, 56, 106605, tzinfo=datetime.timezone(datetime.timedelta(seconds=32400)))` |
|                  | `print(atime2)`               | `2020-01-24 08:38:56.106605+09:00`                                                                               |
|                  | `print(atime2.tzinfo)`        | `UTC+09:00`                                                                                                      |
| 最終更新日時     | `mtime1`                      | `datetime.datetime(2020, 1, 24, 8, 38, 56, 106605)`                                                              |
|                  | `print(mtime1)`               | `2020-01-24 08:38:56.106605`                                                                                     |
|                  | `mtime2`                      | `datetime.datetime(2020, 1, 24, 8, 38, 56, 106605, tzinfo=datetime.timezone(datetime.timedelta(seconds=32400))`  |
|                  | `print(mtime2)`               | `2020-01-24 08:38:56.106605+09:00`                                                                               |
|                  | `print(mtime2.tzinfo)`        | `UTC+09:00`                                                                                                      |
| ファイルサイズ   | `size`                        | `321480`                                                                                                         |
|                  | `print(human_readable(size))` | `313.9 KB`                                                                                                       |

<a id="markdown-ファイルを作成" name="ファイルを作成"></a>

### ファイルを作成

<a id="markdown-touch" name="touch"></a>

#### touch()

```py
from pathlib import Path
def touch(filepath):
    Path(filepath).touch()
```

```py
import os
def touch(filepath):
    if os.path.isfile(filepath):
        pass
    else:
        with open(filepath, 'w', encoding='UTF-8') as f:
            pass
```

<a id="markdown-既存のファイルがある場合はバックアップを作成して再作成" name="既存のファイルがある場合はバックアップを作成して再作成"></a>

#### 既存のファイルがある場合はバックアップを作成して再作成

```py
from pathlib import Path
import os
import shutil


def touch(filepath):
    Path(filepath).touch()


FILEPATH = './test-file'

bkup_dt = datetime.now().strftime('%Y%m%d%H%M%S')
NEW_FILEPATH = os.path.splitext(FILEPATH)[0] + bkup_dt + os.path.splitext(FILEPATH)[1]

if os.path.exists(FILEPATH):
    RESULT_FILEPATH = shutil.move(
        FILEPATH,
        NEW_FILEPATH
        )
    print(RESULT_FILEPATH)

touch(FILEPATH)
```

<a id="markdown-フォルダを作成" name="フォルダを作成"></a>

### フォルダを作成

```py
import os

DIRPATH = './test-folder/'

os.makedirs(DIRPATH)
```

<a id="markdown-既存のフォルダがある場合にエラーとしない" name="既存のフォルダがある場合にエラーとしない"></a>

#### 既存のフォルダがある場合にエラーとしない

```py
import os

DIRPATH = './test-folder/'

os.makedirs(DIRPATH, exist_ok=True)
```

<a id="markdown-既存のフォルダがある場合はバックアップを作成して再作成" name="既存のフォルダがある場合はバックアップを作成して再作成"></a>

#### 既存のフォルダがある場合はバックアップを作成して再作成

```py
import os
import shutil

DIRPATH = './test-folder/'

NEW_DIRPATH = os.path.dirname(DIRPATH) # './test-folder' # 末尾のスラッシュなし
bkup_dt = datetime.now().strftime('%Y%m%d%H%M%S')
NEW_DIRPATH += bkup_dt

if os.path.exists(DIRPATH):
    RESULT_DIRPATH = shutil.move(
        DIRPATH,
        NEW_DIRPATH
        )
    print(RESULT_DIRPATH)

# os.makedirs(DIRPATH, exist_ok=True)
os.makedirs(DIRPATH)
```

<a id="markdown-ファイル・フォルダをコピー" name="ファイル・フォルダをコピー"></a>

### ファイル・フォルダをコピー

| 項目                             | コピー対象                                   | `dst` が既存                         | 備考                                                                                                        |
| -------------------------------- | -------------------------------------------- | ------------------------------------ | ----------------------------------------------------------------------------------------------------------- |
| `shutil.copy(src, dst)`          | ファイル（パーミッションを含む）             | 上書き                               | メタデータはコピーされない                                                                                  |
|                                  |                                              |                                      | dst がディレクトリであればファイル名は src と同じものが指定されたディレクトリ内に作成（または上書き）される |
| `shutil.copy2(src, dst)`         | ファイル（パーミッション、メタデータを含む） | 上書き                               | メタデータは `copystat()` 関数でコピー                                                                      |
| `shutil.copyfile(src, dst)`      | ファイル                                     | 上書き                               | `dst` にはディレクトリは指定できない                                                                        |
| `shutil.copyfileobj(fsrc, fdst)` | ファイル形式のオブジェクト                   | 上書き                               |                                                                                                             |
| `shutil.copymode(src, dst)`      | パーミッション                               |                                      | ファイル内容や所有者、グループはコピーされない                                                              |
| `shutil.copystat(src, dst)`      |                                              |                                      |                                                                                                             |
| `shutil.copytree(src, dst)`      | src を起点としたディレクトリツリー           | `dirs_exist_ok=False` ならば `Error` | `dst` には既存のディレクトリは指定できない（存在しない親ディレクトリも含めて作成される）                    |
|                                  |                                              |                                      | パーミッションと時刻は `copystat()` 関数で、個々のファイルは `shutil.copy2()` でコピーされる                |

```py
from pathlib import Path
import os
import shutil

srcpath = './test-copy1.txt'
dstpath = './test-copy2.txt'

Path(srcpath).touch()

# ファイル→ファイル (同名のファイルが既に存在すれば上書き)
result_path = shutil.copyfile(srcpath, dstpath)
print(result_path)
```

> ./test-copy2.txt

<a id="markdown-ディレクトリツリーをコピーcopytree" name="ディレクトリツリーをコピーcopytree"></a>

#### ディレクトリツリーをコピー(copytree)

```py
from glob import glob
from pathlib import Path
import os
import shutil


def touch(filepath):
    Path(filepath).touch()


srcpath = './test-dirtree/dir1'
srcfpath = './test-dirtree/dir1/file1.txt'
dstpath = './test-dirtree/dir2'

os.makedirs(srcpath, exist_ok=True)
touch(srcfpath)

result_path = shutil.copytree(srcpath, dstpath) # ディレクトリが既に存在するとFileExistsError
print(result_path)

glob('./test-dirtree/**', recursive=True)
```

> './test-dirtree/dir2'
>
> [
>
> './test-dirtree/',
>
> './test-dirtree/dir1',
>
> './test-dirtree/dir1/file1.txt',
>
> './test-dirtree/dir2',
>
> './test-dirtree/dir2/file1.txt'
>
> ]

```py
from glob import glob
from pathlib import Path
import os
from distutils.dir_util import copy_tree


def touch(filepath):
    Path(filepath).touch()


srcpath = './test-dirtree/dir1'
srcfpath = './test-dirtree/dir1/file1.txt'
dstpath = './test-dirtree/dir2'

os.makedirs(srcpath, exist_ok=True)
touch(srcfpath)
os.makedirs(dstpath, exist_ok=True)

# distutils.dir_util
result_path = copy_tree(srcpath, dstpath) # ディレクトリが既に存在してもコピーされる
print(result_path)

glob('./test-dirtree/**', recursive=True)
```

> ['./test-dirtree/dir2/file1.txt']
>
> ['./test-dirtree/', './test-dirtree/dir1', './test-dirtree/dir1/file1.txt', './test-dirtree/dir2', './test-dirtree/dir2/file1.txt']

<a id="markdown-ファイル形式のオブジェクトをコピーcopyfileobj" name="ファイル形式のオブジェクトをコピーcopyfileobj"></a>

#### ファイル形式のオブジェクトをコピー(copyfileobj)

```py
import os
import shutil
import requests


def download(url):
    file_name = os.path.basename(url)
    res = requests.get(url, stream=True)
    if res.status_code == 200:
        with open(file_name, 'wb') as file:
            res.raw.decode_content = True
            shutil.copyfileobj(res.raw, file)


if __name__ == '__main__':
    url = 'https://example.net/logo.png'
    download(url)
```

<a id="markdown-ファイル・フォルダをリネーム" name="ファイル・フォルダをリネーム"></a>

### ファイル・フォルダをリネーム

| 項目                   | 内容                                             | `dst` が既存                                         | 備考                                                                             |
| ---------------------- | ------------------------------------------------ | ---------------------------------------------------- | -------------------------------------------------------------------------------- |
| `os.rename(src, dst)`  | ファイルまたはディレクトリ src を dst に名前変更 | ディレクトリの場合、 `OSError`                       |                                                                                  |
|                        |                                                  | ファイルの場合、置換(Unix)または `OSError` (Windows) |                                                                                  |
| `os.renames(old, new)` | 再帰的にディレクトリやファイル名を変更           |                                                      | 新たなパス名を持つファイルを配置するために必要な途中のディレクトリ構造をまず作成 |

<a id="markdown-osrename" name="osrename"></a>

#### os.rename

```py
from glob import glob
from pathlib import Path
import os
import shutil


def touch(filepath):
    Path(filepath).touch()


dirpath = './test-rename/'
srcpath = './test-rename/file1.txt'
dstpath = './test-rename/file2.txt'

os.makedirs(dirpath, exist_ok=True)
touch(srcpath)
glob('./test-rename/**', recursive=True)

os.rename(srcpath, dstpath)
glob('./test-rename/**', recursive=True)

touch(srcpath)
glob('./test-rename/**', recursive=True)

os.rename(srcpath, dstpath) # dstpathのファイルが既に存在すると、上書きされる
glob('./test-rename/**', recursive=True)
```

> ['./test-rename/', './test-rename/file1.txt']
>
> ['./test-rename/', './test-rename/file2.txt']
>
> ['./test-rename/', './test-rename/file1.txt', './test-rename/file2.txt']
>
> ['./test-rename/', './test-rename/file2.txt'] \# dstpath のファイルが既に存在すると、上書きされる

```py
from glob import glob
from pathlib import Path
import os
import shutil


def touch(filepath):
    Path(filepath).touch()


srcpath = './test-rename/dir1'
srcfpath = './test-rename/dir1/file1.txt'
dstpath = './test-rename/dir2'
dstfpath = './test-rename/dir2/file1.txt'

# 移動元ディレクトリと配下のファイルが存在
shutil.rmtree(srcpath, ignore_errors=True)
shutil.rmtree(dstpath, ignore_errors=True)
os.makedirs(srcpath, exist_ok=True)
# os.makedirs(dstpath, exist_ok=True)
touch(srcfpath)
# touch(dstfpath)

os.rename(srcpath, dstpath)
glob('./test-rename/**', recursive=True)

# 移動元ディレクトリと配下のファイル、移動先ディレクトリが存在
shutil.rmtree(srcpath, ignore_errors=True)
shutil.rmtree(dstpath, ignore_errors=True)
os.makedirs(srcpath, exist_ok=True)
os.makedirs(dstpath, exist_ok=True)
touch(srcfpath)
# touch(dstfpath)

os.rename(srcpath, dstpath)
glob('./test-rename/**', recursive=True)

# 移動元ディレクトリと配下のファイル、移動先ディレクトリと配下の(同名)ファイルが存在
shutil.rmtree(srcpath, ignore_errors=True)
shutil.rmtree(dstpath, ignore_errors=True)
os.makedirs(srcpath, exist_ok=True)
os.makedirs(dstpath, exist_ok=True)
touch(srcfpath)
touch(dstfpath)

os.rename(srcpath, dstpath) # OSError: [Errno 39] Directory not empty: './test-rename/dir1' -> './test-rename/dir2'
```

> \# 移動元ディレクトリと配下のファイルが存在
>
> ['./test-rename/', './test-rename/dir2', './test-rename/dir2/file1.txt']

> \# 移動元ディレクトリと配下のファイル、移動先ディレクトリが存在
>
> ['./test-rename/', './test-rename/dir2', './test-rename/dir2/file1.txt']

> \# 移動元ディレクトリと配下のファイル、移動先ディレクトリと配下の(同名)ファイルが存在
>
> OSError: [Errno 39] Directory not empty: './test-rename/dir1' -> './test-rename/dir2'

<a id="markdown-shutilmove" name="shutilmove"></a>

#### shutil.move

```py
from glob import glob
from pathlib import Path
import os
import shutil


def touch(filepath):
    Path(filepath).touch()


srcpath = './test-move/dir1'
srcfpath = './test-move/dir1/file1.txt'
dstpath = './test-move/dir2'
dstfpath = './test-move/dir2/file2.txt'

os.makedirs(srcpath, exist_ok=True)
touch(srcfpath)
os.makedirs(dstpath, exist_ok=True)

result_path = shutil.move(srcfpath, dstpath)
print(result_path)

touch(srcfpath)

result_path = shutil.move(srcfpath, dstfpath)
print(result_path)
```

> ./test-move/dir2/file1.txt
>
> ./test-move/dir2/file2.txt

```py
from glob import glob
from pathlib import Path
import os
import shutil


def touch(filepath):
    Path(filepath).touch()


srcpath = './test-move/dir1'
srcfpath = './test-move/dir1/file1.txt'
dstpath = './test-move/dir2'
dstdpath = './test-move/dir2/dir1'
dstfpath = './test-move/dir2/file1.txt'
dstfpath2 = './test-move/dir2/dir1/file1.txt'


# 移動元ディレクトリと配下のファイルが存在
os.makedirs(srcpath, exist_ok=True)
touch(srcfpath)
shutil.rmtree(dstpath, ignore_errors=True)

result_path = shutil.move(srcpath, dstpath)
print(result_path)

glob('./test-move/**', recursive=True)

# 移動元ディレクトリと配下のファイル、移動先ディレクトリが存在
os.makedirs(srcpath, exist_ok=True)
touch(srcfpath)
os.remove(dstfpath)

result_path = shutil.move(srcpath, dstpath)
print(result_path)

glob('./test-move/**', recursive=True)

# 移動元ディレクトリと配下のファイル、移動先ディレクトリと配下の(同名)ファイルが存在
os.makedirs(srcpath, exist_ok=True)
touch(srcfpath)
shutil.rmtree(dstdpath, ignore_errors=True)
touch(dstfpath2)

result_path = shutil.move(srcpath, dstpath)

glob('./test-move/**', recursive=True) # shutil.Error: Destination path './test-move/dir2/dir1' already exists
```

> \# 移動元ディレクトリと配下のファイルが存在
>
> ./test-move/dir2
>
> ['./test-move/', './test-move/dir2', './test-move/dir2/file1.txt']

> \# 移動元ディレクトリと配下のファイル、移動先ディレクトリが存在
>
> ./test-move/dir2/dir1
>
> ['./test-move/', './test-move/dir2', './test-move/dir2/dir1', './test-move/dir2/dir1/file1.txt']

> \# 移動元ディレクトリと配下のファイル、移動先ディレクトリと配下の(同名)ファイルが存在
>
> shutil.Error: Destination path './test-move/dir2/dir1' already exists

<a id="markdown-ファイルを削除" name="ファイルを削除"></a>

### ファイルを削除

<a id="markdown-特定のファイルを削除" name="特定のファイルを削除"></a>

#### 特定のファイルを削除

```py
from pathlib import Path
import os


def touch(filepath):
    Path(filepath).touch()


path = './test-remove.txt'
touch(path)

# ファイルを削除
os.remove(path)

if not os.path.exists(path):
    print('removed')
```

> removed

<a id="markdown-ファイルを検索して削除" name="ファイルを検索して削除"></a>

#### ファイルを検索して削除

```py
from glob import glob
from pathlib import Path
import os


def touch(filepath):
    Path(filepath).touch()


path = './test-remove'
fpath = './test-remove/test1.txt'
os.makedirs(path, exist_ok=True)
touch(fpath)

# ファイルを検索して削除
[os.remove(f) for f in glob('./test-remove/*.txt')]

os.rmdir(path)
```

<a id="markdown-フォルダを削除" name="フォルダを削除"></a>

### フォルダを削除

```py
from pathlib import Path
import os
import shutil


def touch(filepath):
    Path(filepath).touch()


path = './test-remove'
fpath = './test-remove/test1.txt'

os.makedirs(path, exist_ok=True)

os.remove(path) # IsADirectoryError

# 空フォルダを削除
os.rmdir(path)

os.makedirs(path, exist_ok=True)
touch(fpath)

# 中身ごとフォルダを削除
# shutil.rmtree(path, ignore_errors=True)
shutil.rmtree(path)

if not os.path.exists(path):
    print('removed')
```

> removed

<a id="markdown-タイプ別のファイル読み書き" name="タイプ別のファイル読み書き"></a>

### タイプ別のファイル読み書き

<a id="markdown-テキストファイル" name="テキストファイル"></a>

#### テキストファイル

<a id="markdown-モード" name="モード"></a>

##### モード

| mode | 読み込み | 書き込み | ファイルポインタ | 既存ファイルが存在する | 既存ファイルが存在しない |
| ---- | -------- | -------- | ---------------- | ---------------------- | ------------------------ |
| r    | ○        | ×        | 先頭             | ○                      | FileNotFoundError        |
| x    |          |          | 先頭             | FileExistsError        | 新規作成                 |
| w    | ×        | ○        | 先頭             | ○                      | 新規作成                 |
| a    | ×        | ○        | 終端             | ○                      | 新規作成                 |
| r+   | ○        | ○        | 先頭             | ○                      | FileNotFoundError        |
| w+   | ○        | ○        | 先頭             | ○                      | 新規作成                 |
| a+   | ○        | ○        | 終端             | ○                      | 新規作成                 |

r+ 読み書き両用。
ファイルがない場合はエラー。
w+ 読み書き両用。
ファイルがある場合は「w」と同じ処理。
a+ 追記・読み書き両用。
ファイルがない場合は新規作成。

<a id="markdown-文字コードの推測" name="文字コードの推測"></a>

##### 文字コードの推測

ファイルの文字エンコーディングが OS 標準のものと異なる場合はエラーとなるため、Web から入手したファイルなど文字コードが不明のファイルを読み込む際には、推測する必要がある

[python/python3md-encode.py](python/python3md-encode.py)

```py
import codecs
import os

def detect_encode(filepath):
    cs = [
        'utf-8',
        'utf_8_sig', # BOMあり
        'euc_jp',
        'cp932',
        #
        'euc_jis_2004',
        'euc_jisx0213',
        'iso2022_jp_1',
        'iso2022_jp_2',
        'iso2022_jp_3',
        'iso2022_jp_2004',
        'iso2022_jp_ext',
        'iso2022_jp',
        'shift_jis_2004',
        'shift_jis',
        'shift_jisx0213',
        'utf_7',
        'utf_16_be',
        'utf_16_le',
        'utf_16',
    ]

    for c in cs:
        try:
            with codecs.open(filepath, 'r', c, errors='strict') as f:
                print(f.read())
                return c
        except Exception as e:
            continue
    return None

c = detect_encode(os.path.join('test-fileio', 'inputsjis.txt'))
print(c)
```

> cp932

<a id="markdown-エラーハンドラ" name="エラーハンドラ"></a>

###### エラーハンドラ

| 値       | 意味                                                                                                                  |
| -------- | --------------------------------------------------------------------------------------------------------------------- |
| 'strict' | UnicodeError (または、そのサブクラス) を送出します。これがデフォルトの動作です。 strict_errors() で実装されています。 |
| 'ignore' | 不正な形式のデータを無視し、何も通知することなく処理を継続します。ignore_errors() で実装されています。                |

ユニコード文字列をエンコードするコーデックでのみ有効な値:

| 値                  | 意味                                                                                                                                                                                                                                  |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 'replace'           | 適当な置換マーカーで置換します。Python では、組み込み codec のデコード時には公式の U+FFFD 代替文字が、エンコード時には '?' が使用されます。 replace_errors() で実装されています。                                                     |
| 'xmlcharrefreplace' | 適切な XML 文字参照で置換します (エンコードのみ)。 xmlcharrefreplace_errors() で実装されています。                                                                                                                                    |
| 'backslashreplace'  | バックスラッシュつきのエスケープシーケンスで置換します。 backslashreplace_errors() で実装されています。                                                                                                                               |
| 'namereplace'       | \N{...} エスケープシーケンスで置換します (エンコードのみ)。 namereplace_errors() で実装されています。                                                                                                                                 |
| 'surrogateescape'   | デコード時には、バイト列を U+DC80 から U+DCFF の範囲の個々のサロゲートコードで置き換えます。データのエンコード時に 'surrogateescape' エラーハンドラが使用されると、このコードは同じバイト列に戻されます。 (詳しくは PEP 383 を参照。) |

`utf-8, utf-16, utf-32, utf-16-be, utf-16-le, utf-32-be, utf-32-le` でのみ有効な値:

| 値              | 意味                                                                                                                   |
| --------------- | ---------------------------------------------------------------------------------------------------------------------- |
| 'surrogatepass' | サロゲートコードのエンコードとデコードを許可します。通常、これらの codecc は、サロゲートの存在をエラーとして扱います。 |

<a id="markdown-cchardet-モジュールを使用" name="cchardet-モジュールを使用"></a>

###### cChardet モジュールを使用

chardet モジュールだと `windows-1252` と判定されがちなので [cChardet](https://github.com/PyYoshi/cChardet) モジュールを利用する

```py
import cchardet

def detect_enc(filepath):
    with open(filepath, mode='rb') as f:
        return cchardet.detect(f.read())

print(detect_enc('./test-fileio/inputsjis.txt'))
```

> {'encoding': 'SHIFT_JIS', 'confidence': 1.0}

<a id="markdown-読み込み" name="読み込み"></a>

##### 読み込み

<a id="markdown-単一の文字列として読み込みr-読み取り" name="単一の文字列として読み込みr-読み取り"></a>

###### 単一の文字列として読み込み(r: 読み取り)

mode が `'r'` の場合、指定したパスにファイルが存在しない場合はエラーとなる

```py
import os
with open('NOT.FOUND', 'r') as file:
    file.read()
```

> FileNotFoundError

```py
import os

filepath = './NOT.FOUND'
if os.path.exists(os.path.dirname(os.path.abspath(filepath))):
    if os.path.exists(os.path.abspath(filepath)):
        with open(filepath, 'r') as file:
            file.write('')
    else:
        print('File Not Found')
else:
    print('Directory Not Found')
```

<a id="markdown--shift-jis" name="-shift-jis"></a>
####### SHIFT-JIS

```py
import os
with open(os.path.join('test-fileio', 'inputsjis.txt'), 'r', encoding='sjis') as file:
    string = file.read()
    print(string)
```

```py
import os
with open(os.path.join('test-fileio', 'inputsjis.txt'), 'r', encoding='shiftjis') as file:
    string = file.read()
    print(string)
```

```py
import os
with open(os.path.join('test-fileio', 'inputsjis.txt'), 'r', encoding='shift-jis') as file:
    string = file.read()
    print(string)
```

```py
import os
with open(os.path.join('test-fileio', 'inputsjis.txt'), 'r', encoding='shift_jis') as file:
    string = file.read()
    print(string)
```

<a id="markdown--utf-8-bom-なし" name="-utf-8-bom-なし"></a>
####### UTF-8 BOM なし

```
あいうえお8XkfWDHyFdcB52MbTNNswDnFRAsZdEgRmmsaNktD
かきくけこxahfE6WkxNFpU-4KgnJ4jS2jZUyWf9spDbKRaFyC
```

```py
import os
with open(os.path.join('test-fileio', 'inpututf8.txt'), 'r', encoding='utf8') as file:
    string = file.read()
    print(string)
```

```py
import os
with open(os.path.join('test-fileio', 'inpututf8.txt'), 'r', encoding='utf-8') as file:
    string = file.read()
    print(string)
```

```py
import os
with open(os.path.join('test-fileio', 'inpututf8.txt'), 'r', encoding='utf_8') as file:
    string = file.read()
    print(string)
```

```
?あいうえお8XkfWDHyFdcB52MbTNNswDnFRAsZdEgRmmsaNktD
かきくけこxahfE6WkxNFpU-4KgnJ4jS2jZUyWf9spDbKRaFyC
```

<a id="markdown--utf-8-bom-あり" name="-utf-8-bom-あり"></a>
####### UTF-8 BOM あり

```py
import os
with open(os.path.join('test-fileio', 'inpututf8.txt'), 'r', encoding='utf_8_sig') as file:
    string = file.read()
    print(string)
```

```
あいうえお8XkfWDHyFdcB52MbTNNswDnFRAsZdEgRmmsaNktD
かきくけこxahfE6WkxNFpU-4KgnJ4jS2jZUyWf9spDbKRaFyC
```

<a id="markdown-1-行ずつ読み込みr-読み取り" name="1-行ずつ読み込みr-読み取り"></a>

###### 1 行ずつ読み込み(r: 読み取り)

```py
import os
with open(os.path.join('test-fileio', 'inpututf8.txt'), 'r', encoding='utf_8') as file:
    string = file.readline()
    while string:
        print(string)
        string = file.readline()
```

<a id="markdown-リストへ格納r-読み取り" name="リストへ格納r-読み取り"></a>

###### リストへ格納(r: 読み取り)

```py
import os
with open(os.path.join('test-fileio', 'inpututf8.txt'), 'r', encoding='utf_8') as file:
    strings = file.readlines()
    print(strings)
```

```
[
    '\ufeffあいうえお8XkfWDHyFdcB52MbTNNswDnFRAsZdEgRmmsaNktD\n',
    'かきくけこxahfE6WkxNFpU-4KgnJ4jS2jZUyWf9spDbKRaFyC\n'
]
```

<a id="markdown-書き込み" name="書き込み"></a>

##### 書き込み

- mode が `'a'` の場合、指定したパスにファイルが存在する場合は追記、存在しない場合は新規作成、親フォルダが存在しない場合はエラーとなる

```py
import os
with open('PATH/NOT/FOUND', 'a') as file:
    file.write('')
```

> FileNotFoundError

- mode が `'r+'` の場合、読み書きモードで開く(ファイルポインタが先頭)

- mode が `'w'` の場合、指定したパスにファイルが存在する場合は上書き、存在しない場合は新規作成、親フォルダが存在しない場合はエラーとなる

```py
import os
with open('PATH/NOT/FOUND', 'w') as file:
    file.write('')
```

> FileNotFoundError

- mode が `'ｘ'` の場合、指定したパスにファイルが既に存在する場合はエラーとなる

```py
import os
with open(os.path.join('test-fileio', 'outpututf8.txt'), 'x') as file:
    file.write('')
with open(os.path.join('test-fileio', 'outpututf8.txt'), 'x') as file:
    file.write('')
```

> FileExistsError

<a id="markdown-単一の文字列として書き込みx-新規作成" name="単一の文字列として書き込みx-新規作成"></a>

###### 単一の文字列として書き込み(x: 新規作成)

```py
import os
string = 'foobar\nhoge\n'
with open(os.path.join('test-fileio', 'outpututf8.txt'), 'x', encoding='utf_8') as file:
    file.write(string)
```

> 11

<a id="markdown-リストを書き込みx-新規作成" name="リストを書き込みx-新規作成"></a>

###### リストを書き込み(x: 新規作成)

```py
import os
lst = ['foobar', 'hoge']
with open(os.path.join('test-fileio', 'outpututf8.txt'), 'x', encoding='utf_8') as file:
    file.writelines(lst) # 要素間には空白文字等は挿入されない
```

<a id="markdown-単一の文字列として書き込みw-新規作成／上書き" name="単一の文字列として書き込みw-新規作成／上書き"></a>

###### 単一の文字列として書き込み(w: 新規作成／上書き)

```py
import os
string = 'foobar\nhoge\n'
with open(os.path.join('test-fileio', 'outpututf8.txt'), 'w', encoding='utf_8') as file:
    file.write(string)
```

> 11

<a id="markdown-既存ファイルが存在するときに上書きするか確認する" name="既存ファイルが存在するときに上書きするか確認する"></a>

###### 既存ファイルが存在するときに上書きするか確認する

```py
import os
string = 'foobar\nhoge\n'

if os.path.exists(os.path.join('test-fileio', 'outpututf8.txt')):
    while True:
        answer = input('Overwrite?: (y/n)').lower()
        if answer == 'y':
            with open(os.path.join('test-fileio', 'outpututf8.txt'), 'w') as file:
                file.write(string)
            break
        elif answer == 'n':
            break
else:
    print('File Not Found')
```

<a id="markdown-リストを書き込みw-新規作成／上書き" name="リストを書き込みw-新規作成／上書き"></a>

###### リストを書き込み(w: 新規作成／上書き)

```py
import os
lst = ['foobar', 'hoge']
with open(os.path.join('test-fileio', 'outpututf8.txt'), 'w', encoding='utf_8') as file:
    file.writelines(lst) # 要素間には空白文字等は挿入されない
```

<a id="markdown-単一の文字列として書き込みa-追記" name="単一の文字列として書き込みa-追記"></a>

###### 単一の文字列として書き込み(a: 追記)

```py
import os
string = 'foobar\nhoge\n'
with open(os.path.join('test-fileio', 'outpututf8.txt'), 'a', encoding='utf_8') as file:
    file.write(string)
```

<a id="markdown-リストを書き込みa-追記" name="リストを書き込みa-追記"></a>

###### リストを書き込み(a: 追記)

```py
import os
lst = ['foobar', 'hoge']
with open(os.path.join('test-fileio', 'outpututf8.txt'), 'a', encoding='utf_8') as file:
    file.writelines(lst) # 要素間には空白文字等は挿入されない
```

<a id="markdown-csv-ファイル" name="csv-ファイル"></a>

#### csv ファイル

<a id="markdown-読み込み-1" name="読み込み-1"></a>

##### 読み込み

Windows 環境の場合は、明示的に UTF-8 を指定しないと SJIS として読み書きされる

<a id="markdown-リストに格納csvreader" name="リストに格納csvreader"></a>

###### リストに格納(csv.reader)

```py
import csv
import os

with open(os.path.join('test-fileio', 'inputsjis.csv'), encoding='shift_jis', newline='') as csvfile:
    for row in csv.reader(csvfile, delimiter=',', quotechar='"'):
        print(', '.join(row))

with open(os.path.join('test-fileio', 'inpututf8.csv'), encoding='utf_8', newline='') as csvfile:
    for row in csv.reader(csvfile, delimiter=',', quotechar='"'):
        print(', '.join(row))
```

> 1, 2, 3
> 4, 5, 6
> 7, 8, 9

<a id="markdown-辞書に格納csvdictreader" name="辞書に格納csvdictreader"></a>

###### 辞書に格納(csv.DictReader)

```py
import csv
import os

with open(os.path.join('test-fileio', 'inputsjis.csv'), encoding='shift_jis', newline='') as csvfile:
    f = csv.DictReader(csvfile, delimiter=',', quotechar='"')
    l = [row for row in f]
    print(l)

# 1行目がヘッダでない場合は、fieldnamesにヘッダ項目を指定する
with open(os.path.join('test-fileio', 'inputsjis.csv'), encoding='shift_jis', newline='') as csvfile:
    f = csv.DictReader(csvfile, fieldnames=['h1', 'h2', 'h3'])
    for row in f:
        print(row)

# 1列目がデータではない場合(IDなど)
fieldnames = ['h1', 'h2', 'h3']
with open(os.path.join('test-fileio', 'inpututf8.csv'), encoding='utf_8', newline='') as csvfile:
    f = csv.DictReader(csvfile, fieldnames=fieldnames)
    l = [row for row in f]

print([m.pop(fieldnames[0]) for m in l])
print(l)
```

> [{'1': '4', '2': '5', '3': '6'}, {'1': '7', '2': '8', '3': '9'}]

> \# 1 行目がヘッダでない場合は、fieldnames にヘッダ項目を指定する
>
> {'h1': '1', 'h2': '2', 'h3': '3'}
>
> {'h1': '4', 'h2': '5', 'h3': '6'}
>
> {'h1': '7', 'h2': '8', 'h3': '9'}

> \# 1 列目がデータではない場合(ID など)
>
> [{'h2': '2', 'h3': '3'}, {'h2': '5', 'h3': '6'}, {'h2': '8', 'h3': '9'}]

<a id="markdown-メモリ上の-csv-文字列の読み込み" name="メモリ上の-csv-文字列の読み込み"></a>

###### メモリ上の csv 文字列の読み込み

```py
import csv
from io import StringIO

csv_str = """
1-1,1-2,1-3
2-1,2-2,"2-3-1
2-3-2"
"""

# sio = StringIO(csv_str.strip())

# try:
#     # 区切り文字を判別
#     dialect = csv.Sniffer().sniff(sio.readline())
# except:
#     dialect = csv.excel

# sio.seek(0)

for row in csv.reader(StringIO(csv_str.strip())):
    print(row)

```

> ['1-1', '1-2', '1-3']
>
> ['2-1', '2-2', '2-3-1\n2-3-2']

<a id="markdown-書き込み-1" name="書き込み-1"></a>

##### 書き込み

<a id="markdown-上書きmodew" name="上書きmodew"></a>

###### 上書き(mode:w)

```py
import csv

# リストを1行ずつ書き込み
with open(os.path.join('test-fileio', 'outpututf8.csv'), 'w', encoding='utf_8', newline='') as csvfile:
    spamwriter = csv.writer(csvfile, delimiter=',', quotechar='"', quoting=csv.QUOTE_MINIMAL)
    # delimiter='\t'とすればタブ区切り(tsv)
    # quoting=csv.QUOTE_ALLとすれば区切り文字などを含まない要素もquotecharで囲まれ、
    # quoting=csv.QUOTE_NONNUMERICとすれば数値以外が囲まれる
    spamwriter.writerow(['foo', 'bar', 'hoge'])
    spamwriter.writerow(['foo', 'bar', 'hoge'])

# 2次元配列を一括書き込み
with open(os.path.join('test-fileio', 'outpututf8.csv'), 'w', encoding='utf_8', newline='') as csvfile:
    spamwriter = csv.writer(csvfile, delimiter=',', quotechar='"', quoting=csv.QUOTE_MINIMAL)
    spamwriter.writerow(['foo', 'bar', 'hoge'])
    spamwriter.writerows([['foo', 'bar'],['hoge', 'piyo']]) # 2次元配列

# 辞書の値を書き込み
dct1 = {'h1': 1, 'h2': 2, 'h3': 3, 'h4': 4, 'h5': 5}

with open(os.path.join('test-fileio', 'outpututf8.csv'), 'w', encoding='utf_8', newline='') as csvfile:
    spamwriter = csv.DictWriter(csvfile, ['h1', 'h2', 'h3', 'h4', 'unknownkey', 'h5']) # ['h1', 'h2', 'h3', 'h5']のように、不足している場合はwriterowでValueError
    spamwriter.writeheader()
    spamwriter.writerow(dct1)

# 辞書の値を書き込み(fieldnamesに指定した以外のキーを無視)
with open(os.path.join('test-fileio', 'outpututf8.csv'), 'w', encoding='utf_8', newline='') as csvfile:
    spamwriter = csv.DictWriter(csvfile, ['h1', 'h2', 'h3', 'h5'], extrasaction='ignore')
    spamwriter.writeheader()
    spamwriter.writerow(dct1)

# 辞書の配列を書き込み
dct1 = {'h1': 1, 'h2': 2, 'h3': 3, 'h4': 4, 'h5': 5}
dct2 = {'h1': 11, 'h2': 12, 'h3': 13, 'h5': 15}
with open(os.path.join('test-fileio', 'outpututf8.csv'), 'w', encoding='utf_8', newline='') as csvfile:
    spamwriter = csv.DictWriter(csvfile, dct1.keys())
    spamwriter.writeheader()
    spamwriter.writerows([dct1,dct2])
```

> \# 1 行ずつ書き込み
>
> 14
>
> 14

> \# 2 次元配列を一括書き込み
>
> foo,bar,hoge
>
> foo,bar
>
> hoge,piyo

> \# 辞書の値を書き込み
>
> h1,h2,h3,h4,unknownkey,h5
>
> 1,2,3,4,,5

> \# 辞書の値を書き込み(fieldnames に指定した以外のキーを無視)
>
> h1,h2,h3,h5
>
> 1,2,3,5

> \# 辞書の配列を書き込み
>
> h1,h2,h3,h4,h5
>
> 1,2,3,4,5
>
> 11,12,13,,15

<a id="markdown-追記modea" name="追記modea"></a>

###### 追記(mode:a)

```py
import csv
with open(os.path.join('test-fileio', 'outpututf8.csv'), 'a', encoding='utf_8', newline='') as csvfile:
    spamwriter = csv.writer(csvfile, delimiter=',', quotechar='"', quoting=csv.QUOTE_MINIMAL)
    spamwriter.writerow(['foo', 'bar', 'hoge'])
    spamwriter.writerow(['foo', 'bar', 'hoge'])
```

> 14
>
> 14

<a id="markdown-tsv-ファイル" name="tsv-ファイル"></a>

#### tsv ファイル

<a id="markdown-メモリ上の-tsv-文字列の読み込み" name="メモリ上の-tsv-文字列の読み込み"></a>

###### メモリ上の tsv 文字列の読み込み

```py
import csv
from io import StringIO

csv_str = """
1-1\t1-2\t1-3
2-1\t2-2\t"2-3-1
2-3-2"
"""

for row in csv.reader(StringIO(csv_str.strip()), csv.excel_tab):
    print(row)

```

> ['1-1', '1-2', '1-3']
>
> ['2-1', '2-2', '2-3-1\n2-3-2']

<a id="markdown-json-ファイル" name="json-ファイル"></a>

#### json ファイル

<a id="markdown-スクリプトを書かずjsontool-で解析する" name="スクリプトを書かずjsontool-で解析する"></a>

##### スクリプトを書かず、json.tool で解析する

```sh
$ python -m json.tool ./test-fileio/inpututf8.json
```

<a id="markdown-読み込み-2" name="読み込み-2"></a>

##### 読み込み

`json.load()` にはファイルオブジェクトを指定、 `json.loads()` 文字列またはバイト列を指定する

<a id="markdown-ファイルから読み込み" name="ファイルから読み込み"></a>

##### ファイルから読み込み

```py
import json
import os

with open(os.path.join('test-fileio', 'inpututf8.json'), 'r', encoding='utf_8') as file:
    string = file.read()
    print(string)
    json_dict = json.load(file)
    print('json_dict:{}'.format(type(json_dict)))
```

> {
>
>     "key1":"val1",
>
>     "key2":"val2"
>
> }
>
> json_dict:\<class 'dict'\>

<a id="markdown-文字列から読み込み" name="文字列から読み込み"></a>

##### 文字列から読み込み

```py
import json

json_str = '''
{
    'key1':'val1',
    'key2':'val2'
}
'''

json_dict = json.loads(json_str)
print('json_dict:{}'.format(type(json_dict)))
```

> json_dict:\<class 'dict'\>

<a id="markdown-文字列から読み込み順序を保つ" name="文字列から読み込み順序を保つ"></a>

##### 文字列から読み込み(順序を保つ)

```py
import collections
import json

json_str = '''
{
    'key1':'val1',
    'key2':'val2'
}
'''

decoder = json.jsonDecoder(object_pairs_hook=collections.OrderedDict)
print(decoder.decode(json_str))
```

> OrderedDict([('key1', 'val1'), ('key2', 'val2')])

<a id="markdown-要素の読み込み" name="要素の読み込み"></a>

##### 要素の読み込み

```py
import json

json_str = '''
{
    'key1':'val1',
    'key2':{
        'key2-1':'val2-1',
        vkey2-2':'val2-2'
    }
}
'''

json_dict = json.loads(json_str)
print('json_dict:{}'.format(type(json_dict)))

for x in json_dict:
    print('{0}:{1}'.format(x, json_dict[x]))

for x in json_dict:
    print(json_dict[x])
    for y in json_dict[x]:
        if isinstance(y, dict):
            print('{0}:{1}'.format(y, json_dict[y]))
```

> json_dict:<class 'dict'>
>
> key1:val1
>
> key2:{'key2-1': 'val2-1', 'key2-2': 'val2-2'}
>
> val1
>
> {'key2-1': 'val2-1', 'key2-2': 'val2-2'}

<a id="markdown-要素の検索" name="要素の検索"></a>

###### 要素の検索

```py
import json
import os

def search(arg, cond):
    res =[]
    if cond(arg):
        res.append(arg)
    if isinstance(arg, list):
        for item in arg:
            res += search(item, cond)
    elif isinstance(arg, dict):
        for value in arg.values():
            res += search(value, cond)
    return res

def is_valid_value(arg):
    if isinstance(arg, str):
        return 'val3-' in arg
    if isinstance(arg, dict):
        return arg.keys() == {'key5-1', 'key5-2'}

with open(os.path.join('test-fileio', 'inpututf8nest.json'), encoding='utf-8') as f:
    json_str = json.load(f)
    result = search(json_str, is_valid_value)
    print(result)
```

> ['val3-1', 'val3-2', {'key5-1': 'val5-1', 'key5-2': 'val5-2'}]

<a id="markdown-要素の追加" name="要素の追加"></a>

##### 要素の追加

```py
import json
import os

with open(os.path.join('test-fileio', 'inpututf8.json'), 'r', encoding='utf_8') as file:
    json_dict = json.load(file)
    json_dict['key3'] = 'added'
    print('{}'.format(json_dict))
```

> {'key1': 'val1', 'key2': 'val2', 'key3': 'added'}

<a id="markdown-要素の置換" name="要素の置換"></a>

##### 要素の置換

```py
import json
import os

with open(os.path.join('test-fileio', 'inpututf8.json'), 'r', encoding='utf_8') as file:
    json_dict = json.load(file)
    json_dict['key1'] = 'replaced'
    print('{}'.format(json_dict))
```

> {'key1': 'replaced', 'key2': 'val2'}

<a id="markdown-要素の削除" name="要素の削除"></a>

##### 要素の削除

```py
import json
import os

with open(os.path.join('test-fileio', 'inpututf8.json'), 'r', encoding='utf_8') as file:
    json_dict = json.load(file)
    json_dict.pop('key1')
    print('{}'.format(json_dict))
```

> 'val1'
>
> {'key2': 'val2'}

<a id="markdown-ファイルに書き込み" name="ファイルに書き込み"></a>

##### ファイルに書き込み

`json.dump()` でファイル出力、 `json.dumps()` で文字列出力する

<a id="markdown-ファイルに書き込み-1" name="ファイルに書き込み-1"></a>

##### ファイルに書き込み

`json.dump()` でファイル出力、 `json.dumps()` で文字列出力する

```py
import json
import os

# 書き出すオブジェクト
jsondata = {
    'title': 'foobar',
    'items': [
        {
            'title': '1',
            'description': 'hoge'
        },
        {
            'title': '2',
            'description': 'hogehoge'
        }
    ]
}

savepath = os.path.join('test-fileio', 'outpututf8.json')
with open(savepath, 'w', encoding='utf_8') as outfile:
    json.dump(jsondata, outfile)
```

<a id="markdown-文字列として出力" name="文字列として出力"></a>

##### 文字列として出力

```py
import json
import os

with open(os.path.join('test-fileio', 'inpututf8.json'), 'r', encoding='utf_8') as file:
    json_dict = json.load(file)

    jsonstr = json.dumps(json_dict)
    # Unicodeエスケープせずに出力
    jsonstr = json.dumps(json_dict, ensure_ascii=False)
    # 区切り文字を変更して出力
    jsonstr = json.dumps(json_dict, separators=(';', '='))
    # インデント幅を変更して出力
    jsonstr = json.dumps(json_dict, indent=8)
    # キーでソートして出力
    jsonstr = json.dumps(json_dict, sort_keys=True)

    print(jsonstr)
```

> {"key1": "val1", "key2": "val2"}

<a id="markdown-datetime-型を出力する" name="datetime-型を出力する"></a>

##### datetime 型を出力する

```py
import json
from datetime import date, datetime

def json_serial(obj):
    if isinstance(obj, (datetime, date)):
        return obj.isoformat() # ISO形式の文字列に変換
    raise TypeError ("Type %s not serializable" % type(obj))

# datetime型を含むdict
item = { "run_at" : datetime.now() }

# default引数を指定して、JSON文字列を生成します
jsonstr = json.dumps(item, default=json_serial)
print(jsonstr)
```

> {"run_at": "2020-01-27T08:15:26.848402"}

<a id="markdown-xml-ファイル" name="xml-ファイル"></a>

#### XML ファイル

<a id="markdown-ファイルから一括読み込み" name="ファイルから一括読み込み"></a>

##### ファイルから一括読み込み

```py
import os
import xml.etree.ElementTree as ET

filepath = os.path.join('test-fileio', 'inpututf8.xml')
tree = ET.parse(filepath)

# root要素を取得
root = tree.getroot()
print(root.tag)
print(dir(root))

# 子要素を取得
for child in root:
    print(child.tag, child.attrib)
```

> breakfast_menu
>
> ['__class__', '__copy__', '__deepcopy__', '__delattr__', '__delitem__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__len__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__setitem__', '__setstate__', '__sizeof__', '__str__', '__subclasshook__', 'append', 'attrib', 'clear', 'extend', 'find', 'findall', 'findtext', 'get', 'getchildren', 'getiterator', 'insert', 'items', 'iter', 'iterfind', 'itertext', 'keys', 'makeelement', 'remove', 'set', 'tag', 'tail', 'text']

> food {'title': '001'}
>
> food {'title': '002'}
>
> food {'title': '003'}
>
> food {'title': '004'}
>
> food {'title': '005'}

<a id="markdown-ファイルから逐次的に読み込み" name="ファイルから逐次的に読み込み"></a>

##### ファイルから逐次的に読み込み

```py
import os
import xml.etree.ElementTree as ET

filepath = os.path.join('test-fileio', 'inpututf8.xml')
for event, elem in ET.iterparse(filepath):
    print(event, elem.tag)
    elem.clear()
```

<a id="markdown-文字列から読み込み-1" name="文字列から読み込み-1"></a>

##### 文字列から読み込み

```py
import os
import xml.etree.ElementTree as ET

# <?xml version="1.0" encoding="UTF-8"?>
xml_str = '''<?xml version="1.0" encoding="UTF-8"?>
<note>
  <to>Tove</to>
  <from>Jani</from>
  <heading>Reminder</heading>
  <body>Don't forget me this weekend!</body>
</note>
'''

# root要素を取得
root = ET.fromstring(xml_str)
print(root.tag)
print(root.text)

# 子要素を取得
for child in root:
    print(child.tag, child.attrib)

# 指定した名前の要素を取得
for name in root.iter('from'):
    print(name.text)

# 指定したインデックスの要素を取得
print(root[0].text)
print(root[1].text)
```

> note

> to {}
>
> from {}
>
> heading {}
>
> body {}

> Jani

> Tove
>
> Jani

<a id="markdown-書き込み-2" name="書き込み-2"></a>

##### 書き込み

```py
import os
import xml.etree.ElementTree as ET

inputfilepath = os.path.join('test-fileio', 'inpututf8.xml')
outputfilepath = os.path.join('test-fileio', 'outpututf8.xml')

tree = ET.parse(inputfilepath)

# root要素を取得
root = tree.getroot()
print(root.tag)
print(dir(root))

# 何らかの加工処理
for child in root:
  child.text = 'replaced'

# ファイルに書き込み
tree.write(outputfilepath, encoding='UTF-8')
```

<a id="markdown-xml-文字列を-json-文字列に変換" name="xml-文字列を-json-文字列に変換"></a>

##### XML 文字列を JSON 文字列に変換

```sh
$ pip install xmljson
```

| convention |                                                                                                    |
| ---------- | -------------------------------------------------------------------------------------------------- |
| Abdera     | Use "attributes" for attributes, "children" for nodes                                              |
| BadgerFish | Use "$" for text content, @ to prefix attributes                                                   |
| Cobra      | Use "attributes" for sorted attributes (even when empty), "children" for nodes, values are strings |
| GData      | Use "$t" for text content, attributes added as-is                                                  |
| Parker     | Use tail nodes for text content, ignore attributes                                                 |
| Yahoo      | Use "content" for text content, attributes added as-is                                             |

```py
from collections import OrderedDict
from json import dumps
from xml.etree.ElementTree import fromstring
from xmljson import Yahoo


yahoo = Yahoo(dict_type=OrderedDict)

xml_str = '''<?xml version="1.0" encoding="UTF-8"?>
<note>
  <to>Tove</to>
  <from>Jani</from>
  <heading>Reminder</heading>
  <body>Don't forget me this weekend!</body>
</note>
'''

print(
  dumps(yahoo.data(fromstring(xml_str)), indent=2)
)
```

```json
{
  "note": {
    "to": "Tove",
    "from": "Jani",
    "heading": "Reminder",
    "body": "Don't forget me this weekend!"
  }
}
```

<a id="markdown-arff-ファイル" name="arff-ファイル"></a>

#### ARFF ファイル

<a id="markdown-読み込み-3" name="読み込み-3"></a>

##### 読み込み

```py
import arff
data = arff.load(open('test.arff', 'rb'))
```

<a id="markdown-書き込み-3" name="書き込み-3"></a>

##### 書き込み

```py

import arff
arff.dumps(data)
```

<a id="markdown-ini-ファイル" name="ini-ファイル"></a>

#### ini ファイル

- config.ini

```ini
[settings]
user = foobar
pw = 12345
```

```py
import configparser
import os

# save
config = configparser.ConfigParser()
config['settings'] = {'user': 'foobar',
                     'pw': '12345'}
with open('config.ini', 'w') as configfile:
    config.write(configfile)

# read
inifile = configparser.ConfigParser()
inifile.read(os.path.join('.', 'config.ini'), 'UTF-8')

print(inifile.get('settings', 'user'))
print(inifile.get('settings', 'pw'))

print(config['settings']['user'])
print(config['settings']['pw'])
```

> ['./config.ini']
>
> foobar
>
> 12345
>
> foobar
>
> 12345

<a id="markdown-markdown-ファイル" name="markdown-ファイル"></a>

#### Markdown ファイル

```sh
$ pip install Markdown
```

```py
import markdown

markdown_text_string = '''
# Title

Lorem ipsum dolor sit amet, vix no mutat dicunt, movet petentium iudicabit at vim.

- one
- two
- three

'''

# モジュールとして利用
html = markdown.markdown(markdown_text_string)

# 文字列ごとに新しいインスタンスを作成せずに複数の文字列を処理する場合
md = markdown.Markdown()
html1 = md.convert(markdown_text_string)
html2 = md.reset().convert(markdown_text_string)
```

> '<h1>Title</h1>\n<p>Lorem ipsum dolor sit amet, vix no mutat dicunt, movet petentium iudicabit at vim.</p>\n<ul>\n<li>one</li>\n<li>two</li>\n<li>three</li>\n</ul>'

<a id="markdown-ファイル入出力" name="ファイル入出力"></a>

##### ファイル入出力

```py
import codecs
import markdown

with codecs.open('./test-fileio/input.md', mode='r', encoding='utf-8') as fi:
    text = fi.read()
    html = markdown.markdown(text)
    print(html)

with codecs.open('./test-fileio/output.md.html', 'w', encoding='utf-8', errors='xmlcharrefreplace') as fo:
    fo.write(html)
```

<a id="markdown-ログファイルテキストファイル・追記" name="ログファイルテキストファイル・追記"></a>

#### ログファイル(テキストファイル・追記)

標準出力をログファイルに書き出す

```py
from datetime import datetime
import sys

startTimeStr = datetime.now().strftime('%Y%m%d%H%M%S')
LOGFILE = 'log_{}.txt'.format(startTimeStr)

if __name__ == '__main__':
    try:
        sys.stdout = open(LOGFILE, 'a', encoding='utf-8')
        main()
    except Exception as e:
        with open(LOGFILE, 'a', encoding='utf-8') as logfile:
            nowStr = datetime.now().strftime('%Y/%m/%d %H:%M:%S')
            print('Exception: {} {}'.format(e, nowStr), file=logfile, flush=True)
    finally:
        sys.stdout.close()
        sys.stdout = sys.__stdout__
```

<a id="markdown-zip-ファイル" name="zip-ファイル"></a>

#### zip ファイル

<a id="markdown-zip-ファイル圧縮" name="zip-ファイル圧縮"></a>

##### zip ファイル圧縮

<a id="markdown-shutil-を使ってフォルダごと圧縮" name="shutil-を使ってフォルダごと圧縮"></a>

###### shutil を使ってフォルダごと圧縮

```py
from glob import glob
from pathlib import Path
import os
import shutil
import zipfile


def touch(filepath):
    Path(filepath).touch()


archive_path = './test-archive/archive' # 拡張子なし : './test-archive/archive.zip'が作成される

srcdpath1 = './test-archive/dir1'
srcdpath2 = './test-archive/dir1/dir2'
srcfpath1 = './test-archive/dir1/file1.txt'
srcfpath2 = './test-archive/dir1/dir2/file2.txt'

os.makedirs(srcdpath1, exist_ok=True)
os.makedirs(srcdpath2, exist_ok=True)
touch(srcfpath1)
touch(srcfpath2)

# base_dirを指定しない
shutil.make_archive(archive_path, 'zip', root_dir=srcdpath1, base_dir=None)

with zipfile.ZipFile(archive_path + '.zip') as zip_contents:
    print(zip_contents.namelist())

# base_dirを指定する
rlpath = os.path.relpath(srcdpath2, srcdpath1) # dir2
shutil.make_archive(archive_path, 'zip', root_dir=srcdpath1, base_dir=rlpath) # 既存の圧縮ファイルがある場合は圧縮ファイル自体が上書きされる

with zipfile.ZipFile(archive_path + '.zip') as zip_contents:
    print(zip_contents.namelist())

```

> \# base_dir を指定しない
>
> '/mnt/c/Users/y/Documents/GitHub/Python-cheatsheet/test-archive/archive.zip'
>
> ['dir2/', 'file1.txt', 'dir2/file2.txt']

> \# base_dir を指定する
>
> '/mnt/c/Users/y/Documents/GitHub/Python-cheatsheet/test-archive/archive.zip'
>
> ['dir2/', 'dir2/file2.txt']

<a id="markdown-個別にファイルを追加して圧縮ファイルを作成" name="個別にファイルを追加して圧縮ファイルを作成"></a>

###### 個別にファイルを追加して圧縮ファイルを作成

```py
from glob import glob
from pathlib import Path
import os
import zipfile


def touch(filepath):
    Path(filepath).touch()


archive_path = './test-archive/archive.zip'

srcdpath1 = './test-archive/dir1'
srcdpath2 = './test-archive/dir1/dir2'
srcfpath1 = './test-archive/dir1/file1.txt'
srcfpath2 = './test-archive/dir1/dir2/file2.txt'

os.makedirs(srcdpath1, exist_ok=True)
os.makedirs(srcdpath2, exist_ok=True)
touch(srcfpath1)
touch(srcfpath2)



with zipfile.ZipFile(archive_path, 'w', compression=zipfile.zip_DEFLATED) as z:
    z.write(srcdpath1, arcname=srcdpath1)
    z.write(srcdpath2, arcname=srcdpath2)
    z.write(srcfpath1, arcname=srcfpath1)

with zipfile.ZipFile(archive_path) as zip_contents:
    print(zip_contents.namelist())

# 既存の圧縮ファイルがある場合は圧縮ファイル自体が上書きされる
with zipfile.ZipFile(archive_path, 'w', compression=zipfile.zip_DEFLATED) as z:
    z.write(srcdpath1, arcname=srcdpath1)
    z.write(srcdpath2, arcname=srcdpath2)
    z.write(srcfpath2, arcname=srcfpath2)

with zipfile.ZipFile(archive_path) as zip_contents:
    print(zip_contents.namelist())

# 既存の圧縮ファイルに、ファイルを追加する
with zipfile.ZipFile(archive_path, 'a', compression=zipfile.zip_DEFLATED) as z:
    z.write(srcdpath1, arcname=srcdpath1)
    z.write(srcdpath2, arcname=srcdpath2)
    z.write(srcfpath1, arcname=srcfpath1)
    z.write(srcfpath2, arcname=srcfpath2)

with zipfile.ZipFile(archive_path) as zip_contents:
    print(zip_contents.namelist())
```

> ['test-archive/dir1/', 'test-archive/dir1/dir2/', 'test-archive/dir1/file1.txt']
>
> \# 既存の圧縮ファイルがある場合は圧縮ファイル自体が上書きされる
>
> ['test-archive/dir1/', 'test-archive/dir1/dir2/', 'test-archive/dir1/dir2/file2.txt']
>
> \# 既存の圧縮ファイルに、ファイルを追加する
>
> UserWarning: Duplicate name: 'test-archive/dir1/'
>
> UserWarning: Duplicate name: 'test-archive/dir1/dir2/'
>
> UserWarning: Duplicate name: 'test-archive/dir1/dir2/file2.txt'
>
> [
>
> > 'test-archive/dir1/',
> > 'test-archive/dir1/dir2/',
> > 'test-archive/dir1/dir2/file2.txt',
> > 'test-archive/dir1/',
> > 'test-archive/dir1/dir2/',
> > 'test-archive/dir1/file1.txt',
> > 'test-archive/dir1/dir2/file2.txt'
> > ]

<a id="markdown-zip-ファイル解凍" name="zip-ファイル解凍"></a>

##### zip ファイル解凍

```py
import zipfile


archive_path = './test-archive/archive.zip'
extract_path = '.'


# 内容を確認
with zipfile.ZipFile(archive_path) as zip_contents:
    print(zip_contents.namelist())


with zipfile.ZipFile(archive_path) as zip_contents:
    zip_contents.extractall(extract_path)

# 特定のファイルのみ解凍
with zipfile.ZipFile(archive_path) as zip_contents:
    result_path = zip_contents.extract('test-archive/dir1/file1.txt', extract_path)
    print(result_path)


# パスワードつきzipファイルを解凍
pw = 'Password'
with zipfile.ZipFile(archive_path) as zip_contents:
    zip_contents.extractall(extract_path, pwd=pw)

with zipfile.ZipFile(archive_path) as zip_contents:
    result_path = zip_contents.extract('test-archive/dir1/file1.txt', extract_path, pwd=pw)
    print(result_path)
```

<a id="markdown-ms-office-ファイル" name="ms-office-ファイル"></a>

##### MS Office ファイル

<a id="markdown-excel-ファイル" name="excel-ファイル"></a>

##### Excel ファイル

[openpyxl](https://openpyxl.readthedocs.io/en/stable/) を利用する

```sh
$ pip install openpyxl

# 画像を含める場合はPillowもインストールする
$ pip install pillow
```

<a id="markdown-書き出し" name="書き出し"></a>

###### 書き出し

```py
from openpyxl import Workbook
from openpyxl.utils import get_column_letter

# Workbook を生成
wb = Workbook()

# Workbook は少なくとも 1 つの Worksheet を含むので、 Workbook.active で取得できる
ws1 = wb.active
ws1.title = 'range names' # シートタイトル

# 1 行目から 9 行目に「 0, 1, ... , 25 」を追加
for row in range(1, 10):
    ws1.append(range(26))

# Worksheet を追加
ws2 = wb.create_sheet(title='Pi')

# セルの値を指定
ws2['A2'] = 3.14

# セルの値を取得
cell = ws2.cell(row=2, column=1)
print(cell.value)
# 3.14

# セルの書式設定を取得
from datetime import datetime
ws2['C4'] = datetime(2020, 12, 5)
ws2['C4'].value
# datetime.datetime(2020, 12, 5, 0, 0)
ws2['C4'].number_format
# 'yyyy-mm-dd h:mm:ss'

# セルに数式を指定
ws2['E6'] = '=SUM(1, 1)'
ws2['E6'].value
# =SUM(1, 1)

# 数式の計算はできないが、関数として妥当かは判定できる
from openpyxl.utils import FORMULAE
'SUM' in FORMULAE
# True

# Worksheet を追加
ws3 = wb.create_sheet(title='Data')
for row in range(10, 20):
    for col in range(27, 54):
        # セルの値を指定
        _ = ws3.cell(column=col, row=row, value='{0}'.format(get_column_letter(col)))

print(ws3['AA10'].value)
# AA

# セルの結合
ws3.merge_cells('AA10:AD10')
# ws3.merge_cells(start_row=10, start_column=27, end_row=10, end_column=30) # と同じ

# セルの結合解除
ws3.unmerge_cells('AA10:AD10')
# ws3.unmerge_cells(start_row=10, start_column=27, end_row=10, end_column=30) # と同じ
# 結合して解除したので左上のセルの値だけ残る（ 10 行目の AB, AC, AD が空文字に変わる）

# Worksheet を追加
ws4 = wb.create_sheet(title='Image')

# セルの値を指定
ws4['A1'] = '画像の説明'

# 画像の挿入（ A2 セルの左上に画像の左上が合う）
from openpyxl.drawing.image import Image
img = Image('./test-pillow/image.png')
ws4.add_image(img, 'A2')

# アウトライン（折り畳まれて、ワークシートの左上が E11 になる）
ws4.column_dimensions.group('A','D', hidden=True)
ws4.row_dimensions.group(1,10, hidden=True)

# ファイルに書き込む
wb.save(filename = './test-openpyxl/write.xlsx')
```

<a id="markdown-読み込み-4" name="読み込み-4"></a>

###### 読み込み

```py
from openpyxl import load_workbook

wb = load_workbook(filename = './test-openpyxl/write.xlsx')
sheet_ranges = wb['range names']
print(sheet_ranges['C2'].value)
# 2
```

<a id="markdown-pdf-ファイル" name="pdf-ファイル"></a>

#### PDF ファイル

[pdfminer.six](https://pdfminersix.readthedocs.io/en/latest/)を利用する

```sh
$ pip install pdfminer.six
```

```py
import pdfminer
print(pdfminer.__version__)
```

<a id="markdown-読み込み-5" name="読み込み-5"></a>

###### 読み込み

```py
from pdfminer.high_level import extract_text

text = extract_text('./test-pdfminersix/sample.pdf')
print(repr(text))
print(text)
```

```
'宮沢賢治 やまなし\n\nhttps://www.aozora.gr.jp/cards/000081/ﬁles/46605_311...\n\nやまなし\n\n宮沢賢治\n\n+目次\n\n一、五月\n\n(cid:12690)(cid:12755)(cid:12712)(cid:12676)\n\u3000小さな谷川の底を写した二枚の青い幻燈\n\nです。\n\n(cid:12722)(cid:12684)\n\u3000二疋\n\n(cid:12681)(cid:12715)\nの蟹\n\nの子供らが青じろい水の底で話していました。\n\n『クラムボンはわらったよ。』\n\n『クラムボンはかぷかぷわらったよ。』\n\n(cid:12719)\n『クラムボンは跳\n\nねてわらったよ。』\n\n『クラムボンはかぷかぷわらったよ。』\n\n
（略）
'
```

```
宮沢賢治 やまなし

https://www.aozora.gr.jp/cards/000081/ﬁles/46605_311...

やまなし

宮沢賢治

+目次

一、五月

(cid:12690)(cid:12755)(cid:12712)(cid:12676)
　小さな谷川の底を写した二枚の青い幻燈

です。

(cid:12722)(cid:12684)
　二疋

(cid:12681)(cid:12715)
の蟹

の子供らが青じろい水の底で話していました。

『クラムボンはわらったよ。』

『クラムボンはかぷかぷわらったよ。』

(cid:12719)
『クラムボンは跳

ねてわらったよ。』

『クラムボンはかぷかぷわらったよ。』
（略）
```

```py
from pdfminer.high_level import extract_pages
from pdfminer.layout import LTTextContainer, LTChar

for page_layout in extract_pages('./test-pdfminersix/sample.pdf'):
    for element in page_layout:
        print(element)
        if isinstance(element, LTTextContainer):
            for text_line in element:
                for ch in text_line:
                    if isinstance(ch, LTChar):
                        print(
                            '\t{}, {}, {}, x0={:.2f}, x1={:.2f}, y0={:.2f}, y1={:.2f}, w={:.2f}, h={:.2f}'.format(
                            ch.get_text(), ch.fontname, ch.size, ch.x0, ch.x1, ch.y0, ch.y1, ch.width, ch.height)
                        )
```

```
<LTTextBoxHorizontal(0) 8.650,822.150,91.975,832.150 '宮沢賢治 やまなし\n'>
        宮, AAAAAE+HiraMinProN-W3, 10.0, x0=8.65, x1=18.65, y0=822.15, y1=832.15, w=10.00, h=10.00
        沢, AAAAAE+HiraMinProN-W3, 10.0, x0=18.65, x1=28.65, y0=822.15, y1=832.15, w=10.00, h=10.00
        賢, AAAAAE+HiraMinProN-W3, 10.0, x0=28.65, x1=38.65, y0=822.15, y1=832.15, w=10.00, h=10.00
        治, AAAAAE+HiraMinProN-W3, 10.0, x0=38.65, x1=48.65, y0=822.15, y1=832.15, w=10.00, h=10.00
         , AAAAAE+HiraMinProN-W3, 10.0, x0=48.65, x1=51.98, y0=822.15, y1=832.15, w=3.33, h=10.00
        や, AAAAAE+HiraMinProN-W3, 10.0, x0=51.98, x1=61.98, y0=822.15, y1=832.15, w=10.00, h=10.00
        ま, AAAAAE+HiraMinProN-W3, 10.0, x0=61.98, x1=71.97, y0=822.15, y1=832.15, w=10.00, h=10.00
        な, AAAAAE+HiraMinProN-W3, 10.0, x0=71.98, x1=81.98, y0=822.15, y1=832.15, w=10.00, h=10.00
        し, AAAAAE+HiraMinProN-W3, 10.0, x0=81.98, x1=91.98, y0=822.15, y1=832.15, w=10.00, h=10.00
（略）
```

<a id="markdown-テストデータ生成" name="テストデータ生成"></a>

## テストデータ生成

<a id="markdown-faker" name="faker"></a>

### Faker

<a id="markdown-基本" name="基本"></a>

#### 基本

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/basic.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake = Faker('ja_JP')
    for i in range(100):
        l = [
            # '#'を0から9に、?をlettersのうちどれかに置換
            fake.bothify(
                text='## ??',
                letters='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ' # 既定でa-zA-Z
            ),

            # '^'を8進数に置換
            fake.hexify(
                text='^^:^^:^^:^^:^^:^^',
                # upper=True # 大文字で出力
            ),

            # 2文字の言語コード(例: en)
            fake.language_code(),

            # ?をlettersのうちどれかに置換
            fake.lexify(
                text='????',
                letters='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ' # 既定でa-zA-Z
            ),

            # ロケール(例: en_US)
            fake.locale(),

            # '#'を0から9に、'%'を1から9に、'!'を0から9または空文字に、'@'を1から9または空文字に置換
            fake.numerify(
                text='###'
            ),

            # elementsからランダムに抽出
            fake.random_choices(elements=('a', 'b', 'c', 'd')),
            fake.random_choices(elements=('a', 'b', 'c', 'd'), length=10),
            fake.random_choices(elements=OrderedDict([("a", 0.45), ("b", 0.35), ("c", 0.15), ("d", 0.05), ])),
            fake.random_choices(elements=OrderedDict([("a", 0.45), ("b", 0.35), ("c", 0.15), ("d", 0.05), ]), length=20),

            # 0から9のうちランダムに抽出
            fake.random_digit(),

            # 1から9のうちランダムに抽出
            fake.random_digit_not_null(),

            # 1から9または空文字のうちランダムに抽出。空文字を50%の確率で返す
            fake.random_digit_not_null_or_empty(),

            # 0から9または空文字のうちランダムに抽出。空文字を50%の確率で返す
            fake.random_digit_or_empty(),

            # elementsのうちランダムに1つ抽出
            fake.random_element(elements=('a', 'b', 'c', 'd')),
            fake.random_element(
                elements=OrderedDict(
                    [
                        ("a", 0.5),  # 50%の確率で返す
                        ("b", 0.2),  # 20%の確率で返す
                        ("c", 0.2),  # 20%の確率で返す
                        ("d", 0.1),  # 10%の確率で返す
                    ]
                )
            ),

            # elementsのうちランダムに抽出
            fake.random_elements(
                elements=('a', 'b', 'c', 'd'),  # 重複ありで10個抽出
                length=10,
                unique=False
            ),

            fake.random_elements(
                elements=('a', 'b', 'c', 'd'),  # unique=Trueの場合、lengthはelementsの長さ以下
                length=4,
                unique=True
            ),

            fake.random_elements(
                elements=('a', 'b', 'c', 'd'),  # lengthが指定されていない場合は1から要素数のうちランダムな数
                unique=False
            ),
            fake.random_elements(
                elements=('a', 'b', 'c', 'd'),
                unique=True
            ),

            fake.random_elements(
                elements=OrderedDict([
                    ("a", 0.5),  # 50%の確率で返す
                    ("b", 0.2),  # 20%の確率で返す
                    ("c", 0.2),  # 20%の確率で返す
                    ("d", 0.1),  # 10%の確率で返す
                ]), unique=False
            ),
            fake.random_elements(
                elements=OrderedDict([
                    ("a", 0.5),  # unique=True なので均一分布
                    ("b", 0.2),
                    ("c", 0.2),
                    ("d", 0.1),
                ]), unique=True
            ),

            # minとmaxの間のランダムな整数を1つ抽出
            fake.random_int(),  # 既定ではmin=0, max=9999, step=1
            fake.random_int(min=0, max=15),
            fake.random_int(min=0, max=15, step=3),

            # aからz、AからZのうちランダムに1つ抽出
            fake.random_letter(),

            # aからz、AからZのうちランダムにlength個抽出
            fake.random_letters(length=16),  # 既定ではlength=16

            # aからzのうちランダムに1つ抽出
            fake.random_lowercase_letter(),

            # ランダムな整数を抽出
            fake.random_number(fix_len=False),  # digits=None（既定）の場合は1から9のうちランダムな整数
            fake.random_number(digits=3, fix_len=False),  # fix_len=Falseの場合は、digitsの桁数を超えない数を生成
            fake.random_number(digits=3, fix_len=True),  # fix_len=Trueの場合は、digitsちょうどの桁数の数を生成

            # elementsからランダムにサンプリングされたオブジェクトのリストを生成
            fake.random_sample(elements=('a', 'b', 'c', 'd', 'e', 'f')),
            fake.random_sample(elements=('a', 'b', 'c', 'd', 'e', 'f'), length=3),

            # AからZのうちランダムに1つ抽出
            fake.random_uppercase_letter(),

            # numberに近いランダムな整数を生成
            fake.randomize_nb_elements(
                number=80,
                le=True,  # leがFalse（既定）の場合、数値の140％まで生成。Trueの場合、上限を100％に制限
                ge=True,  # geがFalse（既定）の場合、数値の60％まで生成。Trueの場合、下限を100％に制限
                min=50,  # minが指定されている場合、minより小さい生成値はminでクランプされる
                max=100  # maxが指定されている場合、maxより大きい生成値はmaxでクランプされる
            ),

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-address" name="address"></a>

#### address

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/address.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.address(),

            fake.building_number(),
            fake.city(),
            fake.city_suffix(),
            fake.country(),
            fake.country_code(),
            fake.postcode(),
            fake.street_address(),
            fake.street_name(),
            fake.street_suffix(),

            # Locale
            fake_jp.address(),
            fake_jp.ban(),
            fake_jp.building_name(),
            fake_jp.building_number(),
            fake_jp.chome(),
            fake_jp.city(),
            fake_jp.city_suffix(),
            fake_jp.country(),
            fake_jp.country_code(),
            fake_jp.gou(),
            fake_jp.postcode(),
            fake_jp.prefecture(),
            fake_jp.street_address(),
            fake_jp.street_name(),
            fake_jp.street_suffix(),
            fake_jp.town(),
            fake_jp.zipcode()

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-automotive" name="automotive"></a>

#### automotive

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/automotive.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.license_plate()

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-bank" name="bank"></a>

#### bank

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/bank.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.bank_country(),
            fake.bban(),
            fake.iban(),

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-barcode" name="barcode"></a>

#### barcode

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/barcode.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.ean(),
            fake.ean(length=8),

            fake.ean13(),
            fake.ean13(leading_zero=False),
            fake.ean13(leading_zero=True),

            fake.ean8(),

            fake.upc_a(),
            fake.upc_a(upc_ae_mode=True, base='120004', number_system_digit=0),

            fake.upc_e(),
            fake.upc_e(base='120004', number_system_digit=0, safe_mode=False)

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-color" name="color"></a>

#### color

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/color.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.color(
                hue=None,  # H値
                    # 値が0-360の数値の場合、生成された色のH値
                    # 値が0-360の2つの数値のタプル/リストである場合、色のH値はその範囲からランダムに選択
                    # 値が文字列（'monochrome', 'red', 'orange', 'yellow', 'green', 'blue', 'purple', 'pink'）の場合、色のH値は、指定された文字列に対応するH値の範囲からランダムに選択される
                luminosity=None,
                color_format='hex'
            ),

            fake.color_name(),  # 例: 'SandyBrown'
            fake.hex_color(),  # 例: '#d82c08'
            fake.rgb_color(),  # 例: '197,215,20'
            fake.rgb_css_color(),  # 例: 'rgb(197,215,20)'
            fake.safe_color_name(),  # 例: 'fuchsia'
            fake.safe_hex_color(),  # 例: '#cc5500'

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-company" name="company"></a>

#### company

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/company.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.bs(),
            fake.catch_phrase(),
            fake.company(),
            fake.company_suffix(),

            # Locale
            fake_jp.bs(),
            fake_jp.catch_phrase(),
            fake_jp.company(),
            fake_jp.company_category(),
            fake_jp.company_prefix(),
            fake_jp.company_suffix(),

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-credit_card" name="credit_card"></a>

#### credit_card

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/credit_card.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.credit_card_expire(),
            fake.credit_card_expire(  # 既定
                start='now',
                end='+10y',
                date_format='%m/%y'
            ),

            fake.credit_card_full(),
            fake.credit_card_full(card_type='amex'),
            fake.credit_card_full(card_type='diners'),
            fake.credit_card_full(card_type='discover'),
            fake.credit_card_full(card_type='jcb'),  # jcb16指定と同じ
            fake.credit_card_full(card_type='jcb15'),
            fake.credit_card_full(card_type='jcb16'),
            fake.credit_card_full(card_type='maestro'),
            fake.credit_card_full(card_type='mastercard'),
            fake.credit_card_full(card_type='visa'),  # visa16指定と同じ
            fake.credit_card_full(card_type='visa13'),
            fake.credit_card_full(card_type='visa16'),
            fake.credit_card_full(card_type='visa19'),

            fake.credit_card_number(),
            fake.credit_card_number(card_type='amex'),
            fake.credit_card_number(card_type='jcb'),

            fake.credit_card_provider(),
            fake.credit_card_provider(card_type='diners'),
            fake.credit_card_provider(card_type='maestro'),

            fake.credit_card_security_code(),
            fake.credit_card_security_code(card_type='discover'),
            fake.credit_card_security_code(card_type='mastercard')

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-currency" name="currency"></a>

#### currency

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/currency.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake_jp = Faker('ja_JP')
    for i in range(100):

        c_symbol = ''
        try:
            c_symbol = fake.currency_symbol(code=fake.currency_code()) # currency_code()で定義されているコードと差があり、KeyErrorとなる場合もある
        except:
            pass

        l = [

            fake.cryptocurrency(),

            fake.cryptocurrency_code(),

            fake.cryptocurrency_name(),

            fake.currency(),

            fake.currency_code(),

            fake.currency_name(),

            fake.currency_symbol(),
            fake.currency_symbol(code='USD'),
            c_symbol # fake.currency_symbol(code=fake.currency_code())

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-date_time" name="date_time"></a>

#### date_time

```ps
$ pip install Faker
```

```py
from datetime import date, datetime, timedelta, timezone

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/date_time.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.am_pm(),

            fake.century(),

            # 1970/01/01と現在（またはend_datetime）の間のランダムな日付文字列を抽出
            fake.date(),
            fake.date(
                pattern='%Y-%m-%d',  # 既定
                end_datetime=None
            ),
            fake.date(
                pattern='%Y/%m/%d'
            ),
            fake.date(  # date
                end_datetime=date(1999, 12, 31)
            ),
            fake.date(  # datetime
                end_datetime=datetime(1999, 12, 31, 23, 59, 59)
            ),
            fake.date(  # timedelta
                end_datetime=timedelta(
                    weeks=1,
                    days=2,
                    hours=3,
                    minutes=4,
                    seconds=5,
                    milliseconds=6000,
                    microseconds=7000000,
                )
            ),
            fake.date(  # str
                end_datetime='now'
            ),
            fake.date(end_datetime='+1y'),  # years
            fake.date(end_datetime='-2M'),  # months
            fake.date(end_datetime='+3w'),  # weeks
            fake.date(end_datetime='-4d'),  # days
            fake.date(end_datetime='+5h'),  # hours
            fake.date(end_datetime='-6m'),  # minutes
            fake.date(end_datetime='+7s'),  # seconds

            # 2つの日付の間のランダムな日付（dateオブジェクト）を抽出
            fake.date_between(),  # 開始終了日時をstr（文字列）で指定する場合
            fake.date_between(
                start_date='-30y',  # 既定
                end_date='today'
            ),
            fake.date_between(start_date='today', end_date='+1y'),

            fake.date_between_dates(),  # 開始終了日時をdate型またはdatetime型で指定する場合
            fake.date_between_dates(
                date_start=None,  # 既定（todayのみ）
                date_end=None
            ),
            fake.date_between_dates(date_start=date(2020, 1, 1), date_end=date(2020, 12, 31)),

            # 1970/01/01と現在（またはend_datetime）の間のランダムな日付（dateオブジェクト）を抽出
            fake.date_object(),
            fake.date_object(
                end_datetime=None  # 既定
            ),
            fake.date_object(end_datetime='-1y'),

            # ランダムな年齢から誕生日を生成
            fake.date_of_birth(),
            fake.date_of_birth(
                tzinfo=None,  # 既定
                minimum_age=0,
                maximum_age=115
            ),
            fake.date_of_birth(tzinfo=None, minimum_age=20, maximum_age=30),

            fake.date_this_century(),
            fake.date_this_century(
                before_today=True,  # 既定
                after_today=False
            ),
            fake.date_this_century(before_today=True, after_today=True),
            fake.date_this_century(before_today=False, after_today=True),
            fake.date_this_century(before_today=False, after_today=False),  # todayのみ

            fake.date_this_decade(),
            fake.date_this_decade(
                before_today=True,  # 既定
                after_today=False
            ),

            fake.date_this_year(),
            fake.date_this_year(
                before_today=True,  # 既定
                after_today=False
            ),

            fake.date_this_month(),
            fake.date_this_month(
                before_today=True,  # 既定
                after_today=False
            ),

            # 1970/01/01と現在（またはend_datetime）の間のランダムな日時（datetimeオブジェクト）を抽出
            fake.date_time(),
            fake.date_time(
                tzinfo=None,  # 既定
                end_datetime=None
            ),
            fake.date_time(
                tzinfo=timezone(timedelta(hours=9)),  # datetime.timezone, datetime.timedelta
                end_datetime='+1y'
            ),

            # 0001/01/01と現在（またはend_datetime）の間のランダムな日時（datetimeオブジェクト）を抽出
            fake.date_time_ad(),
            fake.date_time_ad(
                tzinfo=None,  # 既定
                end_datetime=None,
                start_datetime=None
            ),

            # 2つの日付の間のランダムな日時（datetimeオブジェクト）を抽出
            fake.date_time_between(),  # 開始終了日時をstr（文字列）で指定する場合
            fake.date_time_between(
                start_date='-30y',  # 既定
                end_date='now',
                tzinfo=None
            ),

            fake.date_time_between_dates(),  # 開始終了日時をdate型またはdatetime型で指定する場合
            fake.date_time_between_dates(
                datetime_start=None,  # 既定（todayのみ）
                datetime_end=None,
                tzinfo=None
            ),

            fake.date_time_this_century(),
            fake.date_time_this_century(
                before_now=True,  # 既定
                after_now=False,
                tzinfo=None
            ),
            fake.date_time_this_century(before_now=True, after_now=True),
            fake.date_time_this_century(before_now=False, after_now=True),
            fake.date_time_this_century(before_now=False, after_now=False),  # todayのみ

            fake.date_time_this_decade(),
            fake.date_time_this_decade(
                before_now=True,  # 既定
                after_now=False,
                tzinfo=None
            ),

            fake.date_time_this_year(),
            fake.date_time_this_year(
                before_now=True,  # 既定
                after_now=False,
                tzinfo=None
            ),

            fake.date_time_this_month(),
            fake.date_time_this_month(
                before_now=True,  # 既定
                after_now=False,
                tzinfo=None
            ),

            fake.day_of_month(),

            fake.day_of_week(),

            fake.future_date(),
            fake.future_date(
                end_date='+30d',  # 既定
                tzinfo=None
            ),

            fake.future_datetime(),
            fake.future_datetime(
                end_date='+30d',  # 既定
                tzinfo=None
            ),

            fake.iso8601(),
            fake.iso8601(
                tzinfo=None,  # 既定
                end_datetime=None
            ),

            fake.month(),  # ゼロ埋め2桁

            fake.month_name(),  # 例: 'August'

            fake.past_date(),
            fake.past_date(
                start_date='-30d',  # 既定
                tzinfo=None
            ),

            fake.past_datetime(),
            fake.past_datetime(
                start_date='-30d',  # 既定
                tzinfo=None
            ),

            # ランダムな時刻文字列を抽出
            fake.time(),
            fake.time(
                pattern='%H:%M:%S',  # 既定
                end_datetime=None
            ),
            fake.time(
                pattern='%H%M%S',
            ),

            fake.time_delta(
                end_datetime=None  # 既定（todayのみ）
            ),
            fake.time_delta(end_datetime='+1y'),

            fake.time_object(),
            fake.time_object(
                end_datetime=None  # 既定
            ),

            # fake.time_series()
            ' | '.join(
                [str(i) for i in fake.time_series()]
            ),
            ' | '.join(
                [
                    str(i) for i in fake.time_series(
                        start_date='-30d',  # 既定
                        end_date='now',
                        precision=None,
                        distrib=None,
                        tzinfo=None
                    )
                ]
            ),

            fake.timezone(),

            # 1970/01/01（またはstart_datetime）と現在（またはend_datetime）の間のランダムなUnixタイムスタンプを抽出
            fake.unix_time(),
            fake.unix_time(
                end_datetime=None,  # 既定
                start_datetime=None
            ),

            fake.year(),


            #

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-file" name="file"></a>

#### file

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/file.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.file_extension(),
            fake.file_extension(
                category=None  # 既定
            ),
            fake.file_extension(
                category='audio'  # audio|image|office|text|video
            ),

            fake.file_name(),
            fake.file_name(
                category=None,  # 既定
                extension=None
            ),
            fake.file_name(category='image', extension='png'),

            fake.file_path(),
            fake.file_path(
                depth=1,  # 既定
                category=None, # audio|image|office|text|video
                extension=None
            ),
            fake.file_path(depth=0, category='video'),
            fake.file_path(depth=2, category='office'),

            fake.mime_type(),
            fake.mime_type(
                category=None  # 既定
            ),
            fake.mime_type(
                category='multipart'  # application|audio|image|message|model|multipart|text|video
            ),

            fake.unix_device(),
            fake.unix_device(
                prefix=None  # 既定
            ),
            fake.unix_device(
                prefix='sd'  # sd|vd|xvd
            ),

            fake.unix_partition(),
            fake.unix_partition(
                prefix=None  # 既定
            ),
            fake.unix_partition(
                prefix='vd'  # sd|vd|xvd
            ),

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-geo" name="geo"></a>

#### geo

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/geo.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.coordinate(),
            fake.coordinate(
                center=None,  # 既定
                radius=0.001
            ),
            fake.coordinate(
                center=35,
                radius=0.001
            ),

            fake.latitude(),

            fake.latlng(),

            # country_codeで指定された国に含まれるランダムな座標を抽出
            fake.local_latlng(),
            fake.local_latlng(
                country_code='US',
                coords_only=False
            ),

            # 陸上のランダムな座標を抽出
            fake.location_on_land(),
            fake.location_on_land(
                coords_only=False
            ),

            fake.longitude()

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-internet" name="internet"></a>

#### internet

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/internet.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.ascii_company_email(),

            fake.ascii_email(),

            fake.ascii_free_email(),

            fake.ascii_safe_email(),

            fake.company_email(),

            fake.dga(), # Domain generation algorithmで、日付からドメイン名を生成
            fake.dga(
                year=None,  # 既定
                month=None,
                day=None,
                tld=None,
                length=None
            ),

            fake.domain_name(),
            fake.domain_name(
                levels=1  # 既定
            ),
            fake.domain_name(levels=2),

            fake.domain_word(),

            fake.email(),
            fake.email(
                domain=None  # 既定
            ),

            fake.free_email(),

            fake.free_email_domain(),

            fake.hostname(),
            fake.hostname(
                levels=1  # 既定
            ),
            fake.hostname(levels=0),
            fake.hostname(levels=2),

            fake.http_method(),

            fake.image_url(),
            fake.image_url(
                width=None,  # 既定
                height=None
            ),
            fake.image_url(width=320, height=240),

            fake.ipv4(),
            fake.ipv4(  # 既定
                network=False,  # ネットワークアドレス
                address_class=None,  # IPv4ネットワーククラス
                private=None  # Public / private
            ),
            fake.ipv4(
                network=True,
                address_class=None,
                private=True
            ),

            fake.ipv4_network_class(),  # IPv4ネットワーククラス 'a' / 'b' / 'c' を返す

            fake.ipv4_private(),
            fake.ipv4_private(
                network=False,  # 既定
                address_class=None
            ),
            fake.ipv4_private(network=True, address_class='c'),

            fake.ipv4_public(),
            fake.ipv4_public(
                network=False,  # 既定
                address_class=None
            ),
            fake.ipv4_public(network=True, address_class='c'),

            fake.ipv6(),
            fake.ipv6(
                network=False  # 既定
            ),
            fake.ipv6(network=True),

            fake.mac_address(),

            fake.port_number(),
            fake.port_number(  # 既定
                is_system=False,  # System or well-known ports
                is_user=False,    # User or registered ports
                is_dynamic=False  # Dynamic / private / ephemeral ports
            ),
            fake.port_number(
                is_system=True,
                is_user=False,
                is_dynamic=False
            ),
            fake.port_number(
                is_system=False,
                is_user=True,
                is_dynamic=False
            ),
            fake.port_number(
                is_system=False,
                is_user=False,
                is_dynamic=True
            ),

            fake.safe_email(),

            fake.slug(),
            fake.slug(
                value=None  # 既定
            ),
            fake.slug(
                value='12345678901234567890'
            ),

            fake.tld(),

            fake.uri(),

            fake.uri_extension(),

            fake.uri_page(),

            fake.uri_path(),
            fake.uri_path(
                deep=None  # 既定
            ),
            fake.uri_path(deep=2),

            fake.url(),
            fake.url(
                schemes=None  # 既定
            ),
            fake.url(schemes=['http', 'ftp']),

            fake.user_name(),

            # Locale
            fake_jp.ascii_company_email(),
            fake_jp.ascii_email(),
            fake_jp.ascii_free_email(),
            fake_jp.ascii_safe_email(),
            fake_jp.company_email(),
            fake_jp.dga(),
            fake_jp.domain_name(),
            fake_jp.domain_word(),
            fake_jp.email(),
            fake_jp.free_email(),
            fake_jp.free_email_domain(),
            fake_jp.hostname(),
            fake_jp.http_method(),
            fake_jp.image_url(),
            fake_jp.ipv4(),
            fake_jp.ipv4_network_class(),
            fake_jp.ipv4_private(),
            fake_jp.ipv4_public(),
            fake_jp.ipv6(),
            fake_jp.mac_address(),
            fake_jp.port_number(),
            fake_jp.safe_email(),
            fake_jp.slug(),
            fake_jp.tld(),
            fake_jp.uri(),
            fake_jp.uri_extension(),
            fake_jp.uri_page(),
            fake_jp.uri_path(),
            fake_jp.url(),
            fake_jp.user_name()

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-isbn" name="isbn"></a>

#### isbn

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/isbn.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.isbn10(),
            fake.isbn10(
                separator='-'
            ),

            fake.isbn13(),
            fake.isbn13(
                separator='-'
            )

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-job" name="job"></a>

#### job

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/job.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.job()

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-lorem" name="lorem"></a>

#### lorem

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/lorem.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            # 1つの段落を返す
            fake.paragraph(),
            fake.paragraph(
                nb_sentences=3,  # 既定
                variable_nb_sentences=True,  # Falseを設定するとちょうどnb_sentences個の文で生成
                ext_word_list=None
            ),

            # 段落のリストを返す
            ' | '.join(
                [str(i) for i in fake.paragraphs()]
            ),
            ' | '.join(
                [
                    str(i) for i in fake.paragraphs(
                        nb=3,  # 既定
                        ext_word_list=None
                    )
                ]
            ),


            # 文を返す
            fake.sentence(),
            fake.sentence(
                nb_words=6,  # 既定
                variable_nb_words=True,
                ext_word_list=None
            ),
            fake.sentence(
                nb_words=6,
                variable_nb_words=False,
                ext_word_list=['American', 'whole',
                               'magazine', 'truth', 'stop', 'whose']
            ),

            # 文のリストを返す
            ' | '.join(
                [str(i) for i in fake.sentences()]
            ),
            ' | '.join(
                [
                    str(i) for i in fake.sentences(
                        nb=3,  # 既定
                        ext_word_list=None
                    )
                ]
            ),

            # 文字列を返す
            fake.text(),
            fake.text(
                max_nb_chars=200,  # 既定
                ext_word_list=None
            ),

            # 文字列のリストを返す
            ' | '.join(
                [str(i) for i in fake.texts()]
            ),
            ' | '.join(
                [
                    str(i) for i in fake.texts(
                        nb_texts=3,  # 既定
                        max_nb_chars=200,
                        ext_word_list=None
                    )
                ]
            ),

            # 単語を返す
            fake.word(),
            fake.word(
                ext_word_list=None  # 既定
            ),

            # 単語のリストを返す
            ' | '.join(
                [str(i) for i in fake.words()]
            ),
            ' | '.join(
                [
                    str(i) for i in fake.words(
                        nb=3,  # 既定
                        ext_word_list=None,
                        unique=False
                    )
                ]
            ),

            # Locale
            fake_jp.paragraph(),
            ' | '.join(
                [str(i) for i in fake.paragraphs()]
            ),
            fake_jp.sentence(),
            ' | '.join(
                [str(i) for i in fake.sentences()]
            ),
            fake_jp.text(),
            ' | '.join(
                [str(i) for i in fake.texts()]
            ),
            fake_jp.word(),
            ' | '.join(
                [str(i) for i in fake.words()]
            )

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-misc" name="misc"></a>

#### misc

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

fake = Faker()

print(
    fake.binary()
)
print(
    fake.binary(
        length=1048576  # 既定
    )
)

print(
    fake.boolean()
)
print(
    fake.boolean(
        chance_of_getting_true=50  # 既定
    )
)

# ランダムなCSVを返す
print(
    fake.csv()
)
print(
    fake.csv(
        header=None,  # 既定
        data_columns=('{{name}}', '{{address}}'),
        num_rows=10,
        include_row_ids=False
    )
)
print(
    fake.csv(
        header=('Name', 'Address', 'Favorite Color'),
        data_columns=('{{name}}', '{{address}}', '{{safe_color_name}}'),
        num_rows=10,
        include_row_ids=True
    )
)

# 区切り文字で区切られたランダムな値を返す
print(
    fake.dsv()
)
print(
    fake.dsv(
        dialect='faker-csv',  # 既定
        header=None,
        data_columns=('{{name}}', '{{address}}'),
        num_rows=10,
        include_row_ids=False
    )
)
print(
    fake.dsv(
        dialect='excel',
        data_columns=('{{name}}', '{{address}}')
    )
)
print(
    fake.dsv(
        dialect='excel-tab',
        data_columns=('{{name}}', '{{address}}'),
        include_row_ids=True
    )
)

print(
    fake.md5()
)
print(
    fake.md5(  # 16進文字列表現で返す
        raw_output=False  # 既定
    )
)
print(
    fake.md5(  # バイトオブジェクトで返す
        raw_output=True
    )
)

print(
    fake.null_boolean()  # None / True / Falseを返す
)

print(
    fake.password()
)
print(
    fake.password(
        length=10,  # 既定
        digits=True,  # special_chars、digits、upper_case、lower_caseをTrue（既定）に設定すると、対応するカテゴリの少なくとも1つの文字が表示されることが保証される
        lower_case=True,
        upper_case=True,
        special_chars=True  # !@#$%^&*()_+
    )
)
print(
    fake.password(length=12)
)

# パイプで区切られたランダムな値を返す
print(
    fake.psv()
)
print(
    fake.psv(
        header=None,  # 既定
        data_columns=('{{name}}', '{{address}}'),
        num_rows=10,
        include_row_ids=False
    )
)
print(
    fake.psv(
        header=('Name', 'Address', 'Favorite Color'),
        data_columns=('{{name}}', '{{address}}', '{{safe_color_name}}'),
        num_rows=10,
        include_row_ids=True
    )
)

print(
    fake.sha1()
)
print(
    fake.sha1(  # 16進文字列表現で返す
        raw_output=False  # 既定
    )
)
print(
    fake.sha1(  # バイトオブジェクトで返す
        raw_output=True
    )
)

print(
    fake.sha256()
)
print(
    fake.sha256(  # 16進文字列表現で返す
        raw_output=False  # 既定
    )
)
print(
    fake.sha256(  # バイトオブジェクトで返す
        raw_output=True
    )
)

# ランダムな有効なtarファイルを含むbytesオブジェクトを生成
print(
    fake.tar()
)
print(
    fake.tar(  # 既定
        uncompressed_size=65536,  # 圧縮前のファイルの合計サイズ、デフォルトでは16 KiB
        num_files=1,  # 圧縮されたファイルの数、デフォルトでは1
        min_file_size=4096,  # 圧縮前の各ファイルの最小サイズ、デフォルトでは4 KiB
        compression=None  # 圧縮しない（既定）。bzip2 / bz2 / lzma / xz / gzip / gz のどれかを指定すると圧縮される
    )
)
print(
    fake.tar(
        uncompressed_size=256,
        num_files=4,
        min_file_size=32,
        compression='gzip'
    )
)

# タブで区切られたランダムな値を返す
print(
    fake.tsv()
)
print(
    fake.tsv(
        header=None,  # 既定
        data_columns=('{{name}}', '{{address}}'),
        num_rows=10,
        include_row_ids=False
    )
)
print(
    fake.tsv(
        header=('Name', 'Address', 'Favorite Color'),
        data_columns=('{{name}}', '{{address}}', '{{safe_color_name}}'),
        num_rows=10,
        include_row_ids=True
    )
)

print(
    fake.uuid4()
)
print(
    fake.uuid4(
        cast_to=str  # 既定
    )
)

print(
    fake.zip()
)
print(
    fake.zip(
        uncompressed_size=65536,  # 圧縮前のファイルの合計サイズ、デフォルトでは16 KiB
        num_files=1,  # 圧縮されたファイルの数、デフォルトでは1
        min_file_size=4096,  # 圧縮前の各ファイルの最小サイズ、デフォルトでは4 KiB
        compression=None  # 圧縮しない（既定）。bzip2 / bz2 / lzma / xz / gzip / gz のどれかを指定すると圧縮される
    )
)
print(
    fake.zip(
        uncompressed_size=65536,
        num_files=1,
        min_file_size=4096,
        compression='gzip'
    )
)

```

<a id="markdown-person" name="person"></a>

#### person

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/person.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.first_name(),
            fake.first_name_female(),
            fake.first_name_male(),

            fake.last_name(),
            fake.last_name_female(),
            fake.last_name_male(),

            fake.name(),  # フルネーム
            fake.name_female(),
            fake.name_male(),

            fake.prefix(),
            fake.prefix_female(),
            fake.prefix_male(),

            fake.suffix(),
            fake.suffix_female(),
            fake.suffix_male(),

            # Locale
            fake_jp.first_kana_name(),
            fake_jp.first_kana_name_female(),
            fake_jp.first_kana_name_male(),

            fake_jp.first_name(),
            fake_jp.first_name_female(),
            fake_jp.first_name_male(),

            fake_jp.first_romanized_name(),
            fake_jp.first_romanized_name_female(),
            fake_jp.first_romanized_name_male(),

            fake_jp.kana_name(),

            fake_jp.last_kana_name(),

            fake_jp.last_name(),
            fake_jp.last_name_female(),
            fake_jp.last_name_male(),

            fake_jp.last_romanized_name(),

            fake_jp.name(),
            fake_jp.name_female(),
            fake_jp.name_male(),

            # fake_jp.prefix(),
            # fake_jp.prefix_female(),
            # fake_jp.prefix_male(),

            fake_jp.romanized_name(),

            # fake_jp.suffix(),
            # fake_jp.suffix_female(),
            # fake_jp.suffix_male()

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-phone_number" name="phone_number"></a>

#### phone_number

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/phone_number.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.country_calling_code(),
            fake.msisdn(),
            fake.phone_number(),

            # Locale
            fake_jp.country_calling_code(),
            fake_jp.msisdn(),
            fake_jp.phone_number(),

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-profile" name="profile"></a>

#### profile

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/profile.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.profile(),
            fake.profile(
                fields=None,  # 既定
                sex=None
            ),
            fake.profile(
                fields=[
                    'address',
                    'birthdate',
                    'blood_group',
                    'company',
                    'current_location',
                    'job',
                    'mail',
                    'name',
                    'residence',
                    'sex',
                    'ssn',
                    'username',
                    'website'
                ],
                sex='M'
            ),

            fake.simple_profile(),
            fake.simple_profile(
                sex=None  # 既定
            ),
            fake.simple_profile(
                sex='F'
            ),

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-python" name="python"></a>

#### python

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/python.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.pybool(),

            fake.pydecimal(),
            fake.pydecimal(
                left_digits=None,  # 既定
                right_digits=None,
                positive=False,
                min_value=None,
                max_value=None
            ),
            fake.pydecimal(
                left_digits=10,
                right_digits=6,
                positive=True,
                min_value=1000,
                max_value=100000000
            ),

            fake.pydict(),
            fake.pydict(
                nb_elements=10,  # 既定
                variable_nb_elements=True,
                value_types=None
            ),

            fake.pyfloat(),
            fake.pyfloat(
                left_digits=None,  # 既定
                right_digits=None,
                positive=False,
                min_value=None,
                max_value=None
            ),

            fake.pyint(),
            fake.pyint(
                min_value=0,  # 既定
                max_value=9999,
                step=1
            ),

            fake.pyiterable(
                nb_elements=10,  # 既定
                variable_nb_elements=True,
                value_types=None
            ),

            fake.pylist(),
            fake.pylist(
                nb_elements=10,  # 既定
                variable_nb_elements=True,
                value_types=None
            ),

            fake.pyset(),
            fake.pyset(
                nb_elements=10,  # 既定
                variable_nb_elements=True,
                value_types=None
            ),

            fake.pystr(),
            fake.pystr(
                min_chars=None,  # 既定
                max_chars=20
            ),

            fake.pystr_format(),
            fake.pystr_format(
                string_format='?#-###{{random_int}}{{random_letter}}',  # 既定
                letters='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'
            ),

            fake.pystruct(),
            fake.pystruct(
                count=10,  # 既定
                value_types=None
            ),

            fake.pytuple(),
            fake.pytuple(
                nb_elements=10,  # 既定
                variable_nb_elements=True,
                value_types=None
            )

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-ssn" name="ssn"></a>

#### ssn

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/ssn.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.ssn()

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-user_agent" name="user_agent"></a>

#### user_agent

```ps
$ pip install Faker
```

```py
from datetime import datetime

from collections import OrderedDict
from faker import Faker
import csv

with open('test-faker/user_agent.csv', 'w+', encoding='utf-8', newline='') as f:
    csv_writer = csv.writer(f)
    fake = Faker()
    # fake_jp = Faker('ja_JP')
    for i in range(100):
        l = [

            fake.android_platform_token(),

            fake.chrome(),
            fake.chrome(
                version_from=13,  # 既定
                version_to=63,
                build_from=800,
                build_to=899
            ),

            fake.firefox(),

            fake.internet_explorer(),

            fake.ios_platform_token(),

            fake.linux_platform_token(),

            fake.linux_processor(),

            fake.mac_platform_token(),

            fake.mac_processor(),

            fake.opera(),

            fake.safari(),

            fake.user_agent(),

            fake.windows_platform_token(),

        ]
        csv_writer.writerow(l)
        if 0 == i % 100:
            t = [datetime.now().strftime("%Y/%m/%d %H:%M:%S.%f")]
            csv_writer.writerow(t)

```

<a id="markdown-暗号" name="暗号"></a>

## 暗号

<a id="markdown-aes-による暗号化・復号化" name="aes-による暗号化・復号化"></a>

### AES による暗号化・復号化

PyCryptodome をインストールする

```ps
$ pip install pycryptodome
```

- [test-aes/aes_cipher.py](test-aes/aes_cipher.py)

```py
#!/usr/bin/env python
# -*- coding: utf-8 -*-

import base64
import hashlib
from Crypto import Random
from Crypto.Cipher import AES
from Crypto.Util import Padding

class AESCipher(object):
    def __init__(self, key):
        self.key = (hashlib.md5(key.encode('utf-8')).hexdigest()).encode('utf-8')

    def encrypt(self, raw):
        iv = Random.get_random_bytes(AES.block_size)
        cipher = AES.new(self.key, AES.MODE_CBC, iv)
        data = Padding.pad(raw.encode('utf-8'), AES.block_size, 'pkcs7')
        return base64.b64encode(iv + cipher.encrypt(data))

    def decrypt(self, enc):
        enc = base64.b64decode(enc)
        iv = enc[:AES.block_size]
        cipher = AES.new(self.key, AES.MODE_CBC, iv)
        data = Padding.unpad(cipher.decrypt(enc[AES.block_size:]), AES.block_size, 'pkcs7')
        return data.decode('utf-8')
```

- [test-aes/main.py](test-aes/main.py)

```py
import random
import string
from aes_cipher import AESCipher


key_text = ''.join([random.choice(string.ascii_letters + string.digits) for i in range(32)])
plain_text = 'test message.'


cipher = AESCipher(key_text)

encrypted = cipher.encrypt(plain_text)
print(encrypted)

decrypted = cipher.decrypt(encrypted)
print(decrypted)
print(decrypted == plain_text)
```

<a id="markdown-06-300-5000-多要素認証otp" name="06-300-5000-多要素認証otp"></a>

### 06-300-5000-多要素認証（OTP）

PyOTP をインストールする

```sh
$ pip install pyotp
$ pip install Pillow qrcode
```

```py
import pyotp
import time

# Secret Keyを生成する
base32string = pyotp.random_base32() # 'K4F6XO3AIYXH4FVW'
# 16進表記が必要な場合は
# base32string = pyotp.random_hex() # '9542701255ACF6D13D1003104BFA0F19'

totp = pyotp.TOTP(base32string)
code = totp.now() # 現在時刻に対応する認証コード # '871029'
print(code)

totp.verify(code) # True
time.sleep(30) # 30秒経過すると
totp.verify(code) # => False
```

```py
import pyotp

# Secret Keyを生成する
base32string = pyotp.random_base32()

# クライアントアプリに送付するURIを生成
uri = pyotp.TOTP(base32string).provisioning_uri(name="foo@example.net", issuer_name="My App")
print(uri)
# 'otpauth://totp/My%20App:foo%40example.net?secret=PIE6K3PKCM7WWFR3&issuer=My%20App'


# QRコードを生成
import qrcode
import sys
import time

filename = 'result.png'

img = qrcode.make(uri)
img.save(filename)

from PIL import Image
Image.open(filename).show()


# サーバー側コードを生成
totp = pyotp.TOTP(base32string)

print('-' * 30)
for i in range(2):
    print(totp.now()) # クライアントアプリで表示される認証コードと揃っているか確認
    for i in range(30):
        time.sleep(1)
        print('.', end='')
        sys.stdout.flush()
    print('')
    sys.stdout.flush()
```

<a id="markdown-ネットワーク" name="ネットワーク"></a>

## ネットワーク

<a id="markdown-url-文字列の操作" name="url-文字列の操作"></a>

### URL 文字列の操作

<a id="markdown-url-エンコーディング" name="url-エンコーディング"></a>

#### URL エンコーディング

```py
from urllib import parse

# エンコード
print(parse.quote('検索クエリ', encoding='utf-8'))

# デコード
print(parse.unquote('%E6%A4%9C%E7%B4%A2%E3%82%AF%E3%82%A8%E3%83%AA', encoding='utf-8'))
```

> %E6%A4%9C%E7%B4%A2%E3%82%AF%E3%82%A8%E3%83%AA
>
> 検索クエリ

<a id="markdown-変換対象の文字の違いと利用する関数" name="変換対象の文字の違いと利用する関数"></a>

##### 変換対象の文字の違いと利用する関数

```py
print(urllib.parse.quote('+ /'))
print(urllib.parse.quote_plus('+ /'))
print(urllib.parse.quote_plus('+ /', safe='+/'))
```

> %2B%20/
>
> %2B+%2F
>
> ++/

```py
print(urllib.parse.unquote('a+b'))
print(urllib.parse.unquote_plus('a+b'))
```

> a+b
>
> a b

<a id="markdown-url-の一部の要素に日本語が含まれている場合" name="url-の一部の要素に日本語が含まれている場合"></a>

##### URL の一部の要素に日本語が含まれている場合

```py
from urllib.parse import urlparse
import urllib.request

url = 'https://httpbin.org/get/?q=日本語'
p = urlparse(url)
url = '{}://{}{}{}{}{}{}{}{}'.format(
    p.scheme, p.netloc, p.path,
    ';' if p.params else '', p.params,
    '?' if p.query else '', urllib.parse.quote_plus(p.query, safe='=&'),
    '#' if p.fragment else '', p.fragment)
print(url)
response = urllib.request.urlopen(url)
```

<a id="markdown-url-文字列のパース" name="url-文字列のパース"></a>

#### URL 文字列のパース

```py
from urllib import parse

parts = parse.urlparse('https://example.net/user?id=12345&pw=678&q='+'%E6%A4%9C%E7%B4%A2%E3%82%AF%E3%82%A8%E3%83%AA')
print(parts)
print(parts.path)
print(parse.parse_qs(parts.query))

```

> ParseResult(scheme='https', netloc='example.net', path='/user', params='', query='id=12345&pw=678&q=%E6%A4%9C%E7%B4%A2%E3%82%AF%E3%82%A8%E3%83%AA', fragment='')
>
> /user
>
> {'id': ['12345'], 'pw': ['678'], 'q': ['検索クエリ']}

<a id="markdown-url-文字列の組み立て" name="url-文字列の組み立て"></a>

#### URL 文字列の組み立て

```py
from urllib import parse

new_query = parse.urlencode({'id': ['12345'], 'pw': ['678'], 'q': ['検索クエリ']}, True)
print(new_query)


parts = parse.urlparse('https://example.net/user?id=12345&pw=678&q='+'%E6%A4%9C%E7%B4%A2%E3%82%AF%E3%82%A8%E3%83%AA')
print(parts)
new_url = parse.ParseResult(parts.scheme, parts.netloc, parts.path, parts.params, new_query, parts.fragment).geturl()
print(new_url)
```

> id=12345&pw=678&q=%E6%A4%9C%E7%B4%A2%E3%82%AF%E3%82%A8%E3%83%AA
>
> ParseResult(scheme='https', netloc='example.net', path='/user', params='', query='id=12345&pw=678&q=%E6%A4%9C%E7%B4%A2%E3%82%AF%E3%82%A8%E3%83%AA', fragment='')
>
> https://example.net/user?id=12345&pw=678&q=%E6%A4%9C%E7%B4%A2%E3%82%AF%E3%82%A8%E3%83%AA

<a id="markdown-リクエストを送信" name="リクエストを送信"></a>

### リクエストを送信

`urllib` モジュールではなく `Requests` モジュールを利用する場合、以下のコマンドでインストールする

```sh
$ pip install requests
```

<a id="markdown-コンテンツを文字列として取得" name="コンテンツを文字列として取得"></a>

#### コンテンツを文字列として取得

```py
import urllib.request
url = 'http://httpbin.org'

try:
    with urllib.request.urlopen(url) as response:
        html = response.read()
        print(html)
except urllib.error.HTTPError as e:
    print(e.code)
    print(e.read())
```

```py
import urllib.request
url = 'http://httpbin.org'
req = urllib.request.Request(url) # , method='GET')

try:
    with urllib.request.urlopen(req) as response:
        html = response.read()
        print(html)
except urllib.error.HTTPError as e:
    print(e.code)
    print(e.read())
```

```py
import requests
url = 'http://httpbin.org'
response = requests.get(url)
if response.status_code == requests.codes.ok:
    # コンテンツ
    print(response.text)
else:
    # ステータスコード
    print(response.status_code)
```

<a id="markdown-文字コードを指定" name="文字コードを指定"></a>

#### 文字コードを指定

<a id="markdown-特定の文字コードshift-jisを指定" name="特定の文字コードshift-jisを指定"></a>

##### 特定の文字コード(Shift-JIS)を指定

```py
import urllib.request
url = 'http://www.soumu.go.jp/'

try:
    with urllib.request.urlopen(url) as response:
        html = response.read().decode('shift_jis')
        print(html)
except urllib.error.HTTPError as e:
    print(e.code)
    print(e.read())
```

```py
import requests
url = 'http://www.soumu.go.jp/'
response = requests.get(url)

# ステータスコードを確認
if response.status_code == 200:
    response.encoding = 'Shift_JIS'
    print(response.text)
```

<a id="markdown-コンテンツの内容から文字コードを推定する" name="コンテンツの内容から文字コードを推定する"></a>

##### コンテンツの内容から文字コードを推定する

<a id="markdown-chardet-による推定" name="chardet-による推定"></a>

###### chardet による推定

```py
import requests
url = 'http://www.soumu.go.jp/'
response = requests.get(url)

# リターンコードを確認
if response.status_code == 200:
    response.encoding = response.apparent_encoding
    print(response.text)
```

<a id="markdown-cchardet-による推定chardet-よりも高速" name="cchardet-による推定chardet-よりも高速"></a>

###### cChardet による推定(chardet よりも高速)

```sh
$ pip install cchardet
```

```py
import cchardet
import requests
url = 'http://www.soumu.go.jp/'
response = requests.get(url)
if response.status_code == 200:
    response.encoding = cchardet.detect(response.content)['encoding']
    print(response.text)
```

<a id="markdown-コンテンツをテンポラリファイルとして取得" name="コンテンツをテンポラリファイルとして取得"></a>

#### コンテンツをテンポラリファイルとして取得

```py
import urllib.request
url = 'http://httpbin.org/get'
local_filename, headers = urllib.request.urlretrieve(url)
with open(local_filename) as f:
    string = f.read()

print(local_filename)
```

> C:\\Users\\y\\AppData\\Local\\Temp\\tmptkscpwv4

<a id="markdown-バイナリファイルを保存" name="バイナリファイルを保存"></a>

#### バイナリファイルを保存

```py
import os
import urllib.request
url = 'http://httpbin.org/image'
with urllib.request.urlopen(url) as response:
    with open(os.path.basename(url), 'wb') as localfile:
        localfile.write(response.read())
```

> 8090

```py
import os
import requests
url = 'https://www.python.org/static/img/python-logo.png'

def wget(url, file_name):
    r = requests.get(url, stream=True)
    if r.status_code == 200:
        with open(file_name, 'wb') as f:
            f.write(r.content)

wget(url, os.path.basename(url))
```

<a id="markdown-画像ファイルの保存" name="画像ファイルの保存"></a>

##### 画像ファイルの保存

```sh
$ pip install Image requests StringIO
```

```py
import os
import requests
from PIL import Image
from io import BytesIO
url = 'https://www.python.org/static/img/python-logo.png'
r = requests.get(url)
i = Image.open(BytesIO(r.content))
i.save(os.path.basename(url))
```

<a id="markdown-大容量ファイルの保存" name="大容量ファイルの保存"></a>

##### 大容量ファイルの保存

```py
import os
import requests
url = 'https://www.python.org/static/img/python-logo.png'
r = requests.get(url, stream=True)
if r.status_code == 200:
    with open(os.path.basename(url), 'wb') as file:
        for chunk in r.iter_content(chunk_size=1024):
            file.write(chunk)
```

<a id="markdown-get" name="get"></a>

#### GET

```py
import urllib.parse
import urllib.request

url = 'http://httpbin.org/get'

with urllib.request.urlopen(url) as response:
    html = response.read()
    print(html)

# クエリを送信
params = {}
params['name'] = 'Sato'
params['location'] = 'Tokyo'
params['age'] = '30'
query = urllib.parse.urlencode(params)
url = url + '?' + query

with urllib.request.urlopen(url) as response:
    html = response.read()
    print(html)
```

```py
import requests
url = 'http://httpbin.org/get'
r = requests.get(url)
print(r.text)

# クエリを送信
import requests
r = requests.get('http://httpbin.org/get', params={'key':'value'})
print(r.url) # http://httpbin.org/get?key=value
print(r.text)

# 応答
import requests
url = 'http://httpbin.org/get'
r = requests.get(url)

print(r.headers)

print(r.text)

print(r.status_code)  # レスポンスコード
print(r.status_code == requests.codes.ok)  # 200か判定

r.raise_for_status() # エラー時に例外を発生させる
# requests.exceptions.HTTPError

print(r.encoding)  # 文字エンコードの確認
r.encoding = 'Shift-JIS'  # 文字コードの設定(変更)
print(r.text)  # 変更後のエンコーディングが使用される

# リダイレクト
import requests
url = 'http://httpbin.org/get'
# r = requests.get(url, allow_redirects=True)
r = requests.get(url)
print(r.history) # リダイレクト結果を確認する

r = requests.get(url, allow_redirects=False) # リダイレクトさせない
print(r.text)

# タイムアウト
import requests
url = 'https://httpbin.org/deley/5'
r = requests.get(url, timeout=1)
print(r.text)

# JSON
import json
import requests
url = 'http://httpbin.org/json'
r = requests.get(url)
data = r.json()
print(json.dumps(data, indent=4))
```

<a id="markdown-post" name="post"></a>

#### POST

```py
import urllib.parse
import urllib.request

url = 'http://httpbin.org/post'

params = {'name': 'Sato', 'location': 'Tokyo',  'age': '30'}

req = urllib.request.Request(url, urllib.parse.urlencode(params).encode('ascii')) # , method='POST')
with urllib.request.urlopen(req) as response:
    html = response.read()
    print(html)
```

```py
import requests

params = {'name': 'Sato', 'location': 'Tokyo',  'age': '30'}
r = requests.post('http://httpbin.org/post', data=params)
print(r.url)  # 生成されたURL(POSTなのでクエリ文字列がないことを確認)

import json
print(json.loads(res.content.decode())['form']) # {'age': '30', 'location': 'Tokyo', 'name': 'Sato'}
```

<a id="markdown-フォーム送信multipart-エンコード" name="フォーム送信multipart-エンコード"></a>

##### フォーム送信(Multipart エンコード)

```py
import requests
url = 'http://httpbin.org/post'
files = {'file': open('test.png', 'rb')}
r = requests.post(url, files=files)

import requests
url = 'http://httpbin.org/post'
files = {'file': ('test.png', open('test.png', 'rb'))}
r = requests.post(url, files=files)

import requests
url = 'http://httpbin.org/post'
files = {'file': ('test.txt', 'foobar')}
r = requests.post(url, files=files)
```

<a id="markdown-put" name="put"></a>

#### PUT

```py
import requests
url = 'http://httpbin.org/put'
r = requests.put(url)
```

<a id="markdown-delete" name="delete"></a>

#### DELETE

```py
import requests
url = 'http://httpbin.org/delete'
r = requests.delete(url)
```

<a id="markdown-head" name="head"></a>

#### HEAD

```py
import requests
url = 'http://httpbin.org/get'
r = requests.head(url)
```

<a id="markdown-http-ヘッダ" name="http-ヘッダ"></a>

#### HTTP ヘッダ

```py
import urllib.parse
import urllib.request

url = 'http://httpbin.org/headers'

user_agent = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/xxx.xx (KHTML, like Gecko) Chrome/xx.x.xxxx.xx Safari/xxx.xx'
headers = {'User-Agent': user_agent} # ユーザーエージェント

params = {'name': 'Sato', 'location': 'Tokyo',  'age': '30'}

# headers引数
req = urllib.request.Request(url, data=urllib.parse.urlencode(params).encode('ascii'), method='GET', headers=headers)
with urllib.request.urlopen(req) as response:
    html = response.read()
    print(html)

# add_header()
req = urllib.request.Request(url, data=query.encode('ascii'), method='GET')
req.add_header('Referer', 'http://httpbin.org/')
with urllib.request.urlopen(req) as response:
    html = response.read()
    print(html)
```

```py
import requests
url = 'http://httpbin.org/headers'
user_agent = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/xxx.xx (KHTML, like Gecko) Chrome/xx.x.xxxx.xx Safari/xxx.xx'
headers = {'User-Agent': user_agent, 'Referer': 'http://httpbin.org/'}

payload = {'key1': 'val1', 'key2': 'val2'}

r = requests.get(url, data=json.dumps(payload), headers=headers)
print(r.status_code)
print(r.content)
```

<a id="markdown-basic-認証" name="basic-認証"></a>

#### BASIC 認証

```py
import urllib.request
import getpass

url = 'http://httpbin.org/basic-auth/Username/Password'
auth_user = 'Username'
auth_passwd = 'Password'

passman = urllib.request.HTTPPasswordMgrWithDefaultRealm()
# If we knew the realm, we could use it instead of None.
passman.add_password(None, url, auth_user, auth_passwd)
# HTTPBasicAuthHandler or HTTPDigestAuthHandler
authhandler = urllib.request.HTTPBasicAuthHandler(passman)
opener = urllib.request.build_opener(authhandler)
urllib.request.install_opener(opener)

with urllib.request.urlopen(url) as response:
    html = response.read()
```

<a id="markdown-応答ヘッダ・リダイレクト先-url" name="応答ヘッダ・リダイレクト先-url"></a>

#### 応答ヘッダ・リダイレクト先 URL

```py
import urllib.parse
import urllib.request

url = 'http://httpbin.org/'
user_agent = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/xxx.xx (KHTML, like Gecko) Chrome/xx.x.xxxx.xx Safari/xxx.xx'
headers = {'User-Agent': user_agent}

params = {'name': 'Sato', 'location': 'Tokyo',  'age': '30'}

req = urllib.request.Request(url, urllib.parse.urlencode(params).encode('ascii'), headers) # , method='POST')
with urllib.request.urlopen(req) as response:
    url = response.geturl()
    headers = response.info()
    print(headers)
    # charset=req.info().get_content_charset() # 応答ヘッダから文字コードを取得してデコードする例
    # content=req.read().decode(charset)
```

<a id="markdown-セッション" name="セッション"></a>

#### セッション

```py
import requests

session = requests.Session()
r1 = session.get('http://httpbin.org/cookies/set/key1/value1')
r2 = session.get('http://httpbin.org/cookies')
print(r2.text)
```

> {
>
> "cookies": {
>
>     "key1": "value1"
>
> }
>
> }

```py
import requests

session = requests.Session()

# 共通する項目を設定
session.auth = ('Username', 'Password')
session.headers.update({'x-key0': 'value0'})

r = session.get('http://httpbin.org/headers', headers={'x-key1': 'value1'})
print(r.text)

# 個別項目を設定
r = session.get('http://httpbin.org/headers', headers={'x-key2': 'value2'})
print(r.text)
```

```json
{
  "headers": {
    "Accept": "*/*",
    "Accept-Encoding": "gzip, deflate",
    "Host": "httpbin.org",
    "User-Agent": "python-requests/2.22.0",
    "X-Key0": "value0",
    "X-Key1": "value1"
  }
}

{
  "headers": {
    "Accept": "*/*",
    "Accept-Encoding": "gzip, deflate",
    "Host": "httpbin.org",
    "User-Agent": "python-requests/2.22.0",
    "X-Key0": "value0",
    "X-Key2": "value2"
  }
}
```

<a id="markdown-cookie" name="cookie"></a>

#### Cookie

```py
import requests

# 設定
url = 'http://httpbin.org/get'
cookies = dict(key1='val1')
r = requests.get(url, cookies=cookies)

# 取得
url = 'http://httpbin.org/cookies/set/key1/value1'
r = requests.get(url)
r.cookies['key1']  # Cookieが存在する場合は非None
```

<a id="markdown-例外処理とレスポンスコード" name="例外処理とレスポンスコード"></a>

#### 例外処理とレスポンスコード

```py
import urllib.request
url = 'http://httpbin.org'
req = urllib.request.Request(url)
try:
    with urllib.request.urlopen(req) as res:
        body = res.read()
except urllib.error.HTTPError as e:
    print(e.code)
except URLError as e:  # URLErrorはHTTPErrorも拾う
    print(e.code)
    print(e.read())

    if hasattr(e, 'reason'):
        print('Reason: ', e.reason)
    elif hasattr(e, 'code'):
        print('Error code: ', e.code)
else:
    pass  # リクエストに成功
```

```py
import requests
url = 'http://httpbin.org'
try:
    r = requests.get(url)
except requests.exceptions.RequestException as e:
    print('Error: {}'.format(e))
```

<a id="markdown-selenium" name="selenium"></a>

### Selenium

<a id="markdown-selenium-の準備" name="selenium-の準備"></a>

#### Selenium の準備

```sh
$ pip install selenium
```

```py
from selenium import webdriver


driver = webdriver.Chrome()
driver = webdriver.Firefox()
```

<a id="markdown-パスを指定" name="パスを指定"></a>

##### パスを指定

```py
from selenium import webdriver


# (A) ドライバーのパスを指定
#  (A-a) Chrome
#    # driver = webdriver.Chrome(executable_path='/path/to/chromedriver')
#  (A-b) Firefox
#    # driver = webdriver.Firefox(executable_path='/path/to/geckodriver')

# (B) ブラウザのパスを指定
#  (B-a) Chrome
#    # from selenium.webdriver.chrome.options import Options
#
#    # options = Options()
#    # options.binary_location = '/path/to/chrome'
#    # # options.add_argument('--headless')
#
#    # driver = webdriver.Chrome(
#    #     chrome_options=options,
#    #     executable_path='/path/to/chromedriver'
#    # )

#  (B-b) Firefox
from selenium.webdriver.firefox.options import Options
from selenium.webdriver.firefox.firefox_binary import FirefoxBinary

profile = webdriver.FirefoxProfile()
profile.set_preference('browser.download.dir', os.getcwd())
profile.update_preferences()

opts = Options()
opts.log.level = 'trace'
# opts.headless = True

fox_mac_path = '/Applications/Firefox.app/Contents/MacOS/firefox'
gecko_mac_path = '/Users/yu/webdriver/gecko/v0.28.0/geckodriver-v0.28.0-macos/geckodriver'
driver = webdriver.Firefox(
    firefox_binary=FirefoxBinary(fox_mac_path),
    firefox_profile=profile,
    executable_path=gecko_mac_path,
    options=opts
)


driver.get('https://www.google.co.jp/')
```

<a id="markdown-webdriver-manager-for-python" name="webdriver-manager-for-python"></a>

##### Webdriver Manager for Python

[Webdriver Manager for Python](https://github.com/SergeyPirogov/webdriver_manager)

```sh
$ pip install webdriver-manager
```

<a id="markdown-chrome" name="chrome"></a>

###### Chrome

```py
import requests
from selenium import webdriver
from webdriver_manager.utils import chrome_version
from webdriver_manager.chrome import ChromeDriverManager


version = chrome_version()
url = 'http://chromedriver.storage.googleapis.com/LATEST_RELEASE_' + version
response = requests.get(url)
driver = webdriver.Chrome(
    executable_path=ChromeDriverManager(response.text).install()
)
```

<a id="markdown-chromium" name="chromium"></a>

###### Chromium

```py
from selenium import webdriver
from webdriver_manager.chrome import ChromeDriverManager
from webdriver_manager.utils import ChromeType


version = chrome_version(ChromeType.CHROMIUM)
url = 'http://chromedriver.storage.googleapis.com/LATEST_RELEASE_' + version
response = requests.get(url)
driver = webdriver.Chrome(
    executable_path=ChromeDriverManager(chrome_type=ChromeType.CHROMIUM).install()
)
```

<a id="markdown-firefox" name="firefox"></a>

###### Firefox

```py
from selenium import webdriver
from webdriver_manager.firefox import GeckoDriverManager


driver = webdriver.Firefox(
    executable_path=GeckoDriverManager().install()
)
```

<a id="markdown-webdrivermanager" name="webdrivermanager"></a>

##### webdrivermanager

```sh
$ pip install webdrivermanager
```

<a id="markdown-chrome-1" name="chrome-1"></a>

###### Chrome

```py
from webdriverdownloader import  ChromeDriverDownloader


gdd =  ChromeDriverDownloader()
gdd.download_and_install('87.0.4280.20')
```

<a id="markdown-firefox-1" name="firefox-1"></a>

###### Firefox

```py
from webdriverdownloader import GeckoDriverDownloader


gdd = GeckoDriverDownloader()
gdd.download_and_install('v0.28.0')
```

<a id="markdown-web-ページにアクセス" name="web-ページにアクセス"></a>

#### Web ページにアクセス

```py
import datetime
import os


from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.support.ui import WebDriverWait


def get_filepath():
    now = datetime.datetime.now()
    filename = 'screen_{0:%Y%m%d%H%M%S}.png'.format(now)
    filepath = os.path.join(
        '.', # os.path.dirname(os.path.abspath(__file__)),
        filename
    )
    return filepath


def submit(driver, name):
    WebDriverWait(driver, 60).until(EC.element_to_be_clickable((By.NAME, name))).click()


def clearAndSendKeys(driver, name, text):
    driver.find_element_by_name(name).clear()
    driver.find_element_by_name(name).send_keys(text)


# (A) PATHの設定などを済ませている場合
#  (A-a) Chrome
#    # driver = webdriver.Chrome()
# (A-b) Firefox
#    # driver = webdriver.Firefox()

# (B) webdriver-managerを使用する場合
#  (B-a) Chrome
#    # import requests
#    # from webdriver_manager.utils import chrome_version
#    # from webdriver_manager.chrome import ChromeDriverManager
#    # version = chrome_version()
#    # url = 'http://chromedriver.storage.googleapis.com/LATEST_RELEASE_' + version
#    # response = requests.get(url)
#    # driver = webdriver.Chrome(executable_path=ChromeDriverManager(response.text).install())
# (B-b) Firefox
from webdriver_manager.firefox import GeckoDriverManager
driver = webdriver.Firefox(executable_path=GeckoDriverManager().install())
#


driver = webdriver.Firefox()
driver.set_window_size(1280, 720)

driver.get('https://www.google.co.jp/')
# ウィンドウサイズをページのサイズに合わせる
# w = driver.execute_script('return document.body.scrollWidth')
# h = driver.execute_script('return document.body.scrollHeight')
# driver.set_window_size(int(w), int(h))

WebDriverWait(driver, 60).until(EC.presence_of_element_located((By.NAME, 'q')))
driver.save_screenshot(get_filepath())

clearAndSendKeys(driver, 'q', 'Selenium')
submit(driver, 'btnK')
driver.save_screenshot(get_filepath())


# 要素を取得
from selenium.webdriver.common.by import By


# find_element
driver.find_element(By.XPATH, '//*[contains(., "Google")]').text

for elem in driver.find_elements(By.XPATH, '//input'):
    elem.get_attribute('type')

#
for elem in driver.find_elements(By.XPATH, '//input[@type="submit"]'):
    elem.get_attribute('type')

# 要素の指定方法
# By.ID
driver.find_element_by_id('loginForm')

# NAME
driver.find_element_by_name('username')

# XPATH
driver.find_element_by_xpath("/html/body/form[1]")

# LINK_TEXT
driver.find_element_by_link_text('Continue')

# PARTIAL_LINK_TEXT
find_element_by_partial_link_text('Conti')

# TAG_NAME
driver.find_element_by_tag_name('h1')

# CLASS_NAME
driver.find_element_by_class_name('content')

# CSS_SELECTOR
driver.find_element_by_css_selector('p.content')
```

<a id="markdown-クラス" name="クラス"></a>

# クラス

```py
class MyClass:
    '''docstring of MyClass'''

    # クラス変数
    id = 1
    name = 'n1'
    publicClassVariable = 10

    # プライベートクラス変数
    __privateClassVariable = 20

    # コンストラクタ
    def __init__(self, iv1, iv2):
        self.publicInstanceVariable = iv1       # インスタンス変数
        self.__privateInstanceVariable = iv2    # プライベートインスタンス変数

    # デストラクタ
    def __del__(self):
        del(self.publicInstanceVariable)
        del(self.__privateInstanceVariable)

    # 正式な文字列表現(__str__が定義されていないときに呼び出される)
    def __repr__(self):
        return '{}[ID:{}]'.format(self.name, self.id)

    # 非公式な文字列表現(print、format、strなどの組み込み関数でオブジェクトを指定したときに呼び出される)
    def __str__(self):
        return 'MyClass: ' + self.__privateInstanceVariable

    def __unicode__(self):
        return '__unicode__'

    # ゲッター（getter）
    def getName(self):
        return self.__privateInstanceVariable

    # セッター（setter）
    def setName(self, name):
        self.__privateInstanceVariable = name

    # プロパティ（ゲッター・セッタとは異なり、プロパティ名でアクセスできる）
    @property
    def name(self):
        return self.__privateInstanceVariable
    @x.setter
    def name(self, value):
        self.__privateInstanceVariable = value

    # 通常メソッド
    def Calc(self):
        self.publicInstanceVariable2 = 3
        print('パブリックメソッド')

    def __MyCalc(self):
        print('プライベートメソッド')

    @classmethod
    def SelfName(cls):
        publicClassVariable2 = 30
        print('パブリックメソッド')

    @classmethod
    def __PrivateSelfName(cls):
        print('プライベートクラスメソッド')


# インスタンス変数
myClass1.publicInstanceVariable = 3

# インスタンス変数の追加
myClass1.publicInstanceVariable3 = 4

# プライベートインスタンス変数にアクセス
# インスタンス._クラス名__変数名
print(myClass1._MyClass__publicInstanceVariable)

# パプリッククラス変数へアクセス
# インスタンス名でもクラス名でも可
# 　インスタンス変数が存在しない場合は「インスタンス.変数名」はクラス変数を参照するが、
# 　値を代入するとインスタンス変数が追加されるため、それ以降はインスタンス変数が参照される)
print(Widget.classVal)
print(w.classVal)

# クラス変数の追加
MyClass.publicClassVariable3 = 40

# プライベートクラス変数にアクセス
# インスタンス._クラス名__変数名
print(myClass1._MyClass__privateInstanceVariable)


myClass1 = MyClass(1, 2)    # インスタンス化
myClass1.getName()          # メソッド実行
mg = myClass1.getName       # 別名
mg()                        # メソッド実行
```

<a id="markdown-オブジェクトの文字列表現" name="オブジェクトの文字列表現"></a>

## オブジェクトの文字列表現

```py
class MyClass:

    id = 1
    name = 'n1'

    # 正式な文字列表現(__str__が定義されていないときに呼び出される)
    def __repr__(self):
        return 'repr: {}[ID:{}]'.format(self.name, self.id)

    # 非公式な文字列表現(print、format、strなどの組み込み関数でオブジェクトを指定したときに呼び出される)
    def __str__(self):
        return 'str: {}[ID:{}]'.format(self.name, self.id)

    def __unicode__(self):
        return 'unicode: {}[ID:{}]'.format(self.name, self.id)


myClass1 = MyClass()
print("myClass1: " + myClass1)
print("myClass1: " + str(myClass1))
```

> TypeError: can only concatenate str (not "MyClass") to str
>
> myClass1: str: n1[ID:1]

<a id="markdown-オブジェクトの属性の参照と存在チェック" name="オブジェクトの属性の参照と存在チェック"></a>

## オブジェクトの属性の参照と存在チェック

```py
class MyClass:
    publicClassVariable = 10
    __privateClassVariable = 20
    def __init__(self):
        self.val1 = 10
        self.val2 = 20

myClass = MyClass()

# 属性のリスト
print(dir(myClass))

# dict属性（オブジェクトを辞書と見なしたもの。デバッグ表示に使える）
print(vars(myClass))
print(myClass.__dict__)

for key, value in myClass.__dict__.items():
    print(key, ':', value)

# 属性値の参照
print(myClass.publicClassVariable)

# 属性の存在チェック
hasattr(myClass, 'publicClassVariable')
hasattr(myClass, '__privateClassVariable')
```

> # 属性のリスト
>
> ['_MyClass__privateClassVariable', '__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__', 'publicClassVariable', 'val1', 'val2']

> # dict 属性
>
> {'val1': 10, 'val2': 20}
>
> {'val1': 10, 'val2': 20}
>
> ---
>
> val1 : 10
>
> val2 : 20

> # 属性値の参照
>
> 10

> # 属性の存在チェック
>
> True
>
> False

<a id="markdown-クラスの継承" name="クラスの継承"></a>

## クラスの継承

```py
class MySubClass(MyClass):
    def Calc(self):  # オーバーロード
        print('sub  a')
```

<a id="markdown-多重継承" name="多重継承"></a>

### 多重継承

```py
class A(object):
    def __init__(self):
        print 'Initialize A.'

    def method(self):
        print 'Call A method.'


class B(object):
    def __init__(self):
        print 'Initialize B.'

    def method(self):
        print 'Call B method.'


class C(object):
    def __init__(self):
        print 'Initialize C.'

    def method(self):
        print 'Call C method.'


class Main(A, B, C):
    def __init__(self):
        print('Initialize Main.')
        super(Main, self).__init__()
        super(A, self).__init__()
        super(B, self).__init__()

    def method(self):
        print('Call Main method')
        super(Main, self).method()
        super(A, self).method()
        super(B, self).method()


m = Main()
m.method()
```

<a id="markdown-モジュール" name="モジュール"></a>

# モジュール

<a id="markdown-モジュールの読み込み" name="モジュールの読み込み"></a>

## モジュールの読み込み

```py
# import <モジュール名>
import os

print(type(os))

print(os)

print(type(os.path.join))

print(type(os.sep))
```

> \<class 'module'\>
>
> \<module 'os' from '/home/y/.pyenv/versions/3.6.8/lib/python3.6/os.py'\>
>
> \<class 'function'\>
>
> <class 'str'>

```py
from glob import glob, iglob
```

<a id="markdown-推奨される読み込み順序" name="推奨される読み込み順序"></a>

### 推奨される読み込み順序

1. 標準ライブラリ
2. サードパーティライブラリ
3. ローカルライブラリ（自作のライブラリ）

<a id="markdown-外部スクリプトの読み込み" name="外部スクリプトの読み込み"></a>

## 外部スクリプトの読み込み

- test-import/main.py

```py
# subfile.py
import subfile
subfile.hello()


# subdir/main.py
import subdir.main
subdir.main.hello()

# or

from subdir import main
main.hello()


# subdir/subfile.py
import subdir.subfile
subdir.subfile.hello()
```

- test-import/main2.py

```py
from subdir import *
main.hello()
subfile.hello()
```

- test-import/subfile.py

```py
def hello():
    print('test-import/subdir.py hello()')
```

- test-import/subdir/main.py

```py
def hello():
    print('test-import/subdir/main.py hello()')
```

- test-import/subdir/subfile.py

```py
def hello():
    print('test-import/subdir/subfile.py hello()')
```

- test-import/subdir/**init**.py

```py
from glob import glob
from importlib import import_module
import os
import re
import sys

def main():
    myself = sys.modules[__name__]
    mod_paths = glob(os.path.join(os.path.dirname(os.path.abspath(__file__)), '*.py'))
    for py_file in mod_paths:
        mod_name = os.path.splitext(os.path.basename(py_file))[0]
        if re.search('.*__init__.*',mod_name) is None:
            mod = import_module(__name__+ '.' + mod_name)
            for m in mod.__dict__.keys():
                if not m in ['__builtins__', '__doc__', '__file__', '__name__', '__package__']:
                    myself.__dict__[m] = mod.__dict__[m]
main()
```

```sh
$ python test-import/main.py
```

> test-import/subdir.py hello()
>
> test-import/subdir/main.py hello()
>
> test-import/subdir/main.py hello()
>
> test-import/subdir/subfile.py hello()

```sh
$ python test-import/main2.py
```

> test-import/subdir/main.py hello()
>
> test-import/subdir/subfile.py hello()

<a id="markdown-一時的にモジュール検索パスを追加" name="一時的にモジュール検索パスを追加"></a>

## 一時的にモジュール検索パスを追加

```py
import os
import sys

sys.path.append(os.path.join(os.path.dirname(__file__), '..'))
```

<a id="markdown-恒久的にモジュール検索パスを追加" name="恒久的にモジュール検索パスを追加"></a>

## 恒久的にモジュール検索パスを追加

```sh
export PYTHONPATH='/path/to/module:$PYTHONPATH'`
```

site-packages フォルダの中に、`*.pth`ファイル(ファイル名は任意)を作成し、各行にパスを追加

- example.ptn

```py
# foo package configuration

path/to/module
```

<a id="markdown-pip" name="pip"></a>

## pip

<a id="markdown-パッケージのインストール" name="パッケージのインストール"></a>

### パッケージのインストール

<a id="markdown-pip-自体のアップデート" name="pip-自体のアップデート"></a>

#### pip 自体のアップデート

```sh
$ pip install -U pip
```

<a id="markdown-requirementstxt-を基にしたインストール" name="requirementstxt-を基にしたインストール"></a>

#### requirements.txt を基にしたインストール

```sh
$ pip install -r requirements.txt
```

<a id="markdown-特定のバージョンのインストール" name="特定のバージョンのインストール"></a>

#### 特定のバージョンのインストール

```sh
$ pip install <package>==<version>
```

<a id="markdown-requirementstxt-の書き出し" name="requirementstxt-の書き出し"></a>

#### requirements.txt の書き出し

```sh
$ pip freeze > requirements.txt
```

<a id="markdown-requirementstxt-に書かれたパッケージのバージョンを更新" name="requirementstxt-に書かれたパッケージのバージョンを更新"></a>

##### requirements.txt に書かれたパッケージのバージョンを更新

以下のように更新したいパッケージを列挙した `requirements.in` を用意する。

```
django
opencv-python>=4.2,<5
opencv-contrib-python>=4.2,<5
```

```sh
$ pip install pip-tools
$ pip-compile requirements.in
$ pip install -r requirements.txt
```

条件を満たす最新のバージョンを反映した `requirements.txt` が生成され、標準出力にも出力される。

```
#
# This file is autogenerated by pip-compile
# To update, run:
#
#    pip-compile requirements.in
#
asgiref==3.2.10           # via django
django==3.1.1             # via -r requirements.in
numpy==1.19.1             # via opencv-contrib-python, opencv-python
opencv-contrib-python==4.4.0.42  # via -r requirements.in
opencv-python==4.4.0.42   # via -r requirements.in
pytz==2020.1              # via django
sqlparse==0.3.1           # via django
```

<a id="markdown-パッケージのアンインストール" name="パッケージのアンインストール"></a>

### パッケージのアンインストール

```sh
$ pip uninstall -y <package>
```

<a id="markdown-pydoc" name="pydoc"></a>

# pydoc

- python3md-pydoc.py

```py
#!/usr/bin/python
# coding: UTF-8

'''
ファイルの説明
'''
__author__ = 'YA-androidapp<ya.androidapp@gmail.com>'
# __status__ = 'production'
__status__ = 'dev'
__version__ = '0.0.1'
__date__    = '01 Aug. 2019'
class Util():
    '''
    クラスの説明
    '''
    def init():
        '''
        メソッドの説明
        '''
        pass

def main():
    print('main')

if __name__ == '__main__':
    main()
```

```sh
# コンソールに出力
$ pydoc python3md-pydoc

# HTMLファイルを生成
$ pydoc python3md-pydoc
```

<a id="markdown-mypy-による型チェック" name="mypy-による型チェック"></a>

# mypy による型チェック

- mypy をインストール

```sh
$ pip install mypy
```

- 型をチェック

問題なければ `Success: no issues found` と出力され、型が間違っているとエラーが出力される

```sh
$ mypy myscript.py
```

<a id="markdown-型の宣言" name="型の宣言"></a>

## 型の宣言

<a id="markdown-イミュータブルな型" name="イミュータブルな型"></a>

## イミュータブルな型

```py
#!/usr/bin/python3
# -*- coding: utf-8 -*-

boolvar: bool = True
intvar: int = 123
floatvar: float = 1.23
strvar: str = 'foo'

strvar = 'bar'
boolvar = 'hoge'
```

bool 型の変数に文字型の値を代入しようとしているのでエラーが出力される

> python/python3md-mypy.py:10: error: Incompatible types in assignment (expression has type "str", variable has type "bool")
>
> Found 1 error in 1 file (checked 1 source file)

<a id="markdown-ミュータブルな型" name="ミュータブルな型"></a>

## ミュータブルな型

```py
listvar: list = [1, 2, 3]
dictvar: dict = {1: 'foo', 2: 'bar'}
tplvar: tuple[str, str] = ('foo', 'bar')

# 要素の型も定義したい場合はtypingを利用する
from typing import List, Dict, Tuple
listvar: List[int] = [1, 2, 3]
dictvar: Dict[int, str] = {1: 'foo', 2: 'bar'}
tplvar: Tuple[int, str] = (1, 'foo')
```

```py
# 辞書型でキーと値の型を定義
from typing import TypedDict
User = TypedDict('User', {'name': str, 'age': int})

usr: User = {'name': 'Foo Bar', 'age': 17}
```

```py
# 可変長のタプルを定義
tplvar: Tuple[str, ...] = ('foo', 'bar', 'hoge', 'piyo')
```

<a id="markdown-複数の型" name="複数の型"></a>

## 複数の型

```py
from typing import Union

intstrvar: Union[int, str] = 123
intstrvar = 'foo'
intstrvar = 1.23
```

> error: Incompatible types in assignment (expression has type "float", variable has type "Union[int, str]")

<a id="markdown-none-を許容する" name="none-を許容する"></a>

## None を許容する

C#の null 許容値型に相当

```py
from typing import Optional

dictvar: Dict[int, str] = {1: 'foo'}
strnonevar: Optional[str] = dictvar.get(2)
```

> None

<a id="markdown-再代入しない変数final" name="再代入しない変数final"></a>

## 再代入しない変数（final）

```py
from typing import Final
strvar: Final[str] = 'foo'
```

<a id="markdown-def" name="def"></a>

## def

```py
def add_int(x: int, y: int) -> int:
    return x + y


def add_str(x: str, y: str) -> str:
    return x + y


# 戻り値がない場合
def show_values(x: int, y: int) -> None:
    print('{}, {}'.format(x, y))
```

<a id="markdown-class" name="class"></a>

## Class

```py
from dataclasses import dataclass

@dataclass
class User:
    name: str
    age: int
    def show_details(self) -> None:
        print('Name: {}, Age: {}'.format(self.name, self.age))


usr = User('Foo Bar', 17)
usr.show_details()
```

<a id="markdown-画像処理" name="画像処理"></a>

# 画像処理

<a id="markdown-pillowpil" name="pillowpil"></a>

## Pillow（PIL）

<a id="markdown-pillow-のインストール" name="pillow-のインストール"></a>

### Pillow のインストール

```sh
$ pip install Pillow
```

<a id="markdown-画像の生成" name="画像の生成"></a>

### 画像の生成

```py
from PIL import Image

im = Image.new(
    'RGB', # カラーモード
    (256, 256), # 大きさ
    (255, 128, 0) # 塗りつぶし色
)

im.show()
im.save('./test-pillow/image.png')
```

<a id="markdown-ノイズ画像の生成" name="ノイズ画像の生成"></a>

#### ノイズ画像の生成

<a id="markdown-ガウシアンノイズ" name="ガウシアンノイズ"></a>

##### ガウシアンノイズ

```py
from PIL import Image, ImageChops

noise = Image.effect_noise((256, 256), 100)
# noise = Image.effect_noise((256, 256), 10)

noise.show()
noise.save('./test-pillow/noise-gaus.png')

noise = noise.convert('RGB')

# 既存の画像にノイズを合成する
im = Image.open('./test-pillow/image.jpg').convert('RGB')
im = ImageChops.multiply(im, noise)
# im = ImageChops.screen(im, noise)

im.show()
im.save('./test-pillow/noise-gaus_multiply.png')
```

<a id="markdown-画像の読み込み" name="画像の読み込み"></a>

### 画像の読み込み

```py
import matplotlib.pyplot as plt
import numpy as np
from PIL import Image

im = Image.open('./test-pillow/other-blue.jpg')
channels = im.getbands()
# print(channels)

hists_all = im.histogram()
hists = np.split(np.array(hists_all), len(channels))

fig, ax = plt.subplots()
for hist, ch in zip(hists, channels):
    ax.plot(hist, color=ch.lower(), label=ch)

ax.set_xlim(0, 255)
ax.set_xlabel('Value')
ax.set_ylabel('Number')
ax.legend()
plt.show()
```

<a id="markdown-ヒストグラムの取得" name="ヒストグラムの取得"></a>

#### ヒストグラムの取得

```py
from PIL import Image

im = Image.open('./test-pillow/image.png')
print(im.format, im.size, im.mode) # 画像の種類、大きさ、カラーモード
print(im.getextrema()) # 画像の各バンドの最小ピクセル値と最大ピクセル値を取得
print(im.getpixel((64, 64))) # 指定した座標の画素値を取得

# 使用されている色を取得
print(
    im.getcolors(im.size[0] * im.size[1])
)

# ヒストグラムを取得
r, g, b = im.histogram()

# オリジナルの画像をコピーして保持
im_bak = im.copy()

im.show()
```

<a id="markdown-画像の書き出し" name="画像の書き出し"></a>

### 画像の書き出し

```py
from PIL import Image

im = Image.open('./test-pillow/image.png')
im.show()

# im.save('/path/to/image.jpg', quality=95) # JPEGの場合は品質も指定
im.save('./test-pillow/saved.png')
```

<a id="markdown-base64-にエンコードして書き出す" name="base64-にエンコードして書き出す"></a>

#### Base64 にエンコードして書き出す

```py
from PIL import Image
from io import BytesIO
import base64

im = Image.open('./test-pillow/image.png')

buffer = BytesIO()
im.save(buffer, format='png')
print(
    '<img src="data:image/jpeg;base64,' + base64.b64encode(buffer.getvalue()).decode('ascii') + '">'
)
```

<a id="markdown-画素ごとの操作" name="画素ごとの操作"></a>

### 画素ごとの操作

<a id="markdown-画素値の取得" name="画素値の取得"></a>

#### 画素値の取得

```py
from PIL import Image
import itertools


im = Image.open('./test-pillow/image.png')
im = im.convert('RGB')
size = im.size

# for x in range(size[0]):
#     for y in range(size[1]):
#         r, g, b = rgb_im.getpixel((x, y))
for x, y in itertools.product(range(size[0]), range(size[1])):
    r, g, b = im.getpixel((x, y))
    print(x, y, r, g, b)
```

> 0 0 255 128 0
>
> 0 1 255 128 0
>
> 0 2 255 128 0
>
> 0 3 255 128 0
>
> 0 4 255 128 0
>
> ...
>
> 255 251 255 128 0
>
> 255 252 255 128 0
>
> 255 253 255 128 0
>
> 255 254 255 128 0
>
> 255 255 255 128 0

<a id="markdown-画素ごとにコピー" name="画素ごとにコピー"></a>

#### 画素ごとにコピー

```py
from PIL import Image
import itertools


im = Image.open('./test-pillow/image.png')
im = im.convert('RGB')
size = im.size

im2 = Image.new('RGB',size)

for x, y in itertools.product(range(size[0]), range(size[1])):
    r, g, b = im.getpixel((x, y))
    im2.putpixel((x, y),(r, g, b))

im2.show()
im2.save('./test-pillow/copied.png')
```

<a id="markdown-グレースケール画素ごと" name="グレースケール画素ごと"></a>

#### グレースケール（画素ごと）

<a id="markdown-単純平均画素ごと" name="単純平均画素ごと"></a>

##### 単純平均（画素ごと）

```py
from PIL import Image
import itertools
import statistics


im = Image.open('./test-pillow/image.png')
im = im.convert('RGB')
size = im.size

im2 = Image.new('RGB',size)

for x, y in itertools.product(range(size[0]), range(size[1])):
    r, g, b = im.getpixel((x, y))
    p = int(statistics.mean((r, g, b)))
    im2.putpixel((x, y),(p, p, p))

im2.show()
im2.save('./test-pillow/gray_mean.png')
```

<a id="markdown-ntsc-加重平均法画素ごと" name="ntsc-加重平均法画素ごと"></a>

##### NTSC 加重平均法（画素ごと）

```py
from PIL import Image
import itertools


im = Image.open('./test-pillow/image.png')
im = im.convert('RGB')
size = im.size

im2 = Image.new('RGB',size)

for x, y in itertools.product(range(size[0]), range(size[1])):
    r, g, b = im.getpixel((x, y))
    # http://koturn.hatenablog.com/entry/2016/02/05/010000 の式(3)
    p = int((77 * r + 150 * g + 29 * b) / 256)
    im2.putpixel((x, y),(p, p, p))

im2.show()
im2.save('./test-pillow/gray_ntsc.png')
```

<a id="markdown-中間値法画素ごと" name="中間値法画素ごと"></a>

##### 中間値法（画素ごと）

```py
from PIL import Image
import itertools


im = Image.open('./test-pillow/image.png')
im = im.convert('RGB')
size = im.size

im2 = Image.new('RGB',size)

for x, y in itertools.product(range(size[0]), range(size[1])):
    r, g, b = im.getpixel((x, y))
    p = int((max(r, g, b) + min(r, g, b)) / 2)
    im2.putpixel((x, y),(p, p, p))

im2.show()
im2.save('./test-pillow/gray_mid.png')
```

<a id="markdown-画素ごとにネガポジ反転" name="画素ごとにネガポジ反転"></a>

#### 画素ごとにネガポジ反転

```py
from PIL import Image
import itertools
import statistics


im = Image.open('./test-pillow/image.png')
im = im.convert('RGB')
size = im.size

im2 = Image.new('RGBA',size)

for x, y in itertools.product(range(size[0]), range(size[1])):
    r, g, b = im.getpixel((x, y))
    im2.putpixel((x, y),(255 - r, 255 - g, 255 - b))

im2.show()
im2.save('./test-pillow/nega-pixel.png')
```

<a id="markdown-ぼかし処理画素ごと" name="ぼかし処理画素ごと"></a>

#### ぼかし処理（画素ごと）

<a id="markdown-平均化フィルター画素ごと" name="平均化フィルター画素ごと"></a>

##### 平均化フィルター（画素ごと）

```py
from PIL import Image
import itertools


im = Image.open('./test-pillow/other-blue.jpg')
im = im.convert('RGB')
size = im.size

im2 = Image.new('RGBA',size)

for x, y in itertools.product(range(size[0]), range(size[1])):
    r, g, b = im.getpixel((x, y))
    r1 = r2 = r3 = r4 = r5 = r6 = r7 = r8 = r
    g1 = g2 = g3 = g4 = g5 = g6 = g7 = g8 = g
    b1 = b2 = b3 = b4 = b5 = b6 = b7 = b8 = b

    if x - 1 > 0 and y + 1 < size[1]:
        r1, g1, b1 = im.getpixel((x-1,y+1))

    if y + 1 < size[1]:
        r2, g2, b2 = im.getpixel((x,y+1))

    if x + 1 < size[0] and y + 1 < size[1]:
        r3, g3, b3 = im.getpixel((x+1,y+1))

    if x - 1 > 0:
        r4, g4, b4 = im.getpixel((x-1,y))

    if x + 1 < size[0]:
        r5, g5, b5 = im.getpixel((x+1,y))

    if x - 1 > 0 and y - 1 > 0:
        r6, g6, b6 = im.getpixel((x-1,y-1))

    if y - 1 > 0:
        r7, g7, b7 = im.getpixel((x,y-1))

    if x + 1 < size[0] and y - 1 > 0:
        r8, g8, b8 = im.getpixel((x+1,y-1))

    r = int((r + r1 + r2 + r3 + r4 + r5 + r6 + r7 + r8) / 9)
    g = int((g + g1 + g2 + g3 + g4 + g5 + g6 + g7 + g8) / 9)
    b = int((b + b1 + b2 + b3 + b4 + b5 + b6 + b7 + b8) / 9)
    im2.putpixel((x, y), (r, g, b))

im2.show()
im2.save('./test-pillow/filter-aver.png')
```

<a id="markdown-ガウシアンフィルター画素ごと" name="ガウシアンフィルター画素ごと"></a>

##### ガウシアンフィルター（画素ごと）

|     |     |     |     |
| --- | --- | --- | --- |
|     | 1   | 2   | 3   |
|     | 4   |     | 5   |
|     | 6   | 7   | 8   |

```py
from PIL import Image
import itertools


im = Image.open('./test-pillow/other-blue.jpg')
im = im.convert('RGB')
size = im.size

im2 = Image.new('RGBA',size)

for x, y in itertools.product(range(size[0]), range(size[1])):
    r, g, b = im.getpixel((x, y))
    r1 = r2 = r3 = r4 = r5 = r6 = r7 = r8 = r
    g1 = g2 = g3 = g4 = g5 = g6 = g7 = g8 = g
    b1 = b2 = b3 = b4 = b5 = b6 = b7 = b8 = b

    if x - 1 > 0 and y + 1 < size[1]:
        r1, g1, b1 = im.getpixel((x-1,y+1))

    if y + 1 < size[1]:
        r2, g2, b2 = im.getpixel((x,y+1))

    if x + 1 < size[0] and y + 1 < size[1]:
        r3, g3, b3 = im.getpixel((x+1,y+1))

    if x - 1 > 0:
        r4, g4, b4 = im.getpixel((x-1,y))

    if x + 1 < size[0]:
        r5, g5, b5 = im.getpixel((x+1,y))

    if x - 1 > 0 and y - 1 > 0:
        r6, g6, b6 = im.getpixel((x-1,y-1))

    if y - 1 > 0:
        r7, g7, b7 = im.getpixel((x,y-1))

    if x + 1 < size[0] and y - 1 > 0:
        r8, g8, b8 = im.getpixel((x+1,y-1))

    r = int((4 * r + r1 + 2 * r2 + r3 + 2 * r4 + 2 * r5 + r6 + 2 * r7 + r8) / 18)
    g = int((4 * g + g1 + 2 * g2 + g3 + 2 * g4 + 2 * g5 + g6 + 2 * g7 + g8) / 18)
    b = int((4 * b + b1 + 2 * b2 + b3 + 2 * b4 + 2 * b5 + b6 + 2 * b7 + b8) / 18)
    im2.putpixel((x, y), (r, g, b))

im2.show()
im2.save('./test-pillow/filter-gaus.png')
```

<a id="markdown-ノイズ付加" name="ノイズ付加"></a>

#### ノイズ付加

<a id="markdown-ごま塩ノイズ" name="ごま塩ノイズ"></a>

##### ごま塩ノイズ

```py
from PIL import Image
from random import random
import itertools


salt=0.01
pepp=0.01


im = Image.open('./test-pillow/image.png')
im = im.convert('RGB')
size = im.size

im2 = Image.new('RGB',size)

for x, y in itertools.product(range(size[0]), range(size[1])):
    r, g, b = im.getpixel((x, y))
    rand = random()
    if rand < salt:
        im2.putpixel((x, y),(255, 255, 255))
    elif rand > 1 - pepp:
        im2.putpixel((x, y),(0, 0, 0))
    else:
        im2.putpixel((x, y),(r, g, b))

im2.show()
im2.save('./test-pillow/salt-pepper.png')
```

<a id="markdown-色を透明度にする画素ごと" name="色を透明度にする画素ごと"></a>

#### 色を透明度にする（画素ごと）

```py
from PIL import Image
import itertools


target_color = (31, 124, 193)


im = Image.open('./test-pillow/other-blue.jpg')
im = im.convert('RGB')
im2 = Image.new('RGBA', im.size, (0, 0, 0, 0))

for x, y in itertools.product(range(im.size[0]), range(im.size[1])):
    r, g, b = im.getpixel((x, y))
    if r== target_color[0] and g == target_color[1] and b == target_color[2]:
        continue
    im2.putpixel((x, y),(r, g, b))

im2.show()
im2.save('./test-pillow/other-blue_alpha.png')
```

<a id="markdown-画像のリサイズ" name="画像のリサイズ"></a>

### 画像のリサイズ

```py
from PIL import Image


im = Image.open('./test-pillow/image.png')

im = im.resize((64, 64)) # NEAREST

# リサンプリングフィルター( https://pillow.readthedocs.io/en/4.0.x/handbook/concepts.html#filters )を指定
# im = img.resize((64, 64), Image.NEAREST) # 既定
# im = img.resize((64, 64), Image.BOX)
# im = img.resize((64, 64), Image.BILINEAR)
# im = img.resize((64, 64), Image.HAMMING)
# im = img.resize((64, 64), Image.BICUBIC)
# im = img.resize((64, 64), Image.LANCZOS)

# 縦横の長さを、もとの50%に縮小
im = im.resize((int(0.5 * im.width), int(0.5 * im.height)))

# 縦横比を保って指定された幅にリサイズ
new_width = 256
im = im.resize((new_width, int(new_width * im.size[1] / im.size[0])))

# アスペクト比を保って指定された高さにリサイズ
new_height = 128
im = im.resize((int(new_height * im.size[0] / im.size[1]), new_height))

# 変換後のファイルを保存
im.save('./test-pillow/resized.png')
```

<a id="markdown-サムネイル画像の生成" name="サムネイル画像の生成"></a>

#### サムネイル画像の生成

```py
from PIL import Image


im = Image.open('./test-pillow/image.png')
print(im.size)
width, height = im.size


im.thumbnail((int(width / 2), int(height / 2)))

# # フィルタを指定（既定はBICUBIC）
# im.thumbnail((int(width / 2), int(height / 2)), Image.NEAREST)
# im.thumbnail((int(width / 2), int(height / 2)), Image.BOX)
# im.thumbnail((int(width / 2), int(height / 2)), Image.BILINEAR)
# im.thumbnail((int(width / 2), int(height / 2)), Image.HAMMING)
# im.thumbnail((int(width / 2), int(height / 2)), Image.BICUBIC)
# im.thumbnail((int(width / 2), int(height / 2)), Image.LANCZOS)


im.show()
print(im.size)
# 変換後のファイルを保存
im.save('./test-pillow/thumbnail.png')
```

> (255, 255)
>
> (128, 128)

<a id="markdown-複数画像の一括リサイズ" name="複数画像の一括リサイズ"></a>

#### 複数画像の一括リサイズ

```py
import os
import glob
import re
from PIL import Image


FILENAME_SUFFIX = '_resized'


# for f in glob.glob('./test-pillow/*.png'): # 同一階層の複数のファイル
# for f in glob.glob('test-pillow/**/*.png', recursive=True): # 再帰的にサブディレクトリ内のファイルも取得
# for f in [p for p in glob.glob('test-pillow/**/*', recursive=True) if os.path.splitext(p)[1] in ['.jpg', '.png']]: # 複数の拡張子
for f in [p for p in glob.glob('./test-pillow/**/*', recursive=True) if re.search('/[a-z]{5}\.(png|gif)', p)]:
    im = Image.open(f)
    im = im.resize((int(0.5 * im.width), int(0.5 * im.height)))
    root, ext = os.path.splitext(f)
    im.save(root + FILENAME_SUFFIX + ext)
```

<a id="markdown-余白を付けてリサイズ" name="余白を付けてリサイズ"></a>

#### 余白を付けてリサイズ

<a id="markdown-余白のサイズを指定" name="余白のサイズを指定"></a>

##### 余白のサイズを指定

```py
from PIL import Image

def resize(original_image, top, right, bottom, left, color):
    width, height = original_image.size
    resized_image = Image.new(original_image.mode, (width + right + left, height + top + bottom), color)
    resized_image.paste(original_image, (left, top))
    return resized_image


im = Image.open('./test-pillow/image.png')

im = resize(im, 5, 10, 5, 10, (255, 255, 0))
im.show()

# 変換後のファイルを保存
im.save('./test-pillow/margin.png')
```

<a id="markdown-リサイズ後のサイズを指定" name="リサイズ後のサイズを指定"></a>

##### リサイズ後のサイズを指定

```py
from PIL import Image

def resize(original_image, r_width, r_height, color):
    width, height = original_image.size
    if r_width > width and r_height > height:
        resized_image = Image.new(original_image.mode, (r_width, r_height), color)
        resized_image.paste(original_image, ((r_width - width) // 2, (r_height - height) // 2))
        return resized_image


im = Image.open('./test-pillow/image.png')

im = resize(im, 300, 300, (255, 255, 0))
im.show()

# 変換後のファイルを保存
im.save('./test-pillow/margin.png')
```

<a id="markdown-正方形にする" name="正方形にする"></a>

##### 正方形にする

```py
from PIL import Image

def resize(original_image, color):
    width, height = original_image.size
    if width == height:
        return original_image
    elif width > height:
        result = Image.new(original_image.mode, (width, width), color)
        result.paste(original_image, (0, (width - height) // 2))
        return result
    else:
        result = Image.new(original_image.mode, (height, height), color)
        result.paste(original_image, ((height - width) // 2, 0))


im = Image.open('./test-pillow/image.png')

im = resize(im, (255, 255, 0))
im.show()

# 変換後のファイルを保存
im.save('./test-pillow/square.png')
```

<a id="markdown-モザイク" name="モザイク"></a>

#### モザイク

```py
from PIL import Image

im = Image.open('./test-pillow/other-blue.jpg')


# 縮小して拡大することでモザイクがかかる
im = im.resize([x // 8 for x in im.size]).resize(im.size)

# im = im.filter(ImageFilter.GaussianBlur(4))
# im = im.resize([x // 8 for x in im.size]).resize(im.size)


im.show()
im.save('./test-pillow/other-blue_mosaic.png')
```

<a id="markdown-画像のトリミング" name="画像のトリミング"></a>

### 画像のトリミング

```py
from PIL import Image


im = Image.open('./test-pillow/image.png')

im = im.crop(
    (100, 50, 200, 150)
)
# bx = (100, 50, 200, 150)
# im = im.crop(bx)

# 変換後のファイルを保存
im.save('./test-pillow/trimmed.png')
print(im.size)

# 元の画像よりも大きく指定
im = im.crop((0, 0, 300, 300))
im.save('./test-pillow/trimmed_large.png')
print(im.size)
```

> (100, 100)
>
> (300, 300)

トリミング後の画像の左上の画素は元の画像の(100, 50)、右下の画素は元の画像の(199, 149)

<a id="markdown-画像の反転" name="画像の反転"></a>

### 画像の反転

```py
from PIL import Image, ImageOps


im = Image.open('./test-pillow/image.png')

# 左右反転
im = ImageOps.mirror(im)
im.show()

# 上下反転
im = ImageOps.flip(im)
im.show()
```

<a id="markdown-画像の回転" name="画像の回転"></a>

### 画像の回転

```py
from PIL import Image


im = Image.open('./test-pillow/image.png')

im90 = im.rotate(90)
im90.show()

# 元の画像サイズに収まらない領域は保持されない
im30 = im.rotate(30)
im30.show()

# フィルタを指定（既定はNEAREST）
im90 = im.rotate(90, resample=Image.NEAREST)
# im90 = im.rotate(90, resample=Image.BILINEAR)
# im90 = im.rotate(90, resample=Image.BICUBIC)

# 元の画像サイズに収まらない領域も保持
im90e = im.rotate(90, expand=True)
im90e.show()
im30e = im.rotate(30, expand=True)
im30e.show()

# 元の画像サイズに収まらない領域の色を指定
imf = im.rotate(30, fillcolor=(255, 255, 0), expand=True)
imf.show()

# 中心座標を指定
im30c = im.rotate(30, center=(0, 0))

# 平行移動
im0t = im.rotate(0, translate=(100, 50), expand=True)
im0t.show()
im30t = im.rotate(30, translate=(100, 50), expand=True)
im30t.show()
```

<a id="markdown-色の変換" name="色の変換"></a>

### 色の変換

<a id="markdown-色空間の変換" name="色空間の変換"></a>

#### 色空間の変換

<a id="markdown-グレースケール" name="グレースケール"></a>

##### グレースケール

```py
from PIL import Image

im = Image.open('./test-pillow/image.png')
im = im.convert('L')
# im = im.convert('LA') # アルファチャネルがある場合

im.show()
im.save('./test-pillow/convert_l.png')
```

<a id="markdown-hsv-色空間" name="hsv-色空間"></a>

##### HSV 色空間

```py
from PIL import Image, ImageMath

im = Image.open('./test-pillow/image.png')
im = im.convert('HSV')

# 色相（Hue）
# 彩度（Saturation）
# 明度（Value）
h, s, v = im.convert('HSV').split()

# 色の変更
_h = ImageMath.eval('(h + 128) % 255', h=h).convert('L')
_s = ImageMath.eval('(s +  64) % 255', s=s).convert('L')
_v = ImageMath.eval('(v -  32) % 255', v=v).convert('L')
im2 = Image.merge('HSV', (_h, _s, v)).convert('RGB')

im2.show()
im2.save('./test-pillow/convert_hsv.png')
```

<a id="markdown-cielab-色空間" name="cielab-色空間"></a>

##### CIELAB 色空間

```py
from PIL import Image, ImageCms

im = Image.open('./test-pillow/image.png')
if im.mode != 'RGB':
  im = im.convert('RGB')

tr = ImageCms.buildTransformFromOpenProfiles(
  ImageCms.createProfile('sRGB'),
  ImageCms.createProfile('LAB'),
  'RGB',
  'LAB'
)

L, a, b = ImageCms.applyTransform(im, tr).split()
L.save('L.png')
a.save('a.png')
b.save('b.png')
```

<a id="markdown-画素値の置換" name="画素値の置換"></a>

### 画素値の置換

```py
from PIL import Image, ImageChops


src_color = (31, 124, 193)
dst_color = (255, 0, 0)


im = Image.open('./test-pillow/other-blue.jpg')

r, g, b = im.split()
_r = r.point(lambda _: 1 if _ == src_color[0] else 0, mode="1")
_g = g.point(lambda _: 1 if _ == src_color[1] else 0, mode="1")
_b = b.point(lambda _: 1 if _ == src_color[2] else 0, mode="1")
mask = ImageChops.logical_and(
    ImageChops.logical_and(_r, _g),
    _b
)
im.paste(Image.new('RGB', im.size, dst_color), mask=mask)

im.show()
```

<a id="markdown-フィルター処理" name="フィルター処理"></a>

#### フィルター処理

```py
from PIL import Image

im = Image.open('./test-pillow/image.png')


im = im.filter(ImageFilter.BLUR)
im = im.filter(ImageFilter.CONTOUR)
im = im.filter(ImageFilter.DETAIL)
im = im.filter(ImageFilter.EDGE_ENHANCE)
im = im.filter(ImageFilter.EDGE_ENHANCE_MORE)
im = im.filter(ImageFilter.EMBOSS)
im = im.filter(ImageFilter.FIND_EDGES)
im = im.filter(ImageFilter.SHARPEN)
im = im.filter(ImageFilter.SMOOTH)
im = im.filter(ImageFilter.SMOOTH_MORE)

im = im.filter(ImageFilter.BoxBlur(radius=1))

im = im.filter(ImageFilter.GaussianBlur()) # 既定はradius=2
im = im.filter(ImageFilter.GaussianBlur(radius=5))

im = im.filter(ImageFilter.UnsharpMask()) # 既定はradius=2, percent=150, threshold=3
im = im.filter(ImageFilter.UnsharpMask(radius=2, percent=150, threshold=3))

kernel_list =  [1,   0, -1, # エッジ検出の例
          1,   0, -1,
          1,   0, -1]
im = im.filter(ImageFilter.Kernel(size=(3, 3), kernel=kernel_list, scale=1, offset=0))

im = im.filter(ImageFilter.RankFilter(size=5, rank=24)) # rankに0を指定するとmin filter, size * size / 2を指定するとmedian filter, size * size - 1を指定するとmax filter

im = im.filter(ImageFilter.MedianFilter()) # 既定はsize=3
im = im.filter(ImageFilter.MedianFilter(size=3))

im = im.filter(ImageFilter.MinFilter()) # 既定はsize=3
im = im.filter(ImageFilter.MinFilter(size=3))

im = im.filter(ImageFilter.MaxFilter()) # 既定はsize=3
im = im.filter(ImageFilter.MaxFilter(size=3))

im = im.filter(ImageFilter.ModeFilter()) # 既定はsize=3
im = im.filter(ImageFilter.ModeFilter(size=3))


im.show()
im.save('./test-pillow/convert_filter.png')
```

<a id="markdown-画像の合成" name="画像の合成"></a>

### 画像の合成

<a id="markdown-画像の貼り付け" name="画像の貼り付け"></a>

#### 画像の貼り付け

<a id="markdown-単純に貼り付け" name="単純に貼り付け"></a>

##### 単純に貼り付け

```py
from PIL import Image

# 背景画像
im1 = Image.open('./test-pillow/other-blue.jpg').convert('RGBA')
# アルファチャネルがある画像
im2 = Image.open('./test-pillow/other-squirrel.png').convert('RGBA')


# アルファチャネルがない画像同士であれば、 paste のみで充分
# im1.paste(im2, (20, 10))


# 背景画像と同じサイズの透明画像を生成
im_alpha = Image.new('RGBA', im1.size, (255, 255, 255, 0))
# 透明画像の座標 (20, 10) に im2 を貼り付け
im_alpha.paste(im2, (20, 10))
# 背景画像に貼り付け
im3 = Image.alpha_composite(im1, im_alpha)


im3.show()
im3.save('./test-pillow/other-paste_simple.png')
```

<a id="markdown-マスク画像を使用して貼り付け" name="マスク画像を使用して貼り付け"></a>

##### マスク画像を使用して貼り付け

```py
from PIL import Image, ImageDraw, ImageFilter

# 背景画像
im1 = Image.open('./test-pillow/other-blue.jpg').convert('RGBA')
# アルファチャネルがある画像
im2 = Image.open('./test-pillow/other-squirrel.png').convert('RGBA')



# マスク画像を生成
mask = Image.new("L", im2.size, 0)
draw = ImageDraw.Draw(mask)
draw.ellipse((10, 10, mask.size[0] - 10, mask.size[1] - 10), fill=255)
mask = mask.filter(ImageFilter.GaussianBlur(20))



# 背景画像と同じサイズの透明画像を生成
im_alpha = Image.new('RGBA', im1.size, (255, 255, 255, 0))
# 透明画像の座標 (20, 10) に im2 を貼り付け
im_alpha.paste(im2, (20, 10), mask)
# 背景画像に貼り付け
im3 = Image.alpha_composite(im1, im_alpha)


im3.show()
im3.save('./test-pillow/other-paste_mask.png')
```

<a id="markdown-画像に文字を合成" name="画像に文字を合成"></a>

#### 画像に文字を合成

```py
from PIL import Image, ImageDraw, ImageFont
import sys


pos = (10, 10)
mes = 'AWESOME 日本語もOK'
fontcol = (255, 255, 255)
fontsize = 15

if sys.platform == "darwin":
    # Mac
    # font = ImageFont.truetype('/Library/Fonts/Arial Unicode.ttf', fontsize)
    font = ImageFont.truetype('/System/Library/Fonts/ヒラギノ角ゴシック W0.ttc', fontsize)
elif sys.platform == "linux2":
    # Linux
    font = ImageFont.truetype('/', fontsize)
elif sys.platform == "win32":
    # Windows
    font = ImageFont.truetype('C:/WINDOWS/Fonts/YuGothL.ttc', fontsize)

im = Image.open('./test-pillow/image.png')
draw = ImageDraw.Draw(im)
draw.text(pos, mes, font=font, fill=fontcol)

im.show()
im.save('./test-pillow/message.png')
```

<a id="markdown-利用できるフォントの一覧を取得" name="利用できるフォントの一覧を取得"></a>

##### 利用できるフォントの一覧を取得

```sh
$ python -m pip install matplotlib
```

```py
import matplotlib.font_manager
matplotlib.font_manager.findSystemFonts(fontpaths=None, fontext='ttc')
# matplotlib.font_manager.findSystemFonts(fontpaths=None, fontext='ttf') # fontext='ttc'と同じ結果が返る
```

> ['/System/Library/Fonts/Apple Braille Pinpoint 8 Dot.ttf', '/System/Library/Fonts/Supplemental/NotoSansCypriot-Regular.ttf', '/System/Library/Fonts/Thonburi.ttc', '/System/Library/Fonts/Supplemental/Telugu Sangam MN.ttc', '/System/Library/Fonts/Supplemental/Brush Script.ttf', '/System/Library/Fonts/Supplemental/NotoSansLycian-Regular.ttf', '/System/Library/Fonts/Supplemental/SuperClarendon.ttc', '/System/Library/Fonts/Supplemental/Seravek.ttc', '/System/Library/Fonts/Supplemental/Damascus.ttc', '/Library/Fonts/Arial Unicode.ttf', '/System/Library/Fonts/Supplemental/Charter.ttc', '/usr/X11/lib/X11/fonts/TTF/VeraBI.ttf', '/System/Library/Fonts/Supplemental/SignPainter.ttc', '/usr/X11/lib/X11/fonts/TTF/luximri.ttf', '/System/Library/Fonts/Supplemental/NotoSansSyriac-Regular.ttf', '/System/Library/Fonts/Supplemental/STIXSizThreeSymReg.otf', '/System/Library/Fonts/Supplemental/Times New Roman.ttf', '/System/Library/Fonts/Supplemental/Phosphate.ttc', '/System/Library/Fonts/SFCompactRounded.ttf', '/System/Library/Fonts/Supplemental/EuphemiaCAS.ttc', '/Users/yu/Library/Fonts/SourceHanCodeJP-ExtraLight.otf', '/System/Library/Fonts/SFNSTextCondensed-Semibold.otf', '/System/Library/Fonts/Supplemental/NotoSansShavian-Regular.ttf', '/System/Library/Fonts/KohinoorBangla.ttc', '/System/Library/Fonts/Supplemental/NotoSansOlChiki-Regular.ttf', '/System/Library/Fonts/Supplemental/NISC18030.ttf', '/System/Library/Fonts/SFNS.ttf', '/System/Library/Fonts/SFNSTextCondensed-Regular.otf', '/usr/X11/lib/X11/fonts/TTF/luxisri.ttf', '/System/Library/Fonts/Times.ttc', '/System/Library/Fonts/Supplemental/Bodoni 72 OS.ttc', '/Users/yu/Library/Fonts/SourceHanCodeJP-Bold.otf', '/usr/X11/lib/X11/fonts/TTF/luxisbi.ttf', '/System/Library/Fonts/Supplemental/Savoye LET.ttc', '/usr/X11R6/lib/X11/fonts/TTF/VeraMoBd.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMUrhoy.otf', '/System/Library/Fonts/Supplemental/Didot.ttc', '/System/Library/Fonts/Supplemental/DIN Alternate Bold.ttf', '/System/Library/Fonts/Supplemental/DecoTypeNaskh.ttc', '/System/Library/Fonts/Supplemental/Myanmar MN.ttc', '/usr/X11/lib/X11/fonts/TTF/VeraMoBI.ttf', '/System/Library/Fonts/Supplemental/STIXSizTwoSymBol.otf', '/usr/X11R6/lib/X11/fonts/TTF/VeraBI.ttf', '/System/Library/Fonts/Supplemental/Times New Roman Bold Italic.ttf', '/usr/X11/lib/X11/fonts/TTF/luxirb.ttf', '/System/Library/Fonts/Avenir.ttc', '/usr/X11/lib/X11/fonts/TTF/luxisb.ttf', '/System/Library/Fonts/ヒラギノ角ゴシック W6.ttc', '/System/Library/Fonts/Supplemental/Verdana Bold.ttf', '/Users/yu/Library/Fonts/SourceHanCodeJP-Normal.otf', '/System/Library/Fonts/Supplemental/Khmer Sangam MN.ttf', '/System/Library/Fonts/NotoNastaliq.ttc', '/System/Library/Fonts/Supplemental/STIXSizThreeSymBol.otf', '/System/Library/Fonts/Supplemental/NotoSansRejang-Regular.ttf', '/System/Library/Fonts/Supplemental/Courier New Italic.ttf', '/System/Library/Fonts/Supplemental/NotoSansNewTaiLue-Regular.ttf', '/System/Library/Fonts/Symbol.ttf', '/System/Library/Fonts/ZapfDingbats.ttf', '/Users/yu/Library/Fonts/SourceHanCodeJP-HeavyIt.otf', '/System/Library/Fonts/Supplemental/DevanagariMT.ttc', '/System/Library/Fonts/STHeiti Light.ttc', '/System/Library/Fonts/Supplemental/AmericanTypewriter.ttc', '/System/Library/Fonts/Supplemental/STIXVarBol.otf', '/System/Library/Fonts/Supplemental/Krungthep.ttf', '/System/Library/Fonts/Supplemental/NotoSansOldSouthArabian-Regular.ttf', '/System/Library/Fonts/Supplemental/Trebuchet MS.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMNisibinOutline.otf', '/Users/yu/Library/Fonts/SourceHanCodeJP-RegularIt.otf', '/System/Library/Fonts/Supplemental/Baghdad.ttc', '/System/Library/Fonts/Supplemental/Tahoma.ttf', '/System/Library/Fonts/NotoSansKannada.ttc', '/usr/X11/lib/X11/fonts/OTF/SyrCOMTalada.otf', '/System/Library/Fonts/Supplemental/NotoSansChakma-Regular.ttf', '/usr/X11R6/lib/X11/fonts/TTF/VeraSeBd.ttf', '/usr/X11R6/lib/X11/fonts/TTF/luxirr.ttf', '/System/Library/Fonts/Supplemental/SukhumvitSet.ttc', '/System/Library/Fonts/Supplemental/Shree714.ttc', '/System/Library/Fonts/Supplemental/Microsoft Sans Serif.ttf', '/usr/X11/lib/X11/fonts/TTF/VeraMono.ttf', '/System/Library/Fonts/Supplemental/Comic Sans MS Bold.ttf', '/System/Library/Fonts/ヒラギノ角ゴシック W1.ttc', '/System/Library/Fonts/Apple Braille Pinpoint 6 Dot.ttf', '/System/Library/Fonts/Supplemental/DIN Condensed Bold.ttf', '/System/Library/Fonts/Supplemental/Trebuchet MS Bold.ttf', '/System/Library/Fonts/ヒラギノ角ゴシック W8.ttc', '/System/Library/Fonts/ヒラギノ角ゴシック W0.ttc', '/System/Library/Fonts/SFNSDisplayCondensed-Bold.otf', '/usr/X11/lib/X11/fonts/TTF/Vera.ttf', '/System/Library/Fonts/Supplemental/Webdings.ttf', '/System/Library/Fonts/Supplemental/NotoSerifBalinese-Regular.ttf', '/usr/X11/lib/X11/fonts/TTF/VeraSe.ttf', '/System/Library/Fonts/Supplemental/NotoSansBuginese-Regular.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMMardinBold.otf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMMalankara.otf', '/System/Library/Fonts/Supplemental/NotoSansBrahmi-Regular.ttf', '/System/Library/Fonts/Supplemental/Verdana Bold Italic.ttf', '/System/Library/Fonts/Supplemental/Arial Bold Italic.ttf', '/System/Library/Fonts/Supplemental/NotoSansLepcha-Regular.ttf', '/System/Library/Fonts/SFNSTextCondensed-Heavy.otf', '/System/Library/Fonts/NewYorkItalic.ttf', '/System/Library/Fonts/Supplemental/Papyrus.ttc', '/System/Library/Fonts/Supplemental/Zapfino.ttf', '/System/Library/Fonts/Supplemental/Gurmukhi.ttf', '/System/Library/Fonts/Supplemental/NotoSansGlagolitic-Regular.ttf', '/System/Library/Fonts/Supplemental/Georgia Bold Italic.ttf', '/System/Library/Fonts/Supplemental/Verdana Italic.ttf', '/System/Library/Fonts/Supplemental/STIXSizFourSymBol.otf', '/System/Library/Fonts/Supplemental/STIXSizOneSymBol.otf', '/System/Library/Fonts/Supplemental/Nadeem.ttc', '/System/Library/Fonts/Supplemental/Arial Bold.ttf', '/System/Library/Fonts/Supplemental/Georgia Bold.ttf', '/Users/yu/Library/Fonts/SourceHanCodeJP-Regular.otf', '/System/Library/Fonts/Supplemental/NotoSansOldPersian-Regular.ttf', '/System/Library/Fonts/Supplemental/Trebuchet MS Bold Italic.ttf', '/System/Library/Fonts/Supplemental/NotoSansInscriptionalParthian-Regular.ttf', '/System/Library/Fonts/Supplemental/Telugu MN.ttc', '/System/Library/Fonts/Supplemental/STIXIntUpReg.otf', '/System/Library/Fonts/Supplemental/PlantagenetCherokee.ttf', '/Users/yu/Library/Fonts/SourceHanCodeJP-MediumIt.otf', '/System/Library/Fonts/Supplemental/STIXIntSmReg.otf', '/System/Library/Fonts/Supplemental/KufiStandardGK.ttc', '/System/Library/Fonts/Supplemental/Verdana.ttf', '/System/Library/Fonts/Keyboard.ttf', '/System/Library/Fonts/ヒラギノ角ゴシック W3.ttc', '/System/Library/Fonts/Supplemental/Arial.ttf', '/System/Library/Fonts/SFNSMonoItalic.ttf', '/System/Library/Fonts/Supplemental/STIXSizFiveSymReg.otf', '/System/Library/Fonts/Apple Color Emoji.ttc', '/System/Library/Fonts/Supplemental/Lao MN.ttc', '/System/Library/Fonts/Supplemental/NotoSansCham-Regular.ttf', '/System/Library/Fonts/Supplemental/NotoSansOgham-Regular.ttf', '/System/Library/Fonts/ヒラギノ角ゴシック W2.ttc', '/System/Library/Fonts/Supplemental/NotoSansCuneiform-Regular.ttf', '/System/Library/Fonts/Supplemental/NotoSansPhagsPa-Regular.ttf', '/System/Library/Fonts/Supplemental/Beirut.ttc', '/Users/yu/Library/Fonts/SourceHanCodeJP-Heavy.otf', '/System/Library/Fonts/Supplemental/STIXNonUniBolIta.otf', '/System/Library/Fonts/Supplemental/Gurmukhi Sangam MN.ttc', '/System/Library/Fonts/Supplemental/NotoSansVai-Regular.ttf', '/System/Library/Fonts/Supplemental/Copperplate.ttc', '/usr/X11/lib/X11/fonts/TTF/luximb.ttf', '/System/Library/Fonts/Supplemental/Oriya Sangam MN.ttc', '/System/Library/Fonts/SFNSDisplayCondensed-Ultralight.otf', '/System/Library/Fonts/Supplemental/NotoSansSamaritan-Regular.ttf', '/System/Library/Fonts/Supplemental/NotoSansTaiViet-Regular.ttf', '/System/Library/Fonts/SFNSTextCondensed-Medium.otf', '/System/Library/Fonts/Supplemental/Bangla MN.ttc', '/System/Library/Fonts/Supplemental/ChalkboardSE.ttc', '/usr/X11/lib/X11/fonts/OTF/GohaTibebZemen.otf', '/System/Library/Fonts/NotoSansMyanmar.ttc', '/System/Library/Fonts/MarkerFelt.ttc', '/System/Library/Fonts/Supplemental/STIXGeneralBolIta.otf', '/System/Library/Fonts/ヒラギノ角ゴシック W5.ttc', '/usr/X11R6/lib/X11/fonts/TTF/luximb.ttf', '/usr/X11R6/lib/X11/fonts/TTF/luximri.ttf', '/System/Library/Fonts/Supplemental/NotoSansNKo-Regular.ttf', '/Users/yu/Library/Fonts/SourceHanCodeJP-Light.otf', '/usr/X11/lib/X11/fonts/TTF/VeraIt.ttf', '/System/Library/Fonts/Supplemental/Luminari.ttf', '/System/Library/Fonts/HelveticaNeueDeskInterface.ttc', '/System/Library/Fonts/Supplemental/NotoSansOsmanya-Regular.ttf', '/System/Library/Fonts/Noteworthy.ttc', '/Users/yu/Library/Fonts/MyricaM.TTC', '/System/Library/Fonts/Supplemental/Wingdings 3.ttf', '/System/Library/Fonts/Supplemental/AppleMyungjo.ttf', '/System/Library/Fonts/Avenir Next.ttc', '/usr/X11/lib/X11/fonts/OTF/SyrCOMNisibin.otf', '/System/Library/Fonts/Supplemental/Chalkduster.ttf', '/usr/X11R6/lib/X11/fonts/TTF/VeraIt.ttf', '/System/Library/Fonts/Supplemental/Kokonor.ttf', '/System/Library/Fonts/Supplemental/NotoSansRunic-Regular.ttf', '/System/Library/Fonts/Helvetica.ttc', '/System/Library/Fonts/Supplemental/NotoSansOldTurkic-Regular.ttf', '/System/Library/Fonts/Supplemental/Galvji.ttc', '/System/Library/Fonts/Supplemental/Hoefler Text.ttc', '/System/Library/Fonts/Supplemental/Trattatello.ttf', '/System/Library/Fonts/Supplemental/NotoSansTifinagh-Regular.ttf', '/System/Library/Fonts/Supplemental/Kefa.ttc', '/System/Library/Fonts/Supplemental/Mishafi.ttf', '/System/Library/Fonts/Supplemental/Sinhala MN.ttc', '/System/Library/Fonts/Supplemental/NotoSansJavanese-Regular.otf', '/usr/X11R6/lib/X11/fonts/TTF/luximr.ttf', '/System/Library/Fonts/ヒラギノ角ゴシック W9.ttc', '/System/Library/Fonts/Supplemental/Tahoma Bold.ttf', '/System/Library/Fonts/Supplemental/STIXGeneralItalic.otf', '/System/Library/Fonts/SFNSMono.ttf', '/System/Library/Fonts/Apple Braille Outline 6 Dot.ttf', '/System/Library/Fonts/Supplemental/Courier New.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMJerusalemItalic.otf', '/System/Library/Fonts/Supplemental/NotoSansInscriptionalPahlavi-Regular.ttf', '/System/Library/Fonts/Supplemental/Courier New Bold.ttf', '/System/Library/Fonts/NewYork.ttf', '/System/Library/Fonts/Supplemental/NewPeninimMT.ttc', '/Users/yu/Library/Fonts/SourceHanCodeJP-Medium.otf', '/System/Library/Fonts/Supplemental/Arial Italic.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMJerusalemOutline.otf', '/System/Library/Fonts/Supplemental/Skia.ttf', '/System/Library/Fonts/Supplemental/Al Tarikh.ttc', '/System/Library/Fonts/Supplemental/NotoSansTaiTham-Regular.ttf', '/System/Library/Fonts/SFCompactTextItalic.ttf', '/System/Library/Fonts/Supplemental/Hoefler Text Ornaments.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMUrhoyBold.otf', '/System/Library/Fonts/Supplemental/Waseem.ttc', '/System/Library/Fonts/Supplemental/Oriya MN.ttc', '/System/Library/Fonts/Supplemental/Diwan Thuluth.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMTurAbdin.otf', '/System/Library/Fonts/Supplemental/SnellRoundhand.ttc', '/System/Library/Fonts/Supplemental/Kailasa.ttc', '/System/Library/Fonts/Supplemental/Khmer MN.ttc', '/System/Library/Fonts/Supplemental/NotoSansTagalog-Regular.ttf', '/System/Library/Fonts/Supplemental/NotoSansCoptic-Regular.ttf', '/usr/X11R6/lib/X11/fonts/TTF/Vera.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMCtesiphon.otf', '/System/Library/Fonts/Avenir Next Condensed.ttc', '/System/Library/Fonts/ArabicUIText.ttc', '/System/Library/Fonts/Supplemental/NotoSansGothic-Regular.ttf', '/System/Library/Fonts/Supplemental/STIXGeneral.otf', '/System/Library/Fonts/KohinoorGujarati.ttc', '/System/Library/Fonts/Supplemental/Apple Chancery.ttf', '/System/Library/Fonts/Supplemental/Georgia.ttf', '/System/Library/Fonts/Supplemental/Tamil Sangam MN.ttc', '/System/Library/Fonts/Supplemental/Malayalam MN.ttc', '/usr/X11/lib/X11/fonts/OTF/SyrCOMMidyat.otf', '/System/Library/Fonts/Hiragino Sans GB.ttc', '/System/Library/Fonts/Supplemental/NotoSansKaithi-Regular.ttf', '/System/Library/Fonts/Supplemental/Arial Narrow Italic.ttf', '/System/Library/Fonts/Apple Braille Outline 8 Dot.ttf', '/System/Library/Fonts/Supplemental/Arial Rounded Bold.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMQenNeshrin.otf', '/usr/X11R6/lib/X11/fonts/TTF/luxisbi.ttf', '/System/Library/Fonts/Supplemental/Marion.ttc', '/System/Library/Fonts/Supplemental/Georgia Italic.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMMardin.otf', '/System/Library/Fonts/ヒラギノ角ゴシック W4.ttc', '/System/Library/Fonts/ArialHB.ttc', '/System/Library/Fonts/Supplemental/Sana.ttc', '/System/Library/Fonts/Supplemental/Baskerville.ttc', '/System/Library/Fonts/Supplemental/Al Nile.ttc', '/System/Library/Fonts/Supplemental/Rockwell.ttc', '/System/Library/Fonts/Supplemental/STIXIntUpSmBol.otf', '/System/Library/Fonts/Supplemental/GujaratiMT.ttc', '/System/Library/Fonts/Supplemental/Trebuchet MS Italic.ttf', '/System/Library/Fonts/Supplemental/NotoSansCarian-Regular.ttf', '/System/Library/Fonts/AquaKana.ttc', '/System/Library/Fonts/Supplemental/Gurmukhi MN.ttc', '/System/Library/Fonts/Supplemental/Arial Narrow Bold Italic.ttf', '/System/Library/Fonts/Supplemental/Gujarati Sangam MN.ttc', '/System/Library/Fonts/Supplemental/STIXIntSmBol.otf', '/System/Library/Fonts/Supplemental/NotoSansMeeteiMayek-Regular.ttf', '/usr/X11R6/lib/X11/fonts/TTF/VeraSe.ttf', '/System/Library/Fonts/Supplemental/Herculanum.ttf', '/System/Library/Fonts/Supplemental/NotoSansMandaic-Regular.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMJerusalemBold.otf', '/System/Library/Fonts/SFNSTextCondensed-Bold.otf', '/System/Library/Fonts/Supplemental/Silom.ttf', '/System/Library/Fonts/Apple Braille.ttf', '/System/Library/Fonts/SFNSDisplayCondensed-Regular.otf', '/System/Library/Fonts/Supplemental/Raanana.ttc', '/System/Library/Fonts/ヒラギノ角ゴシック W7.ttc', '/System/Library/Fonts/SFNSDisplayCondensed-Semibold.otf', '/System/Library/Fonts/Supplemental/NotoSansLimbu-Regular.ttf', '/System/Library/Fonts/Supplemental/PTSerifCaption.ttc', '/System/Library/Fonts/Supplemental/STIXIntUpSmReg.otf', '/System/Library/Fonts/Supplemental/STIXIntDBol.otf', '/System/Library/Fonts/Supplemental/Myanmar Sangam MN.ttc', '/Users/yu/Library/Fonts/SourceHanCodeJP-NormalIt.otf', '/System/Library/Fonts/Supplemental/Courier New Bold Italic.ttf', '/System/Library/Fonts/LucidaGrande.ttc', '/System/Library/Fonts/Supplemental/Lao Sangam MN.ttf', '/System/Library/Fonts/Supplemental/Sathu.ttf', '/usr/X11R6/lib/X11/fonts/TTF/luxirbi.ttf', '/System/Library/Fonts/NotoSansArmenian.ttc', '/System/Library/Fonts/Supplemental/Corsiva.ttc', '/System/Library/Fonts/Supplemental/NotoSansKayahLi-Regular.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMBatnanBold.otf', '/System/Library/Fonts/Supplemental/Kannada Sangam MN.ttc', '/usr/X11/lib/X11/fonts/OTF/SyrCOMAdiabene.otf', '/System/Library/Fonts/HelveticaNeue.ttc', '/usr/X11R6/lib/X11/fonts/TTF/VeraMoIt.ttf', '/usr/X11R6/lib/X11/fonts/TTF/luxisb.ttf', '/System/Library/Fonts/Supplemental/AppleGothic.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMAntioch.otf', '/System/Library/Fonts/Supplemental/STIXGeneralBol.otf', '/System/Library/Fonts/Supplemental/Ayuthaya.ttf', '/usr/X11/lib/X11/fonts/TTF/GohaTibebZemen.ttf', '/usr/X11/lib/X11/fonts/TTF/VeraMoBd.ttf', '/usr/X11R6/lib/X11/fonts/TTF/luxirb.ttf', '/System/Library/Fonts/SFNSDisplayCondensed-Medium.otf', '/System/Library/Fonts/Supplemental/Bodoni 72 Smallcaps Book.ttf', '/System/Library/Fonts/Supplemental/NotoSansLinearB-Regular.ttf', '/System/Library/Fonts/Supplemental/STIXIntUpDBol.otf', '/usr/X11R6/lib/X11/fonts/TTF/VeraMono.ttf', '/System/Library/Fonts/Supplemental/Arial Unicode.ttf', '/usr/X11/lib/X11/fonts/TTF/VeraBd.ttf', '/System/Library/Fonts/Supplemental/PTMono.ttc', '/System/Library/Fonts/Supplemental/STIXVar.otf', '/System/Library/Fonts/Supplemental/Devanagari Sangam MN.ttc', '/System/Library/Fonts/Supplemental/STIXIntDReg.otf', '/Users/yu/Library/Fonts/SourceHanCodeJP-BoldIt.otf', '/System/Library/Fonts/Supplemental/NotoSansAvestan-Regular.ttf', '/System/Library/Fonts/SFNSDisplayCondensed-Thin.otf', '/System/Library/Fonts/Supplemental/Sinhala Sangam MN.ttc', '/System/Library/Fonts/Supplemental/NotoSansYi-Regular.ttf', '/System/Library/Fonts/Supplemental/Impact.ttf', '/System/Library/Fonts/Supplemental/Futura.ttc', '/System/Library/Fonts/Supplemental/NotoSansBatak-Regular.ttf', '/System/Library/Fonts/Supplemental/STIXNonUni.otf', '/System/Library/Fonts/Supplemental/Arial Black.ttf', '/System/Library/Fonts/Supplemental/Mishafi Gold.ttf', '/System/Library/Fonts/Supplemental/Andale Mono.ttf', '/usr/X11/lib/X11/fonts/TTF/luxirri.ttf', '/System/Library/Fonts/Supplemental/PTSans.ttc', '/System/Library/Fonts/Supplemental/STIXNonUniIta.otf', '/System/Library/Fonts/Supplemental/Comic Sans MS.ttf', '/System/Library/Fonts/Menlo.ttc', '/usr/X11/lib/X11/fonts/TTF/luxirr.ttf', '/System/Library/Fonts/Supplemental/STIXSizOneSymReg.otf', '/System/Library/Fonts/Supplemental/NotoSansHanunoo-Regular.ttf', '/System/Library/Fonts/Supplemental/Bradley Hand Bold.ttf', '/System/Library/Fonts/SFNSDisplayCondensed-Light.otf', '/usr/X11/lib/X11/fonts/TTF/VeraMoIt.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMKharput.otf', '/System/Library/Fonts/SFCompactText.ttf', '/System/Library/Fonts/Supplemental/Farah.ttc', '/System/Library/Fonts/Supplemental/Kannada MN.ttc', '/System/Library/Fonts/Supplemental/NotoSansSaurashtra-Regular.ttf', '/usr/X11R6/lib/X11/fonts/TTF/VeraMoBI.ttf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMJerusalem.otf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMEdessa.otf', '/System/Library/Fonts/Supplemental/Bangla Sangam MN.ttc', '/Users/yu/Library/Fonts/Myrica.TTC', '/System/Library/Fonts/Supplemental/NotoSansSundanese-Regular.ttf', '/System/Library/Fonts/Supplemental/NotoSansMongolian-Regular.ttf', '/System/Library/Fonts/Supplemental/STIXSizFourSymReg.otf', '/usr/X11/lib/X11/fonts/OTF/SyrCOMBatnan.otf', '/System/Library/Fonts/Supplemental/NotoSansPhoenician-Regular.ttf', '/System/Library/Fonts/Supplemental/NotoSansOldItalic-Regular.ttf', '/System/Library/Fonts/Supplemental/Mshtakan.ttc', '/System/Library/Fonts/Supplemental/Cochin.ttc', '/System/Library/Fonts/Supplemental/Farisi.ttf', '/System/Library/Fonts/Supplemental/NotoSansLisu-Regular.ttf', '/System/Library/Fonts/SFNSDisplayCondensed-Black.otf', '/System/Library/Fonts/AppleSDGothicNeo.ttc', '/System/Library/Fonts/Kohinoor.ttc', '/usr/X11/lib/X11/fonts/TTF/luximr.ttf', '/Users/yu/Library/Fonts/SourceHanCodeJP-ExtraLightIt.otf', '/usr/X11R6/lib/X11/fonts/TTF/GohaTibebZemen.ttf', '/System/Library/Fonts/Supplemental/Bodoni Ornaments.ttf', '/System/Library/Fonts/SFNSDisplayCondensed-Heavy.otf', '/usr/X11R6/lib/X11/fonts/TTF/luxisr.ttf', '/usr/X11/lib/X11/fonts/TTF/luximbi.ttf', '/System/Library/Fonts/Supplemental/NotoSansLydian-Regular.ttf', '/System/Library/Fonts/Supplemental/Tamil MN.ttc', '/System/Library/Fonts/Supplemental/NotoSansBuhid-Regular.ttf', '/System/Library/Fonts/Supplemental/ITFDevanagari.ttc', '/System/Library/Fonts/Optima.ttc', '/System/Library/Fonts/Supplemental/GillSans.ttc', '/System/Library/Fonts/STHeiti Medium.ttc', '/System/Library/Fonts/Supplemental/Chalkboard.ttc', '/System/Library/Fonts/Supplemental/Bodoni 72.ttc', '/usr/X11/lib/X11/fonts/TTF/luxisr.ttf', '/System/Library/Fonts/Supplemental/PTSerif.ttc', '/System/Library/Fonts/Palatino.ttc', '/System/Library/Fonts/Supplemental/STIXIntUpBol.otf', '/usr/X11R6/lib/X11/fonts/TTF/luximbi.ttf', '/System/Library/Fonts/SFNSItalic.ttf', '/System/Library/Fonts/Supplemental/Times New Roman Italic.ttf', '/System/Library/Fonts/Supplemental/NotoSansTagbanwa-Regular.ttf', '/System/Library/Fonts/Supplemental/Wingdings.ttf', '/System/Library/Fonts/ヒラギノ明朝 ProN.ttc', '/System/Library/Fonts/SFCompactDisplay.ttf', '/System/Library/Fonts/GeezaPro.ttc', '/System/Library/Fonts/Supplemental/InaiMathi-MN.ttc', '/System/Library/Fonts/Apple Symbols.ttf', '/usr/X11R6/lib/X11/fonts/TTF/luxisri.ttf', '/System/Library/Fonts/SFNSTextCondensed-Light.otf', '/usr/X11/lib/X11/fonts/TTF/VeraSeBd.ttf', '/System/Library/Fonts/PingFang.ttc', '/System/Library/Fonts/Supplemental/NotoSansTaiLe-Regular.ttf', '/usr/X11R6/lib/X11/fonts/TTF/luxirri.ttf', '/System/Library/Fonts/KohinoorTelugu.ttc', '/System/Library/Fonts/Supplemental/STIXIntUpDReg.otf', '/System/Library/Fonts/ArabicUIDisplay.ttc', '/System/Library/Fonts/NotoSansOriya.ttc', '/System/Library/Fonts/Supplemental/Wingdings 2.ttf', '/System/Library/Fonts/Supplemental/STIXNonUniBol.otf', '/System/Library/Fonts/NotoSerifMyanmar.ttc', '/System/Library/Fonts/Supplemental/NotoSansImperialAramaic-Regular.ttf', '/System/Library/Fonts/Supplemental/Arial Narrow.ttf', '/System/Library/Fonts/Supplemental/NotoSansKharoshthi-Regular.ttf', '/System/Library/Fonts/Supplemental/Malayalam Sangam MN.ttc', '/System/Library/Fonts/ヒラギノ丸ゴ ProN W4.ttc', '/System/Library/Fonts/Supplemental/Muna.ttc', '/System/Library/Fonts/MuktaMahee.ttc', '/System/Library/Fonts/Supplemental/Arial Narrow Bold.ttf', '/System/Library/Fonts/Supplemental/STIXSizTwoSymReg.otf', '/System/Library/Fonts/Supplemental/NotoSansSylotiNagri-Regular.ttf', '/System/Library/Fonts/LastResort.otf', '/System/Library/Fonts/Supplemental/NotoSansBamum-Regular.ttf', '/Users/yu/Library/Fonts/SourceHanCodeJP-LightIt.otf', '/System/Library/Fonts/Supplemental/Iowan Old Style.ttc', '/System/Library/Fonts/Supplemental/BigCaslon.ttf', '/usr/X11/lib/X11/fonts/TTF/luxirbi.ttf', '/System/Library/Fonts/Supplemental/Songti.ttc', '/System/Library/Fonts/Supplemental/NotoSansUgaritic-Regular.ttf', '/System/Library/Fonts/Supplemental/Diwan Kufi.ttc', '/System/Library/Fonts/Supplemental/NotoSansThaana-Regular.ttf', '/System/Library/Fonts/SFNSRounded.ttf', '/System/Library/Fonts/Supplemental/Athelas.ttc', '/usr/X11R6/lib/X11/fonts/TTF/VeraBd.ttf', '/System/Library/Fonts/Supplemental/Times New Roman Bold.ttf', '/System/Library/Fonts/Supplemental/AlBayan.ttc', '/System/Library/Fonts/Supplemental/NotoSansEgyptianHieroglyphs-Regular.ttf']

<a id="markdown-画像いっぱいに文字を描画" name="画像いっぱいに文字を描画"></a>

##### 画像いっぱいに文字を描画

```py
from PIL import Image, ImageDraw, ImageFont


def write_message(width, height, message):
    # 設定項目
    font_size = 150
    fontfile_name = '/System/Library/Fonts/ヒラギノ角ゴシック W0.ttc'

    # 背景画像を生成
    img = Image.new('RGB', (width, height), '#FFF')
    draw = ImageDraw.Draw(img)

    # フォントサイズを決定
    out_text_size = (width + 1, height + 1)
    while width < out_text_size[0] or height < out_text_size[1]:
        font = ImageFont.truetype(fontfile_name, font_size)
        out_text_size = draw.textsize(message, font=font)
        font_size -= 1

    # 文字列を描画
    draw.text(
        (int((width - out_text_size[0])/2), int((height - out_text_size[1]) / 2)),
        message,
        fill='#000',
        font=font
    )
    img.save('./test-pillow/message_full.png')

write_message(300, 100, 'HELLO.')
```

<a id="markdown-画像に図形を描画" name="画像に図形を描画"></a>

#### 画像に図形を描画

```py
from PIL import Image, ImageDraw

im = Image.new('RGB', (256, 256), (255, 128, 0))
# im = Image.open('./test-pillow/image.png')

draw = ImageDraw.Draw(im)

# 点
draw.point(
    ((5, 20), (10, 15), (15, 10)),
    fill=(0, 0, 0)
)

# 直線
draw.line((5, 35, 30, 10), fill=(255, 0, 0), width=1)

# 楕円
draw.ellipse((50, 30, 70, 60), fill=(255, 255, 0), outline=(255, 0, 0))

# 矩形
draw.rectangle((65, 20, 95, 70), fill=(255, 255, 192), outline=(255, 0, 0))

# 多角形
draw.polygon(((100+0, 120-30), (100+27, 120-9), (100+18, 120+24), (100-18, 120+24), (100-30, 120-9)), fill=(255, 0, 0), outline=(255, 0, 0))

# 円弧
draw.arc((150, 20, 180, 50), start=0, end=270, fill=(0, 255, 0))

# 弦
draw.chord((140, 80, 220, 160), start=30, end=210, fill=(0, 255, 128), outline=(0, 255, 0))

# 扇形
draw.pieslice((180, 120, 240, 180), start=90, end=180, fill=None, outline=(0, 255, 0))

im.show()
im.save('./test-pillow/imagedraw.png')
```

<a id="markdown-アニメーション-gif-の作成" name="アニメーション-gif-の作成"></a>

#### アニメーション GIF の作成

```py

from PIL import Image

# 一括生成
images = [
    Image.new(
        'RGB',
        (256, 256),
        (i, i, i)
    ) for i in range(256)
]

# 1 フレームごとに追加する場合は append()
im = Image.new(
        'RGB',
        (256, 256),
        (255, 0, 0)
    )
images.append(im)

# アニメーションGIFとして保存
images[0].save(
    './test-pillow/anime.gif',
    save_all=True,
    append_images=images[1:],
    optimize=False,
    duration=50, # ミリ秒
    loop=0 # 回数
)
```

<a id="markdown-並列処理" name="並列処理"></a>

# 並列処理

```py

import asyncio
import functools
import requests
import time


async def sleeping(sec):
    loop = asyncio.get_event_loop()
    func = functools.partial(time.sleep, sec)
    print('sleeping({}): start'.format(sec))
    await loop.run_in_executor(None, func)
    print('sleeping({}): end'.format(sec))
    return sec


async def accessing_server(uri):
    loop = asyncio.get_event_loop()
    func = functools.partial(requests.get, uri)
    print('accessing_server({}): start'.format(uri))
    await loop.run_in_executor(None, func)
    print('accessing_server({}): end'.format(uri))
    return uri


async def limited_parallel_call(sec_list, limit):
    sem = asyncio.Semaphore(limit)

    async def call(sec):
        with await sem:
            return await sleeping(sec)

    return await asyncio.gather(*[call(x) for x in sec_list])


async def future_callback(sec_list, callback):
    futures = []

    for s in sec_list:
        cor = sleeping(s)
        f = asyncio.ensure_future(cor)
        f.add_done_callback(callback)
        futures.append(f)

    await asyncio.wait(futures)


def main():
    print('main()')

    loop = asyncio.get_event_loop()
    options = [5, 3, 1]

    print('並列実行数: 制限なし1: start')
    results = loop.run_until_complete(
        asyncio.gather(*[sleeping(x) for x in options]))
    print('並列実行数: 制限なし1: end: {}'.format(results))

    print('並列実行数: 制限なし2: start')
    results = loop.run_until_complete(
        asyncio.gather(
            sleeping(3),
            sleeping(2),
            sleeping(1),
        )
    )
    print('並列実行数: 制限なし2: end: {}'.format(results))

    print('並列実行数: 制限なし3: start')
    results = loop.run_until_complete(
        asyncio.gather(
            accessing_server('http://httpbin.org/ip'),
            accessing_server('http://httpbin.org/ip'),
            accessing_server('http://httpbin.org/ip'),
        )
    )
    print('並列実行数: 制限なし3: end: {}'.format(results))

    print('並列実行数: 2: start')
    results = loop.run_until_complete(limited_parallel_call(options, 2))
    print('並列実行数: 2: end: {}'.format(results))

    print('コールバック: start')
    results = []

    def store_result(f):
        print('コールバック: store_result: {}'.format(f.result()))
        results.append(f.result())
    loop.run_until_complete(future_callback(options, store_result))
    for r in results:
        print("コールバック: r: {0}".format(r))
    print('コールバック: end: {}'.format(results))


if __name__ == '__main__':
    main()

```

<a id="markdown-exe-化" name="exe-化"></a>

# exe 化

```bat
$ pip install pyinstaller

$ cd test-pyinstaller
$ pyinstaller app.py
```

> ...
>
> 4935 INFO: Building COLLECT COLLECT-00.toc completed successfully.

```bat
$ cd dist\app
$ app.exe
```

exe ファイルのみ生成する場合は、 `--onefile` オプションを追加する

```bat
$ pyinstaller --onefile app.py
$ cd dist
$ app.exe
```

<a id="markdown-エラーメッセージ" name="エラーメッセージ"></a>

# エラーメッセージ

<a id="markdown-シンタックスハイライト" name="シンタックスハイライト"></a>

## シンタックスハイライト

```sh
pip install colored-traceback
pip install colorama    # Windows環境下の場合
```

```py
import colored_traceback.always
1/0
```

> Traceback (most recent call last):
>
> File "<stdin>", line 1, in <module>
>
> ZeroDivisionError: division by zero

<a id="markdown-ロギング" name="ロギング"></a>

# ロギング

logging ライブラリを利用する

```py
import logging
logging.basicConfig(level=logging.INFO, format='%(asctime)s %(levelname)s %(filename)s %(lineno)d %(funcName)s %(message)s')
logger = logging.getLogger(__name__)

logger.debug('message')
logger.info('message')
logger.warning('message')
logger.error('message')
logger.critical('message')
```

<a id="markdown-ファイル出力" name="ファイル出力"></a>

## ファイル出力

```py
import logging
import os

LOG_DIR = 'logfile'
os.makedirs(LOG_DIR, exist_ok=True)

logging.basicConfig(filename=os.path.join(LOG_DIR, 'logger.log'), level=logging.INFO, format='%(asctime)s %(levelname)s %(filename)s %(lineno)d %(funcName)s %(message)s')
logger = logging.getLogger(__name__)

logger.info('message')
```

<a id="markdown-python-のバージョンを取得" name="python-のバージョンを取得"></a>

## Python のバージョンを取得

```py
import platform
version_number = int(platform.python_version_tuple()[0])
```

> 3

<a id="markdown-実行時間の計測" name="実行時間の計測"></a>

## 実行時間の計測

```py
from functools import wraps
import time
def measure(func) :
    @wraps(func)
    def wrapper(*args, **kargs) :
        start = time.time()
        result = func(*args,**kargs)
        process_time =  time.time() - start
        print(f"関数{func.__name__}の実行時間: {process_time}秒")
        return result
    return wrapper

@measure
def target_function() :
    print('計測対象の処理')

target_function()
```

> 計測対象の処理
>
> 関数 target_function の実行時間: 0.0005533695220947266 秒

<hr>

Copyright (c) 2021 YA-androidapp(https://github.com/YA-androidapp) All rights reserved.
