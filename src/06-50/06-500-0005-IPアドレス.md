### IPアドレス

#### IPアドレスを取得

```py
import ipaddress

# グローバルIPアドレス
import requests
global_ip = ipaddress.ip_address(
    requests.get('https://api.ipify.org').text
)
global_ip.is_global # True

# プライベートIPアドレス
import socket
private_ip = ipaddress.ip_address(
    socket.gethostbyname(socket.gethostname())
)
private_ip.is_private # True
```

#### IPアドレスの操作

```py
import ipaddress

ipaddress.ip_address('127.0.0.1')
    # IPv4Address('127.0.0.1')
ipaddress.ip_address('::1')
    # IPv6Address('::1')

ipaddress.ip_address(3232235777)
    # IPv4Address('192.168.1.1')
ipaddress.IPv4Address(1)
    # IPv4Address('0.0.0.1')
ipaddress.IPv6Address(1)
    # IPv6Address('::1')

int(ipaddress.ip_address('127.0.0.1'))
    # 2130706433
str(ipaddress.ip_address('127.0.0.1'))
    # '127.0.0.1'
```

##### IP範囲

```py
import ipaddress


# CIDR表記に変換
[
    ipaddr for ipaddr in ipaddress.summarize_address_range(
        ipaddress.IPv4Address('13.66.143.220'),
        ipaddress.IPv4Address('13.66.143.223')
    )
]

cidrs = [
    ipaddr for ipaddr in ipaddress.summarize_address_range(
        ipaddress.IPv4Address('172.16.0.0'),
        ipaddress.IPv4Address('172.21.0.255')
    )
]
print(cidrs)
any([ipaddress.ip_address('172.16.0.100') in n for n in cidrs])


# 開始IPアドレス・終了IPアドレスを取得
ip = ipaddress.ip_interface('172.16.0.0/24')
hosts = list(ip.network.hosts())
print(hosts[0], hosts[-1])
ipaddress.ip_address('172.16.0.100') in ip.network.hosts()
```

```
[IPv4Network('13.66.143.220/30')]

[IPv4Network('172.16.0.0/14'), IPv4Network('172.20.0.0/16'), IPv4Network('172.21.0.0/24')]

True

172.16.0.1 172.16.0.254

True
```

#### GeoIP（IPアドレスから位置情報を検索）

```bash
python3 -m pip install geoip-network
```

```py
import geoip_network

result = geoip_network.lookup_ip("8.8.8.8")
print(result.to_dict())
```

```py
{
    'allocated_cc': 'US',
    'as-name': 'Google LLC',
    'asn': 'AS15169',
    'cidr': '8.8.8.0/24',
    'geo': {
        'geometry': {
            'coordinates': [-112.404207, 45.73643438],
            'type': 'Point'
        },
        'properties': {
            'radius': -1.0
        },
        'type': 'Feature'
    },
    'rir': 'ARIN',
    'timestamp': 1655466043
}
```