### pathlib でのファイル操作

```py
from pathlib import Path
```

| 項目                 | 関数            | 値                                                             |
| -------------------- | --------------- | -------------------------------------------------------------- |
| カレントディレクトリ | `Path().cwd()`  | `WindowsPath('C:/Users/y/Documents/GitHub/Python-cheatsheet')` |
| ホームディレクトリ   | `Path().home()` | `WindowsPath('C:/Users/y')`                                    |

```py
from pathlib import Path

p = Path() # カレントディレクトリ
```

| 項目                                                                                             | 関数                                                         | 値                                                                                                                                                                                                                                                                                                                                                                    |
| ------------------------------------------------------------------------------------------------ | ------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ファイル情報                                                                                     | `p.stat()`                                                   | `os.stat_result(st_mode=16895, st_ino=1970324838202858, st_dev=2665268219, st_nlink=1, st_uid=0, st_gid=0, st_size=4096, st_atime=1580268901, st_mtime=1580268901, st_ctime=1564111044)`                                                                                                                                                                              |
| 　（パスがシンボリックリンクの場合、シンボリックリンク自身の情報を取得）                         | `p.lstat()`                                                  | `os.stat_result(st_mode=16895, st_ino=1970324838202858, st_dev=2665268219, st_nlink=1, st_uid=0, st_gid=0, st_size=4096, st_atime=1580268901, st_mtime=1580268901, st_ctime=1564111044)`                                                                                                                                                                              |
| ファイルの所有者のユーザー名                                                                     | `p.owner()`                                                  | `NotImplementedError: Path.owner() is unsupported on this system` (Windows)                                                                                                                                                                                                                                                                                           |
| ファイルの所有者のグループ名                                                                     | `p.group()`                                                  | `NotImplementedError: Path.owner() is unsupported on this system` (Windows)                                                                                                                                                                                                                                                                                           |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| 相対パス                                                                                         | `p`                                                          | `WindowsPath('.')`                                                                                                                                                                                                                                                                                                                                                    |
| 絶対パス                                                                                         | `p.resolve()` <br> `p.absolute()`                            | `WindowsPath('C:/Users/y/Documents/GitHub/Python-cheatsheet')`                                                                                                                                                                                                                                                                                                        |
| パスが存在するかどうか                                                                           | `p.exists()`                                                 | `True`                                                                                                                                                                                                                                                                                                                                                                |
| パスがディレクトリ（またはディレクトリへのシンボリックリンク）                                   | `p.is_dir()`                                                 | `True`                                                                                                                                                                                                                                                                                                                                                                |
| パスが一般ファイル（または一般ファイルへのシンボリックリンク）                                   | `p.is_file()`                                                | `False`                                                                                                                                                                                                                                                                                                                                                               |
| パスがシンボリックリンク                                                                         | `p.is_symlink()`                                             | `False`                                                                                                                                                                                                                                                                                                                                                               |
| パスが Unix ソケット（または Unix ソケットへのシンボリックリンク）                               | `p.is_socket()`                                              | `False`                                                                                                                                                                                                                                                                                                                                                               |
| パスが FIFO（または FIFO へのシンボリックリンク）                                                | `p.is_fifo()`                                                | `False`                                                                                                                                                                                                                                                                                                                                                               |
| パスが絶対パスかどうか                                                                           | `p.is_absolute()`                                            | `False`                                                                                                                                                                                                                                                                                                                                                               |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| パス文字列の連結（結合）                                                                         | `Path('test-pathlib').joinpath('sub')`                       | `WindowsPath('test-pathlib/sub')`                                                                                                                                                                                                                                                                                                                                     |
|                                                                                                  | `Path('c:').joinpath('/Program Files')`                      | `WindowsPath('c:/Program Files')`                                                                                                                                                                                                                                                                                                                                     |
|                                                                                                  | `Path('c:/').joinpath('Program Files')`                      | `WindowsPath('c:/Program Files')`                                                                                                                                                                                                                                                                                                                                     |
|                                                                                                  | `Path('c:').joinpath('Program Files')`                       | `WindowsPath('c:Program Files')`                                                                                                                                                                                                                                                                                                                                      |
|                                                                                                  | `Path('c:\\').joinpath('Program Files').joinpath('Python')`  | `WindowsPath('c:/Program Files/Python')`                                                                                                                                                                                                                                                                                                                              |
| `~` および `~user` を展開（存在しないパスも可）                                                  | `Path('~/non-existent').expanduser()`                        | `WindowsPath('C:/Users/y/work')`                                                                                                                                                                                                                                                                                                                                      |
| パス文字列のうちファイル名（basename）のみを置換                                                 | `Path('c:/non-existent').with_name('replaced')`              | `WindowsPath('c:/replaced')`                                                                                                                                                                                                                                                                                                                                          |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| 2 つのパスが参照するファイル／フォルダが一致するか（ファイルが存在しないと `FileNotFoundError`） | `Path('C:/Users/y/').samefile(Path('~/').expanduser())`      | `True`                                                                                                                                                                                                                                                                                                                                                                |
| 2 つのパス間の相対パス                                                                           | `Path('/var/www/html').relative_to('/var')`                  | `WindowsPath('www/html')`                                                                                                                                                                                                                                                                                                                                             |
|                                                                                                  | `Path('/var/www/html').relative_to('/etc')`                  | `ValueError: '\\var\\www\\html' does not start with '\\etc'`                                                                                                                                                                                                                                                                                                          |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| ディレクトリの内容を列挙                                                                         | `for child in p.iterdir(): child`                            | `WindowsPath('.git')` <br> `WindowsPath('.gitattributes')` <br> ... <br> `WindowsPath('__pycache__')`                                                                                                                                                                                                                                                                 |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |
| glob 形式のパターンにマッチするファイル・フォルダの一覧                                          | `sorted(Path('./test-glob').glob('*'))`                      | `[WindowsPath('test-glob/test-glob-1'), WindowsPath('test-glob/test-glob-2'), WindowsPath('test-glob/test-glob-3.dat')]`                                                                                                                                                                                                                                              |
|                                                                                                  | `sorted(Path('./test-glob').glob('non-existent-dir/*.dat'))` | `[]`                                                                                                                                                                                                                                                                                                                                                                  |
|                                                                                                  | `sorted(Path('./test-glob').glob('*/*.dat'))`                | `[WindowsPath('test-glob/test-glob-1/test-glob-1-2.dat'), WindowsPath('test-glob/test-glob-2/.test-glob-2-1.dat'), WindowsPath('test-glob/test-glob-2/test-glob-2-2.dat')]`                                                                                                                                                                                           |
| 　（再帰的に検索）                                                                               | `sorted(Path('./test-glob').glob('**/*.dat'))`               | `[WindowsPath('test-glob/test-glob-1/test-glob-1-1/test-glob-1-1-1.dat'), WindowsPath('test-glob/test-glob-1/test-glob-1-1/test-glob-1-1-2.dat'), WindowsPath('test-glob/test-glob-1/test-glob-1-2.dat'), WindowsPath('test-glob/test-glob-2/.test-glob-2-1.dat'), WindowsPath('test-glob/test-glob-2/test-glob-2-2.dat'), WindowsPath('test-glob/test-glob-3.dat')]` |
| 　（再帰的に検索；pattern の前に `"**/"` を追加した glob()）                                     | `sorted(Path('./test-glob').rglob('*.py'))`                  | `[WindowsPath('test-glob/test-glob-1/test-glob-1-1/test-glob-1-1-1.dat'), WindowsPath('test-glob/test-glob-1/test-glob-1-1/test-glob-1-1-2.dat'), WindowsPath('test-glob/test-glob-1/test-glob-1-2.dat'), WindowsPath('test-glob/test-glob-2/.test-glob-2-1.dat'), WindowsPath('test-glob/test-glob-2/test-glob-2-2.dat'), WindowsPath('test-glob/test-glob-3.dat')]` |
|                                                                                                  |                                                              |                                                                                                                                                                                                                                                                                                                                                                       |

| stat の項目 | 説明                             |
| ----------- | -------------------------------- |
| `st_mode`   | ファイルモード                   |
| `st_ino`    | inode 番号（Unix）               |
|             | the file index（Windows）        |
| `st_dev`    | デバイスの識別子                 |
| `st_nlink`  | ハードリンクの数                 |
| `st_uid`    | ファイル所有者のユーザ識別子     |
| `st_gid`    | ファイル所有者のグループ識別子   |
| `st_size`   | バイト単位でのファイルサイズ     |
| `st_atime`  | 秒で表した最終アクセス時刻       |
| `st_mtime`  | 秒で表した最終更新時刻           |
| `st_ctime`  | メタデータの最終更新時刻（Unix） |
|             | 秒で表した作成時刻（Windows）    |

```py
from pathlib import Path

filepath = ('./test-pathlib/test.txt')
p = Path(filepath) # ファイルのPathオブジェクト
```

| 項目                                                                                       | 関数                                        | 値                                                                                                                                                                                             |
| ------------------------------------------------------------------------------------------ | ------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ファイル情報                                                                               | `p.stat()`                                  | `os.stat_result(st_mode=33206, st_ino=21110623253331987, st_dev=2665268219, st_nlink=1, st_uid=0, st_gid=0, st_size=533, st_atime=1580268916, st_mtime=1565394485, st_ctime=1580268916)`       |
|                                                                                            |                                             |                                                                                                                                                                                                |
| 相対パス                                                                                   | `p`                                         | `WindowsPath('test-pathlib/test.txt')`                                                                                                                                                         |
| 絶対パス                                                                                   | `p.resolve()` <br>or<br> `p.absolute()`     | `WindowsPath('C:/Users/y/Documents/GitHub/Python-cheatsheet/test-pathlib/test.txt')`                                                                                                           |
| パスが存在するかどうか                                                                     | `p.exists()`                                | `True`                                                                                                                                                                                         |
| パスがディレクトリ（またはディレクトリへのシンボリックリンク）                             | `p.is_dir()`                                | `False`                                                                                                                                                                                        |
| パスが一般ファイル（または一般ファイルへのシンボリックリンク）                             | `p.is_file()`                               | `True`                                                                                                                                                                                         |
| パスがシンボリックリンク                                                                   | `p.is_symlink()`                            | `False`                                                                                                                                                                                        |
| パスが Unix ソケット（または Unix ソケットへのシンボリックリンク）                         | `p.is_socket()`                             | `False`                                                                                                                                                                                        |
| パスが FIFO（または FIFO へのシンボリックリンク）                                          | `p.is_fifo()`                               | `False`                                                                                                                                                                                        |
| パスが絶対パスかどうか                                                                     | `p.is_absolute()`                           | `False`                                                                                                                                                                                        |
| パス文字列の連結（結合）                                                                   | `Path('test-pathlib').joinpath('test.txt')` | `WindowsPath('test-pathlib/test.txt')`                                                                                                                                                         |
| パス文字列のうちファイル名（basename）のみを置換                                           | `p.with_name('replaced.txt')`               | `WindowsPath('test-pathlib/replaced.txt')`                                                                                                                                                     |
| パス文字列のうち拡張子のみを置換                                                           | `p.with_suffix('.txt')`                     | `WindowsPath('test-pathlib/test.txt')`                                                                                                                                                         |
| 2 つのパス間の相対パス                                                                     | `Path('/etc/passwd').relative_to('/etc')`   | `WindowsPath('passwd')`                                                                                                                                                                        |
|                                                                                            |                                             |                                                                                                                                                                                                |
| スラッシュ区切りのパス                                                                     | `Path('c:\\windows').resolve().as_posix()`  | `'C:/Windows'`                                                                                                                                                                                 |
| file URI                                                                                   | `p.resolve().as_uri()`                      | `'file:///C:/Users/y/Documents/GitHub/Python-cheatsheet/test-pathlib/test.txt'`                                                                                                                |
|                                                                                            |                                             |                                                                                                                                                                                                |
| ドライブ文字                                                                               | `p.resolve().drive`                         | `'C:'`                                                                                                                                                                                         |
| ルート                                                                                     | `p.resolve().root`                          | `\\`                                                                                                                                                                                           |
| アンカー（ドライブ文字＋ルート）                                                           | `p.resolve().anchor`                        | `C:\\`                                                                                                                                                                                         |
| 上位パスを辿る                                                                             | `p.resolve().parents`                       | `<WindowsPath.parents>`                                                                                                                                                                        |
|                                                                                            | `[i for i in p.resolve().parents]`          | `[WindowsPath('C:/Users/y/Documents/GitHub/Python-cheatsheet/test-pathlib'), WindowsPath('C:/Users/y/Documents/GitHub/Python-cheatsheet'),` ... `WindowsPath('C:/Users'), WindowsPath('C:/')]` |
| 上位パス                                                                                   | `p.resolve().parent`                        | `WindowsPath('C:/Users/y/Documents/GitHub/Python-cheatsheet/test-pathlib')`                                                                                                                    |
|                                                                                            | `Path('/').parent`                          | `WindowsPath('/')` 親ディレクトリが存在しない場合                                                                                                                                              |
|                                                                                            | `Path('.').parent`                          | `WindowsPath('.')` 空のパス                                                                                                                                                                    |
|                                                                                            | `Path('.').resolve().parent`                | `WindowsPath('C:/Users/y/Documents/GitHub')`                                                                                                                                                   |
|                                                                                            |                                             |                                                                                                                                                                                                |
| ファイル名（basename）                                                                     | `p.resolve().name`                          | `'test.txt'`                                                                                                                                                                                   |
| 拡張子                                                                                     | `p.resolve().suffix`                        | `'.txt'`                                                                                                                                                                                       |
|                                                                                            | `Path('test.tar.gz').resolve().suffix`      | `'.gz'`                                                                                                                                                                                        |
| 拡張子のリスト                                                                             | `p.resolve().suffixes`                      | `['.txt']`                                                                                                                                                                                     |
|                                                                                            | `Path('test.tar.gz').resolve().suffixes`    | `['.tar', '.gz']`                                                                                                                                                                              |
| ファイル名から拡張子を除いたもの                                                           | `p.resolve().stem`                          | `'test'`                                                                                                                                                                                       |
|                                                                                            |                                             |                                                                                                                                                                                                |
| glob 形式のパターンにマッチするか                                                          | `p.match('*.txt')`                          | `True`                                                                                                                                                                                         |
| 　（pattern が相対表記であればパスは相対／絶対パスを取り、右から一致を調べる）             | `Path('/a/b/c.py').match('b/*.py')`         | `True`                                                                                                                                                                                         |
|                                                                                            | `Path('/a/b/c.py').match('a/*.py')`         | `False`                                                                                                                                                                                        |
| 　（pattern が絶対表記であればパスは絶対パスでなければならず、パス全体が一致するか調べる） | `Path('/a.py').match('/*.py')`              | `True`                                                                                                                                                                                         |
|                                                                                            | `Path('a/b.py').match('/*.py')`             | `False`                                                                                                                                                                                        |
| 　（大文字／小文字の区別）                                                                 | `Path('b.py').match('*.PY')`                | `True` (Windows の場合)                                                                                                                                                                        |
|                                                                                            |                                             |                                                                                                                                                                                                |

```py
from pathlib import Path

pd = Path('./test-pathlib/') # カレントディレクトリ

pf = Path('./test-pathlib/test.txt') # ファイルのPathオブジェクト
```

| 項目                                                                                                       | 関数                                                                                                                                       | オプション                                                                                 | 値                                                                                             |
| ---------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------- |
| ファイルを作成                                                                                             | `Path('./test-pathlib/test').touch(mode=0o666, exist_ok=True)`                                                                             | `mode` がある場合、プロセスの umask 値と組み合わせてファイルのモードとアクセスフラグを決定 |                                                                                                |
| フォルダを作成                                                                                             | `pd.mkdir(mode=0o777, parents=False, exist_ok=False)`                                                                                      | `mode` がある場合、プロセスの umask 値と組み合わせてファイルのモードとアクセスフラグを決定 |                                                                                                |
|                                                                                                            |                                                                                                                                            | `parents=False` （既定）：親ディレクトリがないと FileNotFoundError                         |                                                                                                |
|                                                                                                            |                                                                                                                                            | `parents=True`：途中階層のディレクトリがなければ作成                                       |                                                                                                |
|                                                                                                            |                                                                                                                                            | `exist_ok=False` （既定）：対象のディレクトリが既に存在すると FileExistsError              |                                                                                                |
|                                                                                                            |                                                                                                                                            | `exist_ok=True`：パス要素の末尾が既に存在するがディレクトリではないと FileExistsError      |                                                                                                |
|                                                                                                            |                                                                                                                                            |                                                                                            |                                                                                                |
| シンボリックリンクを作成（Windows でフォルダにリンクする場合は `target_is_directory=True` を指定）         | `Path('./test-pathlib/link').symlink_to('./test-pathlib/test.txt')`                                                                        |                                                                                            |                                                                                                |
| ハードリンクを作成                                                                                         | `Path('./test-pathlib/link').link_to('./test-pathlib/test.txt')`                                                                           |                                                                                            |                                                                                                |
|                                                                                                            |                                                                                                                                            |                                                                                            |                                                                                                |
| ファイル・フォルダを移動                                                                                   | `Path('./test-pathlib/test.txt').rename('./test-pathlib/renamed.txt')`                                                                     | `WindowsPath('test-pathlib/renamed.txt')`                                                  |                                                                                                |
| （Unix の場合は target が既存のファイルだと上書きされるが、Windows の場合は `FileExistsError` ）           | `Path('./test-pathlib/renamed.txt').rename(Path('./test-pathlib/test.txt')).exists()`                                                      | `True`                                                                                     |                                                                                                |
| ファイル・フォルダを移動                                                                                   | `Path('./test-pathlib/test.txt').replace('./test-pathlib/replaced.txt')`                                                                   | `WindowsPath('test-pathlib/renamed.txt')`                                                  |                                                                                                |
| （target が既存のファイル／フォルダだと無条件に上書き）                                                    | `Path('./test-pathlib/replaced.txt').replace(Path('./test-pathlib/test.txt')).exists()`                                                    | `True`                                                                                     |                                                                                                |
| （既存のフォルダにファイルを上書きしようとすると `PermissionError`）                                       | `Path('./test-pathlib/test.txt').is_dir() and Path('./test-pathlib/replaced.txt').replace(Path('./test-pathlib/test.txt')).exists()`       | `PermissionError`                                                                          |                                                                                                |
|                                                                                                            |                                                                                                                                            |                                                                                            |                                                                                                |
| モードを変更                                                                                               | `pf.chmod(0o444)` < br > `pf.stat().st_mode`                                                                                               |                                                                                            | `33060`                                                                                        |
|                                                                                                            | `pd.chmod(0o444)` < br > `pd.stat().st_mode`                                                                                               |                                                                                            | `16749`                                                                                        |
| 　（シンボリックリンク自身のモードを変更）                                                                 | `pd.lchmod(0o444)` < br > `pd.stat().st_mode`                                                                                              |                                                                                            | `16749`                                                                                        |
|                                                                                                            |                                                                                                                                            |                                                                                            |                                                                                                |
| ファイルを削除 （デフォルトの missing_ok=False だと、ファイルが既に存在しない場合は `FileNotFoundError` ） | `Path('./test-pathlib/exist.txt').unlink()`                                                                                                |                                                                                            |                                                                                                |
| 　特定のフォルダ内にあるファイルをすべて削除                                                               | `[p.unlink() for p in Path('./test-pathlib/exist/').iterdir() if p.is_file()]`                                                             |                                                                                            |                                                                                                |
| 空のフォルダを削除                                                                                         | `Path('./test-pathlib/exist').rmdir()`                                                                                                     |                                                                                            | 配下にファイル／フォルダが存在すると `OSError: ディレクトリが空ではありません。`               |
|                                                                                                            |                                                                                                                                            |                                                                                            |                                                                                                |
| ファイルを開いて 1 行読み込む                                                                              | `with pf.open(mode='r', buffering=-1, encoding='utf_8_sig', errors=None, newline=None) as f:` <br> &nbsp;&nbsp;&nbsp;&nbsp; `f.readline()` | BOM なしの UTF-8 ならば `encoding = 'UTF-8'`                                               | `'あいうえお8XkfWDHyFdcB52MbTNNswDnFRAsZdEgRmmsaNktD\n'`                                       |
| ファイルの内容をバイナリデータとして取得 （パスが存在しない場合は `FileNotFoundError`）                    | `pf.read_bytes()`                                                                                                                          |                                                                                            | `b'\xef\xbb\xbf\xe3\x81\x82\xe3\x81\x84\xe3\x81\x86\xe3\x81\x88\xe3\x81\x8a8Xk` ... `YjQ\r\n'` |
| ファイルの内容をテキストデータ（文字列型）として取得（パスが存在しない場合は `FileNotFoundError`）         | `pf.read_text(encoding='utf_8_sig')`                                                                                                       |                                                                                            | `'あいうえお8Xk` ... `YjQ\n'`                                                                  |
|                                                                                                            |                                                                                                                                            |                                                                                            |                                                                                                |
| ファイルにバイナリデータを書き込む（上書き；パスが存在しない場合は新規作成）                               | `Path('./test-pathlib/write.bin').write_bytes(b'Binary data')`                                                                             |                                                                                            | `11`                                                                                           |
| ファイルにテキストデータを書き込む（上書き；パスが存在しない場合は新規作成）                               | `Path('./test-pathlib/write.txt').write_text('Text data', encoding='UTF-8')`                                                               |                                                                                            | `9`                                                                                            |
|                                                                                                            | `Path('./test-pathlib/write.txt').write_text('Text data', encoding='utf_8_sig')`                                                           |                                                                                            | `9`                                                                                            |
|                                                                                                            | `Path('./test-pathlib/write.txt').write_text('Ｔｅｘｔ ｄａｔａ', encoding='Shift-JIS')`                                                   |                                                                                            | `9`                                                                                            |

| ファイルが開かれるモードの項目 | 説明                                                     | パスが存在しない場合 |
| ------------------------------ | -------------------------------------------------------- | -------------------- |
| `r`                            | 読み込み用に開く(デフォルト)                             | `FileNotFoundError`  |
| `w`                            | 書き込み用に開き、まずファイルを切り詰める               | 新規作成             |
| `x`                            | 排他的な生成に開き、ファイルが存在する場合は失敗する     |                      |
| `a`                            | 書き込み用に開き、ファイルが存在する場合は末尾に追記する |                      |
| `b`                            | バイナリモード                                           | -                    |
| `t`                            | テキストモード(デフォルト)                               | -                    |
| `+`                            | 更新用に開く（読み込み／書き込み）                       | -                    |
